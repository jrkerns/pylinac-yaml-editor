"use strict";(self.webpackChunkpylinac_yaml_editor=self.webpackChunkpylinac_yaml_editor||[]).push([[4482,4830],{8436:(e,r,n)=>{function t(e,r){const n=[],t=[];for(const t of e)r.has(t)||n.push(t);for(const n of r)e.has(n)||t.push(n);return{removed:n,added:t}}function i(e,r){const n=new Set;for(const t of r)e.has(t)&&n.add(t);return n}n.d(r,{E:()=>i,Z:()=>t})},6459:(e,r,n)=>{n.d(r,{A:()=>o});var t,i=n(6844);!function(e){e[e.Ignore=0]="Ignore",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(t||(t={})),function(e){const r="error",n="warning",t="info";e.fromValue=function(o){return o?i.Q_(r,o)?e.Error:i.Q_(n,o)||i.Q_("warn",o)?e.Warning:i.Q_(t,o)?e.Info:e.Ignore:e.Ignore},e.toString=function(i){switch(i){case e.Error:return r;case e.Warning:return n;case e.Info:return t;default:return"ignore"}}}(t||(t={}));const o=t},11:(e,r,n)=>{n.r(r),n.d(r,{MarkerDecorationsService:()=>p});var t=n(0),i=n(998),o=n(6055),s=n(9044),a=n(8295),c=n(4830),u=n(8061),d=n(3072),h=n(2106),l=n(559),g=n(7992),m=n(8436),f=function(e,r){return function(n,t){r(n,t,e)}};let p=class extends i.jG{constructor(e,r){super(),this._markerService=r,this._onDidChangeMarker=this._register(new h.vl),this._markerDecorations=new g.fT,e.getModels().forEach((e=>this._onModelAdded(e))),this._register(e.onModelAdded(this._onModelAdded,this)),this._register(e.onModelRemoved(this._onModelRemoved,this)),this._register(this._markerService.onMarkerChanged(this._handleMarkerChange,this))}dispose(){super.dispose(),this._markerDecorations.forEach((e=>e.dispose())),this._markerDecorations.clear()}getMarker(e,r){const n=this._markerDecorations.get(e);return n&&n.getMarker(r)||null}_handleMarkerChange(e){e.forEach((e=>{const r=this._markerDecorations.get(e);r&&this._updateDecorations(r)}))}_onModelAdded(e){const r=new _(e);this._markerDecorations.set(e.uri,r),this._updateDecorations(r)}_onModelRemoved(e){const r=this._markerDecorations.get(e.uri);r&&(r.dispose(),this._markerDecorations.delete(e.uri)),e.uri.scheme!==d.ny.inMemory&&e.uri.scheme!==d.ny.internal&&e.uri.scheme!==d.ny.vscode||this._markerService?.read({resource:e.uri}).map((e=>e.owner)).forEach((r=>this._markerService.remove(r,[e.uri])))}_updateDecorations(e){const r=this._markerService.read({resource:e.model.uri,take:500});e.update(r)&&this._onDidChangeMarker.fire(e.model)}};p=function(e,r,n,t){var i,o=arguments.length,s=o<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,n,t);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(r,n,s):i(r,n))||s);return o>3&&s&&Object.defineProperty(r,n,s),s}([f(0,c.IModelService),f(1,t.DR)],p);class _ extends i.jG{constructor(e){super(),this.model=e,this._map=new g.cO,this._register((0,i.s)((()=>{this.model.deltaDecorations([...this._map.values()],[]),this._map.clear()})))}update(e){const{added:r,removed:n}=(0,m.Z)(new Set(this._map.keys()),new Set(e));if(0===r.length&&0===n.length)return!1;const t=n.map((e=>this._map.get(e))),i=r.map((e=>({range:this._createDecorationRange(this.model,e),options:this._createDecorationOption(e)}))),o=this.model.deltaDecorations(t,i);for(const e of n)this._map.delete(e);for(let e=0;e<o.length;e++)this._map.set(r[e],o[e]);return!0}getMarker(e){return this._map.getKey(e.id)}_createDecorationRange(e,r){let n=u.Q.lift(r);if(r.severity!==t.cj.Hint||this._hasMarkerTag(r,1)||this._hasMarkerTag(r,2)||(n=n.setEndPosition(n.startLineNumber,n.startColumn+2)),n=e.validateRange(n),n.isEmpty()){const r=e.getLineLastNonWhitespaceColumn(n.startLineNumber)||e.getLineMaxColumn(n.startLineNumber);if(1===r||n.endColumn>=r)return n;const t=e.getWordAtPosition(n.getStartPosition());t&&(n=new u.Q(n.startLineNumber,t.startColumn,n.endLineNumber,t.endColumn))}else if(r.endColumn===Number.MAX_VALUE&&1===r.startColumn&&n.startLineNumber===n.endLineNumber){const t=e.getLineFirstNonWhitespaceColumn(r.startLineNumber);t<n.endColumn&&(n=new u.Q(n.startLineNumber,t,n.endLineNumber,n.endColumn),r.startColumn=t)}return n}_createDecorationOption(e){let r,n,i,c,u;switch(e.severity){case t.cj.Hint:r=this._hasMarkerTag(e,2)?void 0:this._hasMarkerTag(e,1)?"squiggly-unnecessary":"squiggly-hint",i=0;break;case t.cj.Info:r="squiggly-info",n=(0,s.Yf)(a.AQ),i=10,u={color:(0,s.Yf)(l.KoI),position:1};break;case t.cj.Warning:r="squiggly-warning",n=(0,s.Yf)(a.aZ),i=20,u={color:(0,s.Yf)(l.uMG),position:1};break;case t.cj.Error:default:r="squiggly-error",n=(0,s.Yf)(a.yI),i=30,u={color:(0,s.Yf)(l.yLC),position:1}}return e.tags&&(-1!==e.tags.indexOf(1)&&(c="squiggly-inline-unnecessary"),-1!==e.tags.indexOf(2)&&(c="squiggly-inline-deprecated")),{description:"marker-decoration",stickiness:1,className:r,showIfCollapsed:!0,overviewRuler:{color:n,position:o.A5.Right},minimap:u,zIndex:i,inlineClassName:c}}_hasMarkerTag(e,r){return!!e.tags&&e.tags.indexOf(r)>=0}}},4830:(e,r,n)=>{n.r(r),n.d(r,{IModelService:()=>t});const t=(0,n(2399).u1)("modelService")},2399:(e,r,n)=>{var t;n.d(r,{_$:()=>t,_Y:()=>i,u1:()=>o}),function(e){e.serviceIds=new Map,e.DI_TARGET="$di$target",e.DI_DEPENDENCIES="$di$dependencies",e.getServiceDependencies=function(r){return r[e.DI_DEPENDENCIES]||[]}}(t||(t={}));const i=o("instantiationService");function o(e){if(t.serviceIds.has(e))return t.serviceIds.get(e);const r=function(e,n,i){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(e,r,n){r[t.DI_TARGET]===r?r[t.DI_DEPENDENCIES].push({id:e,index:n}):(r[t.DI_DEPENDENCIES]=[{id:e,index:n}],r[t.DI_TARGET]=r)}(r,e,i)};return r.toString=()=>e,t.serviceIds.set(e,r),r}},1460:(e,r,n)=>{n.d(r,{F:()=>o});var t=n(2106),i=n(7167);const o={JSONContribution:"base.contributions.json"},s=new class{constructor(){this._onDidChangeSchema=new t.vl,this.schemasById={}}registerSchema(e,r){var n;this.schemasById[(n=e,n.length>0&&"#"===n.charAt(n.length-1)?n.substring(0,n.length-1):n)]=r,this._onDidChangeSchema.fire(e)}notifySchemaChanged(e){this._onDidChangeSchema.fire(e)}};i.O.add(o.JSONContribution,s)},0:(e,r,n)=>{n.d(r,{DR:()=>c,cj:()=>t,oc:()=>i});var t,i,o=n(6459),s=n(9746),a=n(2399);!function(e){e[e.Hint=1]="Hint",e[e.Info=2]="Info",e[e.Warning=4]="Warning",e[e.Error=8]="Error"}(t||(t={})),function(e){e.compare=function(e,r){return r-e};const r=Object.create(null);r[e.Error]=(0,s.kg)("sev.error","Error"),r[e.Warning]=(0,s.kg)("sev.warning","Warning"),r[e.Info]=(0,s.kg)("sev.info","Info"),e.toString=function(e){return r[e]||""},e.fromSeverity=function(r){switch(r){case o.A.Error:return e.Error;case o.A.Warning:return e.Warning;case o.A.Info:return e.Info;case o.A.Ignore:return e.Hint}},e.toSeverity=function(r){switch(r){case e.Error:return o.A.Error;case e.Warning:return o.A.Warning;case e.Info:return o.A.Info;case e.Hint:return o.A.Ignore}}}(t||(t={})),function(e){const r="";function n(e,n){const i=[r];return e.source?i.push(e.source.replace("¦","\\¦")):i.push(r),e.code?"string"==typeof e.code?i.push(e.code.replace("¦","\\¦")):i.push(e.code.value.replace("¦","\\¦")):i.push(r),void 0!==e.severity&&null!==e.severity?i.push(t.toString(e.severity)):i.push(r),e.message&&n?i.push(e.message.replace("¦","\\¦")):i.push(r),void 0!==e.startLineNumber&&null!==e.startLineNumber?i.push(e.startLineNumber.toString()):i.push(r),void 0!==e.startColumn&&null!==e.startColumn?i.push(e.startColumn.toString()):i.push(r),void 0!==e.endLineNumber&&null!==e.endLineNumber?i.push(e.endLineNumber.toString()):i.push(r),void 0!==e.endColumn&&null!==e.endColumn?i.push(e.endColumn.toString()):i.push(r),i.push(r),i.join("¦")}e.makeKey=function(e){return n(e,!0)},e.makeKeyOptionalMessage=n}(i||(i={}));const c=(0,a.u1)("markerService")},7167:(e,r,n)=>{n.d(r,{O:()=>o});var t=n(7110),i=n(9359);const o=new class{constructor(){this.data=new Map}add(e,r){t.ok(i.Kg(e)),t.ok(i.Gv(r)),t.ok(!this.data.has(e),"There is already an extension with this id"),this.data.set(e,r)}as(e){return this.data.get(e)||null}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDQ4Mi5idW5kbGUuanMiLCJtYXBwaW5ncyI6IitIQUlPLFNBQVNBLEVBQVNDLEVBQVFDLEdBQzdCLE1BQU1DLEVBQVUsR0FDVkMsRUFBUSxHQUNkLElBQUssTUFBTUMsS0FBV0osRUFDYkMsRUFBTUksSUFBSUQsSUFDWEYsRUFBUUksS0FBS0YsR0FHckIsSUFBSyxNQUFNQSxLQUFXSCxFQUNiRCxFQUFPSyxJQUFJRCxJQUNaRCxFQUFNRyxLQUFLRixHQUduQixNQUFPLENBQUVGLFVBQVNDLFFBQ3RCLENBUU8sU0FBU0ksRUFBYUMsRUFBTUMsR0FDL0IsTUFBTUMsRUFBUyxJQUFJQyxJQUNuQixJQUFLLE1BQU1DLEtBQVFILEVBQ1hELEVBQUtILElBQUlPLElBQ1RGLEVBQU9HLElBQUlELEdBR25CLE9BQU9GLENBQ1gsQyw4REM3QklJLEUsV0FDSixTQUFXQSxHQUNQQSxFQUFTQSxFQUFpQixPQUFJLEdBQUssU0FDbkNBLEVBQVNBLEVBQWUsS0FBSSxHQUFLLE9BQ2pDQSxFQUFTQSxFQUFrQixRQUFJLEdBQUssVUFDcENBLEVBQVNBLEVBQWdCLE1BQUksR0FBSyxPQUNyQyxDQUxELENBS0dBLElBQWFBLEVBQVcsQ0FBQyxJQUM1QixTQUFXQSxHQUNQLE1BQU1DLEVBQVMsUUFDVEMsRUFBVyxVQUVYQyxFQUFRLE9BcUJkSCxFQUFTSSxVQWZULFNBQW1CQyxHQUNmLE9BQUtBLEVBR0QsS0FBeUJKLEVBQVFJLEdBQzFCTCxFQUFTTSxNQUVoQixLQUF5QkosRUFBVUcsSUFBVSxLQWR2QyxPQWN1RUEsR0FDdEVMLEVBQVNPLFFBRWhCLEtBQXlCSixFQUFPRSxHQUN6QkwsRUFBU1EsS0FFYlIsRUFBU1MsT0FYTFQsRUFBU1MsTUFZeEIsRUFVQVQsRUFBU1UsU0FSVCxTQUFrQkMsR0FDZCxPQUFRQSxHQUNKLEtBQUtYLEVBQVNNLE1BQU8sT0FBT0wsRUFDNUIsS0FBS0QsRUFBU08sUUFBUyxPQUFPTCxFQUM5QixLQUFLRixFQUFTUSxLQUFNLE9BQU9MLEVBQzNCLFFBQVMsTUExQkQsU0E0QmhCLENBRUgsQ0FuQ0QsQ0FtQ0dILElBQWFBLEVBQVcsQ0FBQyxJQUM1QixTLHFMQ3RDSVksRUFBb0MsU0FBVUMsRUFBWUMsR0FDMUQsT0FBTyxTQUFVQyxFQUFRQyxHQUFPRixFQUFVQyxFQUFRQyxFQUFLSCxFQUFhLENBQ3hFLEVBYUEsSUFBSUksRUFBMkIsY0FBdUMsS0FDbEUsV0FBQUMsQ0FBWUMsRUFBY0MsR0FDdEJDLFFBQ0FDLEtBQUtGLGVBQWlCQSxFQUN0QkUsS0FBS0MsbUJBQXFCRCxLQUFLRSxVQUFVLElBQUksTUFDN0NGLEtBQUtHLG1CQUFxQixJQUFJLEtBQzlCTixFQUFhTyxZQUFZQyxTQUFRQyxHQUFTTixLQUFLTyxjQUFjRCxLQUM3RE4sS0FBS0UsVUFBVUwsRUFBYVcsYUFBYVIsS0FBS08sY0FBZVAsT0FDN0RBLEtBQUtFLFVBQVVMLEVBQWFZLGVBQWVULEtBQUtVLGdCQUFpQlYsT0FDakVBLEtBQUtFLFVBQVVGLEtBQUtGLGVBQWVhLGdCQUFnQlgsS0FBS1ksb0JBQXFCWixNQUNqRixDQUNBLE9BQUFhLEdBQ0lkLE1BQU1jLFVBQ05iLEtBQUtHLG1CQUFtQkUsU0FBUXRCLEdBQVNBLEVBQU04QixZQUMvQ2IsS0FBS0csbUJBQW1CVyxPQUM1QixDQUNBLFNBQUFDLENBQVVDLEVBQUtDLEdBQ1gsTUFBTUMsRUFBb0JsQixLQUFLRyxtQkFBbUJnQixJQUFJSCxHQUN0RCxPQUFPRSxHQUFxQkEsRUFBa0JILFVBQVVFLElBQXVCLElBQ25GLENBQ0EsbUJBQUFMLENBQW9CUSxHQUNoQkEsRUFBaUJmLFNBQVNnQixJQUN0QixNQUFNSCxFQUFvQmxCLEtBQUtHLG1CQUFtQmdCLElBQUlFLEdBQ2xESCxHQUNBbEIsS0FBS3NCLG1CQUFtQkosRUFDNUIsR0FFUixDQUNBLGFBQUFYLENBQWNELEdBQ1YsTUFBTVksRUFBb0IsSUFBSUssRUFBa0JqQixHQUNoRE4sS0FBS0csbUJBQW1CcUIsSUFBSWxCLEVBQU1VLElBQUtFLEdBQ3ZDbEIsS0FBS3NCLG1CQUFtQkosRUFDNUIsQ0FDQSxlQUFBUixDQUFnQkosR0FDWixNQUFNWSxFQUFvQmxCLEtBQUtHLG1CQUFtQmdCLElBQUliLEVBQU1VLEtBQ3hERSxJQUNBQSxFQUFrQkwsVUFDbEJiLEtBQUtHLG1CQUFtQnNCLE9BQU9uQixFQUFNVSxNQUdyQ1YsRUFBTVUsSUFBSVUsU0FBVyxLQUFRQyxVQUMxQnJCLEVBQU1VLElBQUlVLFNBQVcsS0FBUUUsVUFDN0J0QixFQUFNVSxJQUFJVSxTQUFXLEtBQVFHLFFBQ2hDN0IsS0FBS0YsZ0JBQWdCZ0MsS0FBSyxDQUFFVCxTQUFVZixFQUFNVSxNQUFPZSxLQUFJQyxHQUFVQSxFQUFPQyxRQUFPNUIsU0FBUTRCLEdBQVNqQyxLQUFLRixlQUFlb0MsT0FBT0QsRUFBTyxDQUFDM0IsRUFBTVUsT0FFakosQ0FDQSxrQkFBQU0sQ0FBbUJKLEdBRWYsTUFBTWlCLEVBQVVuQyxLQUFLRixlQUFlZ0MsS0FBSyxDQUFFVCxTQUFVSCxFQUFrQlosTUFBTVUsSUFBS29CLEtBQU0sTUFDcEZsQixFQUFrQm1CLE9BQU9GLElBQ3pCbkMsS0FBS0MsbUJBQW1CcUMsS0FBS3BCLEVBQWtCWixNQUV2RCxHQUVKWCxFQTNFOEMsU0FBVTRDLEVBQVk5QyxFQUFRQyxFQUFLOEMsR0FDN0UsSUFBMkhDLEVBQXZIQyxFQUFJQyxVQUFVQyxPQUFRQyxFQUFJSCxFQUFJLEVBQUlqRCxFQUFrQixPQUFUK0MsRUFBZ0JBLEVBQU9NLE9BQU9DLHlCQUF5QnRELEVBQVFDLEdBQU84QyxFQUNySCxHQUF1QixpQkFBWlEsU0FBb0QsbUJBQXJCQSxRQUFRQyxTQUF5QkosRUFBSUcsUUFBUUMsU0FBU1YsRUFBWTlDLEVBQVFDLEVBQUs4QyxRQUNwSCxJQUFLLElBQUlVLEVBQUlYLEVBQVdLLE9BQVMsRUFBR00sR0FBSyxFQUFHQSxLQUFTVCxFQUFJRixFQUFXVyxNQUFJTCxHQUFLSCxFQUFJLEVBQUlELEVBQUVJLEdBQUtILEVBQUksRUFBSUQsRUFBRWhELEVBQVFDLEVBQUttRCxHQUFLSixFQUFFaEQsRUFBUUMsS0FBU21ELEdBQ2hKLE9BQU9ILEVBQUksR0FBS0csR0FBS0MsT0FBT0ssZUFBZTFELEVBQVFDLEVBQUttRCxHQUFJQSxDQUNoRSxDQXNFMkJPLENBQVcsQ0FDbEM5RCxFQUFRLEVBQUcsRUFBQStELGVBQ1gvRCxFQUFRLEVBQUcsT0FDWkssR0FFSCxNQUFNNEIsVUFBMEIsS0FDNUIsV0FBQTNCLENBQVlVLEdBQ1JQLFFBQ0FDLEtBQUtNLE1BQVFBLEVBQ2JOLEtBQUtzRCxLQUFPLElBQUksS0FDaEJ0RCxLQUFLRSxXQUFVLFFBQWEsS0FDeEJGLEtBQUtNLE1BQU1pRCxpQkFBaUIsSUFBSXZELEtBQUtzRCxLQUFLRSxVQUFXLElBQ3JEeEQsS0FBS3NELEtBQUt4QyxPQUFPLElBRXpCLENBQ0EsTUFBQXVCLENBQU9GLEdBR0gsTUFBTSxNQUFFcEUsRUFBSyxRQUFFRCxJQUFZLE9BQVMsSUFBSVMsSUFBSXlCLEtBQUtzRCxLQUFLRyxRQUFTLElBQUlsRixJQUFJNEQsSUFDdkUsR0FBcUIsSUFBakJwRSxFQUFNNkUsUUFBbUMsSUFBbkI5RSxFQUFROEUsT0FDOUIsT0FBTyxFQUVYLE1BQU1jLEVBQVM1RixFQUFRaUUsS0FBSUMsR0FBVWhDLEtBQUtzRCxLQUFLbkMsSUFBSWEsS0FDN0MyQixFQUFpQjVGLEVBQU1nRSxLQUFJQyxJQUN0QixDQUNINEIsTUFBTzVELEtBQUs2RCx1QkFBdUI3RCxLQUFLTSxNQUFPMEIsR0FDL0M4QixRQUFTOUQsS0FBSytELHdCQUF3Qi9CLE9BR3hDZ0MsRUFBTWhFLEtBQUtNLE1BQU1pRCxpQkFBaUJHLEVBQVFDLEdBQ2hELElBQUssTUFBTU0sS0FBaUJuRyxFQUN4QmtDLEtBQUtzRCxLQUFLN0IsT0FBT3dDLEdBRXJCLElBQUssSUFBSUMsRUFBUSxFQUFHQSxFQUFRRixFQUFJcEIsT0FBUXNCLElBQ3BDbEUsS0FBS3NELEtBQUs5QixJQUFJekQsRUFBTW1HLEdBQVFGLEVBQUlFLElBRXBDLE9BQU8sQ0FDWCxDQUNBLFNBQUFuRCxDQUFVRSxHQUNOLE9BQU9qQixLQUFLc0QsS0FBS2EsT0FBT2xELEVBQVdtRCxHQUN2QyxDQUNBLHNCQUFBUCxDQUF1QnZELEVBQU8rRCxHQUMxQixJQUFJQyxFQUFNLElBQU1DLEtBQUtGLEdBT3JCLEdBTklBLEVBQVVoRixXQUFhLEtBQWVtRixNQUFTeEUsS0FBS3lFLGNBQWNKLEVBQVcsSUFBbUNyRSxLQUFLeUUsY0FBY0osRUFBVyxLQUc5SUMsRUFBTUEsRUFBSUksZUFBZUosRUFBSUssZ0JBQWlCTCxFQUFJTSxZQUFjLElBRXBFTixFQUFNaEUsRUFBTXVFLGNBQWNQLEdBQ3RCQSxFQUFJUSxVQUFXLENBQ2YsTUFBTUMsRUFBWXpFLEVBQU0wRSwrQkFBK0JWLEVBQUlLLGtCQUN2RHJFLEVBQU0yRSxpQkFBaUJYLEVBQUlLLGlCQUMvQixHQUFrQixJQUFkSSxHQUFtQlQsRUFBSVksV0FBYUgsRUFHcEMsT0FBT1QsRUFFWCxNQUFNYSxFQUFPN0UsRUFBTThFLGtCQUFrQmQsRUFBSWUsb0JBQ3JDRixJQUNBYixFQUFNLElBQUksSUFBTUEsRUFBSUssZ0JBQWlCUSxFQUFLUCxZQUFhTixFQUFJZ0IsY0FBZUgsRUFBS0QsV0FFdkYsTUFDSyxHQUFJYixFQUFVYSxZQUFjSyxPQUFPQyxXQUF1QyxJQUExQm5CLEVBQVVPLGFBQXFCTixFQUFJSyxrQkFBb0JMLEVBQUlnQixjQUFlLENBQzNILE1BQU1HLEVBQVluRixFQUFNb0YsZ0NBQWdDckIsRUFBVU0saUJBQzlEYyxFQUFZbkIsRUFBSVksWUFDaEJaLEVBQU0sSUFBSSxJQUFNQSxFQUFJSyxnQkFBaUJjLEVBQVduQixFQUFJZ0IsY0FBZWhCLEVBQUlZLFdBQ3ZFYixFQUFVTyxZQUFjYSxFQUVoQyxDQUNBLE9BQU9uQixDQUNYLENBQ0EsdUJBQUFQLENBQXdCL0IsR0FDcEIsSUFBSTJELEVBQ0FDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEVBQ0osT0FBUS9ELEVBQU8zQyxVQUNYLEtBQUssS0FBZW1GLEtBRVptQixFQURBM0YsS0FBS3lFLGNBQWN6QyxFQUFRLFFBQ2ZnRSxFQUVQaEcsS0FBS3lFLGNBQWN6QyxFQUFRLEdBQ3BCLHVCQUdBLGdCQUVoQjZELEVBQVMsRUFDVCxNQUNKLEtBQUssS0FBZTNHLEtBQ2hCeUcsRUFBWSxnQkFDWkMsR0FBUSxRQUFpQixNQUN6QkMsRUFBUyxHQUNURSxFQUFVLENBQ05ILE9BQU8sUUFBaUIsT0FDeEJLLFNBQVUsR0FFZCxNQUNKLEtBQUssS0FBZWhILFFBQ2hCMEcsRUFBWSxtQkFDWkMsR0FBUSxRQUFpQixNQUN6QkMsRUFBUyxHQUNURSxFQUFVLENBQ05ILE9BQU8sUUFBaUIsT0FDeEJLLFNBQVUsR0FFZCxNQUNKLEtBQUssS0FBZWpILE1BQ3BCLFFBQ0kyRyxFQUFZLGlCQUNaQyxHQUFRLFFBQWlCLE1BQ3pCQyxFQUFTLEdBQ1RFLEVBQVUsQ0FDTkgsT0FBTyxRQUFpQixPQUN4QkssU0FBVSxHQVl0QixPQVJJakUsRUFBT2tFLFFBQ3FELElBQXhEbEUsRUFBT2tFLEtBQUtDLFFBQVEsS0FDcEJMLEVBQWtCLGdDQUVxQyxJQUF2RDlELEVBQU9rRSxLQUFLQyxRQUFRLEtBQ3BCTCxFQUFrQiwrQkFHbkIsQ0FDSE0sWUFBYSxvQkFDYkMsV0FBWSxFQUNaVixZQUNBVyxpQkFBaUIsRUFDakJDLGNBQWUsQ0FDWFgsUUFDQUssU0FBVSxLQUFrQk8sT0FFaENULFVBQ0FGLFNBQ0FDLGtCQUVSLENBQ0EsYUFBQXJCLENBQWN6QyxFQUFReUUsR0FDbEIsUUFBSXpFLEVBQU9rRSxNQUNBbEUsRUFBT2tFLEtBQUtDLFFBQVFNLElBQVEsQ0FHM0MsRSxxREM1TkcsTUFBTXBELEdBQWdCLEUsUUFBQSxJQUFnQixlLGlCQ0F0QyxJQUFJcUQsRSxvQ0FDWCxTQUFXQSxHQUNQQSxFQUFNQyxXQUFhLElBQUlDLElBQ3ZCRixFQUFNRyxVQUFZLGFBQ2xCSCxFQUFNSSxnQkFBa0IsbUJBSXhCSixFQUFNSyx1QkFITixTQUFnQ0MsR0FDNUIsT0FBT0EsRUFBS04sRUFBTUksa0JBQW9CLEVBQzFDLENBRUgsQ0FSRCxDQVFHSixJQUFVQSxFQUFRLENBQUMsSUFDZixNQUFNTyxFQUF3QkMsRUFBZ0Isd0JBYTlDLFNBQVNBLEVBQWdCQyxHQUM1QixHQUFJVCxFQUFNQyxXQUFXMUksSUFBSWtKLEdBQ3JCLE9BQU9ULEVBQU1DLFdBQVd4RixJQUFJZ0csR0FFaEMsTUFBTS9DLEVBQUssU0FBVTNFLEVBQVFDLEVBQUt3RSxHQUM5QixHQUF5QixJQUFyQnZCLFVBQVVDLE9BQ1YsTUFBTSxJQUFJNUQsTUFBTSxxRUFsQjVCLFNBQWdDb0YsRUFBSTNFLEVBQVF5RSxHQUNwQ3pFLEVBQU9pSCxFQUFNRyxhQUFlcEgsRUFDNUJBLEVBQU9pSCxFQUFNSSxpQkFBaUI1SSxLQUFLLENBQUVrRyxLQUFJRixXQUd6Q3pFLEVBQU9pSCxFQUFNSSxpQkFBbUIsQ0FBQyxDQUFFMUMsS0FBSUYsVUFDdkN6RSxFQUFPaUgsRUFBTUcsV0FBYXBILEVBRWxDLENBWVEySCxDQUF1QmhELEVBQUkzRSxFQUFReUUsRUFDdkMsRUFHQSxPQUZBRSxFQUFHaEYsU0FBVyxJQUFNK0gsRUFDcEJULEVBQU1DLFdBQVduRixJQUFJMkYsRUFBVy9DLEdBQ3pCQSxDQUNYLEMsMERDbkNPLE1BQU1pRCxFQUFhLENBQ3RCQyxpQkFBa0IsMkJBcUJoQkMsRUFBMkIsSUFiakMsTUFDSSxXQUFBM0gsR0FDSUksS0FBS3dILG1CQUFxQixJQUFJLEtBQzlCeEgsS0FBS3lILFlBQWMsQ0FBQyxDQUN4QixDQUNBLGNBQUFDLENBQWUxRyxFQUFLMkcsR0FYeEIsSUFBcUJ2RCxFQVlicEUsS0FBS3lILGFBWlFyRCxFQVlnQnBELEVBWDdCb0QsRUFBR3hCLE9BQVMsR0FBa0MsTUFBN0J3QixFQUFHd0QsT0FBT3hELEVBQUd4QixPQUFTLEdBQ2hDd0IsRUFBR3lELFVBQVUsRUFBR3pELEVBQUd4QixPQUFTLEdBRWhDd0IsSUFRa0N1RCxFQUNyQzNILEtBQUt3SCxtQkFBbUJsRixLQUFLdEIsRUFDakMsQ0FDQSxtQkFBQThHLENBQW9COUcsR0FDaEJoQixLQUFLd0gsbUJBQW1CbEYsS0FBS3RCLEVBQ2pDLEdBR0osSUFBa0J2QyxJQUFJNEksRUFBV0MsaUJBQWtCQyxFLHNEQ3RCeENRLEVBdUNBQyxFLCtCQXRDWCxTQUFXRCxHQUNQQSxFQUFlQSxFQUFxQixLQUFJLEdBQUssT0FDN0NBLEVBQWVBLEVBQXFCLEtBQUksR0FBSyxPQUM3Q0EsRUFBZUEsRUFBd0IsUUFBSSxHQUFLLFVBQ2hEQSxFQUFlQSxFQUFzQixNQUFJLEdBQUssT0FDakQsQ0FMRCxDQUtHQSxJQUFtQkEsRUFBaUIsQ0FBQyxJQUN4QyxTQUFXQSxHQUlQQSxFQUFlRSxRQUhmLFNBQWlCQyxFQUFHQyxHQUNoQixPQUFPQSxFQUFJRCxDQUNmLEVBRUEsTUFBTUUsRUFBa0J0RixPQUFPdUYsT0FBTyxNQUN0Q0QsRUFBZ0JMLEVBQWUvSSxRQUFTLFFBQVMsWUFBYSxTQUM5RG9KLEVBQWdCTCxFQUFlOUksVUFBVyxRQUFTLGNBQWUsV0FDbEVtSixFQUFnQkwsRUFBZTdJLE9BQVEsUUFBUyxXQUFZLFFBSTVENkksRUFBZTNJLFNBSGYsU0FBa0I4SSxHQUNkLE9BQU9FLEVBQWdCRixJQUFNLEVBQ2pDLEVBVUFILEVBQWVPLGFBUmYsU0FBc0JqSixHQUNsQixPQUFRQSxHQUNKLEtBQUssSUFBU0wsTUFBTyxPQUFPK0ksRUFBZS9JLE1BQzNDLEtBQUssSUFBU0MsUUFBUyxPQUFPOEksRUFBZTlJLFFBQzdDLEtBQUssSUFBU0MsS0FBTSxPQUFPNkksRUFBZTdJLEtBQzFDLEtBQUssSUFBU0MsT0FBUSxPQUFPNEksRUFBZXZELEtBRXBELEVBVUF1RCxFQUFlUSxXQVJmLFNBQW9CbEosR0FDaEIsT0FBUUEsR0FDSixLQUFLMEksRUFBZS9JLE1BQU8sT0FBTyxJQUFTQSxNQUMzQyxLQUFLK0ksRUFBZTlJLFFBQVMsT0FBTyxJQUFTQSxRQUM3QyxLQUFLOEksRUFBZTdJLEtBQU0sT0FBTyxJQUFTQSxLQUMxQyxLQUFLNkksRUFBZXZELEtBQU0sT0FBTyxJQUFTckYsT0FFbEQsQ0FFSCxDQS9CRCxDQStCRzRJLElBQW1CQSxFQUFpQixDQUFDLElBRXhDLFNBQVdDLEdBQ1AsTUFBTVEsRUFBYyxHQUtwQixTQUFTQyxFQUF1QkMsRUFBWUMsR0FDeEMsTUFBTXJLLEVBQVMsQ0FBQ2tLLEdBeURoQixPQXhESUUsRUFBV0UsT0FDWHRLLEVBQU9KLEtBQUt3SyxFQUFXRSxPQUFPQyxRQUFRLElBQUssUUFHM0N2SyxFQUFPSixLQUFLc0ssR0FFWkUsRUFBV0ksS0FDb0IsaUJBQXBCSixFQUFXSSxLQUNsQnhLLEVBQU9KLEtBQUt3SyxFQUFXSSxLQUFLRCxRQUFRLElBQUssUUFHekN2SyxFQUFPSixLQUFLd0ssRUFBV0ksS0FBSy9KLE1BQU04SixRQUFRLElBQUssUUFJbkR2SyxFQUFPSixLQUFLc0ssUUFFWXhDLElBQXhCMEMsRUFBV3JKLFVBQWtELE9BQXhCcUosRUFBV3JKLFNBQ2hEZixFQUFPSixLQUFLNkosRUFBZTNJLFNBQVNzSixFQUFXckosV0FHL0NmLEVBQU9KLEtBQUtzSyxHQUlaRSxFQUFXSyxTQUFXSixFQUN0QnJLLEVBQU9KLEtBQUt3SyxFQUFXSyxRQUFRRixRQUFRLElBQUssUUFHNUN2SyxFQUFPSixLQUFLc0ssUUFFbUJ4QyxJQUEvQjBDLEVBQVcvRCxpQkFBZ0UsT0FBL0IrRCxFQUFXL0QsZ0JBQ3ZEckcsRUFBT0osS0FBS3dLLEVBQVcvRCxnQkFBZ0J2RixZQUd2Q2QsRUFBT0osS0FBS3NLLFFBRWV4QyxJQUEzQjBDLEVBQVc5RCxhQUF3RCxPQUEzQjhELEVBQVc5RCxZQUNuRHRHLEVBQU9KLEtBQUt3SyxFQUFXOUQsWUFBWXhGLFlBR25DZCxFQUFPSixLQUFLc0ssUUFFaUJ4QyxJQUE3QjBDLEVBQVdwRCxlQUE0RCxPQUE3Qm9ELEVBQVdwRCxjQUNyRGhILEVBQU9KLEtBQUt3SyxFQUFXcEQsY0FBY2xHLFlBR3JDZCxFQUFPSixLQUFLc0ssUUFFYXhDLElBQXpCMEMsRUFBV3hELFdBQW9ELE9BQXpCd0QsRUFBV3hELFVBQ2pENUcsRUFBT0osS0FBS3dLLEVBQVd4RCxVQUFVOUYsWUFHakNkLEVBQU9KLEtBQUtzSyxHQUVoQmxLLEVBQU9KLEtBQUtzSyxHQUNMbEssRUFBTzBLLEtBQUssSUFDdkIsQ0E1REFoQixFQUFZaUIsUUFIWixTQUFpQlAsR0FDYixPQUFPRCxFQUF1QkMsR0FBWSxFQUM5QyxFQThEQVYsRUFBWVMsdUJBQXlCQSxDQUN4QyxDQW5FRCxDQW1FR1QsSUFBZ0JBLEVBQWMsQ0FBQyxJQUMzQixNQUFNa0IsR0FBaUIsUUFBZ0IsZ0IsMERDL0Z2QyxNQUFNQyxFQUFXLElBZHhCLE1BQ0ksV0FBQXZKLEdBQ0lJLEtBQUtvSixLQUFPLElBQUl4QyxHQUNwQixDQUNBLEdBQUFuSSxDQUFJMkYsRUFBSWdGLEdBQ0osS0FBVSxLQUFlaEYsSUFDekIsS0FBVSxLQUFlZ0YsSUFDekIsTUFBV3BKLEtBQUtvSixLQUFLbkwsSUFBSW1HLEdBQUssOENBQzlCcEUsS0FBS29KLEtBQUs1SCxJQUFJNEMsRUFBSWdGLEVBQ3RCLENBQ0EsRUFBQUMsQ0FBR2pGLEdBQ0MsT0FBT3BFLEtBQUtvSixLQUFLakksSUFBSWlELElBQU8sSUFDaEMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvYmFzZS9jb21tb24vY29sbGVjdGlvbnMuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9iYXNlL2NvbW1vbi9zZXZlcml0eS5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbWFya2VyRGVjb3JhdGlvbnNTZXJ2aWNlLmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvZWRpdG9yL2NvbW1vbi9zZXJ2aWNlcy9tb2RlbC5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL3BsYXRmb3JtL2luc3RhbnRpYXRpb24vY29tbW9uL2luc3RhbnRpYXRpb24uanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9qc29uc2NoZW1hcy9jb21tb24vanNvbkNvbnRyaWJ1dGlvblJlZ2lzdHJ5LmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvcGxhdGZvcm0vbWFya2Vycy9jb21tb24vbWFya2Vycy5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL3BsYXRmb3JtL3JlZ2lzdHJ5L2NvbW1vbi9wbGF0Zm9ybS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmV4cG9ydCBmdW5jdGlvbiBkaWZmU2V0cyhiZWZvcmUsIGFmdGVyKSB7XG4gICAgY29uc3QgcmVtb3ZlZCA9IFtdO1xuICAgIGNvbnN0IGFkZGVkID0gW107XG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGJlZm9yZSkge1xuICAgICAgICBpZiAoIWFmdGVyLmhhcyhlbGVtZW50KSkge1xuICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBhZnRlcikge1xuICAgICAgICBpZiAoIWJlZm9yZS5oYXMoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGFkZGVkLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgcmVtb3ZlZCwgYWRkZWQgfTtcbn1cbi8qKlxuICogQ29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBvZiB0d28gc2V0cy5cbiAqXG4gKiBAcGFyYW0gc2V0QSAtIFRoZSBmaXJzdCBzZXQuXG4gKiBAcGFyYW0gc2V0QiAtIFRoZSBzZWNvbmQgaXRlcmFibGUuXG4gKiBAcmV0dXJucyBBIG5ldyBzZXQgY29udGFpbmluZyB0aGUgZWxlbWVudHMgdGhhdCBhcmUgaW4gYm90aCBgc2V0QWAgYW5kIGBzZXRCYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGludGVyc2VjdGlvbihzZXRBLCBzZXRCKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IFNldCgpO1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiBzZXRCKSB7XG4gICAgICAgIGlmIChzZXRBLmhhcyhlbGVtKSkge1xuICAgICAgICAgICAgcmVzdWx0LmFkZChlbGVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgKiBhcyBzdHJpbmdzIGZyb20gJy4vc3RyaW5ncy5qcyc7XG52YXIgU2V2ZXJpdHk7XG4oZnVuY3Rpb24gKFNldmVyaXR5KSB7XG4gICAgU2V2ZXJpdHlbU2V2ZXJpdHlbXCJJZ25vcmVcIl0gPSAwXSA9IFwiSWdub3JlXCI7XG4gICAgU2V2ZXJpdHlbU2V2ZXJpdHlbXCJJbmZvXCJdID0gMV0gPSBcIkluZm9cIjtcbiAgICBTZXZlcml0eVtTZXZlcml0eVtcIldhcm5pbmdcIl0gPSAyXSA9IFwiV2FybmluZ1wiO1xuICAgIFNldmVyaXR5W1NldmVyaXR5W1wiRXJyb3JcIl0gPSAzXSA9IFwiRXJyb3JcIjtcbn0pKFNldmVyaXR5IHx8IChTZXZlcml0eSA9IHt9KSk7XG4oZnVuY3Rpb24gKFNldmVyaXR5KSB7XG4gICAgY29uc3QgX2Vycm9yID0gJ2Vycm9yJztcbiAgICBjb25zdCBfd2FybmluZyA9ICd3YXJuaW5nJztcbiAgICBjb25zdCBfd2FybiA9ICd3YXJuJztcbiAgICBjb25zdCBfaW5mbyA9ICdpbmZvJztcbiAgICBjb25zdCBfaWdub3JlID0gJ2lnbm9yZSc7XG4gICAgLyoqXG4gICAgICogUGFyc2VzICdlcnJvcicsICd3YXJuaW5nJywgJ3dhcm4nLCAnaW5mbycgaW4gY2FsbCBjYXNpbmdzXG4gICAgICogYW5kIGZhbGxzIGJhY2sgdG8gaWdub3JlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZyb21WYWx1ZSh2YWx1ZSkge1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gU2V2ZXJpdHkuSWdub3JlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJpbmdzLmVxdWFsc0lnbm9yZUNhc2UoX2Vycm9yLCB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBTZXZlcml0eS5FcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RyaW5ncy5lcXVhbHNJZ25vcmVDYXNlKF93YXJuaW5nLCB2YWx1ZSkgfHwgc3RyaW5ncy5lcXVhbHNJZ25vcmVDYXNlKF93YXJuLCB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBTZXZlcml0eS5XYXJuaW5nO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJpbmdzLmVxdWFsc0lnbm9yZUNhc2UoX2luZm8sIHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIFNldmVyaXR5LkluZm87XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFNldmVyaXR5Lklnbm9yZTtcbiAgICB9XG4gICAgU2V2ZXJpdHkuZnJvbVZhbHVlID0gZnJvbVZhbHVlO1xuICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNldmVyaXR5KSB7XG4gICAgICAgIHN3aXRjaCAoc2V2ZXJpdHkpIHtcbiAgICAgICAgICAgIGNhc2UgU2V2ZXJpdHkuRXJyb3I6IHJldHVybiBfZXJyb3I7XG4gICAgICAgICAgICBjYXNlIFNldmVyaXR5Lldhcm5pbmc6IHJldHVybiBfd2FybmluZztcbiAgICAgICAgICAgIGNhc2UgU2V2ZXJpdHkuSW5mbzogcmV0dXJuIF9pbmZvO1xuICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIF9pZ25vcmU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgU2V2ZXJpdHkudG9TdHJpbmcgPSB0b1N0cmluZztcbn0pKFNldmVyaXR5IHx8IChTZXZlcml0eSA9IHt9KSk7XG5leHBvcnQgZGVmYXVsdCBTZXZlcml0eTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn07XG5pbXBvcnQgeyBJTWFya2VyU2VydmljZSwgTWFya2VyU2V2ZXJpdHkgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9tYXJrZXJzL2NvbW1vbi9tYXJrZXJzLmpzJztcbmltcG9ydCB7IERpc3Bvc2FibGUsIHRvRGlzcG9zYWJsZSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2xpZmVjeWNsZS5qcyc7XG5pbXBvcnQgeyBPdmVydmlld1J1bGVyTGFuZSB9IGZyb20gJy4uL21vZGVsLmpzJztcbmltcG9ydCB7IHRoZW1lQ29sb3JGcm9tSWQgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS90aGVtZS9jb21tb24vdGhlbWVTZXJ2aWNlLmpzJztcbmltcG9ydCB7IG92ZXJ2aWV3UnVsZXJXYXJuaW5nLCBvdmVydmlld1J1bGVySW5mbywgb3ZlcnZpZXdSdWxlckVycm9yIH0gZnJvbSAnLi4vY29yZS9lZGl0b3JDb2xvclJlZ2lzdHJ5LmpzJztcbmltcG9ydCB7IElNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLmpzJztcbmltcG9ydCB7IFJhbmdlIH0gZnJvbSAnLi4vY29yZS9yYW5nZS5qcyc7XG5pbXBvcnQgeyBTY2hlbWFzIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbmV0d29yay5qcyc7XG5pbXBvcnQgeyBFbWl0dGVyIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vZXZlbnQuanMnO1xuaW1wb3J0IHsgbWluaW1hcEluZm8sIG1pbmltYXBXYXJuaW5nLCBtaW5pbWFwRXJyb3IgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS90aGVtZS9jb21tb24vY29sb3JSZWdpc3RyeS5qcyc7XG5pbXBvcnQgeyBCaWRpcmVjdGlvbmFsTWFwLCBSZXNvdXJjZU1hcCB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL21hcC5qcyc7XG5pbXBvcnQgeyBkaWZmU2V0cyB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2NvbGxlY3Rpb25zLmpzJztcbmxldCBNYXJrZXJEZWNvcmF0aW9uc1NlcnZpY2UgPSBjbGFzcyBNYXJrZXJEZWNvcmF0aW9uc1NlcnZpY2UgZXh0ZW5kcyBEaXNwb3NhYmxlIHtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbFNlcnZpY2UsIF9tYXJrZXJTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX21hcmtlclNlcnZpY2UgPSBfbWFya2VyU2VydmljZTtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2VNYXJrZXIgPSB0aGlzLl9yZWdpc3RlcihuZXcgRW1pdHRlcigpKTtcbiAgICAgICAgdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMgPSBuZXcgUmVzb3VyY2VNYXAoKTtcbiAgICAgICAgbW9kZWxTZXJ2aWNlLmdldE1vZGVscygpLmZvckVhY2gobW9kZWwgPT4gdGhpcy5fb25Nb2RlbEFkZGVkKG1vZGVsKSk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyKG1vZGVsU2VydmljZS5vbk1vZGVsQWRkZWQodGhpcy5fb25Nb2RlbEFkZGVkLCB0aGlzKSk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyKG1vZGVsU2VydmljZS5vbk1vZGVsUmVtb3ZlZCh0aGlzLl9vbk1vZGVsUmVtb3ZlZCwgdGhpcykpO1xuICAgICAgICB0aGlzLl9yZWdpc3Rlcih0aGlzLl9tYXJrZXJTZXJ2aWNlLm9uTWFya2VyQ2hhbmdlZCh0aGlzLl9oYW5kbGVNYXJrZXJDaGFuZ2UsIHRoaXMpKTtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgc3VwZXIuZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLl9tYXJrZXJEZWNvcmF0aW9ucy5mb3JFYWNoKHZhbHVlID0+IHZhbHVlLmRpc3Bvc2UoKSk7XG4gICAgICAgIHRoaXMuX21hcmtlckRlY29yYXRpb25zLmNsZWFyKCk7XG4gICAgfVxuICAgIGdldE1hcmtlcih1cmksIGRlY29yYXRpb24pIHtcbiAgICAgICAgY29uc3QgbWFya2VyRGVjb3JhdGlvbnMgPSB0aGlzLl9tYXJrZXJEZWNvcmF0aW9ucy5nZXQodXJpKTtcbiAgICAgICAgcmV0dXJuIG1hcmtlckRlY29yYXRpb25zID8gKG1hcmtlckRlY29yYXRpb25zLmdldE1hcmtlcihkZWNvcmF0aW9uKSB8fCBudWxsKSA6IG51bGw7XG4gICAgfVxuICAgIF9oYW5kbGVNYXJrZXJDaGFuZ2UoY2hhbmdlZFJlc291cmNlcykge1xuICAgICAgICBjaGFuZ2VkUmVzb3VyY2VzLmZvckVhY2goKHJlc291cmNlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJEZWNvcmF0aW9ucyA9IHRoaXMuX21hcmtlckRlY29yYXRpb25zLmdldChyZXNvdXJjZSk7XG4gICAgICAgICAgICBpZiAobWFya2VyRGVjb3JhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVEZWNvcmF0aW9ucyhtYXJrZXJEZWNvcmF0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBfb25Nb2RlbEFkZGVkKG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlckRlY29yYXRpb25zID0gbmV3IE1hcmtlckRlY29yYXRpb25zKG1vZGVsKTtcbiAgICAgICAgdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMuc2V0KG1vZGVsLnVyaSwgbWFya2VyRGVjb3JhdGlvbnMpO1xuICAgICAgICB0aGlzLl91cGRhdGVEZWNvcmF0aW9ucyhtYXJrZXJEZWNvcmF0aW9ucyk7XG4gICAgfVxuICAgIF9vbk1vZGVsUmVtb3ZlZChtb2RlbCkge1xuICAgICAgICBjb25zdCBtYXJrZXJEZWNvcmF0aW9ucyA9IHRoaXMuX21hcmtlckRlY29yYXRpb25zLmdldChtb2RlbC51cmkpO1xuICAgICAgICBpZiAobWFya2VyRGVjb3JhdGlvbnMpIHtcbiAgICAgICAgICAgIG1hcmtlckRlY29yYXRpb25zLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuX21hcmtlckRlY29yYXRpb25zLmRlbGV0ZShtb2RlbC51cmkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNsZWFuIHVwIG1hcmtlcnMgZm9yIGludGVybmFsLCB0cmFuc2llbnQgbW9kZWxzXG4gICAgICAgIGlmIChtb2RlbC51cmkuc2NoZW1lID09PSBTY2hlbWFzLmluTWVtb3J5XG4gICAgICAgICAgICB8fCBtb2RlbC51cmkuc2NoZW1lID09PSBTY2hlbWFzLmludGVybmFsXG4gICAgICAgICAgICB8fCBtb2RlbC51cmkuc2NoZW1lID09PSBTY2hlbWFzLnZzY29kZSkge1xuICAgICAgICAgICAgdGhpcy5fbWFya2VyU2VydmljZT8ucmVhZCh7IHJlc291cmNlOiBtb2RlbC51cmkgfSkubWFwKG1hcmtlciA9PiBtYXJrZXIub3duZXIpLmZvckVhY2gob3duZXIgPT4gdGhpcy5fbWFya2VyU2VydmljZS5yZW1vdmUob3duZXIsIFttb2RlbC51cmldKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX3VwZGF0ZURlY29yYXRpb25zKG1hcmtlckRlY29yYXRpb25zKSB7XG4gICAgICAgIC8vIExpbWl0IHRvIHRoZSBmaXJzdCA1MDAgZXJyb3JzL3dhcm5pbmdzXG4gICAgICAgIGNvbnN0IG1hcmtlcnMgPSB0aGlzLl9tYXJrZXJTZXJ2aWNlLnJlYWQoeyByZXNvdXJjZTogbWFya2VyRGVjb3JhdGlvbnMubW9kZWwudXJpLCB0YWtlOiA1MDAgfSk7XG4gICAgICAgIGlmIChtYXJrZXJEZWNvcmF0aW9ucy51cGRhdGUobWFya2VycykpIHtcbiAgICAgICAgICAgIHRoaXMuX29uRGlkQ2hhbmdlTWFya2VyLmZpcmUobWFya2VyRGVjb3JhdGlvbnMubW9kZWwpO1xuICAgICAgICB9XG4gICAgfVxufTtcbk1hcmtlckRlY29yYXRpb25zU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgIF9fcGFyYW0oMCwgSU1vZGVsU2VydmljZSksXG4gICAgX19wYXJhbSgxLCBJTWFya2VyU2VydmljZSlcbl0sIE1hcmtlckRlY29yYXRpb25zU2VydmljZSk7XG5leHBvcnQgeyBNYXJrZXJEZWNvcmF0aW9uc1NlcnZpY2UgfTtcbmNsYXNzIE1hcmtlckRlY29yYXRpb25zIGV4dGVuZHMgRGlzcG9zYWJsZSB7XG4gICAgY29uc3RydWN0b3IobW9kZWwpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLl9tYXAgPSBuZXcgQmlkaXJlY3Rpb25hbE1hcCgpO1xuICAgICAgICB0aGlzLl9yZWdpc3Rlcih0b0Rpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5kZWx0YURlY29yYXRpb25zKFsuLi50aGlzLl9tYXAudmFsdWVzKCldLCBbXSk7XG4gICAgICAgICAgICB0aGlzLl9tYXAuY2xlYXIoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB1cGRhdGUobWFya2Vycykge1xuICAgICAgICAvLyBXZSB1c2UgdGhlIGZhY3QgdGhhdCBtYXJrZXIgaW5zdGFuY2VzIGFyZSBub3QgcmVjcmVhdGVkIHdoZW4gZGlmZmVyZW50IG93bmVyc1xuICAgICAgICAvLyB1cGRhdGUuIFNvIHdlIGNhbiBjb21wYXJlIHJlZmVyZW5jZXMgdG8gZmluZCBvdXQgd2hhdCBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHVwZGF0ZS5cbiAgICAgICAgY29uc3QgeyBhZGRlZCwgcmVtb3ZlZCB9ID0gZGlmZlNldHMobmV3IFNldCh0aGlzLl9tYXAua2V5cygpKSwgbmV3IFNldChtYXJrZXJzKSk7XG4gICAgICAgIGlmIChhZGRlZC5sZW5ndGggPT09IDAgJiYgcmVtb3ZlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRJZHMgPSByZW1vdmVkLm1hcChtYXJrZXIgPT4gdGhpcy5fbWFwLmdldChtYXJrZXIpKTtcbiAgICAgICAgY29uc3QgbmV3RGVjb3JhdGlvbnMgPSBhZGRlZC5tYXAobWFya2VyID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmFuZ2U6IHRoaXMuX2NyZWF0ZURlY29yYXRpb25SYW5nZSh0aGlzLm1vZGVsLCBtYXJrZXIpLFxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IHRoaXMuX2NyZWF0ZURlY29yYXRpb25PcHRpb24obWFya2VyKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGlkcyA9IHRoaXMubW9kZWwuZGVsdGFEZWNvcmF0aW9ucyhvbGRJZHMsIG5ld0RlY29yYXRpb25zKTtcbiAgICAgICAgZm9yIChjb25zdCByZW1vdmVkTWFya2VyIG9mIHJlbW92ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX21hcC5kZWxldGUocmVtb3ZlZE1hcmtlcik7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGlkcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIHRoaXMuX21hcC5zZXQoYWRkZWRbaW5kZXhdLCBpZHNbaW5kZXhdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0TWFya2VyKGRlY29yYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21hcC5nZXRLZXkoZGVjb3JhdGlvbi5pZCk7XG4gICAgfVxuICAgIF9jcmVhdGVEZWNvcmF0aW9uUmFuZ2UobW9kZWwsIHJhd01hcmtlcikge1xuICAgICAgICBsZXQgcmV0ID0gUmFuZ2UubGlmdChyYXdNYXJrZXIpO1xuICAgICAgICBpZiAocmF3TWFya2VyLnNldmVyaXR5ID09PSBNYXJrZXJTZXZlcml0eS5IaW50ICYmICF0aGlzLl9oYXNNYXJrZXJUYWcocmF3TWFya2VyLCAxIC8qIE1hcmtlclRhZy5Vbm5lY2Vzc2FyeSAqLykgJiYgIXRoaXMuX2hhc01hcmtlclRhZyhyYXdNYXJrZXIsIDIgLyogTWFya2VyVGFnLkRlcHJlY2F0ZWQgKi8pKSB7XG4gICAgICAgICAgICAvLyAqIG5ldmVyIHJlbmRlciBoaW50cyBvbiBtdWx0aXBsZSBsaW5lc1xuICAgICAgICAgICAgLy8gKiBtYWtlIGVub3VnaCBzcGFjZSBmb3IgdGhyZWUgZG90c1xuICAgICAgICAgICAgcmV0ID0gcmV0LnNldEVuZFBvc2l0aW9uKHJldC5zdGFydExpbmVOdW1iZXIsIHJldC5zdGFydENvbHVtbiArIDIpO1xuICAgICAgICB9XG4gICAgICAgIHJldCA9IG1vZGVsLnZhbGlkYXRlUmFuZ2UocmV0KTtcbiAgICAgICAgaWYgKHJldC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1heENvbHVtbiA9IG1vZGVsLmdldExpbmVMYXN0Tm9uV2hpdGVzcGFjZUNvbHVtbihyZXQuc3RhcnRMaW5lTnVtYmVyKSB8fFxuICAgICAgICAgICAgICAgIG1vZGVsLmdldExpbmVNYXhDb2x1bW4ocmV0LnN0YXJ0TGluZU51bWJlcik7XG4gICAgICAgICAgICBpZiAobWF4Q29sdW1uID09PSAxIHx8IHJldC5lbmRDb2x1bW4gPj0gbWF4Q29sdW1uKSB7XG4gICAgICAgICAgICAgICAgLy8gZW1wdHkgbGluZSBvciBiZWhpbmQgZW9sXG4gICAgICAgICAgICAgICAgLy8ga2VlcCB0aGUgcmFuZ2UgYXMgaXMsIGl0IHdpbGwgYmUgcmVuZGVyZWQgMWNoIHdpZGVcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd29yZCA9IG1vZGVsLmdldFdvcmRBdFBvc2l0aW9uKHJldC5nZXRTdGFydFBvc2l0aW9uKCkpO1xuICAgICAgICAgICAgaWYgKHdvcmQpIHtcbiAgICAgICAgICAgICAgICByZXQgPSBuZXcgUmFuZ2UocmV0LnN0YXJ0TGluZU51bWJlciwgd29yZC5zdGFydENvbHVtbiwgcmV0LmVuZExpbmVOdW1iZXIsIHdvcmQuZW5kQ29sdW1uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyYXdNYXJrZXIuZW5kQ29sdW1uID09PSBOdW1iZXIuTUFYX1ZBTFVFICYmIHJhd01hcmtlci5zdGFydENvbHVtbiA9PT0gMSAmJiByZXQuc3RhcnRMaW5lTnVtYmVyID09PSByZXQuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgY29uc3QgbWluQ29sdW1uID0gbW9kZWwuZ2V0TGluZUZpcnN0Tm9uV2hpdGVzcGFjZUNvbHVtbihyYXdNYXJrZXIuc3RhcnRMaW5lTnVtYmVyKTtcbiAgICAgICAgICAgIGlmIChtaW5Db2x1bW4gPCByZXQuZW5kQ29sdW1uKSB7XG4gICAgICAgICAgICAgICAgcmV0ID0gbmV3IFJhbmdlKHJldC5zdGFydExpbmVOdW1iZXIsIG1pbkNvbHVtbiwgcmV0LmVuZExpbmVOdW1iZXIsIHJldC5lbmRDb2x1bW4pO1xuICAgICAgICAgICAgICAgIHJhd01hcmtlci5zdGFydENvbHVtbiA9IG1pbkNvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICBfY3JlYXRlRGVjb3JhdGlvbk9wdGlvbihtYXJrZXIpIHtcbiAgICAgICAgbGV0IGNsYXNzTmFtZTtcbiAgICAgICAgbGV0IGNvbG9yID0gdW5kZWZpbmVkO1xuICAgICAgICBsZXQgekluZGV4O1xuICAgICAgICBsZXQgaW5saW5lQ2xhc3NOYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICBsZXQgbWluaW1hcDtcbiAgICAgICAgc3dpdGNoIChtYXJrZXIuc2V2ZXJpdHkpIHtcbiAgICAgICAgICAgIGNhc2UgTWFya2VyU2V2ZXJpdHkuSGludDpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFzTWFya2VyVGFnKG1hcmtlciwgMiAvKiBNYXJrZXJUYWcuRGVwcmVjYXRlZCAqLykpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9oYXNNYXJrZXJUYWcobWFya2VyLCAxIC8qIE1hcmtlclRhZy5Vbm5lY2Vzc2FyeSAqLykpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJzcXVpZ2dseS11bm5lY2Vzc2FyeVwiIC8qIENsYXNzTmFtZS5FZGl0b3JVbm5lY2Vzc2FyeURlY29yYXRpb24gKi87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcInNxdWlnZ2x5LWhpbnRcIiAvKiBDbGFzc05hbWUuRWRpdG9ySGludERlY29yYXRpb24gKi87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHpJbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5LkluZm86XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJzcXVpZ2dseS1pbmZvXCIgLyogQ2xhc3NOYW1lLkVkaXRvckluZm9EZWNvcmF0aW9uICovO1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvckZyb21JZChvdmVydmlld1J1bGVySW5mbyk7XG4gICAgICAgICAgICAgICAgekluZGV4ID0gMTA7XG4gICAgICAgICAgICAgICAgbWluaW1hcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lQ29sb3JGcm9tSWQobWluaW1hcEluZm8pLFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogMSAvKiBNaW5pbWFwUG9zaXRpb24uSW5saW5lICovXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgTWFya2VyU2V2ZXJpdHkuV2FybmluZzpcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcInNxdWlnZ2x5LXdhcm5pbmdcIiAvKiBDbGFzc05hbWUuRWRpdG9yV2FybmluZ0RlY29yYXRpb24gKi87XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9yRnJvbUlkKG92ZXJ2aWV3UnVsZXJXYXJuaW5nKTtcbiAgICAgICAgICAgICAgICB6SW5kZXggPSAyMDtcbiAgICAgICAgICAgICAgICBtaW5pbWFwID0ge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVDb2xvckZyb21JZChtaW5pbWFwV2FybmluZyksXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAxIC8qIE1pbmltYXBQb3NpdGlvbi5JbmxpbmUgKi9cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBNYXJrZXJTZXZlcml0eS5FcnJvcjpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gXCJzcXVpZ2dseS1lcnJvclwiIC8qIENsYXNzTmFtZS5FZGl0b3JFcnJvckRlY29yYXRpb24gKi87XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9yRnJvbUlkKG92ZXJ2aWV3UnVsZXJFcnJvcik7XG4gICAgICAgICAgICAgICAgekluZGV4ID0gMzA7XG4gICAgICAgICAgICAgICAgbWluaW1hcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lQ29sb3JGcm9tSWQobWluaW1hcEVycm9yKSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IDEgLyogTWluaW1hcFBvc2l0aW9uLklubGluZSAqL1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlci50YWdzKSB7XG4gICAgICAgICAgICBpZiAobWFya2VyLnRhZ3MuaW5kZXhPZigxIC8qIE1hcmtlclRhZy5Vbm5lY2Vzc2FyeSAqLykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgaW5saW5lQ2xhc3NOYW1lID0gXCJzcXVpZ2dseS1pbmxpbmUtdW5uZWNlc3NhcnlcIiAvKiBDbGFzc05hbWUuRWRpdG9yVW5uZWNlc3NhcnlJbmxpbmVEZWNvcmF0aW9uICovO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1hcmtlci50YWdzLmluZGV4T2YoMiAvKiBNYXJrZXJUYWcuRGVwcmVjYXRlZCAqLykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgaW5saW5lQ2xhc3NOYW1lID0gXCJzcXVpZ2dseS1pbmxpbmUtZGVwcmVjYXRlZFwiIC8qIENsYXNzTmFtZS5FZGl0b3JEZXByZWNhdGVkSW5saW5lRGVjb3JhdGlvbiAqLztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdtYXJrZXItZGVjb3JhdGlvbicsXG4gICAgICAgICAgICBzdGlja2luZXNzOiAxIC8qIFRyYWNrZWRSYW5nZVN0aWNraW5lc3MuTmV2ZXJHcm93c1doZW5UeXBpbmdBdEVkZ2VzICovLFxuICAgICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgICAgc2hvd0lmQ29sbGFwc2VkOiB0cnVlLFxuICAgICAgICAgICAgb3ZlcnZpZXdSdWxlcjoge1xuICAgICAgICAgICAgICAgIGNvbG9yLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBPdmVydmlld1J1bGVyTGFuZS5SaWdodFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1pbmltYXAsXG4gICAgICAgICAgICB6SW5kZXgsXG4gICAgICAgICAgICBpbmxpbmVDbGFzc05hbWUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIF9oYXNNYXJrZXJUYWcobWFya2VyLCB0YWcpIHtcbiAgICAgICAgaWYgKG1hcmtlci50YWdzKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFya2VyLnRhZ3MuaW5kZXhPZih0YWcpID49IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgY3JlYXRlRGVjb3JhdG9yIH0gZnJvbSAnLi4vLi4vLi4vcGxhdGZvcm0vaW5zdGFudGlhdGlvbi9jb21tb24vaW5zdGFudGlhdGlvbi5qcyc7XG5leHBvcnQgY29uc3QgSU1vZGVsU2VydmljZSA9IGNyZWF0ZURlY29yYXRvcignbW9kZWxTZXJ2aWNlJyk7XG4iLCIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbi8vIC0tLS0tLSBpbnRlcm5hbCB1dGlsXG5leHBvcnQgdmFyIF91dGlsO1xuKGZ1bmN0aW9uIChfdXRpbCkge1xuICAgIF91dGlsLnNlcnZpY2VJZHMgPSBuZXcgTWFwKCk7XG4gICAgX3V0aWwuRElfVEFSR0VUID0gJyRkaSR0YXJnZXQnO1xuICAgIF91dGlsLkRJX0RFUEVOREVOQ0lFUyA9ICckZGkkZGVwZW5kZW5jaWVzJztcbiAgICBmdW5jdGlvbiBnZXRTZXJ2aWNlRGVwZW5kZW5jaWVzKGN0b3IpIHtcbiAgICAgICAgcmV0dXJuIGN0b3JbX3V0aWwuRElfREVQRU5ERU5DSUVTXSB8fCBbXTtcbiAgICB9XG4gICAgX3V0aWwuZ2V0U2VydmljZURlcGVuZGVuY2llcyA9IGdldFNlcnZpY2VEZXBlbmRlbmNpZXM7XG59KShfdXRpbCB8fCAoX3V0aWwgPSB7fSkpO1xuZXhwb3J0IGNvbnN0IElJbnN0YW50aWF0aW9uU2VydmljZSA9IGNyZWF0ZURlY29yYXRvcignaW5zdGFudGlhdGlvblNlcnZpY2UnKTtcbmZ1bmN0aW9uIHN0b3JlU2VydmljZURlcGVuZGVuY3koaWQsIHRhcmdldCwgaW5kZXgpIHtcbiAgICBpZiAodGFyZ2V0W191dGlsLkRJX1RBUkdFVF0gPT09IHRhcmdldCkge1xuICAgICAgICB0YXJnZXRbX3V0aWwuRElfREVQRU5ERU5DSUVTXS5wdXNoKHsgaWQsIGluZGV4IH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGFyZ2V0W191dGlsLkRJX0RFUEVOREVOQ0lFU10gPSBbeyBpZCwgaW5kZXggfV07XG4gICAgICAgIHRhcmdldFtfdXRpbC5ESV9UQVJHRVRdID0gdGFyZ2V0O1xuICAgIH1cbn1cbi8qKlxuICogVGhlICpvbmx5KiB2YWxpZCB3YXkgdG8gY3JlYXRlIGEge3tTZXJ2aWNlSWRlbnRpZmllcn19LlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGVjb3JhdG9yKHNlcnZpY2VJZCkge1xuICAgIGlmIChfdXRpbC5zZXJ2aWNlSWRzLmhhcyhzZXJ2aWNlSWQpKSB7XG4gICAgICAgIHJldHVybiBfdXRpbC5zZXJ2aWNlSWRzLmdldChzZXJ2aWNlSWQpO1xuICAgIH1cbiAgICBjb25zdCBpZCA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgaW5kZXgpIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQElTZXJ2aWNlTmFtZS1kZWNvcmF0b3IgY2FuIG9ubHkgYmUgdXNlZCB0byBkZWNvcmF0ZSBhIHBhcmFtZXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlU2VydmljZURlcGVuZGVuY3koaWQsIHRhcmdldCwgaW5kZXgpO1xuICAgIH07XG4gICAgaWQudG9TdHJpbmcgPSAoKSA9PiBzZXJ2aWNlSWQ7XG4gICAgX3V0aWwuc2VydmljZUlkcy5zZXQoc2VydmljZUlkLCBpZCk7XG4gICAgcmV0dXJuIGlkO1xufVxuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBFbWl0dGVyIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vZXZlbnQuanMnO1xuaW1wb3J0ICogYXMgcGxhdGZvcm0gZnJvbSAnLi4vLi4vcmVnaXN0cnkvY29tbW9uL3BsYXRmb3JtLmpzJztcbmV4cG9ydCBjb25zdCBFeHRlbnNpb25zID0ge1xuICAgIEpTT05Db250cmlidXRpb246ICdiYXNlLmNvbnRyaWJ1dGlvbnMuanNvbidcbn07XG5mdW5jdGlvbiBub3JtYWxpemVJZChpZCkge1xuICAgIGlmIChpZC5sZW5ndGggPiAwICYmIGlkLmNoYXJBdChpZC5sZW5ndGggLSAxKSA9PT0gJyMnKSB7XG4gICAgICAgIHJldHVybiBpZC5zdWJzdHJpbmcoMCwgaWQubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIHJldHVybiBpZDtcbn1cbmNsYXNzIEpTT05Db250cmlidXRpb25SZWdpc3RyeSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX29uRGlkQ2hhbmdlU2NoZW1hID0gbmV3IEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5zY2hlbWFzQnlJZCA9IHt9O1xuICAgIH1cbiAgICByZWdpc3RlclNjaGVtYSh1cmksIHVucmVzb2x2ZWRTY2hlbWFDb250ZW50KSB7XG4gICAgICAgIHRoaXMuc2NoZW1hc0J5SWRbbm9ybWFsaXplSWQodXJpKV0gPSB1bnJlc29sdmVkU2NoZW1hQ29udGVudDtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2VTY2hlbWEuZmlyZSh1cmkpO1xuICAgIH1cbiAgICBub3RpZnlTY2hlbWFDaGFuZ2VkKHVyaSkge1xuICAgICAgICB0aGlzLl9vbkRpZENoYW5nZVNjaGVtYS5maXJlKHVyaSk7XG4gICAgfVxufVxuY29uc3QganNvbkNvbnRyaWJ1dGlvblJlZ2lzdHJ5ID0gbmV3IEpTT05Db250cmlidXRpb25SZWdpc3RyeSgpO1xucGxhdGZvcm0uUmVnaXN0cnkuYWRkKEV4dGVuc2lvbnMuSlNPTkNvbnRyaWJ1dGlvbiwganNvbkNvbnRyaWJ1dGlvblJlZ2lzdHJ5KTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IFNldmVyaXR5IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3NldmVyaXR5LmpzJztcbmltcG9ydCB7IGxvY2FsaXplIH0gZnJvbSAnLi4vLi4vLi4vbmxzLmpzJztcbmltcG9ydCB7IGNyZWF0ZURlY29yYXRvciB9IGZyb20gJy4uLy4uL2luc3RhbnRpYXRpb24vY29tbW9uL2luc3RhbnRpYXRpb24uanMnO1xuZXhwb3J0IHZhciBNYXJrZXJTZXZlcml0eTtcbihmdW5jdGlvbiAoTWFya2VyU2V2ZXJpdHkpIHtcbiAgICBNYXJrZXJTZXZlcml0eVtNYXJrZXJTZXZlcml0eVtcIkhpbnRcIl0gPSAxXSA9IFwiSGludFwiO1xuICAgIE1hcmtlclNldmVyaXR5W01hcmtlclNldmVyaXR5W1wiSW5mb1wiXSA9IDJdID0gXCJJbmZvXCI7XG4gICAgTWFya2VyU2V2ZXJpdHlbTWFya2VyU2V2ZXJpdHlbXCJXYXJuaW5nXCJdID0gNF0gPSBcIldhcm5pbmdcIjtcbiAgICBNYXJrZXJTZXZlcml0eVtNYXJrZXJTZXZlcml0eVtcIkVycm9yXCJdID0gOF0gPSBcIkVycm9yXCI7XG59KShNYXJrZXJTZXZlcml0eSB8fCAoTWFya2VyU2V2ZXJpdHkgPSB7fSkpO1xuKGZ1bmN0aW9uIChNYXJrZXJTZXZlcml0eSkge1xuICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikge1xuICAgICAgICByZXR1cm4gYiAtIGE7XG4gICAgfVxuICAgIE1hcmtlclNldmVyaXR5LmNvbXBhcmUgPSBjb21wYXJlO1xuICAgIGNvbnN0IF9kaXNwbGF5U3RyaW5ncyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgX2Rpc3BsYXlTdHJpbmdzW01hcmtlclNldmVyaXR5LkVycm9yXSA9IGxvY2FsaXplKCdzZXYuZXJyb3InLCBcIkVycm9yXCIpO1xuICAgIF9kaXNwbGF5U3RyaW5nc1tNYXJrZXJTZXZlcml0eS5XYXJuaW5nXSA9IGxvY2FsaXplKCdzZXYud2FybmluZycsIFwiV2FybmluZ1wiKTtcbiAgICBfZGlzcGxheVN0cmluZ3NbTWFya2VyU2V2ZXJpdHkuSW5mb10gPSBsb2NhbGl6ZSgnc2V2LmluZm8nLCBcIkluZm9cIik7XG4gICAgZnVuY3Rpb24gdG9TdHJpbmcoYSkge1xuICAgICAgICByZXR1cm4gX2Rpc3BsYXlTdHJpbmdzW2FdIHx8ICcnO1xuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS50b1N0cmluZyA9IHRvU3RyaW5nO1xuICAgIGZ1bmN0aW9uIGZyb21TZXZlcml0eShzZXZlcml0eSkge1xuICAgICAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICAgICAgICBjYXNlIFNldmVyaXR5LkVycm9yOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuRXJyb3I7XG4gICAgICAgICAgICBjYXNlIFNldmVyaXR5Lldhcm5pbmc6IHJldHVybiBNYXJrZXJTZXZlcml0eS5XYXJuaW5nO1xuICAgICAgICAgICAgY2FzZSBTZXZlcml0eS5JbmZvOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuSW5mbztcbiAgICAgICAgICAgIGNhc2UgU2V2ZXJpdHkuSWdub3JlOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuSGludDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS5mcm9tU2V2ZXJpdHkgPSBmcm9tU2V2ZXJpdHk7XG4gICAgZnVuY3Rpb24gdG9TZXZlcml0eShzZXZlcml0eSkge1xuICAgICAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5LkVycm9yOiByZXR1cm4gU2V2ZXJpdHkuRXJyb3I7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5Lldhcm5pbmc6IHJldHVybiBTZXZlcml0eS5XYXJuaW5nO1xuICAgICAgICAgICAgY2FzZSBNYXJrZXJTZXZlcml0eS5JbmZvOiByZXR1cm4gU2V2ZXJpdHkuSW5mbztcbiAgICAgICAgICAgIGNhc2UgTWFya2VyU2V2ZXJpdHkuSGludDogcmV0dXJuIFNldmVyaXR5Lklnbm9yZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS50b1NldmVyaXR5ID0gdG9TZXZlcml0eTtcbn0pKE1hcmtlclNldmVyaXR5IHx8IChNYXJrZXJTZXZlcml0eSA9IHt9KSk7XG5leHBvcnQgdmFyIElNYXJrZXJEYXRhO1xuKGZ1bmN0aW9uIChJTWFya2VyRGF0YSkge1xuICAgIGNvbnN0IGVtcHR5U3RyaW5nID0gJyc7XG4gICAgZnVuY3Rpb24gbWFrZUtleShtYXJrZXJEYXRhKSB7XG4gICAgICAgIHJldHVybiBtYWtlS2V5T3B0aW9uYWxNZXNzYWdlKG1hcmtlckRhdGEsIHRydWUpO1xuICAgIH1cbiAgICBJTWFya2VyRGF0YS5tYWtlS2V5ID0gbWFrZUtleTtcbiAgICBmdW5jdGlvbiBtYWtlS2V5T3B0aW9uYWxNZXNzYWdlKG1hcmtlckRhdGEsIHVzZU1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW2VtcHR5U3RyaW5nXTtcbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc291cmNlKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChtYXJrZXJEYXRhLnNvdXJjZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuY29kZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXJrZXJEYXRhLmNvZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobWFya2VyRGF0YS5jb2RlLnJlcGxhY2UoJ8KmJywgJ1xcXFzCpicpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuY29kZS52YWx1ZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc2V2ZXJpdHkgIT09IHVuZGVmaW5lZCAmJiBtYXJrZXJEYXRhLnNldmVyaXR5ICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChNYXJrZXJTZXZlcml0eS50b1N0cmluZyhtYXJrZXJEYXRhLnNldmVyaXR5KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTW9kaWZlZCB0byBub3QgaW5jbHVkZSB0aGUgbWVzc2FnZSBhcyBwYXJ0IG9mIHRoZSBtYXJrZXIga2V5IHRvIHdvcmsgYXJvdW5kXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy83NzQ3NVxuICAgICAgICBpZiAobWFya2VyRGF0YS5tZXNzYWdlICYmIHVzZU1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEubWVzc2FnZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc3RhcnRMaW5lTnVtYmVyICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5zdGFydExpbmVOdW1iZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuc3RhcnRMaW5lTnVtYmVyLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goZW1wdHlTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXJrZXJEYXRhLnN0YXJ0Q29sdW1uICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5zdGFydENvbHVtbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2gobWFya2VyRGF0YS5zdGFydENvbHVtbi50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGVtcHR5U3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWFya2VyRGF0YS5lbmRMaW5lTnVtYmVyICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5lbmRMaW5lTnVtYmVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChtYXJrZXJEYXRhLmVuZExpbmVOdW1iZXIudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuZW5kQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5lbmRDb2x1bW4gIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuZW5kQ29sdW1uLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goZW1wdHlTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5wdXNoKGVtcHR5U3RyaW5nKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCfCpicpO1xuICAgIH1cbiAgICBJTWFya2VyRGF0YS5tYWtlS2V5T3B0aW9uYWxNZXNzYWdlID0gbWFrZUtleU9wdGlvbmFsTWVzc2FnZTtcbn0pKElNYXJrZXJEYXRhIHx8IChJTWFya2VyRGF0YSA9IHt9KSk7XG5leHBvcnQgY29uc3QgSU1hcmtlclNlcnZpY2UgPSBjcmVhdGVEZWNvcmF0b3IoJ21hcmtlclNlcnZpY2UnKTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0ICogYXMgQXNzZXJ0IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2Fzc2VydC5qcyc7XG5pbXBvcnQgKiBhcyBUeXBlcyBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi90eXBlcy5qcyc7XG5jbGFzcyBSZWdpc3RyeUltcGwge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRhdGEgPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIGFkZChpZCwgZGF0YSkge1xuICAgICAgICBBc3NlcnQub2soVHlwZXMuaXNTdHJpbmcoaWQpKTtcbiAgICAgICAgQXNzZXJ0Lm9rKFR5cGVzLmlzT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgQXNzZXJ0Lm9rKCF0aGlzLmRhdGEuaGFzKGlkKSwgJ1RoZXJlIGlzIGFscmVhZHkgYW4gZXh0ZW5zaW9uIHdpdGggdGhpcyBpZCcpO1xuICAgICAgICB0aGlzLmRhdGEuc2V0KGlkLCBkYXRhKTtcbiAgICB9XG4gICAgYXMoaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5nZXQoaWQpIHx8IG51bGw7XG4gICAgfVxufVxuZXhwb3J0IGNvbnN0IFJlZ2lzdHJ5ID0gbmV3IFJlZ2lzdHJ5SW1wbCgpO1xuIl0sIm5hbWVzIjpbImRpZmZTZXRzIiwiYmVmb3JlIiwiYWZ0ZXIiLCJyZW1vdmVkIiwiYWRkZWQiLCJlbGVtZW50IiwiaGFzIiwicHVzaCIsImludGVyc2VjdGlvbiIsInNldEEiLCJzZXRCIiwicmVzdWx0IiwiU2V0IiwiZWxlbSIsImFkZCIsIlNldmVyaXR5IiwiX2Vycm9yIiwiX3dhcm5pbmciLCJfaW5mbyIsImZyb21WYWx1ZSIsInZhbHVlIiwiRXJyb3IiLCJXYXJuaW5nIiwiSW5mbyIsIklnbm9yZSIsInRvU3RyaW5nIiwic2V2ZXJpdHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsInRhcmdldCIsImtleSIsIk1hcmtlckRlY29yYXRpb25zU2VydmljZSIsImNvbnN0cnVjdG9yIiwibW9kZWxTZXJ2aWNlIiwiX21hcmtlclNlcnZpY2UiLCJzdXBlciIsInRoaXMiLCJfb25EaWRDaGFuZ2VNYXJrZXIiLCJfcmVnaXN0ZXIiLCJfbWFya2VyRGVjb3JhdGlvbnMiLCJnZXRNb2RlbHMiLCJmb3JFYWNoIiwibW9kZWwiLCJfb25Nb2RlbEFkZGVkIiwib25Nb2RlbEFkZGVkIiwib25Nb2RlbFJlbW92ZWQiLCJfb25Nb2RlbFJlbW92ZWQiLCJvbk1hcmtlckNoYW5nZWQiLCJfaGFuZGxlTWFya2VyQ2hhbmdlIiwiZGlzcG9zZSIsImNsZWFyIiwiZ2V0TWFya2VyIiwidXJpIiwiZGVjb3JhdGlvbiIsIm1hcmtlckRlY29yYXRpb25zIiwiZ2V0IiwiY2hhbmdlZFJlc291cmNlcyIsInJlc291cmNlIiwiX3VwZGF0ZURlY29yYXRpb25zIiwiTWFya2VyRGVjb3JhdGlvbnMiLCJzZXQiLCJkZWxldGUiLCJzY2hlbWUiLCJpbk1lbW9yeSIsImludGVybmFsIiwidnNjb2RlIiwicmVhZCIsIm1hcCIsIm1hcmtlciIsIm93bmVyIiwicmVtb3ZlIiwibWFya2VycyIsInRha2UiLCJ1cGRhdGUiLCJmaXJlIiwiZGVjb3JhdG9ycyIsImRlc2MiLCJkIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX2RlY29yYXRlIiwiSU1vZGVsU2VydmljZSIsIl9tYXAiLCJkZWx0YURlY29yYXRpb25zIiwidmFsdWVzIiwia2V5cyIsIm9sZElkcyIsIm5ld0RlY29yYXRpb25zIiwicmFuZ2UiLCJfY3JlYXRlRGVjb3JhdGlvblJhbmdlIiwib3B0aW9ucyIsIl9jcmVhdGVEZWNvcmF0aW9uT3B0aW9uIiwiaWRzIiwicmVtb3ZlZE1hcmtlciIsImluZGV4IiwiZ2V0S2V5IiwiaWQiLCJyYXdNYXJrZXIiLCJyZXQiLCJsaWZ0IiwiSGludCIsIl9oYXNNYXJrZXJUYWciLCJzZXRFbmRQb3NpdGlvbiIsInN0YXJ0TGluZU51bWJlciIsInN0YXJ0Q29sdW1uIiwidmFsaWRhdGVSYW5nZSIsImlzRW1wdHkiLCJtYXhDb2x1bW4iLCJnZXRMaW5lTGFzdE5vbldoaXRlc3BhY2VDb2x1bW4iLCJnZXRMaW5lTWF4Q29sdW1uIiwiZW5kQ29sdW1uIiwid29yZCIsImdldFdvcmRBdFBvc2l0aW9uIiwiZ2V0U3RhcnRQb3NpdGlvbiIsImVuZExpbmVOdW1iZXIiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJtaW5Db2x1bW4iLCJnZXRMaW5lRmlyc3ROb25XaGl0ZXNwYWNlQ29sdW1uIiwiY2xhc3NOYW1lIiwiY29sb3IiLCJ6SW5kZXgiLCJpbmxpbmVDbGFzc05hbWUiLCJtaW5pbWFwIiwidW5kZWZpbmVkIiwicG9zaXRpb24iLCJ0YWdzIiwiaW5kZXhPZiIsImRlc2NyaXB0aW9uIiwic3RpY2tpbmVzcyIsInNob3dJZkNvbGxhcHNlZCIsIm92ZXJ2aWV3UnVsZXIiLCJSaWdodCIsInRhZyIsIl91dGlsIiwic2VydmljZUlkcyIsIk1hcCIsIkRJX1RBUkdFVCIsIkRJX0RFUEVOREVOQ0lFUyIsImdldFNlcnZpY2VEZXBlbmRlbmNpZXMiLCJjdG9yIiwiSUluc3RhbnRpYXRpb25TZXJ2aWNlIiwiY3JlYXRlRGVjb3JhdG9yIiwic2VydmljZUlkIiwic3RvcmVTZXJ2aWNlRGVwZW5kZW5jeSIsIkV4dGVuc2lvbnMiLCJKU09OQ29udHJpYnV0aW9uIiwianNvbkNvbnRyaWJ1dGlvblJlZ2lzdHJ5IiwiX29uRGlkQ2hhbmdlU2NoZW1hIiwic2NoZW1hc0J5SWQiLCJyZWdpc3RlclNjaGVtYSIsInVucmVzb2x2ZWRTY2hlbWFDb250ZW50IiwiY2hhckF0Iiwic3Vic3RyaW5nIiwibm90aWZ5U2NoZW1hQ2hhbmdlZCIsIk1hcmtlclNldmVyaXR5IiwiSU1hcmtlckRhdGEiLCJjb21wYXJlIiwiYSIsImIiLCJfZGlzcGxheVN0cmluZ3MiLCJjcmVhdGUiLCJmcm9tU2V2ZXJpdHkiLCJ0b1NldmVyaXR5IiwiZW1wdHlTdHJpbmciLCJtYWtlS2V5T3B0aW9uYWxNZXNzYWdlIiwibWFya2VyRGF0YSIsInVzZU1lc3NhZ2UiLCJzb3VyY2UiLCJyZXBsYWNlIiwiY29kZSIsIm1lc3NhZ2UiLCJqb2luIiwibWFrZUtleSIsIklNYXJrZXJTZXJ2aWNlIiwiUmVnaXN0cnkiLCJkYXRhIiwiYXMiXSwic291cmNlUm9vdCI6IiJ9