"use strict";
(self["webpackChunkpylinac_yaml_editor"] = self["webpackChunkpylinac_yaml_editor"] || []).push([["node_modules_monaco-editor_esm_vs_editor_common_services_languageFeatureDebounce_js"],{

/***/ "./node_modules/monaco-editor/esm/vs/base/common/numbers.js":
/*!******************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/numbers.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MovingAverage: () => (/* binding */ MovingAverage),
/* harmony export */   SlidingWindowAverage: () => (/* binding */ SlidingWindowAverage),
/* harmony export */   clamp: () => (/* binding */ clamp)
/* harmony export */ });
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
function clamp(value, min, max) {
    return Math.min(Math.max(value, min), max);
}
class MovingAverage {
    constructor() {
        this._n = 1;
        this._val = 0;
    }
    update(value) {
        this._val = this._val + (value - this._val) / this._n;
        this._n += 1;
        return this._val;
    }
    get value() {
        return this._val;
    }
}
class SlidingWindowAverage {
    constructor(size) {
        this._n = 0;
        this._val = 0;
        this._values = [];
        this._index = 0;
        this._sum = 0;
        this._values = new Array(size);
        this._values.fill(0, 0, size);
    }
    update(value) {
        const oldValue = this._values[this._index];
        this._values[this._index] = value;
        this._index = (this._index + 1) % this._values.length;
        this._sum -= oldValue;
        this._sum += value;
        if (this._n < this._values.length) {
            this._n += 1;
        }
        this._val = this._sum / this._n;
        return this._val;
    }
    get value() {
        return this._val;
    }
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ILanguageFeatureDebounceService: () => (/* binding */ ILanguageFeatureDebounceService),
/* harmony export */   LanguageFeatureDebounceService: () => (/* binding */ LanguageFeatureDebounceService)
/* harmony export */ });
/* harmony import */ var _base_common_hash_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/hash.js */ "./node_modules/monaco-editor/esm/vs/base/common/hash.js");
/* harmony import */ var _base_common_map_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/map.js */ "./node_modules/monaco-editor/esm/vs/base/common/map.js");
/* harmony import */ var _base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/common/numbers.js */ "./node_modules/monaco-editor/esm/vs/base/common/numbers.js");
/* harmony import */ var _platform_environment_common_environment_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../platform/environment/common/environment.js */ "./node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js");
/* harmony import */ var _platform_instantiation_common_extensions_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../platform/instantiation/common/extensions.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js");
/* harmony import */ var _platform_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../platform/instantiation/common/instantiation.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js");
/* harmony import */ var _platform_log_common_log_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../platform/log/common/log.js */ "./node_modules/monaco-editor/esm/vs/platform/log/common/log.js");
/* harmony import */ var _base_common_network_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../base/common/network.js */ "./node_modules/monaco-editor/esm/vs/base/common/network.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __param = (undefined && undefined.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};








const ILanguageFeatureDebounceService = (0,_platform_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_5__.createDecorator)('ILanguageFeatureDebounceService');
var IdentityHash;
(function (IdentityHash) {
    const _hashes = new WeakMap();
    let pool = 0;
    function of(obj) {
        let value = _hashes.get(obj);
        if (value === undefined) {
            value = ++pool;
            _hashes.set(obj, value);
        }
        return value;
    }
    IdentityHash.of = of;
})(IdentityHash || (IdentityHash = {}));
class NullDebounceInformation {
    constructor(_default) {
        this._default = _default;
    }
    get(_model) {
        return this._default;
    }
    update(_model, _value) {
        return this._default;
    }
    default() {
        return this._default;
    }
}
class FeatureDebounceInformation {
    constructor(_logService, _name, _registry, _default, _min, _max) {
        this._logService = _logService;
        this._name = _name;
        this._registry = _registry;
        this._default = _default;
        this._min = _min;
        this._max = _max;
        this._cache = new _base_common_map_js__WEBPACK_IMPORTED_MODULE_1__.LRUCache(50, 0.7);
    }
    _key(model) {
        return model.id + this._registry.all(model).reduce((hashVal, obj) => (0,_base_common_hash_js__WEBPACK_IMPORTED_MODULE_0__.doHash)(IdentityHash.of(obj), hashVal), 0);
    }
    get(model) {
        const key = this._key(model);
        const avg = this._cache.get(key);
        return avg
            ? (0,_base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.clamp)(avg.value, this._min, this._max)
            : this.default();
    }
    update(model, value) {
        const key = this._key(model);
        let avg = this._cache.get(key);
        if (!avg) {
            avg = new _base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.SlidingWindowAverage(6);
            this._cache.set(key, avg);
        }
        const newValue = (0,_base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.clamp)(avg.update(value), this._min, this._max);
        if (!(0,_base_common_network_js__WEBPACK_IMPORTED_MODULE_7__.matchesScheme)(model.uri, 'output')) {
            this._logService.trace(`[DEBOUNCE: ${this._name}] for ${model.uri.toString()} is ${newValue}ms`);
        }
        return newValue;
    }
    _overall() {
        const result = new _base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.MovingAverage();
        for (const [, avg] of this._cache) {
            result.update(avg.value);
        }
        return result.value;
    }
    default() {
        const value = (this._overall() | 0) || this._default;
        return (0,_base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.clamp)(value, this._min, this._max);
    }
}
let LanguageFeatureDebounceService = class LanguageFeatureDebounceService {
    constructor(_logService, envService) {
        this._logService = _logService;
        this._data = new Map();
        this._isDev = envService.isExtensionDevelopment || !envService.isBuilt;
    }
    for(feature, name, config) {
        const min = config?.min ?? 50;
        const max = config?.max ?? min ** 2;
        const extra = config?.key ?? undefined;
        const key = `${IdentityHash.of(feature)},${min}${extra ? ',' + extra : ''}`;
        let info = this._data.get(key);
        if (!info) {
            if (this._isDev) {
                this._logService.debug(`[DEBOUNCE: ${name}] is disabled in developed mode`);
                info = new NullDebounceInformation(min * 1.5);
            }
            else {
                info = new FeatureDebounceInformation(this._logService, name, feature, (this._overallAverage() | 0) || (min * 1.5), // default is overall default or derived from min-value
                min, max);
            }
            this._data.set(key, info);
        }
        return info;
    }
    _overallAverage() {
        // Average of all language features. Not a great value but an approximation
        const result = new _base_common_numbers_js__WEBPACK_IMPORTED_MODULE_2__.MovingAverage();
        for (const info of this._data.values()) {
            result.update(info.default());
        }
        return result.value;
    }
};
LanguageFeatureDebounceService = __decorate([
    __param(0, _platform_log_common_log_js__WEBPACK_IMPORTED_MODULE_6__.ILogService),
    __param(1, _platform_environment_common_environment_js__WEBPACK_IMPORTED_MODULE_3__.IEnvironmentService)
], LanguageFeatureDebounceService);

(0,_platform_instantiation_common_extensions_js__WEBPACK_IMPORTED_MODULE_4__.registerSingleton)(ILanguageFeatureDebounceService, LanguageFeatureDebounceService, 1 /* InstantiationType.Delayed */);


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js ***!
  \**************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IEnvironmentService: () => (/* binding */ IEnvironmentService)
/* harmony export */ });
/* harmony import */ var _instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../instantiation/common/instantiation.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js");

const IEnvironmentService = (0,_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__.createDecorator)('environmentService');


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SyncDescriptor: () => (/* binding */ SyncDescriptor)
/* harmony export */ });
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
class SyncDescriptor {
    constructor(ctor, staticArguments = [], supportsDelayedInstantiation = false) {
        this.ctor = ctor;
        this.staticArguments = staticArguments;
        this.supportsDelayedInstantiation = supportsDelayedInstantiation;
    }
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getSingletonServiceDescriptors: () => (/* binding */ getSingletonServiceDescriptors),
/* harmony export */   registerSingleton: () => (/* binding */ registerSingleton)
/* harmony export */ });
/* harmony import */ var _descriptors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./descriptors.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

const _registry = [];
function registerSingleton(id, ctorOrDescriptor, supportsDelayedInstantiation) {
    if (!(ctorOrDescriptor instanceof _descriptors_js__WEBPACK_IMPORTED_MODULE_0__.SyncDescriptor)) {
        ctorOrDescriptor = new _descriptors_js__WEBPACK_IMPORTED_MODULE_0__.SyncDescriptor(ctorOrDescriptor, [], Boolean(supportsDelayedInstantiation));
    }
    _registry.push([id, ctorOrDescriptor]);
}
function getSingletonServiceDescriptors() {
    return _registry;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IInstantiationService: () => (/* binding */ IInstantiationService),
/* harmony export */   _util: () => (/* binding */ _util),
/* harmony export */   createDecorator: () => (/* binding */ createDecorator)
/* harmony export */ });
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
// ------ internal util
var _util;
(function (_util) {
    _util.serviceIds = new Map();
    _util.DI_TARGET = '$di$target';
    _util.DI_DEPENDENCIES = '$di$dependencies';
    function getServiceDependencies(ctor) {
        return ctor[_util.DI_DEPENDENCIES] || [];
    }
    _util.getServiceDependencies = getServiceDependencies;
})(_util || (_util = {}));
const IInstantiationService = createDecorator('instantiationService');
function storeServiceDependency(id, target, index) {
    if (target[_util.DI_TARGET] === target) {
        target[_util.DI_DEPENDENCIES].push({ id, index });
    }
    else {
        target[_util.DI_DEPENDENCIES] = [{ id, index }];
        target[_util.DI_TARGET] = target;
    }
}
/**
 * The *only* valid way to create a {{ServiceIdentifier}}.
 */
function createDecorator(serviceId) {
    if (_util.serviceIds.has(serviceId)) {
        return _util.serviceIds.get(serviceId);
    }
    const id = function (target, key, index) {
        if (arguments.length !== 3) {
            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');
        }
        storeServiceDependency(id, target, index);
    };
    id.toString = () => serviceId;
    _util.serviceIds.set(serviceId, id);
    return id;
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZV9tb2R1bGVzX21vbmFjby1lZGl0b3JfZXNtX3ZzX2VkaXRvcl9jb21tb25fc2VydmljZXNfbGFuZ3VhZ2VGZWF0dXJlRGVib3VuY2VfanMuYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFJLElBQUksU0FBSTtBQUM5QjtBQUNBO0FBQ0EsNkNBQTZDLFFBQVE7QUFDckQ7QUFDQTtBQUNBLGVBQWUsU0FBSSxJQUFJLFNBQUk7QUFDM0Isb0NBQW9DO0FBQ3BDO0FBQ3NEO0FBQ0M7QUFDc0M7QUFDSDtBQUNEO0FBQ0M7QUFDeEI7QUFDRjtBQUN6RCx3Q0FBd0MsZ0dBQWU7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9DQUFvQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix5REFBUTtBQUNsQztBQUNBO0FBQ0EsNkVBQTZFLDREQUFNO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDhEQUFLO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQix5RUFBb0I7QUFDMUM7QUFDQTtBQUNBLHlCQUF5Qiw4REFBSztBQUM5QixhQUFhLHNFQUFhO0FBQzFCLGlEQUFpRCxXQUFXLFFBQVEsc0JBQXNCLEtBQUssU0FBUztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrRUFBYTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsOERBQUs7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHlCQUF5QixHQUFHLElBQUksRUFBRSx5QkFBeUI7QUFDbEY7QUFDQTtBQUNBO0FBQ0EscURBQXFELEtBQUs7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGtFQUFhO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxvRUFBVztBQUMxQixlQUFlLDRGQUFtQjtBQUNsQztBQUMwQztBQUMxQywrRkFBaUI7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0STZEO0FBQ3ZFLDRCQUE0Qix1RkFBZTs7Ozs7Ozs7Ozs7Ozs7O0FDRGxEO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDa0Q7QUFDbEQ7QUFDTztBQUNQLHNDQUFzQywyREFBYztBQUNwRCwrQkFBK0IsMkRBQWM7QUFDN0M7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHNCQUFzQjtBQUNoQjtBQUNQO0FBQ0E7QUFDQSw2Q0FBNkMsV0FBVztBQUN4RDtBQUNBO0FBQ0EsMkNBQTJDLFdBQVc7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsbUJBQW1CO0FBQ3pEO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvYmFzZS9jb21tb24vbnVtYmVycy5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbGFuZ3VhZ2VGZWF0dXJlRGVib3VuY2UuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9lbnZpcm9ubWVudC9jb21tb24vZW52aXJvbm1lbnQuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9pbnN0YW50aWF0aW9uL2NvbW1vbi9kZXNjcmlwdG9ycy5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL3BsYXRmb3JtL2luc3RhbnRpYXRpb24vY29tbW9uL2V4dGVuc2lvbnMuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9pbnN0YW50aWF0aW9uL2NvbW1vbi9pbnN0YW50aWF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGZ1bmN0aW9uIGNsYW1wKHZhbHVlLCBtaW4sIG1heCkge1xuICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh2YWx1ZSwgbWluKSwgbWF4KTtcbn1cbmV4cG9ydCBjbGFzcyBNb3ZpbmdBdmVyYWdlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fbiA9IDE7XG4gICAgICAgIHRoaXMuX3ZhbCA9IDA7XG4gICAgfVxuICAgIHVwZGF0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl92YWwgPSB0aGlzLl92YWwgKyAodmFsdWUgLSB0aGlzLl92YWwpIC8gdGhpcy5fbjtcbiAgICAgICAgdGhpcy5fbiArPSAxO1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsO1xuICAgIH1cbiAgICBnZXQgdmFsdWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92YWw7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFNsaWRpbmdXaW5kb3dBdmVyYWdlIHtcbiAgICBjb25zdHJ1Y3RvcihzaXplKSB7XG4gICAgICAgIHRoaXMuX24gPSAwO1xuICAgICAgICB0aGlzLl92YWwgPSAwO1xuICAgICAgICB0aGlzLl92YWx1ZXMgPSBbXTtcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xuICAgICAgICB0aGlzLl9zdW0gPSAwO1xuICAgICAgICB0aGlzLl92YWx1ZXMgPSBuZXcgQXJyYXkoc2l6ZSk7XG4gICAgICAgIHRoaXMuX3ZhbHVlcy5maWxsKDAsIDAsIHNpemUpO1xuICAgIH1cbiAgICB1cGRhdGUodmFsdWUpIHtcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl92YWx1ZXNbdGhpcy5faW5kZXhdO1xuICAgICAgICB0aGlzLl92YWx1ZXNbdGhpcy5faW5kZXhdID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2luZGV4ID0gKHRoaXMuX2luZGV4ICsgMSkgJSB0aGlzLl92YWx1ZXMubGVuZ3RoO1xuICAgICAgICB0aGlzLl9zdW0gLT0gb2xkVmFsdWU7XG4gICAgICAgIHRoaXMuX3N1bSArPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX24gPCB0aGlzLl92YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9uICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdmFsID0gdGhpcy5fc3VtIC8gdGhpcy5fbjtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbDtcbiAgICB9XG4gICAgZ2V0IHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsO1xuICAgIH1cbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn07XG5pbXBvcnQgeyBkb0hhc2ggfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9oYXNoLmpzJztcbmltcG9ydCB7IExSVUNhY2hlIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbWFwLmpzJztcbmltcG9ydCB7IGNsYW1wLCBNb3ZpbmdBdmVyYWdlLCBTbGlkaW5nV2luZG93QXZlcmFnZSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL251bWJlcnMuanMnO1xuaW1wb3J0IHsgSUVudmlyb25tZW50U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2Vudmlyb25tZW50L2NvbW1vbi9lbnZpcm9ubWVudC5qcyc7XG5pbXBvcnQgeyByZWdpc3RlclNpbmdsZXRvbiB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2luc3RhbnRpYXRpb24vY29tbW9uL2V4dGVuc2lvbnMuanMnO1xuaW1wb3J0IHsgY3JlYXRlRGVjb3JhdG9yIH0gZnJvbSAnLi4vLi4vLi4vcGxhdGZvcm0vaW5zdGFudGlhdGlvbi9jb21tb24vaW5zdGFudGlhdGlvbi5qcyc7XG5pbXBvcnQgeyBJTG9nU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2xvZy9jb21tb24vbG9nLmpzJztcbmltcG9ydCB7IG1hdGNoZXNTY2hlbWUgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9uZXR3b3JrLmpzJztcbmV4cG9ydCBjb25zdCBJTGFuZ3VhZ2VGZWF0dXJlRGVib3VuY2VTZXJ2aWNlID0gY3JlYXRlRGVjb3JhdG9yKCdJTGFuZ3VhZ2VGZWF0dXJlRGVib3VuY2VTZXJ2aWNlJyk7XG52YXIgSWRlbnRpdHlIYXNoO1xuKGZ1bmN0aW9uIChJZGVudGl0eUhhc2gpIHtcbiAgICBjb25zdCBfaGFzaGVzID0gbmV3IFdlYWtNYXAoKTtcbiAgICBsZXQgcG9vbCA9IDA7XG4gICAgZnVuY3Rpb24gb2Yob2JqKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IF9oYXNoZXMuZ2V0KG9iaik7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICsrcG9vbDtcbiAgICAgICAgICAgIF9oYXNoZXMuc2V0KG9iaiwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgSWRlbnRpdHlIYXNoLm9mID0gb2Y7XG59KShJZGVudGl0eUhhc2ggfHwgKElkZW50aXR5SGFzaCA9IHt9KSk7XG5jbGFzcyBOdWxsRGVib3VuY2VJbmZvcm1hdGlvbiB7XG4gICAgY29uc3RydWN0b3IoX2RlZmF1bHQpIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdCA9IF9kZWZhdWx0O1xuICAgIH1cbiAgICBnZXQoX21vZGVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0O1xuICAgIH1cbiAgICB1cGRhdGUoX21vZGVsLCBfdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHQ7XG4gICAgfVxuICAgIGRlZmF1bHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0O1xuICAgIH1cbn1cbmNsYXNzIEZlYXR1cmVEZWJvdW5jZUluZm9ybWF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihfbG9nU2VydmljZSwgX25hbWUsIF9yZWdpc3RyeSwgX2RlZmF1bHQsIF9taW4sIF9tYXgpIHtcbiAgICAgICAgdGhpcy5fbG9nU2VydmljZSA9IF9sb2dTZXJ2aWNlO1xuICAgICAgICB0aGlzLl9uYW1lID0gX25hbWU7XG4gICAgICAgIHRoaXMuX3JlZ2lzdHJ5ID0gX3JlZ2lzdHJ5O1xuICAgICAgICB0aGlzLl9kZWZhdWx0ID0gX2RlZmF1bHQ7XG4gICAgICAgIHRoaXMuX21pbiA9IF9taW47XG4gICAgICAgIHRoaXMuX21heCA9IF9tYXg7XG4gICAgICAgIHRoaXMuX2NhY2hlID0gbmV3IExSVUNhY2hlKDUwLCAwLjcpO1xuICAgIH1cbiAgICBfa2V5KG1vZGVsKSB7XG4gICAgICAgIHJldHVybiBtb2RlbC5pZCArIHRoaXMuX3JlZ2lzdHJ5LmFsbChtb2RlbCkucmVkdWNlKChoYXNoVmFsLCBvYmopID0+IGRvSGFzaChJZGVudGl0eUhhc2gub2Yob2JqKSwgaGFzaFZhbCksIDApO1xuICAgIH1cbiAgICBnZXQobW9kZWwpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5fa2V5KG1vZGVsKTtcbiAgICAgICAgY29uc3QgYXZnID0gdGhpcy5fY2FjaGUuZ2V0KGtleSk7XG4gICAgICAgIHJldHVybiBhdmdcbiAgICAgICAgICAgID8gY2xhbXAoYXZnLnZhbHVlLCB0aGlzLl9taW4sIHRoaXMuX21heClcbiAgICAgICAgICAgIDogdGhpcy5kZWZhdWx0KCk7XG4gICAgfVxuICAgIHVwZGF0ZShtb2RlbCwgdmFsdWUpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5fa2V5KG1vZGVsKTtcbiAgICAgICAgbGV0IGF2ZyA9IHRoaXMuX2NhY2hlLmdldChrZXkpO1xuICAgICAgICBpZiAoIWF2Zykge1xuICAgICAgICAgICAgYXZnID0gbmV3IFNsaWRpbmdXaW5kb3dBdmVyYWdlKDYpO1xuICAgICAgICAgICAgdGhpcy5fY2FjaGUuc2V0KGtleSwgYXZnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGNsYW1wKGF2Zy51cGRhdGUodmFsdWUpLCB0aGlzLl9taW4sIHRoaXMuX21heCk7XG4gICAgICAgIGlmICghbWF0Y2hlc1NjaGVtZShtb2RlbC51cmksICdvdXRwdXQnKSkge1xuICAgICAgICAgICAgdGhpcy5fbG9nU2VydmljZS50cmFjZShgW0RFQk9VTkNFOiAke3RoaXMuX25hbWV9XSBmb3IgJHttb2RlbC51cmkudG9TdHJpbmcoKX0gaXMgJHtuZXdWYWx1ZX1tc2ApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICB9XG4gICAgX292ZXJhbGwoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNb3ZpbmdBdmVyYWdlKCk7XG4gICAgICAgIGZvciAoY29uc3QgWywgYXZnXSBvZiB0aGlzLl9jYWNoZSkge1xuICAgICAgICAgICAgcmVzdWx0LnVwZGF0ZShhdmcudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQudmFsdWU7XG4gICAgfVxuICAgIGRlZmF1bHQoKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gKHRoaXMuX292ZXJhbGwoKSB8IDApIHx8IHRoaXMuX2RlZmF1bHQ7XG4gICAgICAgIHJldHVybiBjbGFtcCh2YWx1ZSwgdGhpcy5fbWluLCB0aGlzLl9tYXgpO1xuICAgIH1cbn1cbmxldCBMYW5ndWFnZUZlYXR1cmVEZWJvdW5jZVNlcnZpY2UgPSBjbGFzcyBMYW5ndWFnZUZlYXR1cmVEZWJvdW5jZVNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKF9sb2dTZXJ2aWNlLCBlbnZTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuX2xvZ1NlcnZpY2UgPSBfbG9nU2VydmljZTtcbiAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5faXNEZXYgPSBlbnZTZXJ2aWNlLmlzRXh0ZW5zaW9uRGV2ZWxvcG1lbnQgfHwgIWVudlNlcnZpY2UuaXNCdWlsdDtcbiAgICB9XG4gICAgZm9yKGZlYXR1cmUsIG5hbWUsIGNvbmZpZykge1xuICAgICAgICBjb25zdCBtaW4gPSBjb25maWc/Lm1pbiA/PyA1MDtcbiAgICAgICAgY29uc3QgbWF4ID0gY29uZmlnPy5tYXggPz8gbWluICoqIDI7XG4gICAgICAgIGNvbnN0IGV4dHJhID0gY29uZmlnPy5rZXkgPz8gdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBrZXkgPSBgJHtJZGVudGl0eUhhc2gub2YoZmVhdHVyZSl9LCR7bWlufSR7ZXh0cmEgPyAnLCcgKyBleHRyYSA6ICcnfWA7XG4gICAgICAgIGxldCBpbmZvID0gdGhpcy5fZGF0YS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFpbmZvKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNEZXYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2dTZXJ2aWNlLmRlYnVnKGBbREVCT1VOQ0U6ICR7bmFtZX1dIGlzIGRpc2FibGVkIGluIGRldmVsb3BlZCBtb2RlYCk7XG4gICAgICAgICAgICAgICAgaW5mbyA9IG5ldyBOdWxsRGVib3VuY2VJbmZvcm1hdGlvbihtaW4gKiAxLjUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaW5mbyA9IG5ldyBGZWF0dXJlRGVib3VuY2VJbmZvcm1hdGlvbih0aGlzLl9sb2dTZXJ2aWNlLCBuYW1lLCBmZWF0dXJlLCAodGhpcy5fb3ZlcmFsbEF2ZXJhZ2UoKSB8IDApIHx8IChtaW4gKiAxLjUpLCAvLyBkZWZhdWx0IGlzIG92ZXJhbGwgZGVmYXVsdCBvciBkZXJpdmVkIGZyb20gbWluLXZhbHVlXG4gICAgICAgICAgICAgICAgbWluLCBtYXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZGF0YS5zZXQoa2V5LCBpbmZvKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5mbztcbiAgICB9XG4gICAgX292ZXJhbGxBdmVyYWdlKCkge1xuICAgICAgICAvLyBBdmVyYWdlIG9mIGFsbCBsYW5ndWFnZSBmZWF0dXJlcy4gTm90IGEgZ3JlYXQgdmFsdWUgYnV0IGFuIGFwcHJveGltYXRpb25cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IE1vdmluZ0F2ZXJhZ2UoKTtcbiAgICAgICAgZm9yIChjb25zdCBpbmZvIG9mIHRoaXMuX2RhdGEudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIHJlc3VsdC51cGRhdGUoaW5mby5kZWZhdWx0KCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQudmFsdWU7XG4gICAgfVxufTtcbkxhbmd1YWdlRmVhdHVyZURlYm91bmNlU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgIF9fcGFyYW0oMCwgSUxvZ1NlcnZpY2UpLFxuICAgIF9fcGFyYW0oMSwgSUVudmlyb25tZW50U2VydmljZSlcbl0sIExhbmd1YWdlRmVhdHVyZURlYm91bmNlU2VydmljZSk7XG5leHBvcnQgeyBMYW5ndWFnZUZlYXR1cmVEZWJvdW5jZVNlcnZpY2UgfTtcbnJlZ2lzdGVyU2luZ2xldG9uKElMYW5ndWFnZUZlYXR1cmVEZWJvdW5jZVNlcnZpY2UsIExhbmd1YWdlRmVhdHVyZURlYm91bmNlU2VydmljZSwgMSAvKiBJbnN0YW50aWF0aW9uVHlwZS5EZWxheWVkICovKTtcbiIsImltcG9ydCB7IGNyZWF0ZURlY29yYXRvciB9IGZyb20gJy4uLy4uL2luc3RhbnRpYXRpb24vY29tbW9uL2luc3RhbnRpYXRpb24uanMnO1xuZXhwb3J0IGNvbnN0IElFbnZpcm9ubWVudFNlcnZpY2UgPSBjcmVhdGVEZWNvcmF0b3IoJ2Vudmlyb25tZW50U2VydmljZScpO1xuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5leHBvcnQgY2xhc3MgU3luY0Rlc2NyaXB0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGN0b3IsIHN0YXRpY0FyZ3VtZW50cyA9IFtdLCBzdXBwb3J0c0RlbGF5ZWRJbnN0YW50aWF0aW9uID0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5jdG9yID0gY3RvcjtcbiAgICAgICAgdGhpcy5zdGF0aWNBcmd1bWVudHMgPSBzdGF0aWNBcmd1bWVudHM7XG4gICAgICAgIHRoaXMuc3VwcG9ydHNEZWxheWVkSW5zdGFudGlhdGlvbiA9IHN1cHBvcnRzRGVsYXllZEluc3RhbnRpYXRpb247XG4gICAgfVxufVxuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBTeW5jRGVzY3JpcHRvciB9IGZyb20gJy4vZGVzY3JpcHRvcnMuanMnO1xuY29uc3QgX3JlZ2lzdHJ5ID0gW107XG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJTaW5nbGV0b24oaWQsIGN0b3JPckRlc2NyaXB0b3IsIHN1cHBvcnRzRGVsYXllZEluc3RhbnRpYXRpb24pIHtcbiAgICBpZiAoIShjdG9yT3JEZXNjcmlwdG9yIGluc3RhbmNlb2YgU3luY0Rlc2NyaXB0b3IpKSB7XG4gICAgICAgIGN0b3JPckRlc2NyaXB0b3IgPSBuZXcgU3luY0Rlc2NyaXB0b3IoY3Rvck9yRGVzY3JpcHRvciwgW10sIEJvb2xlYW4oc3VwcG9ydHNEZWxheWVkSW5zdGFudGlhdGlvbikpO1xuICAgIH1cbiAgICBfcmVnaXN0cnkucHVzaChbaWQsIGN0b3JPckRlc2NyaXB0b3JdKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRTaW5nbGV0b25TZXJ2aWNlRGVzY3JpcHRvcnMoKSB7XG4gICAgcmV0dXJuIF9yZWdpc3RyeTtcbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuLy8gLS0tLS0tIGludGVybmFsIHV0aWxcbmV4cG9ydCB2YXIgX3V0aWw7XG4oZnVuY3Rpb24gKF91dGlsKSB7XG4gICAgX3V0aWwuc2VydmljZUlkcyA9IG5ldyBNYXAoKTtcbiAgICBfdXRpbC5ESV9UQVJHRVQgPSAnJGRpJHRhcmdldCc7XG4gICAgX3V0aWwuRElfREVQRU5ERU5DSUVTID0gJyRkaSRkZXBlbmRlbmNpZXMnO1xuICAgIGZ1bmN0aW9uIGdldFNlcnZpY2VEZXBlbmRlbmNpZXMoY3Rvcikge1xuICAgICAgICByZXR1cm4gY3RvcltfdXRpbC5ESV9ERVBFTkRFTkNJRVNdIHx8IFtdO1xuICAgIH1cbiAgICBfdXRpbC5nZXRTZXJ2aWNlRGVwZW5kZW5jaWVzID0gZ2V0U2VydmljZURlcGVuZGVuY2llcztcbn0pKF91dGlsIHx8IChfdXRpbCA9IHt9KSk7XG5leHBvcnQgY29uc3QgSUluc3RhbnRpYXRpb25TZXJ2aWNlID0gY3JlYXRlRGVjb3JhdG9yKCdpbnN0YW50aWF0aW9uU2VydmljZScpO1xuZnVuY3Rpb24gc3RvcmVTZXJ2aWNlRGVwZW5kZW5jeShpZCwgdGFyZ2V0LCBpbmRleCkge1xuICAgIGlmICh0YXJnZXRbX3V0aWwuRElfVEFSR0VUXSA9PT0gdGFyZ2V0KSB7XG4gICAgICAgIHRhcmdldFtfdXRpbC5ESV9ERVBFTkRFTkNJRVNdLnB1c2goeyBpZCwgaW5kZXggfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0YXJnZXRbX3V0aWwuRElfREVQRU5ERU5DSUVTXSA9IFt7IGlkLCBpbmRleCB9XTtcbiAgICAgICAgdGFyZ2V0W191dGlsLkRJX1RBUkdFVF0gPSB0YXJnZXQ7XG4gICAgfVxufVxuLyoqXG4gKiBUaGUgKm9ubHkqIHZhbGlkIHdheSB0byBjcmVhdGUgYSB7e1NlcnZpY2VJZGVudGlmaWVyfX0uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWNvcmF0b3Ioc2VydmljZUlkKSB7XG4gICAgaWYgKF91dGlsLnNlcnZpY2VJZHMuaGFzKHNlcnZpY2VJZCkpIHtcbiAgICAgICAgcmV0dXJuIF91dGlsLnNlcnZpY2VJZHMuZ2V0KHNlcnZpY2VJZCk7XG4gICAgfVxuICAgIGNvbnN0IGlkID0gZnVuY3Rpb24gKHRhcmdldCwga2V5LCBpbmRleCkge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdASVNlcnZpY2VOYW1lLWRlY29yYXRvciBjYW4gb25seSBiZSB1c2VkIHRvIGRlY29yYXRlIGEgcGFyYW1ldGVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgc3RvcmVTZXJ2aWNlRGVwZW5kZW5jeShpZCwgdGFyZ2V0LCBpbmRleCk7XG4gICAgfTtcbiAgICBpZC50b1N0cmluZyA9ICgpID0+IHNlcnZpY2VJZDtcbiAgICBfdXRpbC5zZXJ2aWNlSWRzLnNldChzZXJ2aWNlSWQsIGlkKTtcbiAgICByZXR1cm4gaWQ7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=