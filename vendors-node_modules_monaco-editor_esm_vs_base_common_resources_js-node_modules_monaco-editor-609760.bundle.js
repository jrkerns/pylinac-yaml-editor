"use strict";
(self["webpackChunkpylinac_yaml_editor"] = self["webpackChunkpylinac_yaml_editor"] || []).push([["vendors-node_modules_monaco-editor_esm_vs_base_common_resources_js-node_modules_monaco-editor-609760"],{

/***/ "./node_modules/monaco-editor/esm/vs/base/common/extpath.js":
/*!******************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/extpath.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getRoot: () => (/* binding */ getRoot),
/* harmony export */   hasDriveLetter: () => (/* binding */ hasDriveLetter),
/* harmony export */   isEqualOrParent: () => (/* binding */ isEqualOrParent),
/* harmony export */   isPathSeparator: () => (/* binding */ isPathSeparator),
/* harmony export */   isWindowsDriveLetter: () => (/* binding */ isWindowsDriveLetter),
/* harmony export */   toPosixPath: () => (/* binding */ toPosixPath),
/* harmony export */   toSlashes: () => (/* binding */ toSlashes)
/* harmony export */ });
/* harmony import */ var _path_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./path.js */ "./node_modules/monaco-editor/esm/vs/base/common/path.js");
/* harmony import */ var _platform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./platform.js */ "./node_modules/monaco-editor/esm/vs/base/common/platform.js");
/* harmony import */ var _strings_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/



function isPathSeparator(code) {
    return code === 47 /* CharCode.Slash */ || code === 92 /* CharCode.Backslash */;
}
/**
 * Takes a Windows OS path and changes backward slashes to forward slashes.
 * This should only be done for OS paths from Windows (or user provided paths potentially from Windows).
 * Using it on a Linux or MaxOS path might change it.
 */
function toSlashes(osPath) {
    return osPath.replace(/[\\/]/g, _path_js__WEBPACK_IMPORTED_MODULE_0__.posix.sep);
}
/**
 * Takes a Windows OS path (using backward or forward slashes) and turns it into a posix path:
 * - turns backward slashes into forward slashes
 * - makes it absolute if it starts with a drive letter
 * This should only be done for OS paths from Windows (or user provided paths potentially from Windows).
 * Using it on a Linux or MaxOS path might change it.
 */
function toPosixPath(osPath) {
    if (osPath.indexOf('/') === -1) {
        osPath = toSlashes(osPath);
    }
    if (/^[a-zA-Z]:(\/|$)/.test(osPath)) { // starts with a drive letter
        osPath = '/' + osPath;
    }
    return osPath;
}
/**
 * Computes the _root_ this path, like `getRoot('c:\files') === c:\`,
 * `getRoot('files:///files/path') === files:///`,
 * or `getRoot('\\server\shares\path') === \\server\shares\`
 */
function getRoot(path, sep = _path_js__WEBPACK_IMPORTED_MODULE_0__.posix.sep) {
    if (!path) {
        return '';
    }
    const len = path.length;
    const firstLetter = path.charCodeAt(0);
    if (isPathSeparator(firstLetter)) {
        if (isPathSeparator(path.charCodeAt(1))) {
            // UNC candidate \\localhost\shares\ddd
            //               ^^^^^^^^^^^^^^^^^^^
            if (!isPathSeparator(path.charCodeAt(2))) {
                let pos = 3;
                const start = pos;
                for (; pos < len; pos++) {
                    if (isPathSeparator(path.charCodeAt(pos))) {
                        break;
                    }
                }
                if (start !== pos && !isPathSeparator(path.charCodeAt(pos + 1))) {
                    pos += 1;
                    for (; pos < len; pos++) {
                        if (isPathSeparator(path.charCodeAt(pos))) {
                            return path.slice(0, pos + 1) // consume this separator
                                .replace(/[\\/]/g, sep);
                        }
                    }
                }
            }
        }
        // /user/far
        // ^
        return sep;
    }
    else if (isWindowsDriveLetter(firstLetter)) {
        // check for windows drive letter c:\ or c:
        if (path.charCodeAt(1) === 58 /* CharCode.Colon */) {
            if (isPathSeparator(path.charCodeAt(2))) {
                // C:\fff
                // ^^^
                return path.slice(0, 2) + sep;
            }
            else {
                // C:
                // ^^
                return path.slice(0, 2);
            }
        }
    }
    // check for URI
    // scheme://authority/path
    // ^^^^^^^^^^^^^^^^^^^
    let pos = path.indexOf('://');
    if (pos !== -1) {
        pos += 3; // 3 -> "://".length
        for (; pos < len; pos++) {
            if (isPathSeparator(path.charCodeAt(pos))) {
                return path.slice(0, pos + 1); // consume this separator
            }
        }
    }
    return '';
}
/**
 * @deprecated please use `IUriIdentityService.extUri.isEqualOrParent` instead. If
 * you are in a context without services, consider to pass down the `extUri` from the
 * outside, or use `extUriBiasedIgnorePathCase` if you know what you are doing.
 */
function isEqualOrParent(base, parentCandidate, ignoreCase, separator = _path_js__WEBPACK_IMPORTED_MODULE_0__.sep) {
    if (base === parentCandidate) {
        return true;
    }
    if (!base || !parentCandidate) {
        return false;
    }
    if (parentCandidate.length > base.length) {
        return false;
    }
    if (ignoreCase) {
        const beginsWith = (0,_strings_js__WEBPACK_IMPORTED_MODULE_2__.startsWithIgnoreCase)(base, parentCandidate);
        if (!beginsWith) {
            return false;
        }
        if (parentCandidate.length === base.length) {
            return true; // same path, different casing
        }
        let sepOffset = parentCandidate.length;
        if (parentCandidate.charAt(parentCandidate.length - 1) === separator) {
            sepOffset--; // adjust the expected sep offset in case our candidate already ends in separator character
        }
        return base.charAt(sepOffset) === separator;
    }
    if (parentCandidate.charAt(parentCandidate.length - 1) !== separator) {
        parentCandidate += separator;
    }
    return base.indexOf(parentCandidate) === 0;
}
function isWindowsDriveLetter(char0) {
    return char0 >= 65 /* CharCode.A */ && char0 <= 90 /* CharCode.Z */ || char0 >= 97 /* CharCode.a */ && char0 <= 122 /* CharCode.z */;
}
function hasDriveLetter(path, isWindowsOS = _platform_js__WEBPACK_IMPORTED_MODULE_1__.isWindows) {
    if (isWindowsOS) {
        return isWindowsDriveLetter(path.charCodeAt(0)) && path.charCodeAt(1) === 58 /* CharCode.Colon */;
    }
    return false;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/base/common/mime.js":
/*!***************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/mime.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Mimes: () => (/* binding */ Mimes)
/* harmony export */ });
const Mimes = Object.freeze({
    text: 'text/plain',
    binary: 'application/octet-stream',
    unknown: 'application/unknown',
    markdown: 'text/markdown',
    latex: 'text/latex',
    uriList: 'text/uri-list',
});


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/base/common/resources.js":
/*!********************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/resources.js ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DataUri: () => (/* binding */ DataUri),
/* harmony export */   ExtUri: () => (/* binding */ ExtUri),
/* harmony export */   addTrailingPathSeparator: () => (/* binding */ addTrailingPathSeparator),
/* harmony export */   basename: () => (/* binding */ basename),
/* harmony export */   basenameOrAuthority: () => (/* binding */ basenameOrAuthority),
/* harmony export */   dirname: () => (/* binding */ dirname),
/* harmony export */   extUri: () => (/* binding */ extUri),
/* harmony export */   extUriBiasedIgnorePathCase: () => (/* binding */ extUriBiasedIgnorePathCase),
/* harmony export */   extUriIgnorePathCase: () => (/* binding */ extUriIgnorePathCase),
/* harmony export */   extname: () => (/* binding */ extname),
/* harmony export */   getComparisonKey: () => (/* binding */ getComparisonKey),
/* harmony export */   hasTrailingPathSeparator: () => (/* binding */ hasTrailingPathSeparator),
/* harmony export */   isAbsolutePath: () => (/* binding */ isAbsolutePath),
/* harmony export */   isEqual: () => (/* binding */ isEqual),
/* harmony export */   isEqualAuthority: () => (/* binding */ isEqualAuthority),
/* harmony export */   isEqualOrParent: () => (/* binding */ isEqualOrParent),
/* harmony export */   joinPath: () => (/* binding */ joinPath),
/* harmony export */   normalizePath: () => (/* binding */ normalizePath),
/* harmony export */   originalFSPath: () => (/* binding */ originalFSPath),
/* harmony export */   relativePath: () => (/* binding */ relativePath),
/* harmony export */   removeTrailingPathSeparator: () => (/* binding */ removeTrailingPathSeparator),
/* harmony export */   resolvePath: () => (/* binding */ resolvePath)
/* harmony export */ });
/* harmony import */ var _extpath_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./extpath.js */ "./node_modules/monaco-editor/esm/vs/base/common/extpath.js");
/* harmony import */ var _network_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./network.js */ "./node_modules/monaco-editor/esm/vs/base/common/network.js");
/* harmony import */ var _path_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./path.js */ "./node_modules/monaco-editor/esm/vs/base/common/path.js");
/* harmony import */ var _platform_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./platform.js */ "./node_modules/monaco-editor/esm/vs/base/common/platform.js");
/* harmony import */ var _strings_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/* harmony import */ var _uri_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./uri.js */ "./node_modules/monaco-editor/esm/vs/base/common/uri.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/






function originalFSPath(uri) {
    return (0,_uri_js__WEBPACK_IMPORTED_MODULE_5__.uriToFsPath)(uri, true);
}
class ExtUri {
    constructor(_ignorePathCasing) {
        this._ignorePathCasing = _ignorePathCasing;
    }
    compare(uri1, uri2, ignoreFragment = false) {
        if (uri1 === uri2) {
            return 0;
        }
        return (0,_strings_js__WEBPACK_IMPORTED_MODULE_4__.compare)(this.getComparisonKey(uri1, ignoreFragment), this.getComparisonKey(uri2, ignoreFragment));
    }
    isEqual(uri1, uri2, ignoreFragment = false) {
        if (uri1 === uri2) {
            return true;
        }
        if (!uri1 || !uri2) {
            return false;
        }
        return this.getComparisonKey(uri1, ignoreFragment) === this.getComparisonKey(uri2, ignoreFragment);
    }
    getComparisonKey(uri, ignoreFragment = false) {
        return uri.with({
            path: this._ignorePathCasing(uri) ? uri.path.toLowerCase() : undefined,
            fragment: ignoreFragment ? null : undefined
        }).toString();
    }
    isEqualOrParent(base, parentCandidate, ignoreFragment = false) {
        if (base.scheme === parentCandidate.scheme) {
            if (base.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
                return _extpath_js__WEBPACK_IMPORTED_MODULE_0__.isEqualOrParent(originalFSPath(base), originalFSPath(parentCandidate), this._ignorePathCasing(base)) && base.query === parentCandidate.query && (ignoreFragment || base.fragment === parentCandidate.fragment);
            }
            if (isEqualAuthority(base.authority, parentCandidate.authority)) {
                return _extpath_js__WEBPACK_IMPORTED_MODULE_0__.isEqualOrParent(base.path, parentCandidate.path, this._ignorePathCasing(base), '/') && base.query === parentCandidate.query && (ignoreFragment || base.fragment === parentCandidate.fragment);
            }
        }
        return false;
    }
    // --- path math
    joinPath(resource, ...pathFragment) {
        return _uri_js__WEBPACK_IMPORTED_MODULE_5__.URI.joinPath(resource, ...pathFragment);
    }
    basenameOrAuthority(resource) {
        return basename(resource) || resource.authority;
    }
    basename(resource) {
        return _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.basename(resource.path);
    }
    extname(resource) {
        return _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.extname(resource.path);
    }
    dirname(resource) {
        if (resource.path.length === 0) {
            return resource;
        }
        let dirname;
        if (resource.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            dirname = _uri_js__WEBPACK_IMPORTED_MODULE_5__.URI.file(_path_js__WEBPACK_IMPORTED_MODULE_2__.dirname(originalFSPath(resource))).path;
        }
        else {
            dirname = _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.dirname(resource.path);
            if (resource.authority && dirname.length && dirname.charCodeAt(0) !== 47 /* CharCode.Slash */) {
                console.error(`dirname("${resource.toString})) resulted in a relative path`);
                dirname = '/'; // If a URI contains an authority component, then the path component must either be empty or begin with a CharCode.Slash ("/") character
            }
        }
        return resource.with({
            path: dirname
        });
    }
    normalizePath(resource) {
        if (!resource.path.length) {
            return resource;
        }
        let normalizedPath;
        if (resource.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            normalizedPath = _uri_js__WEBPACK_IMPORTED_MODULE_5__.URI.file(_path_js__WEBPACK_IMPORTED_MODULE_2__.normalize(originalFSPath(resource))).path;
        }
        else {
            normalizedPath = _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.normalize(resource.path);
        }
        return resource.with({
            path: normalizedPath
        });
    }
    relativePath(from, to) {
        if (from.scheme !== to.scheme || !isEqualAuthority(from.authority, to.authority)) {
            return undefined;
        }
        if (from.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            const relativePath = _path_js__WEBPACK_IMPORTED_MODULE_2__.relative(originalFSPath(from), originalFSPath(to));
            return _platform_js__WEBPACK_IMPORTED_MODULE_3__.isWindows ? _extpath_js__WEBPACK_IMPORTED_MODULE_0__.toSlashes(relativePath) : relativePath;
        }
        let fromPath = from.path || '/';
        const toPath = to.path || '/';
        if (this._ignorePathCasing(from)) {
            // make casing of fromPath match toPath
            let i = 0;
            for (const len = Math.min(fromPath.length, toPath.length); i < len; i++) {
                if (fromPath.charCodeAt(i) !== toPath.charCodeAt(i)) {
                    if (fromPath.charAt(i).toLowerCase() !== toPath.charAt(i).toLowerCase()) {
                        break;
                    }
                }
            }
            fromPath = toPath.substr(0, i) + fromPath.substr(i);
        }
        return _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.relative(fromPath, toPath);
    }
    resolvePath(base, path) {
        if (base.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            const newURI = _uri_js__WEBPACK_IMPORTED_MODULE_5__.URI.file(_path_js__WEBPACK_IMPORTED_MODULE_2__.resolve(originalFSPath(base), path));
            return base.with({
                authority: newURI.authority,
                path: newURI.path
            });
        }
        path = _extpath_js__WEBPACK_IMPORTED_MODULE_0__.toPosixPath(path); // we allow path to be a windows path
        return base.with({
            path: _path_js__WEBPACK_IMPORTED_MODULE_2__.posix.resolve(base.path, path)
        });
    }
    // --- misc
    isAbsolutePath(resource) {
        return !!resource.path && resource.path[0] === '/';
    }
    isEqualAuthority(a1, a2) {
        return a1 === a2 || (a1 !== undefined && a2 !== undefined && (0,_strings_js__WEBPACK_IMPORTED_MODULE_4__.equalsIgnoreCase)(a1, a2));
    }
    hasTrailingPathSeparator(resource, sep = _path_js__WEBPACK_IMPORTED_MODULE_2__.sep) {
        if (resource.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            const fsp = originalFSPath(resource);
            return fsp.length > _extpath_js__WEBPACK_IMPORTED_MODULE_0__.getRoot(fsp).length && fsp[fsp.length - 1] === sep;
        }
        else {
            const p = resource.path;
            return (p.length > 1 && p.charCodeAt(p.length - 1) === 47 /* CharCode.Slash */) && !(/^[a-zA-Z]:(\/$|\\$)/.test(resource.fsPath)); // ignore the slash at offset 0
        }
    }
    removeTrailingPathSeparator(resource, sep = _path_js__WEBPACK_IMPORTED_MODULE_2__.sep) {
        // Make sure that the path isn't a drive letter. A trailing separator there is not removable.
        if (hasTrailingPathSeparator(resource, sep)) {
            return resource.with({ path: resource.path.substr(0, resource.path.length - 1) });
        }
        return resource;
    }
    addTrailingPathSeparator(resource, sep = _path_js__WEBPACK_IMPORTED_MODULE_2__.sep) {
        let isRootSep = false;
        if (resource.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file) {
            const fsp = originalFSPath(resource);
            isRootSep = ((fsp !== undefined) && (fsp.length === _extpath_js__WEBPACK_IMPORTED_MODULE_0__.getRoot(fsp).length) && (fsp[fsp.length - 1] === sep));
        }
        else {
            sep = '/';
            const p = resource.path;
            isRootSep = p.length === 1 && p.charCodeAt(p.length - 1) === 47 /* CharCode.Slash */;
        }
        if (!isRootSep && !hasTrailingPathSeparator(resource, sep)) {
            return resource.with({ path: resource.path + '/' });
        }
        return resource;
    }
}
/**
 * Unbiased utility that takes uris "as they are". This means it can be interchanged with
 * uri#toString() usages. The following is true
 * ```
 * assertEqual(aUri.toString() === bUri.toString(), exturi.isEqual(aUri, bUri))
 * ```
 */
const extUri = new ExtUri(() => false);
/**
 * BIASED utility that _mostly_ ignored the case of urs paths. ONLY use this util if you
 * understand what you are doing.
 *
 * This utility is INCOMPATIBLE with `uri.toString()`-usages and both CANNOT be used interchanged.
 *
 * When dealing with uris from files or documents, `extUri` (the unbiased friend)is sufficient
 * because those uris come from a "trustworthy source". When creating unknown uris it's always
 * better to use `IUriIdentityService` which exposes an `IExtUri`-instance which knows when path
 * casing matters.
 */
const extUriBiasedIgnorePathCase = new ExtUri(uri => {
    // A file scheme resource is in the same platform as code, so ignore case for non linux platforms
    // Resource can be from another platform. Lowering the case as an hack. Should come from File system provider
    return uri.scheme === _network_js__WEBPACK_IMPORTED_MODULE_1__.Schemas.file ? !_platform_js__WEBPACK_IMPORTED_MODULE_3__.isLinux : true;
});
/**
 * BIASED utility that always ignores the casing of uris paths. ONLY use this util if you
 * understand what you are doing.
 *
 * This utility is INCOMPATIBLE with `uri.toString()`-usages and both CANNOT be used interchanged.
 *
 * When dealing with uris from files or documents, `extUri` (the unbiased friend)is sufficient
 * because those uris come from a "trustworthy source". When creating unknown uris it's always
 * better to use `IUriIdentityService` which exposes an `IExtUri`-instance which knows when path
 * casing matters.
 */
const extUriIgnorePathCase = new ExtUri(_ => true);
const isEqual = extUri.isEqual.bind(extUri);
const isEqualOrParent = extUri.isEqualOrParent.bind(extUri);
const getComparisonKey = extUri.getComparisonKey.bind(extUri);
const basenameOrAuthority = extUri.basenameOrAuthority.bind(extUri);
const basename = extUri.basename.bind(extUri);
const extname = extUri.extname.bind(extUri);
const dirname = extUri.dirname.bind(extUri);
const joinPath = extUri.joinPath.bind(extUri);
const normalizePath = extUri.normalizePath.bind(extUri);
const relativePath = extUri.relativePath.bind(extUri);
const resolvePath = extUri.resolvePath.bind(extUri);
const isAbsolutePath = extUri.isAbsolutePath.bind(extUri);
const isEqualAuthority = extUri.isEqualAuthority.bind(extUri);
const hasTrailingPathSeparator = extUri.hasTrailingPathSeparator.bind(extUri);
const removeTrailingPathSeparator = extUri.removeTrailingPathSeparator.bind(extUri);
const addTrailingPathSeparator = extUri.addTrailingPathSeparator.bind(extUri);
/**
 * Data URI related helpers.
 */
var DataUri;
(function (DataUri) {
    DataUri.META_DATA_LABEL = 'label';
    DataUri.META_DATA_DESCRIPTION = 'description';
    DataUri.META_DATA_SIZE = 'size';
    DataUri.META_DATA_MIME = 'mime';
    function parseMetaData(dataUri) {
        const metadata = new Map();
        // Given a URI of:  data:image/png;size:2313;label:SomeLabel;description:SomeDescription;base64,77+9UE5...
        // the metadata is: size:2313;label:SomeLabel;description:SomeDescription
        const meta = dataUri.path.substring(dataUri.path.indexOf(';') + 1, dataUri.path.lastIndexOf(';'));
        meta.split(';').forEach(property => {
            const [key, value] = property.split(':');
            if (key && value) {
                metadata.set(key, value);
            }
        });
        // Given a URI of:  data:image/png;size:2313;label:SomeLabel;description:SomeDescription;base64,77+9UE5...
        // the mime is: image/png
        const mime = dataUri.path.substring(0, dataUri.path.indexOf(';'));
        if (mime) {
            metadata.set(DataUri.META_DATA_MIME, mime);
        }
        return metadata;
    }
    DataUri.parseMetaData = parseMetaData;
})(DataUri || (DataUri = {}));


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/languages/modesRegistry.js":
/*!************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/languages/modesRegistry.js ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   EditorModesRegistry: () => (/* binding */ EditorModesRegistry),
/* harmony export */   Extensions: () => (/* binding */ Extensions),
/* harmony export */   ModesRegistry: () => (/* binding */ ModesRegistry),
/* harmony export */   PLAINTEXT_EXTENSION: () => (/* binding */ PLAINTEXT_EXTENSION),
/* harmony export */   PLAINTEXT_LANGUAGE_ID: () => (/* binding */ PLAINTEXT_LANGUAGE_ID)
/* harmony export */ });
/* harmony import */ var _nls_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../nls.js */ "./node_modules/monaco-editor/esm/vs/nls.js");
/* harmony import */ var _base_common_event_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/event.js */ "./node_modules/monaco-editor/esm/vs/base/common/event.js");
/* harmony import */ var _platform_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../platform/registry/common/platform.js */ "./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js");
/* harmony import */ var _base_common_mime_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../base/common/mime.js */ "./node_modules/monaco-editor/esm/vs/base/common/mime.js");
/* harmony import */ var _platform_configuration_common_configurationRegistry_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../platform/configuration/common/configurationRegistry.js */ "./node_modules/monaco-editor/esm/vs/platform/configuration/common/configurationRegistry.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/





// Define extension point ids
const Extensions = {
    ModesRegistry: 'editor.modesRegistry'
};
class EditorModesRegistry {
    constructor() {
        this._onDidChangeLanguages = new _base_common_event_js__WEBPACK_IMPORTED_MODULE_1__.Emitter();
        this.onDidChangeLanguages = this._onDidChangeLanguages.event;
        this._languages = [];
    }
    registerLanguage(def) {
        this._languages.push(def);
        this._onDidChangeLanguages.fire(undefined);
        return {
            dispose: () => {
                for (let i = 0, len = this._languages.length; i < len; i++) {
                    if (this._languages[i] === def) {
                        this._languages.splice(i, 1);
                        return;
                    }
                }
            }
        };
    }
    getLanguages() {
        return this._languages;
    }
}
const ModesRegistry = new EditorModesRegistry();
_platform_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_2__.Registry.add(Extensions.ModesRegistry, ModesRegistry);
const PLAINTEXT_LANGUAGE_ID = 'plaintext';
const PLAINTEXT_EXTENSION = '.txt';
ModesRegistry.registerLanguage({
    id: PLAINTEXT_LANGUAGE_ID,
    extensions: [PLAINTEXT_EXTENSION],
    aliases: [_nls_js__WEBPACK_IMPORTED_MODULE_0__.localize('plainText.alias', "Plain Text"), 'text'],
    mimetypes: [_base_common_mime_js__WEBPACK_IMPORTED_MODULE_3__.Mimes.text]
});
_platform_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_2__.Registry.as(_platform_configuration_common_configurationRegistry_js__WEBPACK_IMPORTED_MODULE_4__.Extensions.Configuration)
    .registerDefaultConfigurations([{
        overrides: {
            '[plaintext]': {
                'editor.unicodeHighlight.ambiguousCharacters': false,
                'editor.unicodeHighlight.invisibleCharacters': false
            }
        }
    }]);


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/configuration/common/configuration.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/configuration/common/configuration.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IConfigurationService: () => (/* binding */ IConfigurationService),
/* harmony export */   addToValueTree: () => (/* binding */ addToValueTree),
/* harmony export */   getConfigurationValue: () => (/* binding */ getConfigurationValue),
/* harmony export */   getLanguageTagSettingPlainKey: () => (/* binding */ getLanguageTagSettingPlainKey),
/* harmony export */   removeFromValueTree: () => (/* binding */ removeFromValueTree),
/* harmony export */   toValuesTree: () => (/* binding */ toValuesTree)
/* harmony export */ });
/* harmony import */ var _instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../instantiation/common/instantiation.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

const IConfigurationService = (0,_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__.createDecorator)('configurationService');
function toValuesTree(properties, conflictReporter) {
    const root = Object.create(null);
    for (const key in properties) {
        addToValueTree(root, key, properties[key], conflictReporter);
    }
    return root;
}
function addToValueTree(settingsTreeRoot, key, value, conflictReporter) {
    const segments = key.split('.');
    const last = segments.pop();
    let curr = settingsTreeRoot;
    for (let i = 0; i < segments.length; i++) {
        const s = segments[i];
        let obj = curr[s];
        switch (typeof obj) {
            case 'undefined':
                obj = curr[s] = Object.create(null);
                break;
            case 'object':
                if (obj === null) {
                    conflictReporter(`Ignoring ${key} as ${segments.slice(0, i + 1).join('.')} is null`);
                    return;
                }
                break;
            default:
                conflictReporter(`Ignoring ${key} as ${segments.slice(0, i + 1).join('.')} is ${JSON.stringify(obj)}`);
                return;
        }
        curr = obj;
    }
    if (typeof curr === 'object' && curr !== null) {
        try {
            curr[last] = value; // workaround https://github.com/microsoft/vscode/issues/13606
        }
        catch (e) {
            conflictReporter(`Ignoring ${key} as ${segments.join('.')} is ${JSON.stringify(curr)}`);
        }
    }
    else {
        conflictReporter(`Ignoring ${key} as ${segments.join('.')} is ${JSON.stringify(curr)}`);
    }
}
function removeFromValueTree(valueTree, key) {
    const segments = key.split('.');
    doRemoveFromValueTree(valueTree, segments);
}
function doRemoveFromValueTree(valueTree, segments) {
    const first = segments.shift();
    if (segments.length === 0) {
        // Reached last segment
        delete valueTree[first];
        return;
    }
    if (Object.keys(valueTree).indexOf(first) !== -1) {
        const value = valueTree[first];
        if (typeof value === 'object' && !Array.isArray(value)) {
            doRemoveFromValueTree(value, segments);
            if (Object.keys(value).length === 0) {
                delete valueTree[first];
            }
        }
    }
}
/**
 * A helper function to get the configuration value with a specific settings path (e.g. config.some.setting)
 */
function getConfigurationValue(config, settingPath, defaultValue) {
    function accessSetting(config, path) {
        let current = config;
        for (const component of path) {
            if (typeof current !== 'object' || current === null) {
                return undefined;
            }
            current = current[component];
        }
        return current;
    }
    const path = settingPath.split('.');
    const result = accessSetting(config, path);
    return typeof result === 'undefined' ? defaultValue : result;
}
function getLanguageTagSettingPlainKey(settingKey) {
    return settingKey.replace(/[\[\]]/g, '');
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/configuration/common/configurationRegistry.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/configuration/common/configurationRegistry.js ***!
  \**************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Extensions: () => (/* binding */ Extensions),
/* harmony export */   OVERRIDE_PROPERTY_PATTERN: () => (/* binding */ OVERRIDE_PROPERTY_PATTERN),
/* harmony export */   OVERRIDE_PROPERTY_REGEX: () => (/* binding */ OVERRIDE_PROPERTY_REGEX),
/* harmony export */   allSettings: () => (/* binding */ allSettings),
/* harmony export */   applicationSettings: () => (/* binding */ applicationSettings),
/* harmony export */   getDefaultValue: () => (/* binding */ getDefaultValue),
/* harmony export */   machineOverridableSettings: () => (/* binding */ machineOverridableSettings),
/* harmony export */   machineSettings: () => (/* binding */ machineSettings),
/* harmony export */   overrideIdentifiersFromKey: () => (/* binding */ overrideIdentifiersFromKey),
/* harmony export */   resourceLanguageSettingsSchemaId: () => (/* binding */ resourceLanguageSettingsSchemaId),
/* harmony export */   resourceSettings: () => (/* binding */ resourceSettings),
/* harmony export */   validateProperty: () => (/* binding */ validateProperty),
/* harmony export */   windowSettings: () => (/* binding */ windowSettings)
/* harmony export */ });
/* harmony import */ var _base_common_arrays_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/arrays.js */ "./node_modules/monaco-editor/esm/vs/base/common/arrays.js");
/* harmony import */ var _base_common_event_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/event.js */ "./node_modules/monaco-editor/esm/vs/base/common/event.js");
/* harmony import */ var _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/common/types.js */ "./node_modules/monaco-editor/esm/vs/base/common/types.js");
/* harmony import */ var _nls_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../nls.js */ "./node_modules/monaco-editor/esm/vs/nls.js");
/* harmony import */ var _configuration_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./configuration.js */ "./node_modules/monaco-editor/esm/vs/platform/configuration/common/configuration.js");
/* harmony import */ var _jsonschemas_common_jsonContributionRegistry_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../jsonschemas/common/jsonContributionRegistry.js */ "./node_modules/monaco-editor/esm/vs/platform/jsonschemas/common/jsonContributionRegistry.js");
/* harmony import */ var _registry_common_platform_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../registry/common/platform.js */ "./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/







const Extensions = {
    Configuration: 'base.contributions.configuration'
};
const allSettings = { properties: {}, patternProperties: {} };
const applicationSettings = { properties: {}, patternProperties: {} };
const machineSettings = { properties: {}, patternProperties: {} };
const machineOverridableSettings = { properties: {}, patternProperties: {} };
const windowSettings = { properties: {}, patternProperties: {} };
const resourceSettings = { properties: {}, patternProperties: {} };
const resourceLanguageSettingsSchemaId = 'vscode://schemas/settings/resourceLanguage';
const contributionRegistry = _registry_common_platform_js__WEBPACK_IMPORTED_MODULE_6__.Registry.as(_jsonschemas_common_jsonContributionRegistry_js__WEBPACK_IMPORTED_MODULE_5__.Extensions.JSONContribution);
class ConfigurationRegistry {
    constructor() {
        this.registeredConfigurationDefaults = [];
        this.overrideIdentifiers = new Set();
        this._onDidSchemaChange = new _base_common_event_js__WEBPACK_IMPORTED_MODULE_1__.Emitter();
        this._onDidUpdateConfiguration = new _base_common_event_js__WEBPACK_IMPORTED_MODULE_1__.Emitter();
        this.configurationDefaultsOverrides = new Map();
        this.defaultLanguageConfigurationOverridesNode = {
            id: 'defaultOverrides',
            title: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('defaultLanguageConfigurationOverrides.title', "Default Language Configuration Overrides"),
            properties: {}
        };
        this.configurationContributors = [this.defaultLanguageConfigurationOverridesNode];
        this.resourceLanguageSettingsSchema = {
            properties: {},
            patternProperties: {},
            additionalProperties: true,
            allowTrailingCommas: true,
            allowComments: true
        };
        this.configurationProperties = {};
        this.policyConfigurations = new Map();
        this.excludedConfigurationProperties = {};
        contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId, this.resourceLanguageSettingsSchema);
        this.registerOverridePropertyPatternKey();
    }
    registerConfiguration(configuration, validate = true) {
        this.registerConfigurations([configuration], validate);
    }
    registerConfigurations(configurations, validate = true) {
        const properties = new Set();
        this.doRegisterConfigurations(configurations, validate, properties);
        contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId, this.resourceLanguageSettingsSchema);
        this._onDidSchemaChange.fire();
        this._onDidUpdateConfiguration.fire({ properties });
    }
    registerDefaultConfigurations(configurationDefaults) {
        const properties = new Set();
        this.doRegisterDefaultConfigurations(configurationDefaults, properties);
        this._onDidSchemaChange.fire();
        this._onDidUpdateConfiguration.fire({ properties, defaultsOverrides: true });
    }
    doRegisterDefaultConfigurations(configurationDefaults, bucket) {
        this.registeredConfigurationDefaults.push(...configurationDefaults);
        const overrideIdentifiers = [];
        for (const { overrides, source } of configurationDefaults) {
            for (const key in overrides) {
                bucket.add(key);
                const configurationDefaultOverridesForKey = this.configurationDefaultsOverrides.get(key)
                    ?? this.configurationDefaultsOverrides.set(key, { configurationDefaultOverrides: [] }).get(key);
                const value = overrides[key];
                configurationDefaultOverridesForKey.configurationDefaultOverrides.push({ value, source });
                // Configuration defaults for Override Identifiers
                if (OVERRIDE_PROPERTY_REGEX.test(key)) {
                    const newDefaultOverride = this.mergeDefaultConfigurationsForOverrideIdentifier(key, value, source, configurationDefaultOverridesForKey.configurationDefaultOverrideValue);
                    if (!newDefaultOverride) {
                        continue;
                    }
                    configurationDefaultOverridesForKey.configurationDefaultOverrideValue = newDefaultOverride;
                    this.updateDefaultOverrideProperty(key, newDefaultOverride, source);
                    overrideIdentifiers.push(...overrideIdentifiersFromKey(key));
                }
                // Configuration defaults for Configuration Properties
                else {
                    const newDefaultOverride = this.mergeDefaultConfigurationsForConfigurationProperty(key, value, source, configurationDefaultOverridesForKey.configurationDefaultOverrideValue);
                    if (!newDefaultOverride) {
                        continue;
                    }
                    configurationDefaultOverridesForKey.configurationDefaultOverrideValue = newDefaultOverride;
                    const property = this.configurationProperties[key];
                    if (property) {
                        this.updatePropertyDefaultValue(key, property);
                        this.updateSchema(key, property);
                    }
                }
            }
        }
        this.doRegisterOverrideIdentifiers(overrideIdentifiers);
    }
    updateDefaultOverrideProperty(key, newDefaultOverride, source) {
        const property = {
            type: 'object',
            default: newDefaultOverride.value,
            description: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('defaultLanguageConfiguration.description', "Configure settings to be overridden for the {0} language.", (0,_configuration_js__WEBPACK_IMPORTED_MODULE_4__.getLanguageTagSettingPlainKey)(key)),
            $ref: resourceLanguageSettingsSchemaId,
            defaultDefaultValue: newDefaultOverride.value,
            source,
            defaultValueSource: source
        };
        this.configurationProperties[key] = property;
        this.defaultLanguageConfigurationOverridesNode.properties[key] = property;
    }
    mergeDefaultConfigurationsForOverrideIdentifier(overrideIdentifier, configurationValueObject, valueSource, existingDefaultOverride) {
        const defaultValue = existingDefaultOverride?.value || {};
        const source = existingDefaultOverride?.source ?? new Map();
        // This should not happen
        if (!(source instanceof Map)) {
            console.error('objectConfigurationSources is not a Map');
            return undefined;
        }
        for (const propertyKey of Object.keys(configurationValueObject)) {
            const propertyDefaultValue = configurationValueObject[propertyKey];
            const isObjectSetting = _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isObject(propertyDefaultValue) &&
                (_base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefined(defaultValue[propertyKey]) || _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isObject(defaultValue[propertyKey]));
            // If the default value is an object, merge the objects and store the source of each keys
            if (isObjectSetting) {
                defaultValue[propertyKey] = { ...(defaultValue[propertyKey] ?? {}), ...propertyDefaultValue };
                // Track the source of each value in the object
                if (valueSource) {
                    for (const objectKey in propertyDefaultValue) {
                        source.set(`${propertyKey}.${objectKey}`, valueSource);
                    }
                }
            }
            // Primitive values are overridden
            else {
                defaultValue[propertyKey] = propertyDefaultValue;
                if (valueSource) {
                    source.set(propertyKey, valueSource);
                }
                else {
                    source.delete(propertyKey);
                }
            }
        }
        return { value: defaultValue, source };
    }
    mergeDefaultConfigurationsForConfigurationProperty(propertyKey, value, valuesSource, existingDefaultOverride) {
        const property = this.configurationProperties[propertyKey];
        const existingDefaultValue = existingDefaultOverride?.value ?? property?.defaultDefaultValue;
        let source = valuesSource;
        const isObjectSetting = _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isObject(value) &&
            (property !== undefined && property.type === 'object' ||
                property === undefined && (_base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefined(existingDefaultValue) || _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isObject(existingDefaultValue)));
        // If the default value is an object, merge the objects and store the source of each keys
        if (isObjectSetting) {
            source = existingDefaultOverride?.source ?? new Map();
            // This should not happen
            if (!(source instanceof Map)) {
                console.error('defaultValueSource is not a Map');
                return undefined;
            }
            for (const objectKey in value) {
                if (valuesSource) {
                    source.set(`${propertyKey}.${objectKey}`, valuesSource);
                }
            }
            value = { ...(_base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isObject(existingDefaultValue) ? existingDefaultValue : {}), ...value };
        }
        return { value, source };
    }
    registerOverrideIdentifiers(overrideIdentifiers) {
        this.doRegisterOverrideIdentifiers(overrideIdentifiers);
        this._onDidSchemaChange.fire();
    }
    doRegisterOverrideIdentifiers(overrideIdentifiers) {
        for (const overrideIdentifier of overrideIdentifiers) {
            this.overrideIdentifiers.add(overrideIdentifier);
        }
        this.updateOverridePropertyPatternKey();
    }
    doRegisterConfigurations(configurations, validate, bucket) {
        configurations.forEach(configuration => {
            this.validateAndRegisterProperties(configuration, validate, configuration.extensionInfo, configuration.restrictedProperties, undefined, bucket);
            this.configurationContributors.push(configuration);
            this.registerJSONConfiguration(configuration);
        });
    }
    validateAndRegisterProperties(configuration, validate = true, extensionInfo, restrictedProperties, scope = 3 /* ConfigurationScope.WINDOW */, bucket) {
        scope = _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefinedOrNull(configuration.scope) ? scope : configuration.scope;
        const properties = configuration.properties;
        if (properties) {
            for (const key in properties) {
                const property = properties[key];
                if (validate && validateProperty(key, property)) {
                    delete properties[key];
                    continue;
                }
                property.source = extensionInfo;
                // update default value
                property.defaultDefaultValue = properties[key].default;
                this.updatePropertyDefaultValue(key, property);
                // update scope
                if (OVERRIDE_PROPERTY_REGEX.test(key)) {
                    property.scope = undefined; // No scope for overridable properties `[${identifier}]`
                }
                else {
                    property.scope = _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefinedOrNull(property.scope) ? scope : property.scope;
                    property.restricted = _base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefinedOrNull(property.restricted) ? !!restrictedProperties?.includes(key) : property.restricted;
                }
                // Add to properties maps
                // Property is included by default if 'included' is unspecified
                if (properties[key].hasOwnProperty('included') && !properties[key].included) {
                    this.excludedConfigurationProperties[key] = properties[key];
                    delete properties[key];
                    continue;
                }
                else {
                    this.configurationProperties[key] = properties[key];
                    if (properties[key].policy?.name) {
                        this.policyConfigurations.set(properties[key].policy.name, key);
                    }
                }
                if (!properties[key].deprecationMessage && properties[key].markdownDeprecationMessage) {
                    // If not set, default deprecationMessage to the markdown source
                    properties[key].deprecationMessage = properties[key].markdownDeprecationMessage;
                }
                bucket.add(key);
            }
        }
        const subNodes = configuration.allOf;
        if (subNodes) {
            for (const node of subNodes) {
                this.validateAndRegisterProperties(node, validate, extensionInfo, restrictedProperties, scope, bucket);
            }
        }
    }
    getConfigurationProperties() {
        return this.configurationProperties;
    }
    getPolicyConfigurations() {
        return this.policyConfigurations;
    }
    registerJSONConfiguration(configuration) {
        const register = (configuration) => {
            const properties = configuration.properties;
            if (properties) {
                for (const key in properties) {
                    this.updateSchema(key, properties[key]);
                }
            }
            const subNodes = configuration.allOf;
            subNodes?.forEach(register);
        };
        register(configuration);
    }
    updateSchema(key, property) {
        allSettings.properties[key] = property;
        switch (property.scope) {
            case 1 /* ConfigurationScope.APPLICATION */:
                applicationSettings.properties[key] = property;
                break;
            case 2 /* ConfigurationScope.MACHINE */:
                machineSettings.properties[key] = property;
                break;
            case 6 /* ConfigurationScope.MACHINE_OVERRIDABLE */:
                machineOverridableSettings.properties[key] = property;
                break;
            case 3 /* ConfigurationScope.WINDOW */:
                windowSettings.properties[key] = property;
                break;
            case 4 /* ConfigurationScope.RESOURCE */:
                resourceSettings.properties[key] = property;
                break;
            case 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */:
                resourceSettings.properties[key] = property;
                this.resourceLanguageSettingsSchema.properties[key] = property;
                break;
        }
    }
    updateOverridePropertyPatternKey() {
        for (const overrideIdentifier of this.overrideIdentifiers.values()) {
            const overrideIdentifierProperty = `[${overrideIdentifier}]`;
            const resourceLanguagePropertiesSchema = {
                type: 'object',
                description: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('overrideSettings.defaultDescription', "Configure editor settings to be overridden for a language."),
                errorMessage: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('overrideSettings.errorMessage', "This setting does not support per-language configuration."),
                $ref: resourceLanguageSettingsSchemaId,
            };
            this.updatePropertyDefaultValue(overrideIdentifierProperty, resourceLanguagePropertiesSchema);
            allSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
            applicationSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
            machineSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
            machineOverridableSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
            windowSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
            resourceSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;
        }
    }
    registerOverridePropertyPatternKey() {
        const resourceLanguagePropertiesSchema = {
            type: 'object',
            description: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('overrideSettings.defaultDescription', "Configure editor settings to be overridden for a language."),
            errorMessage: _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('overrideSettings.errorMessage', "This setting does not support per-language configuration."),
            $ref: resourceLanguageSettingsSchemaId,
        };
        allSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        applicationSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        machineSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        machineOverridableSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        windowSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        resourceSettings.patternProperties[OVERRIDE_PROPERTY_PATTERN] = resourceLanguagePropertiesSchema;
        this._onDidSchemaChange.fire();
    }
    updatePropertyDefaultValue(key, property) {
        const configurationdefaultOverride = this.configurationDefaultsOverrides.get(key)?.configurationDefaultOverrideValue;
        let defaultValue = undefined;
        let defaultSource = undefined;
        if (configurationdefaultOverride
            && (!property.disallowConfigurationDefault || !configurationdefaultOverride.source) // Prevent overriding the default value if the property is disallowed to be overridden by configuration defaults from extensions
        ) {
            defaultValue = configurationdefaultOverride.value;
            defaultSource = configurationdefaultOverride.source;
        }
        if (_base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefined(defaultValue)) {
            defaultValue = property.defaultDefaultValue;
            defaultSource = undefined;
        }
        if (_base_common_types_js__WEBPACK_IMPORTED_MODULE_2__.isUndefined(defaultValue)) {
            defaultValue = getDefaultValue(property.type);
        }
        property.default = defaultValue;
        property.defaultValueSource = defaultSource;
    }
}
const OVERRIDE_IDENTIFIER_PATTERN = `\\[([^\\]]+)\\]`;
const OVERRIDE_IDENTIFIER_REGEX = new RegExp(OVERRIDE_IDENTIFIER_PATTERN, 'g');
const OVERRIDE_PROPERTY_PATTERN = `^(${OVERRIDE_IDENTIFIER_PATTERN})+$`;
const OVERRIDE_PROPERTY_REGEX = new RegExp(OVERRIDE_PROPERTY_PATTERN);
function overrideIdentifiersFromKey(key) {
    const identifiers = [];
    if (OVERRIDE_PROPERTY_REGEX.test(key)) {
        let matches = OVERRIDE_IDENTIFIER_REGEX.exec(key);
        while (matches?.length) {
            const identifier = matches[1].trim();
            if (identifier) {
                identifiers.push(identifier);
            }
            matches = OVERRIDE_IDENTIFIER_REGEX.exec(key);
        }
    }
    return (0,_base_common_arrays_js__WEBPACK_IMPORTED_MODULE_0__.distinct)(identifiers);
}
function getDefaultValue(type) {
    const t = Array.isArray(type) ? type[0] : type;
    switch (t) {
        case 'boolean':
            return false;
        case 'integer':
        case 'number':
            return 0;
        case 'string':
            return '';
        case 'array':
            return [];
        case 'object':
            return {};
        default:
            return null;
    }
}
const configurationRegistry = new ConfigurationRegistry();
_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_6__.Registry.add(Extensions.Configuration, configurationRegistry);
function validateProperty(property, schema) {
    if (!property.trim()) {
        return _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('config.property.empty', "Cannot register an empty property");
    }
    if (OVERRIDE_PROPERTY_REGEX.test(property)) {
        return _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('config.property.languageDefault', "Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.", property);
    }
    if (configurationRegistry.getConfigurationProperties()[property] !== undefined) {
        return _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('config.property.duplicate', "Cannot register '{0}'. This property is already registered.", property);
    }
    if (schema.policy?.name && configurationRegistry.getPolicyConfigurations().get(schema.policy?.name) !== undefined) {
        return _nls_js__WEBPACK_IMPORTED_MODULE_3__.localize('config.policy.duplicate', "Cannot register '{0}'. The associated policy {1} is already registered with {2}.", property, schema.policy?.name, configurationRegistry.getPolicyConfigurations().get(schema.policy?.name));
    }
    return null;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IInstantiationService: () => (/* binding */ IInstantiationService),
/* harmony export */   _util: () => (/* binding */ _util),
/* harmony export */   createDecorator: () => (/* binding */ createDecorator)
/* harmony export */ });
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
// ------ internal util
var _util;
(function (_util) {
    _util.serviceIds = new Map();
    _util.DI_TARGET = '$di$target';
    _util.DI_DEPENDENCIES = '$di$dependencies';
    function getServiceDependencies(ctor) {
        return ctor[_util.DI_DEPENDENCIES] || [];
    }
    _util.getServiceDependencies = getServiceDependencies;
})(_util || (_util = {}));
const IInstantiationService = createDecorator('instantiationService');
function storeServiceDependency(id, target, index) {
    if (target[_util.DI_TARGET] === target) {
        target[_util.DI_DEPENDENCIES].push({ id, index });
    }
    else {
        target[_util.DI_DEPENDENCIES] = [{ id, index }];
        target[_util.DI_TARGET] = target;
    }
}
/**
 * The *only* valid way to create a {{ServiceIdentifier}}.
 */
function createDecorator(serviceId) {
    if (_util.serviceIds.has(serviceId)) {
        return _util.serviceIds.get(serviceId);
    }
    const id = function (target, key, index) {
        if (arguments.length !== 3) {
            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');
        }
        storeServiceDependency(id, target, index);
    };
    id.toString = () => serviceId;
    _util.serviceIds.set(serviceId, id);
    return id;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/jsonschemas/common/jsonContributionRegistry.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/jsonschemas/common/jsonContributionRegistry.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Extensions: () => (/* binding */ Extensions)
/* harmony export */ });
/* harmony import */ var _base_common_event_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/event.js */ "./node_modules/monaco-editor/esm/vs/base/common/event.js");
/* harmony import */ var _registry_common_platform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../registry/common/platform.js */ "./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/


const Extensions = {
    JSONContribution: 'base.contributions.json'
};
function normalizeId(id) {
    if (id.length > 0 && id.charAt(id.length - 1) === '#') {
        return id.substring(0, id.length - 1);
    }
    return id;
}
class JSONContributionRegistry {
    constructor() {
        this._onDidChangeSchema = new _base_common_event_js__WEBPACK_IMPORTED_MODULE_0__.Emitter();
        this.schemasById = {};
    }
    registerSchema(uri, unresolvedSchemaContent) {
        this.schemasById[normalizeId(uri)] = unresolvedSchemaContent;
        this._onDidChangeSchema.fire(uri);
    }
    notifySchemaChanged(uri) {
        this._onDidChangeSchema.fire(uri);
    }
}
const jsonContributionRegistry = new JSONContributionRegistry();
_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_1__.Registry.add(Extensions.JSONContribution, jsonContributionRegistry);


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js":
/*!********************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Registry: () => (/* binding */ Registry)
/* harmony export */ });
/* harmony import */ var _base_common_assert_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/assert.js */ "./node_modules/monaco-editor/esm/vs/base/common/assert.js");
/* harmony import */ var _base_common_types_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/types.js */ "./node_modules/monaco-editor/esm/vs/base/common/types.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/


class RegistryImpl {
    constructor() {
        this.data = new Map();
    }
    add(id, data) {
        _base_common_assert_js__WEBPACK_IMPORTED_MODULE_0__.ok(_base_common_types_js__WEBPACK_IMPORTED_MODULE_1__.isString(id));
        _base_common_assert_js__WEBPACK_IMPORTED_MODULE_0__.ok(_base_common_types_js__WEBPACK_IMPORTED_MODULE_1__.isObject(data));
        _base_common_assert_js__WEBPACK_IMPORTED_MODULE_0__.ok(!this.data.has(id), 'There is already an extension with this id');
        this.data.set(id, data);
    }
    as(id) {
        return this.data.get(id) || null;
    }
}
const Registry = new RegistryImpl();


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfbW9uYWNvLWVkaXRvcl9lc21fdnNfYmFzZV9jb21tb25fcmVzb3VyY2VzX2pzLW5vZGVfbW9kdWxlc19tb25hY28tZWRpdG9yLTYwOTc2MC5idW5kbGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3VDO0FBQ0c7QUFDVTtBQUM3QztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCxvQ0FBb0MsMkNBQUs7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLDZCQUE2QiwyQ0FBSztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsV0FBVztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsV0FBVztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCLGVBQWUsV0FBVztBQUMxQjtBQUNBLCtDQUErQztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLHdFQUF3RSx5Q0FBRztBQUNsRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpRUFBb0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDd0Q7QUFDTTtBQUN2RDtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDBEQUFPO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRUFBaUI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDN0JqQjtBQUNBO0FBQ0E7QUFDQTtBQUN5RDtBQUNGO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFTLENBQUMsMkRBQWM7QUFDaEMsUUFBUSxzREFBUyxDQUFDLDJEQUFjO0FBQ2hDLFFBQVEsc0RBQVM7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2Jhc2UvY29tbW9uL2V4dHBhdGguanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9iYXNlL2NvbW1vbi9taW1lLmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvYmFzZS9jb21tb24vcmVzb3VyY2VzLmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvZWRpdG9yL2NvbW1vbi9sYW5ndWFnZXMvbW9kZXNSZWdpc3RyeS5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL3BsYXRmb3JtL2NvbmZpZ3VyYXRpb24vY29tbW9uL2NvbmZpZ3VyYXRpb24uanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9jb25maWd1cmF0aW9uL2NvbW1vbi9jb25maWd1cmF0aW9uUmVnaXN0cnkuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9pbnN0YW50aWF0aW9uL2NvbW1vbi9pbnN0YW50aWF0aW9uLmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvcGxhdGZvcm0vanNvbnNjaGVtYXMvY29tbW9uL2pzb25Db250cmlidXRpb25SZWdpc3RyeS5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL3BsYXRmb3JtL3JlZ2lzdHJ5L2NvbW1vbi9wbGF0Zm9ybS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmltcG9ydCB7IHBvc2l4LCBzZXAgfSBmcm9tICcuL3BhdGguanMnO1xuaW1wb3J0IHsgaXNXaW5kb3dzIH0gZnJvbSAnLi9wbGF0Zm9ybS5qcyc7XG5pbXBvcnQgeyBzdGFydHNXaXRoSWdub3JlQ2FzZSB9IGZyb20gJy4vc3RyaW5ncy5qcyc7XG5leHBvcnQgZnVuY3Rpb24gaXNQYXRoU2VwYXJhdG9yKGNvZGUpIHtcbiAgICByZXR1cm4gY29kZSA9PT0gNDcgLyogQ2hhckNvZGUuU2xhc2ggKi8gfHwgY29kZSA9PT0gOTIgLyogQ2hhckNvZGUuQmFja3NsYXNoICovO1xufVxuLyoqXG4gKiBUYWtlcyBhIFdpbmRvd3MgT1MgcGF0aCBhbmQgY2hhbmdlcyBiYWNrd2FyZCBzbGFzaGVzIHRvIGZvcndhcmQgc2xhc2hlcy5cbiAqIFRoaXMgc2hvdWxkIG9ubHkgYmUgZG9uZSBmb3IgT1MgcGF0aHMgZnJvbSBXaW5kb3dzIChvciB1c2VyIHByb3ZpZGVkIHBhdGhzIHBvdGVudGlhbGx5IGZyb20gV2luZG93cykuXG4gKiBVc2luZyBpdCBvbiBhIExpbnV4IG9yIE1heE9TIHBhdGggbWlnaHQgY2hhbmdlIGl0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9TbGFzaGVzKG9zUGF0aCkge1xuICAgIHJldHVybiBvc1BhdGgucmVwbGFjZSgvW1xcXFwvXS9nLCBwb3NpeC5zZXApO1xufVxuLyoqXG4gKiBUYWtlcyBhIFdpbmRvd3MgT1MgcGF0aCAodXNpbmcgYmFja3dhcmQgb3IgZm9yd2FyZCBzbGFzaGVzKSBhbmQgdHVybnMgaXQgaW50byBhIHBvc2l4IHBhdGg6XG4gKiAtIHR1cm5zIGJhY2t3YXJkIHNsYXNoZXMgaW50byBmb3J3YXJkIHNsYXNoZXNcbiAqIC0gbWFrZXMgaXQgYWJzb2x1dGUgaWYgaXQgc3RhcnRzIHdpdGggYSBkcml2ZSBsZXR0ZXJcbiAqIFRoaXMgc2hvdWxkIG9ubHkgYmUgZG9uZSBmb3IgT1MgcGF0aHMgZnJvbSBXaW5kb3dzIChvciB1c2VyIHByb3ZpZGVkIHBhdGhzIHBvdGVudGlhbGx5IGZyb20gV2luZG93cykuXG4gKiBVc2luZyBpdCBvbiBhIExpbnV4IG9yIE1heE9TIHBhdGggbWlnaHQgY2hhbmdlIGl0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9Qb3NpeFBhdGgob3NQYXRoKSB7XG4gICAgaWYgKG9zUGF0aC5pbmRleE9mKCcvJykgPT09IC0xKSB7XG4gICAgICAgIG9zUGF0aCA9IHRvU2xhc2hlcyhvc1BhdGgpO1xuICAgIH1cbiAgICBpZiAoL15bYS16QS1aXTooXFwvfCQpLy50ZXN0KG9zUGF0aCkpIHsgLy8gc3RhcnRzIHdpdGggYSBkcml2ZSBsZXR0ZXJcbiAgICAgICAgb3NQYXRoID0gJy8nICsgb3NQYXRoO1xuICAgIH1cbiAgICByZXR1cm4gb3NQYXRoO1xufVxuLyoqXG4gKiBDb21wdXRlcyB0aGUgX3Jvb3RfIHRoaXMgcGF0aCwgbGlrZSBgZ2V0Um9vdCgnYzpcXGZpbGVzJykgPT09IGM6XFxgLFxuICogYGdldFJvb3QoJ2ZpbGVzOi8vL2ZpbGVzL3BhdGgnKSA9PT0gZmlsZXM6Ly8vYCxcbiAqIG9yIGBnZXRSb290KCdcXFxcc2VydmVyXFxzaGFyZXNcXHBhdGgnKSA9PT0gXFxcXHNlcnZlclxcc2hhcmVzXFxgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSb290KHBhdGgsIHNlcCA9IHBvc2l4LnNlcCkge1xuICAgIGlmICghcGF0aCkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IGxlbiA9IHBhdGgubGVuZ3RoO1xuICAgIGNvbnN0IGZpcnN0TGV0dGVyID0gcGF0aC5jaGFyQ29kZUF0KDApO1xuICAgIGlmIChpc1BhdGhTZXBhcmF0b3IoZmlyc3RMZXR0ZXIpKSB7XG4gICAgICAgIGlmIChpc1BhdGhTZXBhcmF0b3IocGF0aC5jaGFyQ29kZUF0KDEpKSkge1xuICAgICAgICAgICAgLy8gVU5DIGNhbmRpZGF0ZSBcXFxcbG9jYWxob3N0XFxzaGFyZXNcXGRkZFxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICBeXl5eXl5eXl5eXl5eXl5eXl5eXG4gICAgICAgICAgICBpZiAoIWlzUGF0aFNlcGFyYXRvcihwYXRoLmNoYXJDb2RlQXQoMikpKSB7XG4gICAgICAgICAgICAgICAgbGV0IHBvcyA9IDM7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBwb3M7XG4gICAgICAgICAgICAgICAgZm9yICg7IHBvcyA8IGxlbjsgcG9zKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUGF0aFNlcGFyYXRvcihwYXRoLmNoYXJDb2RlQXQocG9zKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdGFydCAhPT0gcG9zICYmICFpc1BhdGhTZXBhcmF0b3IocGF0aC5jaGFyQ29kZUF0KHBvcyArIDEpKSkge1xuICAgICAgICAgICAgICAgICAgICBwb3MgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IHBvcyA8IGxlbjsgcG9zKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1BhdGhTZXBhcmF0b3IocGF0aC5jaGFyQ29kZUF0KHBvcykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdGguc2xpY2UoMCwgcG9zICsgMSkgLy8gY29uc3VtZSB0aGlzIHNlcGFyYXRvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xcXFwvXS9nLCBzZXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIC91c2VyL2ZhclxuICAgICAgICAvLyBeXG4gICAgICAgIHJldHVybiBzZXA7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzV2luZG93c0RyaXZlTGV0dGVyKGZpcnN0TGV0dGVyKSkge1xuICAgICAgICAvLyBjaGVjayBmb3Igd2luZG93cyBkcml2ZSBsZXR0ZXIgYzpcXCBvciBjOlxuICAgICAgICBpZiAocGF0aC5jaGFyQ29kZUF0KDEpID09PSA1OCAvKiBDaGFyQ29kZS5Db2xvbiAqLykge1xuICAgICAgICAgICAgaWYgKGlzUGF0aFNlcGFyYXRvcihwYXRoLmNoYXJDb2RlQXQoMikpKSB7XG4gICAgICAgICAgICAgICAgLy8gQzpcXGZmZlxuICAgICAgICAgICAgICAgIC8vIF5eXlxuICAgICAgICAgICAgICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIDIpICsgc2VwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQzpcbiAgICAgICAgICAgICAgICAvLyBeXlxuICAgICAgICAgICAgICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGNoZWNrIGZvciBVUklcbiAgICAvLyBzY2hlbWU6Ly9hdXRob3JpdHkvcGF0aFxuICAgIC8vIF5eXl5eXl5eXl5eXl5eXl5eXl5cbiAgICBsZXQgcG9zID0gcGF0aC5pbmRleE9mKCc6Ly8nKTtcbiAgICBpZiAocG9zICE9PSAtMSkge1xuICAgICAgICBwb3MgKz0gMzsgLy8gMyAtPiBcIjovL1wiLmxlbmd0aFxuICAgICAgICBmb3IgKDsgcG9zIDwgbGVuOyBwb3MrKykge1xuICAgICAgICAgICAgaWYgKGlzUGF0aFNlcGFyYXRvcihwYXRoLmNoYXJDb2RlQXQocG9zKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aC5zbGljZSgwLCBwb3MgKyAxKTsgLy8gY29uc3VtZSB0aGlzIHNlcGFyYXRvclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAnJztcbn1cbi8qKlxuICogQGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBgSVVyaUlkZW50aXR5U2VydmljZS5leHRVcmkuaXNFcXVhbE9yUGFyZW50YCBpbnN0ZWFkLiBJZlxuICogeW91IGFyZSBpbiBhIGNvbnRleHQgd2l0aG91dCBzZXJ2aWNlcywgY29uc2lkZXIgdG8gcGFzcyBkb3duIHRoZSBgZXh0VXJpYCBmcm9tIHRoZVxuICogb3V0c2lkZSwgb3IgdXNlIGBleHRVcmlCaWFzZWRJZ25vcmVQYXRoQ2FzZWAgaWYgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFcXVhbE9yUGFyZW50KGJhc2UsIHBhcmVudENhbmRpZGF0ZSwgaWdub3JlQ2FzZSwgc2VwYXJhdG9yID0gc2VwKSB7XG4gICAgaWYgKGJhc2UgPT09IHBhcmVudENhbmRpZGF0ZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCFiYXNlIHx8ICFwYXJlbnRDYW5kaWRhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGFyZW50Q2FuZGlkYXRlLmxlbmd0aCA+IGJhc2UubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGlnbm9yZUNhc2UpIHtcbiAgICAgICAgY29uc3QgYmVnaW5zV2l0aCA9IHN0YXJ0c1dpdGhJZ25vcmVDYXNlKGJhc2UsIHBhcmVudENhbmRpZGF0ZSk7XG4gICAgICAgIGlmICghYmVnaW5zV2l0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnRDYW5kaWRhdGUubGVuZ3RoID09PSBiYXNlLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIHNhbWUgcGF0aCwgZGlmZmVyZW50IGNhc2luZ1xuICAgICAgICB9XG4gICAgICAgIGxldCBzZXBPZmZzZXQgPSBwYXJlbnRDYW5kaWRhdGUubGVuZ3RoO1xuICAgICAgICBpZiAocGFyZW50Q2FuZGlkYXRlLmNoYXJBdChwYXJlbnRDYW5kaWRhdGUubGVuZ3RoIC0gMSkgPT09IHNlcGFyYXRvcikge1xuICAgICAgICAgICAgc2VwT2Zmc2V0LS07IC8vIGFkanVzdCB0aGUgZXhwZWN0ZWQgc2VwIG9mZnNldCBpbiBjYXNlIG91ciBjYW5kaWRhdGUgYWxyZWFkeSBlbmRzIGluIHNlcGFyYXRvciBjaGFyYWN0ZXJcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZS5jaGFyQXQoc2VwT2Zmc2V0KSA9PT0gc2VwYXJhdG9yO1xuICAgIH1cbiAgICBpZiAocGFyZW50Q2FuZGlkYXRlLmNoYXJBdChwYXJlbnRDYW5kaWRhdGUubGVuZ3RoIC0gMSkgIT09IHNlcGFyYXRvcikge1xuICAgICAgICBwYXJlbnRDYW5kaWRhdGUgKz0gc2VwYXJhdG9yO1xuICAgIH1cbiAgICByZXR1cm4gYmFzZS5pbmRleE9mKHBhcmVudENhbmRpZGF0ZSkgPT09IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNXaW5kb3dzRHJpdmVMZXR0ZXIoY2hhcjApIHtcbiAgICByZXR1cm4gY2hhcjAgPj0gNjUgLyogQ2hhckNvZGUuQSAqLyAmJiBjaGFyMCA8PSA5MCAvKiBDaGFyQ29kZS5aICovIHx8IGNoYXIwID49IDk3IC8qIENoYXJDb2RlLmEgKi8gJiYgY2hhcjAgPD0gMTIyIC8qIENoYXJDb2RlLnogKi87XG59XG5leHBvcnQgZnVuY3Rpb24gaGFzRHJpdmVMZXR0ZXIocGF0aCwgaXNXaW5kb3dzT1MgPSBpc1dpbmRvd3MpIHtcbiAgICBpZiAoaXNXaW5kb3dzT1MpIHtcbiAgICAgICAgcmV0dXJuIGlzV2luZG93c0RyaXZlTGV0dGVyKHBhdGguY2hhckNvZGVBdCgwKSkgJiYgcGF0aC5jaGFyQ29kZUF0KDEpID09PSA1OCAvKiBDaGFyQ29kZS5Db2xvbiAqLztcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuIiwiZXhwb3J0IGNvbnN0IE1pbWVzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgdGV4dDogJ3RleHQvcGxhaW4nLFxuICAgIGJpbmFyeTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgdW5rbm93bjogJ2FwcGxpY2F0aW9uL3Vua25vd24nLFxuICAgIG1hcmtkb3duOiAndGV4dC9tYXJrZG93bicsXG4gICAgbGF0ZXg6ICd0ZXh0L2xhdGV4JyxcbiAgICB1cmlMaXN0OiAndGV4dC91cmktbGlzdCcsXG59KTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0ICogYXMgZXh0cGF0aCBmcm9tICcuL2V4dHBhdGguanMnO1xuaW1wb3J0IHsgU2NoZW1hcyB9IGZyb20gJy4vbmV0d29yay5qcyc7XG5pbXBvcnQgKiBhcyBwYXRocyBmcm9tICcuL3BhdGguanMnO1xuaW1wb3J0IHsgaXNMaW51eCwgaXNXaW5kb3dzIH0gZnJvbSAnLi9wbGF0Zm9ybS5qcyc7XG5pbXBvcnQgeyBjb21wYXJlIGFzIHN0ckNvbXBhcmUsIGVxdWFsc0lnbm9yZUNhc2UgfSBmcm9tICcuL3N0cmluZ3MuanMnO1xuaW1wb3J0IHsgVVJJLCB1cmlUb0ZzUGF0aCB9IGZyb20gJy4vdXJpLmpzJztcbmV4cG9ydCBmdW5jdGlvbiBvcmlnaW5hbEZTUGF0aCh1cmkpIHtcbiAgICByZXR1cm4gdXJpVG9Gc1BhdGgodXJpLCB0cnVlKTtcbn1cbmV4cG9ydCBjbGFzcyBFeHRVcmkge1xuICAgIGNvbnN0cnVjdG9yKF9pZ25vcmVQYXRoQ2FzaW5nKSB7XG4gICAgICAgIHRoaXMuX2lnbm9yZVBhdGhDYXNpbmcgPSBfaWdub3JlUGF0aENhc2luZztcbiAgICB9XG4gICAgY29tcGFyZSh1cmkxLCB1cmkyLCBpZ25vcmVGcmFnbWVudCA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh1cmkxID09PSB1cmkyKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RyQ29tcGFyZSh0aGlzLmdldENvbXBhcmlzb25LZXkodXJpMSwgaWdub3JlRnJhZ21lbnQpLCB0aGlzLmdldENvbXBhcmlzb25LZXkodXJpMiwgaWdub3JlRnJhZ21lbnQpKTtcbiAgICB9XG4gICAgaXNFcXVhbCh1cmkxLCB1cmkyLCBpZ25vcmVGcmFnbWVudCA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh1cmkxID09PSB1cmkyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXVyaTEgfHwgIXVyaTIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb21wYXJpc29uS2V5KHVyaTEsIGlnbm9yZUZyYWdtZW50KSA9PT0gdGhpcy5nZXRDb21wYXJpc29uS2V5KHVyaTIsIGlnbm9yZUZyYWdtZW50KTtcbiAgICB9XG4gICAgZ2V0Q29tcGFyaXNvbktleSh1cmksIGlnbm9yZUZyYWdtZW50ID0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHVyaS53aXRoKHtcbiAgICAgICAgICAgIHBhdGg6IHRoaXMuX2lnbm9yZVBhdGhDYXNpbmcodXJpKSA/IHVyaS5wYXRoLnRvTG93ZXJDYXNlKCkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBmcmFnbWVudDogaWdub3JlRnJhZ21lbnQgPyBudWxsIDogdW5kZWZpbmVkXG4gICAgICAgIH0pLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGlzRXF1YWxPclBhcmVudChiYXNlLCBwYXJlbnRDYW5kaWRhdGUsIGlnbm9yZUZyYWdtZW50ID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGJhc2Uuc2NoZW1lID09PSBwYXJlbnRDYW5kaWRhdGUuc2NoZW1lKSB7XG4gICAgICAgICAgICBpZiAoYmFzZS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBleHRwYXRoLmlzRXF1YWxPclBhcmVudChvcmlnaW5hbEZTUGF0aChiYXNlKSwgb3JpZ2luYWxGU1BhdGgocGFyZW50Q2FuZGlkYXRlKSwgdGhpcy5faWdub3JlUGF0aENhc2luZyhiYXNlKSkgJiYgYmFzZS5xdWVyeSA9PT0gcGFyZW50Q2FuZGlkYXRlLnF1ZXJ5ICYmIChpZ25vcmVGcmFnbWVudCB8fCBiYXNlLmZyYWdtZW50ID09PSBwYXJlbnRDYW5kaWRhdGUuZnJhZ21lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRXF1YWxBdXRob3JpdHkoYmFzZS5hdXRob3JpdHksIHBhcmVudENhbmRpZGF0ZS5hdXRob3JpdHkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4dHBhdGguaXNFcXVhbE9yUGFyZW50KGJhc2UucGF0aCwgcGFyZW50Q2FuZGlkYXRlLnBhdGgsIHRoaXMuX2lnbm9yZVBhdGhDYXNpbmcoYmFzZSksICcvJykgJiYgYmFzZS5xdWVyeSA9PT0gcGFyZW50Q2FuZGlkYXRlLnF1ZXJ5ICYmIChpZ25vcmVGcmFnbWVudCB8fCBiYXNlLmZyYWdtZW50ID09PSBwYXJlbnRDYW5kaWRhdGUuZnJhZ21lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gLS0tIHBhdGggbWF0aFxuICAgIGpvaW5QYXRoKHJlc291cmNlLCAuLi5wYXRoRnJhZ21lbnQpIHtcbiAgICAgICAgcmV0dXJuIFVSSS5qb2luUGF0aChyZXNvdXJjZSwgLi4ucGF0aEZyYWdtZW50KTtcbiAgICB9XG4gICAgYmFzZW5hbWVPckF1dGhvcml0eShyZXNvdXJjZSkge1xuICAgICAgICByZXR1cm4gYmFzZW5hbWUocmVzb3VyY2UpIHx8IHJlc291cmNlLmF1dGhvcml0eTtcbiAgICB9XG4gICAgYmFzZW5hbWUocmVzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHBhdGhzLnBvc2l4LmJhc2VuYW1lKHJlc291cmNlLnBhdGgpO1xuICAgIH1cbiAgICBleHRuYW1lKHJlc291cmNlKSB7XG4gICAgICAgIHJldHVybiBwYXRocy5wb3NpeC5leHRuYW1lKHJlc291cmNlLnBhdGgpO1xuICAgIH1cbiAgICBkaXJuYW1lKHJlc291cmNlKSB7XG4gICAgICAgIGlmIChyZXNvdXJjZS5wYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBkaXJuYW1lO1xuICAgICAgICBpZiAocmVzb3VyY2Uuc2NoZW1lID09PSBTY2hlbWFzLmZpbGUpIHtcbiAgICAgICAgICAgIGRpcm5hbWUgPSBVUkkuZmlsZShwYXRocy5kaXJuYW1lKG9yaWdpbmFsRlNQYXRoKHJlc291cmNlKSkpLnBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkaXJuYW1lID0gcGF0aHMucG9zaXguZGlybmFtZShyZXNvdXJjZS5wYXRoKTtcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZS5hdXRob3JpdHkgJiYgZGlybmFtZS5sZW5ndGggJiYgZGlybmFtZS5jaGFyQ29kZUF0KDApICE9PSA0NyAvKiBDaGFyQ29kZS5TbGFzaCAqLykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGRpcm5hbWUoXCIke3Jlc291cmNlLnRvU3RyaW5nfSkpIHJlc3VsdGVkIGluIGEgcmVsYXRpdmUgcGF0aGApO1xuICAgICAgICAgICAgICAgIGRpcm5hbWUgPSAnLyc7IC8vIElmIGEgVVJJIGNvbnRhaW5zIGFuIGF1dGhvcml0eSBjb21wb25lbnQsIHRoZW4gdGhlIHBhdGggY29tcG9uZW50IG11c3QgZWl0aGVyIGJlIGVtcHR5IG9yIGJlZ2luIHdpdGggYSBDaGFyQ29kZS5TbGFzaCAoXCIvXCIpIGNoYXJhY3RlclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNvdXJjZS53aXRoKHtcbiAgICAgICAgICAgIHBhdGg6IGRpcm5hbWVcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG5vcm1hbGl6ZVBhdGgocmVzb3VyY2UpIHtcbiAgICAgICAgaWYgKCFyZXNvdXJjZS5wYXRoLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBub3JtYWxpemVkUGF0aDtcbiAgICAgICAgaWYgKHJlc291cmNlLnNjaGVtZSA9PT0gU2NoZW1hcy5maWxlKSB7XG4gICAgICAgICAgICBub3JtYWxpemVkUGF0aCA9IFVSSS5maWxlKHBhdGhzLm5vcm1hbGl6ZShvcmlnaW5hbEZTUGF0aChyZXNvdXJjZSkpKS5wYXRoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm9ybWFsaXplZFBhdGggPSBwYXRocy5wb3NpeC5ub3JtYWxpemUocmVzb3VyY2UucGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc291cmNlLndpdGgoe1xuICAgICAgICAgICAgcGF0aDogbm9ybWFsaXplZFBhdGhcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlbGF0aXZlUGF0aChmcm9tLCB0bykge1xuICAgICAgICBpZiAoZnJvbS5zY2hlbWUgIT09IHRvLnNjaGVtZSB8fCAhaXNFcXVhbEF1dGhvcml0eShmcm9tLmF1dGhvcml0eSwgdG8uYXV0aG9yaXR5KSkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnJvbS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aHMucmVsYXRpdmUob3JpZ2luYWxGU1BhdGgoZnJvbSksIG9yaWdpbmFsRlNQYXRoKHRvKSk7XG4gICAgICAgICAgICByZXR1cm4gaXNXaW5kb3dzID8gZXh0cGF0aC50b1NsYXNoZXMocmVsYXRpdmVQYXRoKSA6IHJlbGF0aXZlUGF0aDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZnJvbVBhdGggPSBmcm9tLnBhdGggfHwgJy8nO1xuICAgICAgICBjb25zdCB0b1BhdGggPSB0by5wYXRoIHx8ICcvJztcbiAgICAgICAgaWYgKHRoaXMuX2lnbm9yZVBhdGhDYXNpbmcoZnJvbSkpIHtcbiAgICAgICAgICAgIC8vIG1ha2UgY2FzaW5nIG9mIGZyb21QYXRoIG1hdGNoIHRvUGF0aFxuICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgZm9yIChjb25zdCBsZW4gPSBNYXRoLm1pbihmcm9tUGF0aC5sZW5ndGgsIHRvUGF0aC5sZW5ndGgpOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZnJvbVBhdGguY2hhckNvZGVBdChpKSAhPT0gdG9QYXRoLmNoYXJDb2RlQXQoaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZyb21QYXRoLmNoYXJBdChpKS50b0xvd2VyQ2FzZSgpICE9PSB0b1BhdGguY2hhckF0KGkpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJvbVBhdGggPSB0b1BhdGguc3Vic3RyKDAsIGkpICsgZnJvbVBhdGguc3Vic3RyKGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXRocy5wb3NpeC5yZWxhdGl2ZShmcm9tUGF0aCwgdG9QYXRoKTtcbiAgICB9XG4gICAgcmVzb2x2ZVBhdGgoYmFzZSwgcGF0aCkge1xuICAgICAgICBpZiAoYmFzZS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgbmV3VVJJID0gVVJJLmZpbGUocGF0aHMucmVzb2x2ZShvcmlnaW5hbEZTUGF0aChiYXNlKSwgcGF0aCkpO1xuICAgICAgICAgICAgcmV0dXJuIGJhc2Uud2l0aCh7XG4gICAgICAgICAgICAgICAgYXV0aG9yaXR5OiBuZXdVUkkuYXV0aG9yaXR5LFxuICAgICAgICAgICAgICAgIHBhdGg6IG5ld1VSSS5wYXRoXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBwYXRoID0gZXh0cGF0aC50b1Bvc2l4UGF0aChwYXRoKTsgLy8gd2UgYWxsb3cgcGF0aCB0byBiZSBhIHdpbmRvd3MgcGF0aFxuICAgICAgICByZXR1cm4gYmFzZS53aXRoKHtcbiAgICAgICAgICAgIHBhdGg6IHBhdGhzLnBvc2l4LnJlc29sdmUoYmFzZS5wYXRoLCBwYXRoKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tIG1pc2NcbiAgICBpc0Fic29sdXRlUGF0aChyZXNvdXJjZSkge1xuICAgICAgICByZXR1cm4gISFyZXNvdXJjZS5wYXRoICYmIHJlc291cmNlLnBhdGhbMF0gPT09ICcvJztcbiAgICB9XG4gICAgaXNFcXVhbEF1dGhvcml0eShhMSwgYTIpIHtcbiAgICAgICAgcmV0dXJuIGExID09PSBhMiB8fCAoYTEgIT09IHVuZGVmaW5lZCAmJiBhMiAhPT0gdW5kZWZpbmVkICYmIGVxdWFsc0lnbm9yZUNhc2UoYTEsIGEyKSk7XG4gICAgfVxuICAgIGhhc1RyYWlsaW5nUGF0aFNlcGFyYXRvcihyZXNvdXJjZSwgc2VwID0gcGF0aHMuc2VwKSB7XG4gICAgICAgIGlmIChyZXNvdXJjZS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgZnNwID0gb3JpZ2luYWxGU1BhdGgocmVzb3VyY2UpO1xuICAgICAgICAgICAgcmV0dXJuIGZzcC5sZW5ndGggPiBleHRwYXRoLmdldFJvb3QoZnNwKS5sZW5ndGggJiYgZnNwW2ZzcC5sZW5ndGggLSAxXSA9PT0gc2VwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcCA9IHJlc291cmNlLnBhdGg7XG4gICAgICAgICAgICByZXR1cm4gKHAubGVuZ3RoID4gMSAmJiBwLmNoYXJDb2RlQXQocC5sZW5ndGggLSAxKSA9PT0gNDcgLyogQ2hhckNvZGUuU2xhc2ggKi8pICYmICEoL15bYS16QS1aXTooXFwvJHxcXFxcJCkvLnRlc3QocmVzb3VyY2UuZnNQYXRoKSk7IC8vIGlnbm9yZSB0aGUgc2xhc2ggYXQgb2Zmc2V0IDBcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW1vdmVUcmFpbGluZ1BhdGhTZXBhcmF0b3IocmVzb3VyY2UsIHNlcCA9IHBhdGhzLnNlcCkge1xuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgcGF0aCBpc24ndCBhIGRyaXZlIGxldHRlci4gQSB0cmFpbGluZyBzZXBhcmF0b3IgdGhlcmUgaXMgbm90IHJlbW92YWJsZS5cbiAgICAgICAgaWYgKGhhc1RyYWlsaW5nUGF0aFNlcGFyYXRvcihyZXNvdXJjZSwgc2VwKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlLndpdGgoeyBwYXRoOiByZXNvdXJjZS5wYXRoLnN1YnN0cigwLCByZXNvdXJjZS5wYXRoLmxlbmd0aCAtIDEpIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNvdXJjZTtcbiAgICB9XG4gICAgYWRkVHJhaWxpbmdQYXRoU2VwYXJhdG9yKHJlc291cmNlLCBzZXAgPSBwYXRocy5zZXApIHtcbiAgICAgICAgbGV0IGlzUm9vdFNlcCA9IGZhbHNlO1xuICAgICAgICBpZiAocmVzb3VyY2Uuc2NoZW1lID09PSBTY2hlbWFzLmZpbGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGZzcCA9IG9yaWdpbmFsRlNQYXRoKHJlc291cmNlKTtcbiAgICAgICAgICAgIGlzUm9vdFNlcCA9ICgoZnNwICE9PSB1bmRlZmluZWQpICYmIChmc3AubGVuZ3RoID09PSBleHRwYXRoLmdldFJvb3QoZnNwKS5sZW5ndGgpICYmIChmc3BbZnNwLmxlbmd0aCAtIDFdID09PSBzZXApKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNlcCA9ICcvJztcbiAgICAgICAgICAgIGNvbnN0IHAgPSByZXNvdXJjZS5wYXRoO1xuICAgICAgICAgICAgaXNSb290U2VwID0gcC5sZW5ndGggPT09IDEgJiYgcC5jaGFyQ29kZUF0KHAubGVuZ3RoIC0gMSkgPT09IDQ3IC8qIENoYXJDb2RlLlNsYXNoICovO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNSb290U2VwICYmICFoYXNUcmFpbGluZ1BhdGhTZXBhcmF0b3IocmVzb3VyY2UsIHNlcCkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS53aXRoKHsgcGF0aDogcmVzb3VyY2UucGF0aCArICcvJyB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzb3VyY2U7XG4gICAgfVxufVxuLyoqXG4gKiBVbmJpYXNlZCB1dGlsaXR5IHRoYXQgdGFrZXMgdXJpcyBcImFzIHRoZXkgYXJlXCIuIFRoaXMgbWVhbnMgaXQgY2FuIGJlIGludGVyY2hhbmdlZCB3aXRoXG4gKiB1cmkjdG9TdHJpbmcoKSB1c2FnZXMuIFRoZSBmb2xsb3dpbmcgaXMgdHJ1ZVxuICogYGBgXG4gKiBhc3NlcnRFcXVhbChhVXJpLnRvU3RyaW5nKCkgPT09IGJVcmkudG9TdHJpbmcoKSwgZXh0dXJpLmlzRXF1YWwoYVVyaSwgYlVyaSkpXG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNvbnN0IGV4dFVyaSA9IG5ldyBFeHRVcmkoKCkgPT4gZmFsc2UpO1xuLyoqXG4gKiBCSUFTRUQgdXRpbGl0eSB0aGF0IF9tb3N0bHlfIGlnbm9yZWQgdGhlIGNhc2Ugb2YgdXJzIHBhdGhzLiBPTkxZIHVzZSB0aGlzIHV0aWwgaWYgeW91XG4gKiB1bmRlcnN0YW5kIHdoYXQgeW91IGFyZSBkb2luZy5cbiAqXG4gKiBUaGlzIHV0aWxpdHkgaXMgSU5DT01QQVRJQkxFIHdpdGggYHVyaS50b1N0cmluZygpYC11c2FnZXMgYW5kIGJvdGggQ0FOTk9UIGJlIHVzZWQgaW50ZXJjaGFuZ2VkLlxuICpcbiAqIFdoZW4gZGVhbGluZyB3aXRoIHVyaXMgZnJvbSBmaWxlcyBvciBkb2N1bWVudHMsIGBleHRVcmlgICh0aGUgdW5iaWFzZWQgZnJpZW5kKWlzIHN1ZmZpY2llbnRcbiAqIGJlY2F1c2UgdGhvc2UgdXJpcyBjb21lIGZyb20gYSBcInRydXN0d29ydGh5IHNvdXJjZVwiLiBXaGVuIGNyZWF0aW5nIHVua25vd24gdXJpcyBpdCdzIGFsd2F5c1xuICogYmV0dGVyIHRvIHVzZSBgSVVyaUlkZW50aXR5U2VydmljZWAgd2hpY2ggZXhwb3NlcyBhbiBgSUV4dFVyaWAtaW5zdGFuY2Ugd2hpY2gga25vd3Mgd2hlbiBwYXRoXG4gKiBjYXNpbmcgbWF0dGVycy5cbiAqL1xuZXhwb3J0IGNvbnN0IGV4dFVyaUJpYXNlZElnbm9yZVBhdGhDYXNlID0gbmV3IEV4dFVyaSh1cmkgPT4ge1xuICAgIC8vIEEgZmlsZSBzY2hlbWUgcmVzb3VyY2UgaXMgaW4gdGhlIHNhbWUgcGxhdGZvcm0gYXMgY29kZSwgc28gaWdub3JlIGNhc2UgZm9yIG5vbiBsaW51eCBwbGF0Zm9ybXNcbiAgICAvLyBSZXNvdXJjZSBjYW4gYmUgZnJvbSBhbm90aGVyIHBsYXRmb3JtLiBMb3dlcmluZyB0aGUgY2FzZSBhcyBhbiBoYWNrLiBTaG91bGQgY29tZSBmcm9tIEZpbGUgc3lzdGVtIHByb3ZpZGVyXG4gICAgcmV0dXJuIHVyaS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSA/ICFpc0xpbnV4IDogdHJ1ZTtcbn0pO1xuLyoqXG4gKiBCSUFTRUQgdXRpbGl0eSB0aGF0IGFsd2F5cyBpZ25vcmVzIHRoZSBjYXNpbmcgb2YgdXJpcyBwYXRocy4gT05MWSB1c2UgdGhpcyB1dGlsIGlmIHlvdVxuICogdW5kZXJzdGFuZCB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gKlxuICogVGhpcyB1dGlsaXR5IGlzIElOQ09NUEFUSUJMRSB3aXRoIGB1cmkudG9TdHJpbmcoKWAtdXNhZ2VzIGFuZCBib3RoIENBTk5PVCBiZSB1c2VkIGludGVyY2hhbmdlZC5cbiAqXG4gKiBXaGVuIGRlYWxpbmcgd2l0aCB1cmlzIGZyb20gZmlsZXMgb3IgZG9jdW1lbnRzLCBgZXh0VXJpYCAodGhlIHVuYmlhc2VkIGZyaWVuZClpcyBzdWZmaWNpZW50XG4gKiBiZWNhdXNlIHRob3NlIHVyaXMgY29tZSBmcm9tIGEgXCJ0cnVzdHdvcnRoeSBzb3VyY2VcIi4gV2hlbiBjcmVhdGluZyB1bmtub3duIHVyaXMgaXQncyBhbHdheXNcbiAqIGJldHRlciB0byB1c2UgYElVcmlJZGVudGl0eVNlcnZpY2VgIHdoaWNoIGV4cG9zZXMgYW4gYElFeHRVcmlgLWluc3RhbmNlIHdoaWNoIGtub3dzIHdoZW4gcGF0aFxuICogY2FzaW5nIG1hdHRlcnMuXG4gKi9cbmV4cG9ydCBjb25zdCBleHRVcmlJZ25vcmVQYXRoQ2FzZSA9IG5ldyBFeHRVcmkoXyA9PiB0cnVlKTtcbmV4cG9ydCBjb25zdCBpc0VxdWFsID0gZXh0VXJpLmlzRXF1YWwuYmluZChleHRVcmkpO1xuZXhwb3J0IGNvbnN0IGlzRXF1YWxPclBhcmVudCA9IGV4dFVyaS5pc0VxdWFsT3JQYXJlbnQuYmluZChleHRVcmkpO1xuZXhwb3J0IGNvbnN0IGdldENvbXBhcmlzb25LZXkgPSBleHRVcmkuZ2V0Q29tcGFyaXNvbktleS5iaW5kKGV4dFVyaSk7XG5leHBvcnQgY29uc3QgYmFzZW5hbWVPckF1dGhvcml0eSA9IGV4dFVyaS5iYXNlbmFtZU9yQXV0aG9yaXR5LmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBiYXNlbmFtZSA9IGV4dFVyaS5iYXNlbmFtZS5iaW5kKGV4dFVyaSk7XG5leHBvcnQgY29uc3QgZXh0bmFtZSA9IGV4dFVyaS5leHRuYW1lLmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBkaXJuYW1lID0gZXh0VXJpLmRpcm5hbWUuYmluZChleHRVcmkpO1xuZXhwb3J0IGNvbnN0IGpvaW5QYXRoID0gZXh0VXJpLmpvaW5QYXRoLmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBub3JtYWxpemVQYXRoID0gZXh0VXJpLm5vcm1hbGl6ZVBhdGguYmluZChleHRVcmkpO1xuZXhwb3J0IGNvbnN0IHJlbGF0aXZlUGF0aCA9IGV4dFVyaS5yZWxhdGl2ZVBhdGguYmluZChleHRVcmkpO1xuZXhwb3J0IGNvbnN0IHJlc29sdmVQYXRoID0gZXh0VXJpLnJlc29sdmVQYXRoLmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBpc0Fic29sdXRlUGF0aCA9IGV4dFVyaS5pc0Fic29sdXRlUGF0aC5iaW5kKGV4dFVyaSk7XG5leHBvcnQgY29uc3QgaXNFcXVhbEF1dGhvcml0eSA9IGV4dFVyaS5pc0VxdWFsQXV0aG9yaXR5LmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBoYXNUcmFpbGluZ1BhdGhTZXBhcmF0b3IgPSBleHRVcmkuaGFzVHJhaWxpbmdQYXRoU2VwYXJhdG9yLmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCByZW1vdmVUcmFpbGluZ1BhdGhTZXBhcmF0b3IgPSBleHRVcmkucmVtb3ZlVHJhaWxpbmdQYXRoU2VwYXJhdG9yLmJpbmQoZXh0VXJpKTtcbmV4cG9ydCBjb25zdCBhZGRUcmFpbGluZ1BhdGhTZXBhcmF0b3IgPSBleHRVcmkuYWRkVHJhaWxpbmdQYXRoU2VwYXJhdG9yLmJpbmQoZXh0VXJpKTtcbi8qKlxuICogRGF0YSBVUkkgcmVsYXRlZCBoZWxwZXJzLlxuICovXG5leHBvcnQgdmFyIERhdGFVcmk7XG4oZnVuY3Rpb24gKERhdGFVcmkpIHtcbiAgICBEYXRhVXJpLk1FVEFfREFUQV9MQUJFTCA9ICdsYWJlbCc7XG4gICAgRGF0YVVyaS5NRVRBX0RBVEFfREVTQ1JJUFRJT04gPSAnZGVzY3JpcHRpb24nO1xuICAgIERhdGFVcmkuTUVUQV9EQVRBX1NJWkUgPSAnc2l6ZSc7XG4gICAgRGF0YVVyaS5NRVRBX0RBVEFfTUlNRSA9ICdtaW1lJztcbiAgICBmdW5jdGlvbiBwYXJzZU1ldGFEYXRhKGRhdGFVcmkpIHtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBuZXcgTWFwKCk7XG4gICAgICAgIC8vIEdpdmVuIGEgVVJJIG9mOiAgZGF0YTppbWFnZS9wbmc7c2l6ZToyMzEzO2xhYmVsOlNvbWVMYWJlbDtkZXNjcmlwdGlvbjpTb21lRGVzY3JpcHRpb247YmFzZTY0LDc3KzlVRTUuLi5cbiAgICAgICAgLy8gdGhlIG1ldGFkYXRhIGlzOiBzaXplOjIzMTM7bGFiZWw6U29tZUxhYmVsO2Rlc2NyaXB0aW9uOlNvbWVEZXNjcmlwdGlvblxuICAgICAgICBjb25zdCBtZXRhID0gZGF0YVVyaS5wYXRoLnN1YnN0cmluZyhkYXRhVXJpLnBhdGguaW5kZXhPZignOycpICsgMSwgZGF0YVVyaS5wYXRoLmxhc3RJbmRleE9mKCc7JykpO1xuICAgICAgICBtZXRhLnNwbGl0KCc7JykuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XG4gICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBwcm9wZXJ0eS5zcGxpdCgnOicpO1xuICAgICAgICAgICAgaWYgKGtleSAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEdpdmVuIGEgVVJJIG9mOiAgZGF0YTppbWFnZS9wbmc7c2l6ZToyMzEzO2xhYmVsOlNvbWVMYWJlbDtkZXNjcmlwdGlvbjpTb21lRGVzY3JpcHRpb247YmFzZTY0LDc3KzlVRTUuLi5cbiAgICAgICAgLy8gdGhlIG1pbWUgaXM6IGltYWdlL3BuZ1xuICAgICAgICBjb25zdCBtaW1lID0gZGF0YVVyaS5wYXRoLnN1YnN0cmluZygwLCBkYXRhVXJpLnBhdGguaW5kZXhPZignOycpKTtcbiAgICAgICAgaWYgKG1pbWUpIHtcbiAgICAgICAgICAgIG1ldGFkYXRhLnNldChEYXRhVXJpLk1FVEFfREFUQV9NSU1FLCBtaW1lKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWV0YWRhdGE7XG4gICAgfVxuICAgIERhdGFVcmkucGFyc2VNZXRhRGF0YSA9IHBhcnNlTWV0YURhdGE7XG59KShEYXRhVXJpIHx8IChEYXRhVXJpID0ge30pKTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0ICogYXMgbmxzIGZyb20gJy4uLy4uLy4uL25scy5qcyc7XG5pbXBvcnQgeyBFbWl0dGVyIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vZXZlbnQuanMnO1xuaW1wb3J0IHsgUmVnaXN0cnkgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9yZWdpc3RyeS9jb21tb24vcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgTWltZXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9taW1lLmpzJztcbmltcG9ydCB7IEV4dGVuc2lvbnMgYXMgQ29uZmlndXJhdGlvbkV4dGVuc2lvbnMgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9jb25maWd1cmF0aW9uL2NvbW1vbi9jb25maWd1cmF0aW9uUmVnaXN0cnkuanMnO1xuLy8gRGVmaW5lIGV4dGVuc2lvbiBwb2ludCBpZHNcbmV4cG9ydCBjb25zdCBFeHRlbnNpb25zID0ge1xuICAgIE1vZGVzUmVnaXN0cnk6ICdlZGl0b3IubW9kZXNSZWdpc3RyeSdcbn07XG5leHBvcnQgY2xhc3MgRWRpdG9yTW9kZXNSZWdpc3RyeSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX29uRGlkQ2hhbmdlTGFuZ3VhZ2VzID0gbmV3IEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vbkRpZENoYW5nZUxhbmd1YWdlcyA9IHRoaXMuX29uRGlkQ2hhbmdlTGFuZ3VhZ2VzLmV2ZW50O1xuICAgICAgICB0aGlzLl9sYW5ndWFnZXMgPSBbXTtcbiAgICB9XG4gICAgcmVnaXN0ZXJMYW5ndWFnZShkZWYpIHtcbiAgICAgICAgdGhpcy5fbGFuZ3VhZ2VzLnB1c2goZGVmKTtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2VMYW5ndWFnZXMuZmlyZSh1bmRlZmluZWQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGlzcG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9sYW5ndWFnZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xhbmd1YWdlc1tpXSA9PT0gZGVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYW5ndWFnZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBnZXRMYW5ndWFnZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sYW5ndWFnZXM7XG4gICAgfVxufVxuZXhwb3J0IGNvbnN0IE1vZGVzUmVnaXN0cnkgPSBuZXcgRWRpdG9yTW9kZXNSZWdpc3RyeSgpO1xuUmVnaXN0cnkuYWRkKEV4dGVuc2lvbnMuTW9kZXNSZWdpc3RyeSwgTW9kZXNSZWdpc3RyeSk7XG5leHBvcnQgY29uc3QgUExBSU5URVhUX0xBTkdVQUdFX0lEID0gJ3BsYWludGV4dCc7XG5leHBvcnQgY29uc3QgUExBSU5URVhUX0VYVEVOU0lPTiA9ICcudHh0Jztcbk1vZGVzUmVnaXN0cnkucmVnaXN0ZXJMYW5ndWFnZSh7XG4gICAgaWQ6IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCxcbiAgICBleHRlbnNpb25zOiBbUExBSU5URVhUX0VYVEVOU0lPTl0sXG4gICAgYWxpYXNlczogW25scy5sb2NhbGl6ZSgncGxhaW5UZXh0LmFsaWFzJywgXCJQbGFpbiBUZXh0XCIpLCAndGV4dCddLFxuICAgIG1pbWV0eXBlczogW01pbWVzLnRleHRdXG59KTtcblJlZ2lzdHJ5LmFzKENvbmZpZ3VyYXRpb25FeHRlbnNpb25zLkNvbmZpZ3VyYXRpb24pXG4gICAgLnJlZ2lzdGVyRGVmYXVsdENvbmZpZ3VyYXRpb25zKFt7XG4gICAgICAgIG92ZXJyaWRlczoge1xuICAgICAgICAgICAgJ1twbGFpbnRleHRdJzoge1xuICAgICAgICAgICAgICAgICdlZGl0b3IudW5pY29kZUhpZ2hsaWdodC5hbWJpZ3VvdXNDaGFyYWN0ZXJzJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ2VkaXRvci51bmljb2RlSGlnaGxpZ2h0LmludmlzaWJsZUNoYXJhY3RlcnMnOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfV0pO1xuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBjcmVhdGVEZWNvcmF0b3IgfSBmcm9tICcuLi8uLi9pbnN0YW50aWF0aW9uL2NvbW1vbi9pbnN0YW50aWF0aW9uLmpzJztcbmV4cG9ydCBjb25zdCBJQ29uZmlndXJhdGlvblNlcnZpY2UgPSBjcmVhdGVEZWNvcmF0b3IoJ2NvbmZpZ3VyYXRpb25TZXJ2aWNlJyk7XG5leHBvcnQgZnVuY3Rpb24gdG9WYWx1ZXNUcmVlKHByb3BlcnRpZXMsIGNvbmZsaWN0UmVwb3J0ZXIpIHtcbiAgICBjb25zdCByb290ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGFkZFRvVmFsdWVUcmVlKHJvb3QsIGtleSwgcHJvcGVydGllc1trZXldLCBjb25mbGljdFJlcG9ydGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvb3Q7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkVG9WYWx1ZVRyZWUoc2V0dGluZ3NUcmVlUm9vdCwga2V5LCB2YWx1ZSwgY29uZmxpY3RSZXBvcnRlcikge1xuICAgIGNvbnN0IHNlZ21lbnRzID0ga2V5LnNwbGl0KCcuJyk7XG4gICAgY29uc3QgbGFzdCA9IHNlZ21lbnRzLnBvcCgpO1xuICAgIGxldCBjdXJyID0gc2V0dGluZ3NUcmVlUm9vdDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHMgPSBzZWdtZW50c1tpXTtcbiAgICAgICAgbGV0IG9iaiA9IGN1cnJbc107XG4gICAgICAgIHN3aXRjaCAodHlwZW9mIG9iaikge1xuICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgICAgICAgICBvYmogPSBjdXJyW3NdID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgaWYgKG9iaiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25mbGljdFJlcG9ydGVyKGBJZ25vcmluZyAke2tleX0gYXMgJHtzZWdtZW50cy5zbGljZSgwLCBpICsgMSkuam9pbignLicpfSBpcyBudWxsYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbmZsaWN0UmVwb3J0ZXIoYElnbm9yaW5nICR7a2V5fSBhcyAke3NlZ21lbnRzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcuJyl9IGlzICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY3VyciA9IG9iajtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjdXJyID09PSAnb2JqZWN0JyAmJiBjdXJyICE9PSBudWxsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjdXJyW2xhc3RdID0gdmFsdWU7IC8vIHdvcmthcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzEzNjA2XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbmZsaWN0UmVwb3J0ZXIoYElnbm9yaW5nICR7a2V5fSBhcyAke3NlZ21lbnRzLmpvaW4oJy4nKX0gaXMgJHtKU09OLnN0cmluZ2lmeShjdXJyKX1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uZmxpY3RSZXBvcnRlcihgSWdub3JpbmcgJHtrZXl9IGFzICR7c2VnbWVudHMuam9pbignLicpfSBpcyAke0pTT04uc3RyaW5naWZ5KGN1cnIpfWApO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVGcm9tVmFsdWVUcmVlKHZhbHVlVHJlZSwga2V5KSB7XG4gICAgY29uc3Qgc2VnbWVudHMgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICBkb1JlbW92ZUZyb21WYWx1ZVRyZWUodmFsdWVUcmVlLCBzZWdtZW50cyk7XG59XG5mdW5jdGlvbiBkb1JlbW92ZUZyb21WYWx1ZVRyZWUodmFsdWVUcmVlLCBzZWdtZW50cykge1xuICAgIGNvbnN0IGZpcnN0ID0gc2VnbWVudHMuc2hpZnQoKTtcbiAgICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIFJlYWNoZWQgbGFzdCBzZWdtZW50XG4gICAgICAgIGRlbGV0ZSB2YWx1ZVRyZWVbZmlyc3RdO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyh2YWx1ZVRyZWUpLmluZGV4T2YoZmlyc3QpICE9PSAtMSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlVHJlZVtmaXJzdF07XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgZG9SZW1vdmVGcm9tVmFsdWVUcmVlKHZhbHVlLCBzZWdtZW50cyk7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB2YWx1ZVRyZWVbZmlyc3RdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBBIGhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIGNvbmZpZ3VyYXRpb24gdmFsdWUgd2l0aCBhIHNwZWNpZmljIHNldHRpbmdzIHBhdGggKGUuZy4gY29uZmlnLnNvbWUuc2V0dGluZylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZ3VyYXRpb25WYWx1ZShjb25maWcsIHNldHRpbmdQYXRoLCBkZWZhdWx0VmFsdWUpIHtcbiAgICBmdW5jdGlvbiBhY2Nlc3NTZXR0aW5nKGNvbmZpZywgcGF0aCkge1xuICAgICAgICBsZXQgY3VycmVudCA9IGNvbmZpZztcbiAgICAgICAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgcGF0aCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ICE9PSAnb2JqZWN0JyB8fCBjdXJyZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2NvbXBvbmVudF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgfVxuICAgIGNvbnN0IHBhdGggPSBzZXR0aW5nUGF0aC5zcGxpdCgnLicpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGFjY2Vzc1NldHRpbmcoY29uZmlnLCBwYXRoKTtcbiAgICByZXR1cm4gdHlwZW9mIHJlc3VsdCA9PT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiByZXN1bHQ7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VUYWdTZXR0aW5nUGxhaW5LZXkoc2V0dGluZ0tleSkge1xuICAgIHJldHVybiBzZXR0aW5nS2V5LnJlcGxhY2UoL1tcXFtcXF1dL2csICcnKTtcbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgZGlzdGluY3QgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9hcnJheXMuanMnO1xuaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2V2ZW50LmpzJztcbmltcG9ydCAqIGFzIHR5cGVzIGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3R5cGVzLmpzJztcbmltcG9ydCAqIGFzIG5scyBmcm9tICcuLi8uLi8uLi9ubHMuanMnO1xuaW1wb3J0IHsgZ2V0TGFuZ3VhZ2VUYWdTZXR0aW5nUGxhaW5LZXkgfSBmcm9tICcuL2NvbmZpZ3VyYXRpb24uanMnO1xuaW1wb3J0IHsgRXh0ZW5zaW9ucyBhcyBKU09ORXh0ZW5zaW9ucyB9IGZyb20gJy4uLy4uL2pzb25zY2hlbWFzL2NvbW1vbi9qc29uQ29udHJpYnV0aW9uUmVnaXN0cnkuanMnO1xuaW1wb3J0IHsgUmVnaXN0cnkgfSBmcm9tICcuLi8uLi9yZWdpc3RyeS9jb21tb24vcGxhdGZvcm0uanMnO1xuZXhwb3J0IGNvbnN0IEV4dGVuc2lvbnMgPSB7XG4gICAgQ29uZmlndXJhdGlvbjogJ2Jhc2UuY29udHJpYnV0aW9ucy5jb25maWd1cmF0aW9uJ1xufTtcbmV4cG9ydCBjb25zdCBhbGxTZXR0aW5ncyA9IHsgcHJvcGVydGllczoge30sIHBhdHRlcm5Qcm9wZXJ0aWVzOiB7fSB9O1xuZXhwb3J0IGNvbnN0IGFwcGxpY2F0aW9uU2V0dGluZ3MgPSB7IHByb3BlcnRpZXM6IHt9LCBwYXR0ZXJuUHJvcGVydGllczoge30gfTtcbmV4cG9ydCBjb25zdCBtYWNoaW5lU2V0dGluZ3MgPSB7IHByb3BlcnRpZXM6IHt9LCBwYXR0ZXJuUHJvcGVydGllczoge30gfTtcbmV4cG9ydCBjb25zdCBtYWNoaW5lT3ZlcnJpZGFibGVTZXR0aW5ncyA9IHsgcHJvcGVydGllczoge30sIHBhdHRlcm5Qcm9wZXJ0aWVzOiB7fSB9O1xuZXhwb3J0IGNvbnN0IHdpbmRvd1NldHRpbmdzID0geyBwcm9wZXJ0aWVzOiB7fSwgcGF0dGVyblByb3BlcnRpZXM6IHt9IH07XG5leHBvcnQgY29uc3QgcmVzb3VyY2VTZXR0aW5ncyA9IHsgcHJvcGVydGllczoge30sIHBhdHRlcm5Qcm9wZXJ0aWVzOiB7fSB9O1xuZXhwb3J0IGNvbnN0IHJlc291cmNlTGFuZ3VhZ2VTZXR0aW5nc1NjaGVtYUlkID0gJ3ZzY29kZTovL3NjaGVtYXMvc2V0dGluZ3MvcmVzb3VyY2VMYW5ndWFnZSc7XG5jb25zdCBjb250cmlidXRpb25SZWdpc3RyeSA9IFJlZ2lzdHJ5LmFzKEpTT05FeHRlbnNpb25zLkpTT05Db250cmlidXRpb24pO1xuY2xhc3MgQ29uZmlndXJhdGlvblJlZ2lzdHJ5IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkQ29uZmlndXJhdGlvbkRlZmF1bHRzID0gW107XG4gICAgICAgIHRoaXMub3ZlcnJpZGVJZGVudGlmaWVycyA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5fb25EaWRTY2hlbWFDaGFuZ2UgPSBuZXcgRW1pdHRlcigpO1xuICAgICAgICB0aGlzLl9vbkRpZFVwZGF0ZUNvbmZpZ3VyYXRpb24gPSBuZXcgRW1pdHRlcigpO1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25EZWZhdWx0c092ZXJyaWRlcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb25maWd1cmF0aW9uT3ZlcnJpZGVzTm9kZSA9IHtcbiAgICAgICAgICAgIGlkOiAnZGVmYXVsdE92ZXJyaWRlcycsXG4gICAgICAgICAgICB0aXRsZTogbmxzLmxvY2FsaXplKCdkZWZhdWx0TGFuZ3VhZ2VDb25maWd1cmF0aW9uT3ZlcnJpZGVzLnRpdGxlJywgXCJEZWZhdWx0IExhbmd1YWdlIENvbmZpZ3VyYXRpb24gT3ZlcnJpZGVzXCIpLFxuICAgICAgICAgICAgcHJvcGVydGllczoge31cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uQ29udHJpYnV0b3JzID0gW3RoaXMuZGVmYXVsdExhbmd1YWdlQ29uZmlndXJhdGlvbk92ZXJyaWRlc05vZGVdO1xuICAgICAgICB0aGlzLnJlc291cmNlTGFuZ3VhZ2VTZXR0aW5nc1NjaGVtYSA9IHtcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LFxuICAgICAgICAgICAgcGF0dGVyblByb3BlcnRpZXM6IHt9LFxuICAgICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHRydWUsXG4gICAgICAgICAgICBhbGxvd1RyYWlsaW5nQ29tbWFzOiB0cnVlLFxuICAgICAgICAgICAgYWxsb3dDb21tZW50czogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzID0ge307XG4gICAgICAgIHRoaXMucG9saWN5Q29uZmlndXJhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuZXhjbHVkZWRDb25maWd1cmF0aW9uUHJvcGVydGllcyA9IHt9O1xuICAgICAgICBjb250cmlidXRpb25SZWdpc3RyeS5yZWdpc3RlclNjaGVtYShyZXNvdXJjZUxhbmd1YWdlU2V0dGluZ3NTY2hlbWFJZCwgdGhpcy5yZXNvdXJjZUxhbmd1YWdlU2V0dGluZ3NTY2hlbWEpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyT3ZlcnJpZGVQcm9wZXJ0eVBhdHRlcm5LZXkoKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb24sIHZhbGlkYXRlID0gdHJ1ZSkge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29uZmlndXJhdGlvbnMoW2NvbmZpZ3VyYXRpb25dLCB2YWxpZGF0ZSk7XG4gICAgfVxuICAgIHJlZ2lzdGVyQ29uZmlndXJhdGlvbnMoY29uZmlndXJhdGlvbnMsIHZhbGlkYXRlID0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLmRvUmVnaXN0ZXJDb25maWd1cmF0aW9ucyhjb25maWd1cmF0aW9ucywgdmFsaWRhdGUsIHByb3BlcnRpZXMpO1xuICAgICAgICBjb250cmlidXRpb25SZWdpc3RyeS5yZWdpc3RlclNjaGVtYShyZXNvdXJjZUxhbmd1YWdlU2V0dGluZ3NTY2hlbWFJZCwgdGhpcy5yZXNvdXJjZUxhbmd1YWdlU2V0dGluZ3NTY2hlbWEpO1xuICAgICAgICB0aGlzLl9vbkRpZFNjaGVtYUNoYW5nZS5maXJlKCk7XG4gICAgICAgIHRoaXMuX29uRGlkVXBkYXRlQ29uZmlndXJhdGlvbi5maXJlKHsgcHJvcGVydGllcyB9KTtcbiAgICB9XG4gICAgcmVnaXN0ZXJEZWZhdWx0Q29uZmlndXJhdGlvbnMoY29uZmlndXJhdGlvbkRlZmF1bHRzKSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuZG9SZWdpc3RlckRlZmF1bHRDb25maWd1cmF0aW9ucyhjb25maWd1cmF0aW9uRGVmYXVsdHMsIHByb3BlcnRpZXMpO1xuICAgICAgICB0aGlzLl9vbkRpZFNjaGVtYUNoYW5nZS5maXJlKCk7XG4gICAgICAgIHRoaXMuX29uRGlkVXBkYXRlQ29uZmlndXJhdGlvbi5maXJlKHsgcHJvcGVydGllcywgZGVmYXVsdHNPdmVycmlkZXM6IHRydWUgfSk7XG4gICAgfVxuICAgIGRvUmVnaXN0ZXJEZWZhdWx0Q29uZmlndXJhdGlvbnMoY29uZmlndXJhdGlvbkRlZmF1bHRzLCBidWNrZXQpIHtcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkQ29uZmlndXJhdGlvbkRlZmF1bHRzLnB1c2goLi4uY29uZmlndXJhdGlvbkRlZmF1bHRzKTtcbiAgICAgICAgY29uc3Qgb3ZlcnJpZGVJZGVudGlmaWVycyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHsgb3ZlcnJpZGVzLCBzb3VyY2UgfSBvZiBjb25maWd1cmF0aW9uRGVmYXVsdHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG92ZXJyaWRlcykge1xuICAgICAgICAgICAgICAgIGJ1Y2tldC5hZGQoa2V5KTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uRGVmYXVsdE92ZXJyaWRlc0ZvcktleSA9IHRoaXMuY29uZmlndXJhdGlvbkRlZmF1bHRzT3ZlcnJpZGVzLmdldChrZXkpXG4gICAgICAgICAgICAgICAgICAgID8/IHRoaXMuY29uZmlndXJhdGlvbkRlZmF1bHRzT3ZlcnJpZGVzLnNldChrZXksIHsgY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZXM6IFtdIH0pLmdldChrZXkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gb3ZlcnJpZGVzW2tleV07XG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZXNGb3JLZXkuY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZXMucHVzaCh7IHZhbHVlLCBzb3VyY2UgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBkZWZhdWx0cyBmb3IgT3ZlcnJpZGUgSWRlbnRpZmllcnNcbiAgICAgICAgICAgICAgICBpZiAoT1ZFUlJJREVfUFJPUEVSVFlfUkVHRVgudGVzdChrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RlZmF1bHRPdmVycmlkZSA9IHRoaXMubWVyZ2VEZWZhdWx0Q29uZmlndXJhdGlvbnNGb3JPdmVycmlkZUlkZW50aWZpZXIoa2V5LCB2YWx1ZSwgc291cmNlLCBjb25maWd1cmF0aW9uRGVmYXVsdE92ZXJyaWRlc0ZvcktleS5jb25maWd1cmF0aW9uRGVmYXVsdE92ZXJyaWRlVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld0RlZmF1bHRPdmVycmlkZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZXNGb3JLZXkuY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZVZhbHVlID0gbmV3RGVmYXVsdE92ZXJyaWRlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURlZmF1bHRPdmVycmlkZVByb3BlcnR5KGtleSwgbmV3RGVmYXVsdE92ZXJyaWRlLCBzb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICBvdmVycmlkZUlkZW50aWZpZXJzLnB1c2goLi4ub3ZlcnJpZGVJZGVudGlmaWVyc0Zyb21LZXkoa2V5KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24gZGVmYXVsdHMgZm9yIENvbmZpZ3VyYXRpb24gUHJvcGVydGllc1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdEZWZhdWx0T3ZlcnJpZGUgPSB0aGlzLm1lcmdlRGVmYXVsdENvbmZpZ3VyYXRpb25zRm9yQ29uZmlndXJhdGlvblByb3BlcnR5KGtleSwgdmFsdWUsIHNvdXJjZSwgY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZXNGb3JLZXkuY29uZmlndXJhdGlvbkRlZmF1bHRPdmVycmlkZVZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdEZWZhdWx0T3ZlcnJpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25EZWZhdWx0T3ZlcnJpZGVzRm9yS2V5LmNvbmZpZ3VyYXRpb25EZWZhdWx0T3ZlcnJpZGVWYWx1ZSA9IG5ld0RlZmF1bHRPdmVycmlkZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9wZXJ0eURlZmF1bHRWYWx1ZShrZXksIHByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2NoZW1hKGtleSwgcHJvcGVydHkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZG9SZWdpc3Rlck92ZXJyaWRlSWRlbnRpZmllcnMob3ZlcnJpZGVJZGVudGlmaWVycyk7XG4gICAgfVxuICAgIHVwZGF0ZURlZmF1bHRPdmVycmlkZVByb3BlcnR5KGtleSwgbmV3RGVmYXVsdE92ZXJyaWRlLCBzb3VyY2UpIHtcbiAgICAgICAgY29uc3QgcHJvcGVydHkgPSB7XG4gICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgIGRlZmF1bHQ6IG5ld0RlZmF1bHRPdmVycmlkZS52YWx1ZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBubHMubG9jYWxpemUoJ2RlZmF1bHRMYW5ndWFnZUNvbmZpZ3VyYXRpb24uZGVzY3JpcHRpb24nLCBcIkNvbmZpZ3VyZSBzZXR0aW5ncyB0byBiZSBvdmVycmlkZGVuIGZvciB0aGUgezB9IGxhbmd1YWdlLlwiLCBnZXRMYW5ndWFnZVRhZ1NldHRpbmdQbGFpbktleShrZXkpKSxcbiAgICAgICAgICAgICRyZWY6IHJlc291cmNlTGFuZ3VhZ2VTZXR0aW5nc1NjaGVtYUlkLFxuICAgICAgICAgICAgZGVmYXVsdERlZmF1bHRWYWx1ZTogbmV3RGVmYXVsdE92ZXJyaWRlLnZhbHVlLFxuICAgICAgICAgICAgc291cmNlLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlU291cmNlOiBzb3VyY2VcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllc1trZXldID0gcHJvcGVydHk7XG4gICAgICAgIHRoaXMuZGVmYXVsdExhbmd1YWdlQ29uZmlndXJhdGlvbk92ZXJyaWRlc05vZGUucHJvcGVydGllc1trZXldID0gcHJvcGVydHk7XG4gICAgfVxuICAgIG1lcmdlRGVmYXVsdENvbmZpZ3VyYXRpb25zRm9yT3ZlcnJpZGVJZGVudGlmaWVyKG92ZXJyaWRlSWRlbnRpZmllciwgY29uZmlndXJhdGlvblZhbHVlT2JqZWN0LCB2YWx1ZVNvdXJjZSwgZXhpc3RpbmdEZWZhdWx0T3ZlcnJpZGUpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gZXhpc3RpbmdEZWZhdWx0T3ZlcnJpZGU/LnZhbHVlIHx8IHt9O1xuICAgICAgICBjb25zdCBzb3VyY2UgPSBleGlzdGluZ0RlZmF1bHRPdmVycmlkZT8uc291cmNlID8/IG5ldyBNYXAoKTtcbiAgICAgICAgLy8gVGhpcyBzaG91bGQgbm90IGhhcHBlblxuICAgICAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBNYXApKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdvYmplY3RDb25maWd1cmF0aW9uU291cmNlcyBpcyBub3QgYSBNYXAnKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eUtleSBvZiBPYmplY3Qua2V5cyhjb25maWd1cmF0aW9uVmFsdWVPYmplY3QpKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eURlZmF1bHRWYWx1ZSA9IGNvbmZpZ3VyYXRpb25WYWx1ZU9iamVjdFtwcm9wZXJ0eUtleV07XG4gICAgICAgICAgICBjb25zdCBpc09iamVjdFNldHRpbmcgPSB0eXBlcy5pc09iamVjdChwcm9wZXJ0eURlZmF1bHRWYWx1ZSkgJiZcbiAgICAgICAgICAgICAgICAodHlwZXMuaXNVbmRlZmluZWQoZGVmYXVsdFZhbHVlW3Byb3BlcnR5S2V5XSkgfHwgdHlwZXMuaXNPYmplY3QoZGVmYXVsdFZhbHVlW3Byb3BlcnR5S2V5XSkpO1xuICAgICAgICAgICAgLy8gSWYgdGhlIGRlZmF1bHQgdmFsdWUgaXMgYW4gb2JqZWN0LCBtZXJnZSB0aGUgb2JqZWN0cyBhbmQgc3RvcmUgdGhlIHNvdXJjZSBvZiBlYWNoIGtleXNcbiAgICAgICAgICAgIGlmIChpc09iamVjdFNldHRpbmcpIHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWVbcHJvcGVydHlLZXldID0geyAuLi4oZGVmYXVsdFZhbHVlW3Byb3BlcnR5S2V5XSA/PyB7fSksIC4uLnByb3BlcnR5RGVmYXVsdFZhbHVlIH07XG4gICAgICAgICAgICAgICAgLy8gVHJhY2sgdGhlIHNvdXJjZSBvZiBlYWNoIHZhbHVlIGluIHRoZSBvYmplY3RcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RLZXkgaW4gcHJvcGVydHlEZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZS5zZXQoYCR7cHJvcGVydHlLZXl9LiR7b2JqZWN0S2V5fWAsIHZhbHVlU291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFByaW1pdGl2ZSB2YWx1ZXMgYXJlIG92ZXJyaWRkZW5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZVtwcm9wZXJ0eUtleV0gPSBwcm9wZXJ0eURlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlLnNldChwcm9wZXJ0eUtleSwgdmFsdWVTb3VyY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlLmRlbGV0ZShwcm9wZXJ0eUtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHZhbHVlOiBkZWZhdWx0VmFsdWUsIHNvdXJjZSB9O1xuICAgIH1cbiAgICBtZXJnZURlZmF1bHRDb25maWd1cmF0aW9uc0ZvckNvbmZpZ3VyYXRpb25Qcm9wZXJ0eShwcm9wZXJ0eUtleSwgdmFsdWUsIHZhbHVlc1NvdXJjZSwgZXhpc3RpbmdEZWZhdWx0T3ZlcnJpZGUpIHtcbiAgICAgICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzW3Byb3BlcnR5S2V5XTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdEZWZhdWx0VmFsdWUgPSBleGlzdGluZ0RlZmF1bHRPdmVycmlkZT8udmFsdWUgPz8gcHJvcGVydHk/LmRlZmF1bHREZWZhdWx0VmFsdWU7XG4gICAgICAgIGxldCBzb3VyY2UgPSB2YWx1ZXNTb3VyY2U7XG4gICAgICAgIGNvbnN0IGlzT2JqZWN0U2V0dGluZyA9IHR5cGVzLmlzT2JqZWN0KHZhbHVlKSAmJlxuICAgICAgICAgICAgKHByb3BlcnR5ICE9PSB1bmRlZmluZWQgJiYgcHJvcGVydHkudHlwZSA9PT0gJ29iamVjdCcgfHxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9PT0gdW5kZWZpbmVkICYmICh0eXBlcy5pc1VuZGVmaW5lZChleGlzdGluZ0RlZmF1bHRWYWx1ZSkgfHwgdHlwZXMuaXNPYmplY3QoZXhpc3RpbmdEZWZhdWx0VmFsdWUpKSk7XG4gICAgICAgIC8vIElmIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGFuIG9iamVjdCwgbWVyZ2UgdGhlIG9iamVjdHMgYW5kIHN0b3JlIHRoZSBzb3VyY2Ugb2YgZWFjaCBrZXlzXG4gICAgICAgIGlmIChpc09iamVjdFNldHRpbmcpIHtcbiAgICAgICAgICAgIHNvdXJjZSA9IGV4aXN0aW5nRGVmYXVsdE92ZXJyaWRlPy5zb3VyY2UgPz8gbmV3IE1hcCgpO1xuICAgICAgICAgICAgLy8gVGhpcyBzaG91bGQgbm90IGhhcHBlblxuICAgICAgICAgICAgaWYgKCEoc291cmNlIGluc3RhbmNlb2YgTWFwKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2RlZmF1bHRWYWx1ZVNvdXJjZSBpcyBub3QgYSBNYXAnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RLZXkgaW4gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzU291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZS5zZXQoYCR7cHJvcGVydHlLZXl9LiR7b2JqZWN0S2V5fWAsIHZhbHVlc1NvdXJjZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWUgPSB7IC4uLih0eXBlcy5pc09iamVjdChleGlzdGluZ0RlZmF1bHRWYWx1ZSkgPyBleGlzdGluZ0RlZmF1bHRWYWx1ZSA6IHt9KSwgLi4udmFsdWUgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyB2YWx1ZSwgc291cmNlIH07XG4gICAgfVxuICAgIHJlZ2lzdGVyT3ZlcnJpZGVJZGVudGlmaWVycyhvdmVycmlkZUlkZW50aWZpZXJzKSB7XG4gICAgICAgIHRoaXMuZG9SZWdpc3Rlck92ZXJyaWRlSWRlbnRpZmllcnMob3ZlcnJpZGVJZGVudGlmaWVycyk7XG4gICAgICAgIHRoaXMuX29uRGlkU2NoZW1hQ2hhbmdlLmZpcmUoKTtcbiAgICB9XG4gICAgZG9SZWdpc3Rlck92ZXJyaWRlSWRlbnRpZmllcnMob3ZlcnJpZGVJZGVudGlmaWVycykge1xuICAgICAgICBmb3IgKGNvbnN0IG92ZXJyaWRlSWRlbnRpZmllciBvZiBvdmVycmlkZUlkZW50aWZpZXJzKSB7XG4gICAgICAgICAgICB0aGlzLm92ZXJyaWRlSWRlbnRpZmllcnMuYWRkKG92ZXJyaWRlSWRlbnRpZmllcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVPdmVycmlkZVByb3BlcnR5UGF0dGVybktleSgpO1xuICAgIH1cbiAgICBkb1JlZ2lzdGVyQ29uZmlndXJhdGlvbnMoY29uZmlndXJhdGlvbnMsIHZhbGlkYXRlLCBidWNrZXQpIHtcbiAgICAgICAgY29uZmlndXJhdGlvbnMuZm9yRWFjaChjb25maWd1cmF0aW9uID0+IHtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVBbmRSZWdpc3RlclByb3BlcnRpZXMoY29uZmlndXJhdGlvbiwgdmFsaWRhdGUsIGNvbmZpZ3VyYXRpb24uZXh0ZW5zaW9uSW5mbywgY29uZmlndXJhdGlvbi5yZXN0cmljdGVkUHJvcGVydGllcywgdW5kZWZpbmVkLCBidWNrZXQpO1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uQ29udHJpYnV0b3JzLnB1c2goY29uZmlndXJhdGlvbik7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVySlNPTkNvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB2YWxpZGF0ZUFuZFJlZ2lzdGVyUHJvcGVydGllcyhjb25maWd1cmF0aW9uLCB2YWxpZGF0ZSA9IHRydWUsIGV4dGVuc2lvbkluZm8sIHJlc3RyaWN0ZWRQcm9wZXJ0aWVzLCBzY29wZSA9IDMgLyogQ29uZmlndXJhdGlvblNjb3BlLldJTkRPVyAqLywgYnVja2V0KSB7XG4gICAgICAgIHNjb3BlID0gdHlwZXMuaXNVbmRlZmluZWRPck51bGwoY29uZmlndXJhdGlvbi5zY29wZSkgPyBzY29wZSA6IGNvbmZpZ3VyYXRpb24uc2NvcGU7XG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBjb25maWd1cmF0aW9uLnByb3BlcnRpZXM7XG4gICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW2tleV07XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlICYmIHZhbGlkYXRlUHJvcGVydHkoa2V5LCBwcm9wZXJ0eSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHByb3BlcnRpZXNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb3BlcnR5LnNvdXJjZSA9IGV4dGVuc2lvbkluZm87XG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGRlZmF1bHQgdmFsdWVcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eS5kZWZhdWx0RGVmYXVsdFZhbHVlID0gcHJvcGVydGllc1trZXldLmRlZmF1bHQ7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9wZXJ0eURlZmF1bHRWYWx1ZShrZXksIHByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgc2NvcGVcbiAgICAgICAgICAgICAgICBpZiAoT1ZFUlJJREVfUFJPUEVSVFlfUkVHRVgudGVzdChrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5LnNjb3BlID0gdW5kZWZpbmVkOyAvLyBObyBzY29wZSBmb3Igb3ZlcnJpZGFibGUgcHJvcGVydGllcyBgWyR7aWRlbnRpZmllcn1dYFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkuc2NvcGUgPSB0eXBlcy5pc1VuZGVmaW5lZE9yTnVsbChwcm9wZXJ0eS5zY29wZSkgPyBzY29wZSA6IHByb3BlcnR5LnNjb3BlO1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eS5yZXN0cmljdGVkID0gdHlwZXMuaXNVbmRlZmluZWRPck51bGwocHJvcGVydHkucmVzdHJpY3RlZCkgPyAhIXJlc3RyaWN0ZWRQcm9wZXJ0aWVzPy5pbmNsdWRlcyhrZXkpIDogcHJvcGVydHkucmVzdHJpY3RlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQWRkIHRvIHByb3BlcnRpZXMgbWFwc1xuICAgICAgICAgICAgICAgIC8vIFByb3BlcnR5IGlzIGluY2x1ZGVkIGJ5IGRlZmF1bHQgaWYgJ2luY2x1ZGVkJyBpcyB1bnNwZWNpZmllZFxuICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2tleV0uaGFzT3duUHJvcGVydHkoJ2luY2x1ZGVkJykgJiYgIXByb3BlcnRpZXNba2V5XS5pbmNsdWRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2x1ZGVkQ29uZmlndXJhdGlvblByb3BlcnRpZXNba2V5XSA9IHByb3BlcnRpZXNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHByb3BlcnRpZXNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0aWVzW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2tleV0ucG9saWN5Py5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGljeUNvbmZpZ3VyYXRpb25zLnNldChwcm9wZXJ0aWVzW2tleV0ucG9saWN5Lm5hbWUsIGtleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0aWVzW2tleV0uZGVwcmVjYXRpb25NZXNzYWdlICYmIHByb3BlcnRpZXNba2V5XS5tYXJrZG93bkRlcHJlY2F0aW9uTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBub3Qgc2V0LCBkZWZhdWx0IGRlcHJlY2F0aW9uTWVzc2FnZSB0byB0aGUgbWFya2Rvd24gc291cmNlXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNba2V5XS5kZXByZWNhdGlvbk1lc3NhZ2UgPSBwcm9wZXJ0aWVzW2tleV0ubWFya2Rvd25EZXByZWNhdGlvbk1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ1Y2tldC5hZGQoa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdWJOb2RlcyA9IGNvbmZpZ3VyYXRpb24uYWxsT2Y7XG4gICAgICAgIGlmIChzdWJOb2Rlcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHN1Yk5vZGVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0ZUFuZFJlZ2lzdGVyUHJvcGVydGllcyhub2RlLCB2YWxpZGF0ZSwgZXh0ZW5zaW9uSW5mbywgcmVzdHJpY3RlZFByb3BlcnRpZXMsIHNjb3BlLCBidWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldENvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllcztcbiAgICB9XG4gICAgZ2V0UG9saWN5Q29uZmlndXJhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvbGljeUNvbmZpZ3VyYXRpb25zO1xuICAgIH1cbiAgICByZWdpc3RlckpTT05Db25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgY29uc3QgcmVnaXN0ZXIgPSAoY29uZmlndXJhdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IGNvbmZpZ3VyYXRpb24ucHJvcGVydGllcztcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNjaGVtYShrZXksIHByb3BlcnRpZXNba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc3ViTm9kZXMgPSBjb25maWd1cmF0aW9uLmFsbE9mO1xuICAgICAgICAgICAgc3ViTm9kZXM/LmZvckVhY2gocmVnaXN0ZXIpO1xuICAgICAgICB9O1xuICAgICAgICByZWdpc3Rlcihjb25maWd1cmF0aW9uKTtcbiAgICB9XG4gICAgdXBkYXRlU2NoZW1hKGtleSwgcHJvcGVydHkpIHtcbiAgICAgICAgYWxsU2V0dGluZ3MucHJvcGVydGllc1trZXldID0gcHJvcGVydHk7XG4gICAgICAgIHN3aXRjaCAocHJvcGVydHkuc2NvcGUpIHtcbiAgICAgICAgICAgIGNhc2UgMSAvKiBDb25maWd1cmF0aW9uU2NvcGUuQVBQTElDQVRJT04gKi86XG4gICAgICAgICAgICAgICAgYXBwbGljYXRpb25TZXR0aW5ncy5wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBDb25maWd1cmF0aW9uU2NvcGUuTUFDSElORSAqLzpcbiAgICAgICAgICAgICAgICBtYWNoaW5lU2V0dGluZ3MucHJvcGVydGllc1trZXldID0gcHJvcGVydHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDYgLyogQ29uZmlndXJhdGlvblNjb3BlLk1BQ0hJTkVfT1ZFUlJJREFCTEUgKi86XG4gICAgICAgICAgICAgICAgbWFjaGluZU92ZXJyaWRhYmxlU2V0dGluZ3MucHJvcGVydGllc1trZXldID0gcHJvcGVydHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDMgLyogQ29uZmlndXJhdGlvblNjb3BlLldJTkRPVyAqLzpcbiAgICAgICAgICAgICAgICB3aW5kb3dTZXR0aW5ncy5wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNCAvKiBDb25maWd1cmF0aW9uU2NvcGUuUkVTT1VSQ0UgKi86XG4gICAgICAgICAgICAgICAgcmVzb3VyY2VTZXR0aW5ncy5wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNSAvKiBDb25maWd1cmF0aW9uU2NvcGUuTEFOR1VBR0VfT1ZFUlJJREFCTEUgKi86XG4gICAgICAgICAgICAgICAgcmVzb3VyY2VTZXR0aW5ncy5wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc291cmNlTGFuZ3VhZ2VTZXR0aW5nc1NjaGVtYS5wcm9wZXJ0aWVzW2tleV0gPSBwcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVPdmVycmlkZVByb3BlcnR5UGF0dGVybktleSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBvdmVycmlkZUlkZW50aWZpZXIgb2YgdGhpcy5vdmVycmlkZUlkZW50aWZpZXJzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBjb25zdCBvdmVycmlkZUlkZW50aWZpZXJQcm9wZXJ0eSA9IGBbJHtvdmVycmlkZUlkZW50aWZpZXJ9XWA7XG4gICAgICAgICAgICBjb25zdCByZXNvdXJjZUxhbmd1YWdlUHJvcGVydGllc1NjaGVtYSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbmxzLmxvY2FsaXplKCdvdmVycmlkZVNldHRpbmdzLmRlZmF1bHREZXNjcmlwdGlvbicsIFwiQ29uZmlndXJlIGVkaXRvciBzZXR0aW5ncyB0byBiZSBvdmVycmlkZGVuIGZvciBhIGxhbmd1YWdlLlwiKSxcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2U6IG5scy5sb2NhbGl6ZSgnb3ZlcnJpZGVTZXR0aW5ncy5lcnJvck1lc3NhZ2UnLCBcIlRoaXMgc2V0dGluZyBkb2VzIG5vdCBzdXBwb3J0IHBlci1sYW5ndWFnZSBjb25maWd1cmF0aW9uLlwiKSxcbiAgICAgICAgICAgICAgICAkcmVmOiByZXNvdXJjZUxhbmd1YWdlU2V0dGluZ3NTY2hlbWFJZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVByb3BlcnR5RGVmYXVsdFZhbHVlKG92ZXJyaWRlSWRlbnRpZmllclByb3BlcnR5LCByZXNvdXJjZUxhbmd1YWdlUHJvcGVydGllc1NjaGVtYSk7XG4gICAgICAgICAgICBhbGxTZXR0aW5ncy5wcm9wZXJ0aWVzW292ZXJyaWRlSWRlbnRpZmllclByb3BlcnR5XSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICAgICAgYXBwbGljYXRpb25TZXR0aW5ncy5wcm9wZXJ0aWVzW292ZXJyaWRlSWRlbnRpZmllclByb3BlcnR5XSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICAgICAgbWFjaGluZVNldHRpbmdzLnByb3BlcnRpZXNbb3ZlcnJpZGVJZGVudGlmaWVyUHJvcGVydHldID0gcmVzb3VyY2VMYW5ndWFnZVByb3BlcnRpZXNTY2hlbWE7XG4gICAgICAgICAgICBtYWNoaW5lT3ZlcnJpZGFibGVTZXR0aW5ncy5wcm9wZXJ0aWVzW292ZXJyaWRlSWRlbnRpZmllclByb3BlcnR5XSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICAgICAgd2luZG93U2V0dGluZ3MucHJvcGVydGllc1tvdmVycmlkZUlkZW50aWZpZXJQcm9wZXJ0eV0gPSByZXNvdXJjZUxhbmd1YWdlUHJvcGVydGllc1NjaGVtYTtcbiAgICAgICAgICAgIHJlc291cmNlU2V0dGluZ3MucHJvcGVydGllc1tvdmVycmlkZUlkZW50aWZpZXJQcm9wZXJ0eV0gPSByZXNvdXJjZUxhbmd1YWdlUHJvcGVydGllc1NjaGVtYTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWdpc3Rlck92ZXJyaWRlUHJvcGVydHlQYXR0ZXJuS2V5KCkge1xuICAgICAgICBjb25zdCByZXNvdXJjZUxhbmd1YWdlUHJvcGVydGllc1NjaGVtYSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IG5scy5sb2NhbGl6ZSgnb3ZlcnJpZGVTZXR0aW5ncy5kZWZhdWx0RGVzY3JpcHRpb24nLCBcIkNvbmZpZ3VyZSBlZGl0b3Igc2V0dGluZ3MgdG8gYmUgb3ZlcnJpZGRlbiBmb3IgYSBsYW5ndWFnZS5cIiksXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2U6IG5scy5sb2NhbGl6ZSgnb3ZlcnJpZGVTZXR0aW5ncy5lcnJvck1lc3NhZ2UnLCBcIlRoaXMgc2V0dGluZyBkb2VzIG5vdCBzdXBwb3J0IHBlci1sYW5ndWFnZSBjb25maWd1cmF0aW9uLlwiKSxcbiAgICAgICAgICAgICRyZWY6IHJlc291cmNlTGFuZ3VhZ2VTZXR0aW5nc1NjaGVtYUlkLFxuICAgICAgICB9O1xuICAgICAgICBhbGxTZXR0aW5ncy5wYXR0ZXJuUHJvcGVydGllc1tPVkVSUklERV9QUk9QRVJUWV9QQVRURVJOXSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICBhcHBsaWNhdGlvblNldHRpbmdzLnBhdHRlcm5Qcm9wZXJ0aWVzW09WRVJSSURFX1BST1BFUlRZX1BBVFRFUk5dID0gcmVzb3VyY2VMYW5ndWFnZVByb3BlcnRpZXNTY2hlbWE7XG4gICAgICAgIG1hY2hpbmVTZXR0aW5ncy5wYXR0ZXJuUHJvcGVydGllc1tPVkVSUklERV9QUk9QRVJUWV9QQVRURVJOXSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICBtYWNoaW5lT3ZlcnJpZGFibGVTZXR0aW5ncy5wYXR0ZXJuUHJvcGVydGllc1tPVkVSUklERV9QUk9QRVJUWV9QQVRURVJOXSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICB3aW5kb3dTZXR0aW5ncy5wYXR0ZXJuUHJvcGVydGllc1tPVkVSUklERV9QUk9QRVJUWV9QQVRURVJOXSA9IHJlc291cmNlTGFuZ3VhZ2VQcm9wZXJ0aWVzU2NoZW1hO1xuICAgICAgICByZXNvdXJjZVNldHRpbmdzLnBhdHRlcm5Qcm9wZXJ0aWVzW09WRVJSSURFX1BST1BFUlRZX1BBVFRFUk5dID0gcmVzb3VyY2VMYW5ndWFnZVByb3BlcnRpZXNTY2hlbWE7XG4gICAgICAgIHRoaXMuX29uRGlkU2NoZW1hQ2hhbmdlLmZpcmUoKTtcbiAgICB9XG4gICAgdXBkYXRlUHJvcGVydHlEZWZhdWx0VmFsdWUoa2V5LCBwcm9wZXJ0eSkge1xuICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uZGVmYXVsdE92ZXJyaWRlID0gdGhpcy5jb25maWd1cmF0aW9uRGVmYXVsdHNPdmVycmlkZXMuZ2V0KGtleSk/LmNvbmZpZ3VyYXRpb25EZWZhdWx0T3ZlcnJpZGVWYWx1ZTtcbiAgICAgICAgbGV0IGRlZmF1bHRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgbGV0IGRlZmF1bHRTb3VyY2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uZGVmYXVsdE92ZXJyaWRlXG4gICAgICAgICAgICAmJiAoIXByb3BlcnR5LmRpc2FsbG93Q29uZmlndXJhdGlvbkRlZmF1bHQgfHwgIWNvbmZpZ3VyYXRpb25kZWZhdWx0T3ZlcnJpZGUuc291cmNlKSAvLyBQcmV2ZW50IG92ZXJyaWRpbmcgdGhlIGRlZmF1bHQgdmFsdWUgaWYgdGhlIHByb3BlcnR5IGlzIGRpc2FsbG93ZWQgdG8gYmUgb3ZlcnJpZGRlbiBieSBjb25maWd1cmF0aW9uIGRlZmF1bHRzIGZyb20gZXh0ZW5zaW9uc1xuICAgICAgICApIHtcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IGNvbmZpZ3VyYXRpb25kZWZhdWx0T3ZlcnJpZGUudmFsdWU7XG4gICAgICAgICAgICBkZWZhdWx0U291cmNlID0gY29uZmlndXJhdGlvbmRlZmF1bHRPdmVycmlkZS5zb3VyY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVzLmlzVW5kZWZpbmVkKGRlZmF1bHRWYWx1ZSkpIHtcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IHByb3BlcnR5LmRlZmF1bHREZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICBkZWZhdWx0U291cmNlID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlcy5pc1VuZGVmaW5lZChkZWZhdWx0VmFsdWUpKSB7XG4gICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSBnZXREZWZhdWx0VmFsdWUocHJvcGVydHkudHlwZSk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcGVydHkuZGVmYXVsdCA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgcHJvcGVydHkuZGVmYXVsdFZhbHVlU291cmNlID0gZGVmYXVsdFNvdXJjZTtcbiAgICB9XG59XG5jb25zdCBPVkVSUklERV9JREVOVElGSUVSX1BBVFRFUk4gPSBgXFxcXFsoW15cXFxcXV0rKVxcXFxdYDtcbmNvbnN0IE9WRVJSSURFX0lERU5USUZJRVJfUkVHRVggPSBuZXcgUmVnRXhwKE9WRVJSSURFX0lERU5USUZJRVJfUEFUVEVSTiwgJ2cnKTtcbmV4cG9ydCBjb25zdCBPVkVSUklERV9QUk9QRVJUWV9QQVRURVJOID0gYF4oJHtPVkVSUklERV9JREVOVElGSUVSX1BBVFRFUk59KSskYDtcbmV4cG9ydCBjb25zdCBPVkVSUklERV9QUk9QRVJUWV9SRUdFWCA9IG5ldyBSZWdFeHAoT1ZFUlJJREVfUFJPUEVSVFlfUEFUVEVSTik7XG5leHBvcnQgZnVuY3Rpb24gb3ZlcnJpZGVJZGVudGlmaWVyc0Zyb21LZXkoa2V5KSB7XG4gICAgY29uc3QgaWRlbnRpZmllcnMgPSBbXTtcbiAgICBpZiAoT1ZFUlJJREVfUFJPUEVSVFlfUkVHRVgudGVzdChrZXkpKSB7XG4gICAgICAgIGxldCBtYXRjaGVzID0gT1ZFUlJJREVfSURFTlRJRklFUl9SRUdFWC5leGVjKGtleSk7XG4gICAgICAgIHdoaWxlIChtYXRjaGVzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBtYXRjaGVzWzFdLnRyaW0oKTtcbiAgICAgICAgICAgIGlmIChpZGVudGlmaWVyKSB7XG4gICAgICAgICAgICAgICAgaWRlbnRpZmllcnMucHVzaChpZGVudGlmaWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1hdGNoZXMgPSBPVkVSUklERV9JREVOVElGSUVSX1JFR0VYLmV4ZWMoa2V5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGlzdGluY3QoaWRlbnRpZmllcnMpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRWYWx1ZSh0eXBlKSB7XG4gICAgY29uc3QgdCA9IEFycmF5LmlzQXJyYXkodHlwZSkgPyB0eXBlWzBdIDogdHlwZTtcbiAgICBzd2l0Y2ggKHQpIHtcbiAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNhc2UgJ2ludGVnZXInOlxuICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIGNhc2UgJ2FycmF5JzpcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbmNvbnN0IGNvbmZpZ3VyYXRpb25SZWdpc3RyeSA9IG5ldyBDb25maWd1cmF0aW9uUmVnaXN0cnkoKTtcblJlZ2lzdHJ5LmFkZChFeHRlbnNpb25zLkNvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25SZWdpc3RyeSk7XG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVQcm9wZXJ0eShwcm9wZXJ0eSwgc2NoZW1hKSB7XG4gICAgaWYgKCFwcm9wZXJ0eS50cmltKCkpIHtcbiAgICAgICAgcmV0dXJuIG5scy5sb2NhbGl6ZSgnY29uZmlnLnByb3BlcnR5LmVtcHR5JywgXCJDYW5ub3QgcmVnaXN0ZXIgYW4gZW1wdHkgcHJvcGVydHlcIik7XG4gICAgfVxuICAgIGlmIChPVkVSUklERV9QUk9QRVJUWV9SRUdFWC50ZXN0KHByb3BlcnR5KSkge1xuICAgICAgICByZXR1cm4gbmxzLmxvY2FsaXplKCdjb25maWcucHJvcGVydHkubGFuZ3VhZ2VEZWZhdWx0JywgXCJDYW5ub3QgcmVnaXN0ZXIgJ3swfScuIFRoaXMgbWF0Y2hlcyBwcm9wZXJ0eSBwYXR0ZXJuICdcXFxcXFxcXFsuKlxcXFxcXFxcXSQnIGZvciBkZXNjcmliaW5nIGxhbmd1YWdlIHNwZWNpZmljIGVkaXRvciBzZXR0aW5ncy4gVXNlICdjb25maWd1cmF0aW9uRGVmYXVsdHMnIGNvbnRyaWJ1dGlvbi5cIiwgcHJvcGVydHkpO1xuICAgIH1cbiAgICBpZiAoY29uZmlndXJhdGlvblJlZ2lzdHJ5LmdldENvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzKClbcHJvcGVydHldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIG5scy5sb2NhbGl6ZSgnY29uZmlnLnByb3BlcnR5LmR1cGxpY2F0ZScsIFwiQ2Fubm90IHJlZ2lzdGVyICd7MH0nLiBUaGlzIHByb3BlcnR5IGlzIGFscmVhZHkgcmVnaXN0ZXJlZC5cIiwgcHJvcGVydHkpO1xuICAgIH1cbiAgICBpZiAoc2NoZW1hLnBvbGljeT8ubmFtZSAmJiBjb25maWd1cmF0aW9uUmVnaXN0cnkuZ2V0UG9saWN5Q29uZmlndXJhdGlvbnMoKS5nZXQoc2NoZW1hLnBvbGljeT8ubmFtZSkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gbmxzLmxvY2FsaXplKCdjb25maWcucG9saWN5LmR1cGxpY2F0ZScsIFwiQ2Fubm90IHJlZ2lzdGVyICd7MH0nLiBUaGUgYXNzb2NpYXRlZCBwb2xpY3kgezF9IGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHsyfS5cIiwgcHJvcGVydHksIHNjaGVtYS5wb2xpY3k/Lm5hbWUsIGNvbmZpZ3VyYXRpb25SZWdpc3RyeS5nZXRQb2xpY3lDb25maWd1cmF0aW9ucygpLmdldChzY2hlbWEucG9saWN5Py5uYW1lKSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4vLyAtLS0tLS0gaW50ZXJuYWwgdXRpbFxuZXhwb3J0IHZhciBfdXRpbDtcbihmdW5jdGlvbiAoX3V0aWwpIHtcbiAgICBfdXRpbC5zZXJ2aWNlSWRzID0gbmV3IE1hcCgpO1xuICAgIF91dGlsLkRJX1RBUkdFVCA9ICckZGkkdGFyZ2V0JztcbiAgICBfdXRpbC5ESV9ERVBFTkRFTkNJRVMgPSAnJGRpJGRlcGVuZGVuY2llcyc7XG4gICAgZnVuY3Rpb24gZ2V0U2VydmljZURlcGVuZGVuY2llcyhjdG9yKSB7XG4gICAgICAgIHJldHVybiBjdG9yW191dGlsLkRJX0RFUEVOREVOQ0lFU10gfHwgW107XG4gICAgfVxuICAgIF91dGlsLmdldFNlcnZpY2VEZXBlbmRlbmNpZXMgPSBnZXRTZXJ2aWNlRGVwZW5kZW5jaWVzO1xufSkoX3V0aWwgfHwgKF91dGlsID0ge30pKTtcbmV4cG9ydCBjb25zdCBJSW5zdGFudGlhdGlvblNlcnZpY2UgPSBjcmVhdGVEZWNvcmF0b3IoJ2luc3RhbnRpYXRpb25TZXJ2aWNlJyk7XG5mdW5jdGlvbiBzdG9yZVNlcnZpY2VEZXBlbmRlbmN5KGlkLCB0YXJnZXQsIGluZGV4KSB7XG4gICAgaWYgKHRhcmdldFtfdXRpbC5ESV9UQVJHRVRdID09PSB0YXJnZXQpIHtcbiAgICAgICAgdGFyZ2V0W191dGlsLkRJX0RFUEVOREVOQ0lFU10ucHVzaCh7IGlkLCBpbmRleCB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRhcmdldFtfdXRpbC5ESV9ERVBFTkRFTkNJRVNdID0gW3sgaWQsIGluZGV4IH1dO1xuICAgICAgICB0YXJnZXRbX3V0aWwuRElfVEFSR0VUXSA9IHRhcmdldDtcbiAgICB9XG59XG4vKipcbiAqIFRoZSAqb25seSogdmFsaWQgd2F5IHRvIGNyZWF0ZSBhIHt7U2VydmljZUlkZW50aWZpZXJ9fS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlY29yYXRvcihzZXJ2aWNlSWQpIHtcbiAgICBpZiAoX3V0aWwuc2VydmljZUlkcy5oYXMoc2VydmljZUlkKSkge1xuICAgICAgICByZXR1cm4gX3V0aWwuc2VydmljZUlkcy5nZXQoc2VydmljZUlkKTtcbiAgICB9XG4gICAgY29uc3QgaWQgPSBmdW5jdGlvbiAodGFyZ2V0LCBrZXksIGluZGV4KSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0BJU2VydmljZU5hbWUtZGVjb3JhdG9yIGNhbiBvbmx5IGJlIHVzZWQgdG8gZGVjb3JhdGUgYSBwYXJhbWV0ZXInKTtcbiAgICAgICAgfVxuICAgICAgICBzdG9yZVNlcnZpY2VEZXBlbmRlbmN5KGlkLCB0YXJnZXQsIGluZGV4KTtcbiAgICB9O1xuICAgIGlkLnRvU3RyaW5nID0gKCkgPT4gc2VydmljZUlkO1xuICAgIF91dGlsLnNlcnZpY2VJZHMuc2V0KHNlcnZpY2VJZCwgaWQpO1xuICAgIHJldHVybiBpZDtcbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2V2ZW50LmpzJztcbmltcG9ydCAqIGFzIHBsYXRmb3JtIGZyb20gJy4uLy4uL3JlZ2lzdHJ5L2NvbW1vbi9wbGF0Zm9ybS5qcyc7XG5leHBvcnQgY29uc3QgRXh0ZW5zaW9ucyA9IHtcbiAgICBKU09OQ29udHJpYnV0aW9uOiAnYmFzZS5jb250cmlidXRpb25zLmpzb24nXG59O1xuZnVuY3Rpb24gbm9ybWFsaXplSWQoaWQpIHtcbiAgICBpZiAoaWQubGVuZ3RoID4gMCAmJiBpZC5jaGFyQXQoaWQubGVuZ3RoIC0gMSkgPT09ICcjJykge1xuICAgICAgICByZXR1cm4gaWQuc3Vic3RyaW5nKDAsIGlkLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgICByZXR1cm4gaWQ7XG59XG5jbGFzcyBKU09OQ29udHJpYnV0aW9uUmVnaXN0cnkge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9vbkRpZENoYW5nZVNjaGVtYSA9IG5ldyBFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuc2NoZW1hc0J5SWQgPSB7fTtcbiAgICB9XG4gICAgcmVnaXN0ZXJTY2hlbWEodXJpLCB1bnJlc29sdmVkU2NoZW1hQ29udGVudCkge1xuICAgICAgICB0aGlzLnNjaGVtYXNCeUlkW25vcm1hbGl6ZUlkKHVyaSldID0gdW5yZXNvbHZlZFNjaGVtYUNvbnRlbnQ7XG4gICAgICAgIHRoaXMuX29uRGlkQ2hhbmdlU2NoZW1hLmZpcmUodXJpKTtcbiAgICB9XG4gICAgbm90aWZ5U2NoZW1hQ2hhbmdlZCh1cmkpIHtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2VTY2hlbWEuZmlyZSh1cmkpO1xuICAgIH1cbn1cbmNvbnN0IGpzb25Db250cmlidXRpb25SZWdpc3RyeSA9IG5ldyBKU09OQ29udHJpYnV0aW9uUmVnaXN0cnkoKTtcbnBsYXRmb3JtLlJlZ2lzdHJ5LmFkZChFeHRlbnNpb25zLkpTT05Db250cmlidXRpb24sIGpzb25Db250cmlidXRpb25SZWdpc3RyeSk7XG4iLCIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmltcG9ydCAqIGFzIEFzc2VydCBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9hc3NlcnQuanMnO1xuaW1wb3J0ICogYXMgVHlwZXMgZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vdHlwZXMuanMnO1xuY2xhc3MgUmVnaXN0cnlJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICBhZGQoaWQsIGRhdGEpIHtcbiAgICAgICAgQXNzZXJ0Lm9rKFR5cGVzLmlzU3RyaW5nKGlkKSk7XG4gICAgICAgIEFzc2VydC5vayhUeXBlcy5pc09iamVjdChkYXRhKSk7XG4gICAgICAgIEFzc2VydC5vayghdGhpcy5kYXRhLmhhcyhpZCksICdUaGVyZSBpcyBhbHJlYWR5IGFuIGV4dGVuc2lvbiB3aXRoIHRoaXMgaWQnKTtcbiAgICAgICAgdGhpcy5kYXRhLnNldChpZCwgZGF0YSk7XG4gICAgfVxuICAgIGFzKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuZ2V0KGlkKSB8fCBudWxsO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBSZWdpc3RyeSA9IG5ldyBSZWdpc3RyeUltcGwoKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==