"use strict";
(self["webpackChunkpylinac_yaml_editor"] = self["webpackChunkpylinac_yaml_editor"] || []).push([["vendors-node_modules_monaco-editor_esm_vs_editor_common_services_languagesRegistry_js"],{

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   clearPlatformLanguageAssociations: () => (/* binding */ clearPlatformLanguageAssociations),
/* harmony export */   getLanguageIds: () => (/* binding */ getLanguageIds),
/* harmony export */   registerPlatformLanguageAssociation: () => (/* binding */ registerPlatformLanguageAssociation)
/* harmony export */ });
/* harmony import */ var _base_common_glob_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/glob.js */ "./node_modules/monaco-editor/esm/vs/base/common/glob.js");
/* harmony import */ var _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/mime.js */ "./node_modules/monaco-editor/esm/vs/base/common/mime.js");
/* harmony import */ var _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/common/network.js */ "./node_modules/monaco-editor/esm/vs/base/common/network.js");
/* harmony import */ var _base_common_path_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../base/common/path.js */ "./node_modules/monaco-editor/esm/vs/base/common/path.js");
/* harmony import */ var _base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../base/common/resources.js */ "./node_modules/monaco-editor/esm/vs/base/common/resources.js");
/* harmony import */ var _base_common_strings_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../base/common/strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/* harmony import */ var _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../languages/modesRegistry.js */ "./node_modules/monaco-editor/esm/vs/editor/common/languages/modesRegistry.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/







let registeredAssociations = [];
let nonUserRegisteredAssociations = [];
let userRegisteredAssociations = [];
/**
 * Associate a language to the registry (platform).
 * * **NOTE**: This association will lose over associations registered using `registerConfiguredLanguageAssociation`.
 * * **NOTE**: Use `clearPlatformLanguageAssociations` to remove all associations registered using this function.
 */
function registerPlatformLanguageAssociation(association, warnOnOverwrite = false) {
    _registerLanguageAssociation(association, false, warnOnOverwrite);
}
function _registerLanguageAssociation(association, userConfigured, warnOnOverwrite) {
    // Register
    const associationItem = toLanguageAssociationItem(association, userConfigured);
    registeredAssociations.push(associationItem);
    if (!associationItem.userConfigured) {
        nonUserRegisteredAssociations.push(associationItem);
    }
    else {
        userRegisteredAssociations.push(associationItem);
    }
    // Check for conflicts unless this is a user configured association
    if (warnOnOverwrite && !associationItem.userConfigured) {
        registeredAssociations.forEach(a => {
            if (a.mime === associationItem.mime || a.userConfigured) {
                return; // same mime or userConfigured is ok
            }
            if (associationItem.extension && a.extension === associationItem.extension) {
                console.warn(`Overwriting extension <<${associationItem.extension}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.filename && a.filename === associationItem.filename) {
                console.warn(`Overwriting filename <<${associationItem.filename}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.filepattern && a.filepattern === associationItem.filepattern) {
                console.warn(`Overwriting filepattern <<${associationItem.filepattern}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.firstline && a.firstline === associationItem.firstline) {
                console.warn(`Overwriting firstline <<${associationItem.firstline}>> to now point to mime <<${associationItem.mime}>>`);
            }
        });
    }
}
function toLanguageAssociationItem(association, userConfigured) {
    return {
        id: association.id,
        mime: association.mime,
        filename: association.filename,
        extension: association.extension,
        filepattern: association.filepattern,
        firstline: association.firstline,
        userConfigured: userConfigured,
        filenameLowercase: association.filename ? association.filename.toLowerCase() : undefined,
        extensionLowercase: association.extension ? association.extension.toLowerCase() : undefined,
        filepatternLowercase: association.filepattern ? (0,_base_common_glob_js__WEBPACK_IMPORTED_MODULE_0__.parse)(association.filepattern.toLowerCase()) : undefined,
        filepatternOnPath: association.filepattern ? association.filepattern.indexOf(_base_common_path_js__WEBPACK_IMPORTED_MODULE_3__.posix.sep) >= 0 : false
    };
}
/**
 * Clear language associations from the registry (platform).
 */
function clearPlatformLanguageAssociations() {
    registeredAssociations = registeredAssociations.filter(a => a.userConfigured);
    nonUserRegisteredAssociations = [];
}
/**
 * @see `getMimeTypes`
 */
function getLanguageIds(resource, firstLine) {
    return getAssociations(resource, firstLine).map(item => item.id);
}
function getAssociations(resource, firstLine) {
    let path;
    if (resource) {
        switch (resource.scheme) {
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.file:
                path = resource.fsPath;
                break;
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.data: {
                const metadata = _base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__.DataUri.parseMetaData(resource);
                path = metadata.get(_base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__.DataUri.META_DATA_LABEL);
                break;
            }
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.vscodeNotebookCell:
                // File path not relevant for language detection of cell
                path = undefined;
                break;
            default:
                path = resource.path;
        }
    }
    if (!path) {
        return [{ id: 'unknown', mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.unknown }];
    }
    path = path.toLowerCase();
    const filename = (0,_base_common_path_js__WEBPACK_IMPORTED_MODULE_3__.basename)(path);
    // 1.) User configured mappings have highest priority
    const configuredLanguage = getAssociationByPath(path, filename, userRegisteredAssociations);
    if (configuredLanguage) {
        return [configuredLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
    }
    // 2.) Registered mappings have middle priority
    const registeredLanguage = getAssociationByPath(path, filename, nonUserRegisteredAssociations);
    if (registeredLanguage) {
        return [registeredLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
    }
    // 3.) Firstline has lowest priority
    if (firstLine) {
        const firstlineLanguage = getAssociationByFirstline(firstLine);
        if (firstlineLanguage) {
            return [firstlineLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
        }
    }
    return [{ id: 'unknown', mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.unknown }];
}
function getAssociationByPath(path, filename, associations) {
    let filenameMatch = undefined;
    let patternMatch = undefined;
    let extensionMatch = undefined;
    // We want to prioritize associations based on the order they are registered so that the last registered
    // association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074
    for (let i = associations.length - 1; i >= 0; i--) {
        const association = associations[i];
        // First exact name match
        if (filename === association.filenameLowercase) {
            filenameMatch = association;
            break; // take it!
        }
        // Longest pattern match
        if (association.filepattern) {
            if (!patternMatch || association.filepattern.length > patternMatch.filepattern.length) {
                const target = association.filepatternOnPath ? path : filename; // match on full path if pattern contains path separator
                if (association.filepatternLowercase?.(target)) {
                    patternMatch = association;
                }
            }
        }
        // Longest extension match
        if (association.extension) {
            if (!extensionMatch || association.extension.length > extensionMatch.extension.length) {
                if (filename.endsWith(association.extensionLowercase)) {
                    extensionMatch = association;
                }
            }
        }
    }
    // 1.) Exact name match has second highest priority
    if (filenameMatch) {
        return filenameMatch;
    }
    // 2.) Match on pattern
    if (patternMatch) {
        return patternMatch;
    }
    // 3.) Match on extension comes next
    if (extensionMatch) {
        return extensionMatch;
    }
    return undefined;
}
function getAssociationByFirstline(firstLine) {
    if ((0,_base_common_strings_js__WEBPACK_IMPORTED_MODULE_5__.startsWithUTF8BOM)(firstLine)) {
        firstLine = firstLine.substr(1);
    }
    if (firstLine.length > 0) {
        // We want to prioritize associations based on the order they are registered so that the last registered
        // association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074
        for (let i = registeredAssociations.length - 1; i >= 0; i--) {
            const association = registeredAssociations[i];
            if (!association.firstline) {
                continue;
            }
            const matches = firstLine.match(association.firstline);
            if (matches && matches.length > 0) {
                return association;
            }
        }
    }
    return undefined;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js ***!
  \***************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LanguageIdCodec: () => (/* binding */ LanguageIdCodec),
/* harmony export */   LanguagesRegistry: () => (/* binding */ LanguagesRegistry)
/* harmony export */ });
/* harmony import */ var _base_common_event_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/event.js */ "./node_modules/monaco-editor/esm/vs/base/common/event.js");
/* harmony import */ var _base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/lifecycle.js */ "./node_modules/monaco-editor/esm/vs/base/common/lifecycle.js");
/* harmony import */ var _base_common_strings_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/common/strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/* harmony import */ var _languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./languagesAssociations.js */ "./node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js");
/* harmony import */ var _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../languages/modesRegistry.js */ "./node_modules/monaco-editor/esm/vs/editor/common/languages/modesRegistry.js");
/* harmony import */ var _platform_configuration_common_configurationRegistry_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../platform/configuration/common/configurationRegistry.js */ "./node_modules/monaco-editor/esm/vs/platform/configuration/common/configurationRegistry.js");
/* harmony import */ var _platform_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../platform/registry/common/platform.js */ "./node_modules/monaco-editor/esm/vs/platform/registry/common/platform.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/







const hasOwnProperty = Object.prototype.hasOwnProperty;
const NULL_LANGUAGE_ID = 'vs.editor.nullLanguage';
class LanguageIdCodec {
    constructor() {
        this._languageIdToLanguage = [];
        this._languageToLanguageId = new Map();
        this._register(NULL_LANGUAGE_ID, 0 /* LanguageId.Null */);
        this._register(_languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_4__.PLAINTEXT_LANGUAGE_ID, 1 /* LanguageId.PlainText */);
        this._nextLanguageId = 2;
    }
    _register(language, languageId) {
        this._languageIdToLanguage[languageId] = language;
        this._languageToLanguageId.set(language, languageId);
    }
    register(language) {
        if (this._languageToLanguageId.has(language)) {
            return;
        }
        const languageId = this._nextLanguageId++;
        this._register(language, languageId);
    }
    encodeLanguageId(languageId) {
        return this._languageToLanguageId.get(languageId) || 0 /* LanguageId.Null */;
    }
    decodeLanguageId(languageId) {
        return this._languageIdToLanguage[languageId] || NULL_LANGUAGE_ID;
    }
}
class LanguagesRegistry extends _base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__.Disposable {
    static { this.instanceCount = 0; }
    constructor(useModesRegistry = true, warnOnOverwrite = false) {
        super();
        this._onDidChange = this._register(new _base_common_event_js__WEBPACK_IMPORTED_MODULE_0__.Emitter());
        this.onDidChange = this._onDidChange.event;
        LanguagesRegistry.instanceCount++;
        this._warnOnOverwrite = warnOnOverwrite;
        this.languageIdCodec = new LanguageIdCodec();
        this._dynamicLanguages = [];
        this._languages = {};
        this._mimeTypesMap = {};
        this._nameMap = {};
        this._lowercaseNameMap = {};
        if (useModesRegistry) {
            this._initializeFromRegistry();
            this._register(_languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_4__.ModesRegistry.onDidChangeLanguages((m) => {
                this._initializeFromRegistry();
            }));
        }
    }
    dispose() {
        LanguagesRegistry.instanceCount--;
        super.dispose();
    }
    _initializeFromRegistry() {
        this._languages = {};
        this._mimeTypesMap = {};
        this._nameMap = {};
        this._lowercaseNameMap = {};
        (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.clearPlatformLanguageAssociations)();
        const desc = [].concat(_languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_4__.ModesRegistry.getLanguages()).concat(this._dynamicLanguages);
        this._registerLanguages(desc);
    }
    _registerLanguages(desc) {
        for (const d of desc) {
            this._registerLanguage(d);
        }
        // Rebuild fast path maps
        this._mimeTypesMap = {};
        this._nameMap = {};
        this._lowercaseNameMap = {};
        Object.keys(this._languages).forEach((langId) => {
            const language = this._languages[langId];
            if (language.name) {
                this._nameMap[language.name] = language.identifier;
            }
            language.aliases.forEach((alias) => {
                this._lowercaseNameMap[alias.toLowerCase()] = language.identifier;
            });
            language.mimetypes.forEach((mimetype) => {
                this._mimeTypesMap[mimetype] = language.identifier;
            });
        });
        _platform_registry_common_platform_js__WEBPACK_IMPORTED_MODULE_6__.Registry.as(_platform_configuration_common_configurationRegistry_js__WEBPACK_IMPORTED_MODULE_5__.Extensions.Configuration).registerOverrideIdentifiers(this.getRegisteredLanguageIds());
        this._onDidChange.fire();
    }
    _registerLanguage(lang) {
        const langId = lang.id;
        let resolvedLanguage;
        if (hasOwnProperty.call(this._languages, langId)) {
            resolvedLanguage = this._languages[langId];
        }
        else {
            this.languageIdCodec.register(langId);
            resolvedLanguage = {
                identifier: langId,
                name: null,
                mimetypes: [],
                aliases: [],
                extensions: [],
                filenames: [],
                configurationFiles: [],
                icons: []
            };
            this._languages[langId] = resolvedLanguage;
        }
        this._mergeLanguage(resolvedLanguage, lang);
    }
    _mergeLanguage(resolvedLanguage, lang) {
        const langId = lang.id;
        let primaryMime = null;
        if (Array.isArray(lang.mimetypes) && lang.mimetypes.length > 0) {
            resolvedLanguage.mimetypes.push(...lang.mimetypes);
            primaryMime = lang.mimetypes[0];
        }
        if (!primaryMime) {
            primaryMime = `text/x-${langId}`;
            resolvedLanguage.mimetypes.push(primaryMime);
        }
        if (Array.isArray(lang.extensions)) {
            if (lang.configuration) {
                // insert first as this appears to be the 'primary' language definition
                resolvedLanguage.extensions = lang.extensions.concat(resolvedLanguage.extensions);
            }
            else {
                resolvedLanguage.extensions = resolvedLanguage.extensions.concat(lang.extensions);
            }
            for (const extension of lang.extensions) {
                (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.registerPlatformLanguageAssociation)({ id: langId, mime: primaryMime, extension: extension }, this._warnOnOverwrite);
            }
        }
        if (Array.isArray(lang.filenames)) {
            for (const filename of lang.filenames) {
                (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.registerPlatformLanguageAssociation)({ id: langId, mime: primaryMime, filename: filename }, this._warnOnOverwrite);
                resolvedLanguage.filenames.push(filename);
            }
        }
        if (Array.isArray(lang.filenamePatterns)) {
            for (const filenamePattern of lang.filenamePatterns) {
                (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.registerPlatformLanguageAssociation)({ id: langId, mime: primaryMime, filepattern: filenamePattern }, this._warnOnOverwrite);
            }
        }
        if (typeof lang.firstLine === 'string' && lang.firstLine.length > 0) {
            let firstLineRegexStr = lang.firstLine;
            if (firstLineRegexStr.charAt(0) !== '^') {
                firstLineRegexStr = '^' + firstLineRegexStr;
            }
            try {
                const firstLineRegex = new RegExp(firstLineRegexStr);
                if (!(0,_base_common_strings_js__WEBPACK_IMPORTED_MODULE_2__.regExpLeadsToEndlessLoop)(firstLineRegex)) {
                    (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.registerPlatformLanguageAssociation)({ id: langId, mime: primaryMime, firstline: firstLineRegex }, this._warnOnOverwrite);
                }
            }
            catch (err) {
                // Most likely, the regex was bad
                console.warn(`[${lang.id}]: Invalid regular expression \`${firstLineRegexStr}\`: `, err);
            }
        }
        resolvedLanguage.aliases.push(langId);
        let langAliases = null;
        if (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases)) {
            if (lang.aliases.length === 0) {
                // signal that this language should not get a name
                langAliases = [null];
            }
            else {
                langAliases = lang.aliases;
            }
        }
        if (langAliases !== null) {
            for (const langAlias of langAliases) {
                if (!langAlias || langAlias.length === 0) {
                    continue;
                }
                resolvedLanguage.aliases.push(langAlias);
            }
        }
        const containsAliases = (langAliases !== null && langAliases.length > 0);
        if (containsAliases && langAliases[0] === null) {
            // signal that this language should not get a name
        }
        else {
            const bestName = (containsAliases ? langAliases[0] : null) || langId;
            if (containsAliases || !resolvedLanguage.name) {
                resolvedLanguage.name = bestName;
            }
        }
        if (lang.configuration) {
            resolvedLanguage.configurationFiles.push(lang.configuration);
        }
        if (lang.icon) {
            resolvedLanguage.icons.push(lang.icon);
        }
    }
    isRegisteredLanguageId(languageId) {
        if (!languageId) {
            return false;
        }
        return hasOwnProperty.call(this._languages, languageId);
    }
    getRegisteredLanguageIds() {
        return Object.keys(this._languages);
    }
    getLanguageIdByLanguageName(languageName) {
        const languageNameLower = languageName.toLowerCase();
        if (!hasOwnProperty.call(this._lowercaseNameMap, languageNameLower)) {
            return null;
        }
        return this._lowercaseNameMap[languageNameLower];
    }
    getLanguageIdByMimeType(mimeType) {
        if (!mimeType) {
            return null;
        }
        if (hasOwnProperty.call(this._mimeTypesMap, mimeType)) {
            return this._mimeTypesMap[mimeType];
        }
        return null;
    }
    guessLanguageIdByFilepathOrFirstLine(resource, firstLine) {
        if (!resource && !firstLine) {
            return [];
        }
        return (0,_languagesAssociations_js__WEBPACK_IMPORTED_MODULE_3__.getLanguageIds)(resource, firstLine);
    }
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfbW9uYWNvLWVkaXRvcl9lc21fdnNfZWRpdG9yX2NvbW1vbl9zZXJ2aWNlc19sYW5ndWFnZXNSZWdpc3RyeV9qcy5idW5kbGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ3FEO0FBQ0E7QUFDSztBQUNLO0FBQ0g7QUFDUTtBQUNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQSx3REFBd0QsMEJBQTBCLDRCQUE0QixxQkFBcUI7QUFDbkk7QUFDQTtBQUNBLHVEQUF1RCx5QkFBeUIsNEJBQTRCLHFCQUFxQjtBQUNqSTtBQUNBO0FBQ0EsMERBQTBELDRCQUE0Qiw0QkFBNEIscUJBQXFCO0FBQ3ZJO0FBQ0E7QUFDQSx3REFBd0QsMEJBQTBCLDRCQUE0QixxQkFBcUI7QUFDbkk7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsMkRBQUs7QUFDN0QscUZBQXFGLHVEQUFLO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDREQUFPO0FBQ3hCO0FBQ0E7QUFDQSxpQkFBaUIsNERBQU87QUFDeEIsaUNBQWlDLDhEQUFPO0FBQ3hDLG9DQUFvQyw4REFBTztBQUMzQztBQUNBO0FBQ0EsaUJBQWlCLDREQUFPO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFB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a0Msa0JBQWtCO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSx5RUFBYztBQUM3QjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9lZGl0b3IvY29tbW9uL3NlcnZpY2VzL2xhbmd1YWdlc0Fzc29jaWF0aW9ucy5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbGFuZ3VhZ2VzUmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2dsb2IuanMnO1xuaW1wb3J0IHsgTWltZXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9taW1lLmpzJztcbmltcG9ydCB7IFNjaGVtYXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9uZXR3b3JrLmpzJztcbmltcG9ydCB7IGJhc2VuYW1lLCBwb3NpeCB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3BhdGguanMnO1xuaW1wb3J0IHsgRGF0YVVyaSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3Jlc291cmNlcy5qcyc7XG5pbXBvcnQgeyBzdGFydHNXaXRoVVRGOEJPTSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3N0cmluZ3MuanMnO1xuaW1wb3J0IHsgUExBSU5URVhUX0xBTkdVQUdFX0lEIH0gZnJvbSAnLi4vbGFuZ3VhZ2VzL21vZGVzUmVnaXN0cnkuanMnO1xubGV0IHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMgPSBbXTtcbmxldCBub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyA9IFtdO1xubGV0IHVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gW107XG4vKipcbiAqIEFzc29jaWF0ZSBhIGxhbmd1YWdlIHRvIHRoZSByZWdpc3RyeSAocGxhdGZvcm0pLlxuICogKiAqKk5PVEUqKjogVGhpcyBhc3NvY2lhdGlvbiB3aWxsIGxvc2Ugb3ZlciBhc3NvY2lhdGlvbnMgcmVnaXN0ZXJlZCB1c2luZyBgcmVnaXN0ZXJDb25maWd1cmVkTGFuZ3VhZ2VBc3NvY2lhdGlvbmAuXG4gKiAqICoqTk9URSoqOiBVc2UgYGNsZWFyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uc2AgdG8gcmVtb3ZlIGFsbCBhc3NvY2lhdGlvbnMgcmVnaXN0ZXJlZCB1c2luZyB0aGlzIGZ1bmN0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJQbGF0Zm9ybUxhbmd1YWdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb24sIHdhcm5Pbk92ZXJ3cml0ZSA9IGZhbHNlKSB7XG4gICAgX3JlZ2lzdGVyTGFuZ3VhZ2VBc3NvY2lhdGlvbihhc3NvY2lhdGlvbiwgZmFsc2UsIHdhcm5Pbk92ZXJ3cml0ZSk7XG59XG5mdW5jdGlvbiBfcmVnaXN0ZXJMYW5ndWFnZUFzc29jaWF0aW9uKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCwgd2Fybk9uT3ZlcndyaXRlKSB7XG4gICAgLy8gUmVnaXN0ZXJcbiAgICBjb25zdCBhc3NvY2lhdGlvbkl0ZW0gPSB0b0xhbmd1YWdlQXNzb2NpYXRpb25JdGVtKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCk7XG4gICAgcmVnaXN0ZXJlZEFzc29jaWF0aW9ucy5wdXNoKGFzc29jaWF0aW9uSXRlbSk7XG4gICAgaWYgKCFhc3NvY2lhdGlvbkl0ZW0udXNlckNvbmZpZ3VyZWQpIHtcbiAgICAgICAgbm9uVXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbkl0ZW0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbkl0ZW0pO1xuICAgIH1cbiAgICAvLyBDaGVjayBmb3IgY29uZmxpY3RzIHVubGVzcyB0aGlzIGlzIGEgdXNlciBjb25maWd1cmVkIGFzc29jaWF0aW9uXG4gICAgaWYgKHdhcm5Pbk92ZXJ3cml0ZSAmJiAhYXNzb2NpYXRpb25JdGVtLnVzZXJDb25maWd1cmVkKSB7XG4gICAgICAgIHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMuZm9yRWFjaChhID0+IHtcbiAgICAgICAgICAgIGlmIChhLm1pbWUgPT09IGFzc29jaWF0aW9uSXRlbS5taW1lIHx8IGEudXNlckNvbmZpZ3VyZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIHNhbWUgbWltZSBvciB1c2VyQ29uZmlndXJlZCBpcyBva1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uSXRlbS5leHRlbnNpb24gJiYgYS5leHRlbnNpb24gPT09IGFzc29jaWF0aW9uSXRlbS5leHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE92ZXJ3cml0aW5nIGV4dGVuc2lvbiA8PCR7YXNzb2NpYXRpb25JdGVtLmV4dGVuc2lvbn0+PiB0byBub3cgcG9pbnQgdG8gbWltZSA8PCR7YXNzb2NpYXRpb25JdGVtLm1pbWV9Pj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbkl0ZW0uZmlsZW5hbWUgJiYgYS5maWxlbmFtZSA9PT0gYXNzb2NpYXRpb25JdGVtLmZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBPdmVyd3JpdGluZyBmaWxlbmFtZSA8PCR7YXNzb2NpYXRpb25JdGVtLmZpbGVuYW1lfT4+IHRvIG5vdyBwb2ludCB0byBtaW1lIDw8JHthc3NvY2lhdGlvbkl0ZW0ubWltZX0+PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uSXRlbS5maWxlcGF0dGVybiAmJiBhLmZpbGVwYXR0ZXJuID09PSBhc3NvY2lhdGlvbkl0ZW0uZmlsZXBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE92ZXJ3cml0aW5nIGZpbGVwYXR0ZXJuIDw8JHthc3NvY2lhdGlvbkl0ZW0uZmlsZXBhdHRlcm59Pj4gdG8gbm93IHBvaW50IHRvIG1pbWUgPDwke2Fzc29jaWF0aW9uSXRlbS5taW1lfT4+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXNzb2NpYXRpb25JdGVtLmZpcnN0bGluZSAmJiBhLmZpcnN0bGluZSA9PT0gYXNzb2NpYXRpb25JdGVtLmZpcnN0bGluZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgT3ZlcndyaXRpbmcgZmlyc3RsaW5lIDw8JHthc3NvY2lhdGlvbkl0ZW0uZmlyc3RsaW5lfT4+IHRvIG5vdyBwb2ludCB0byBtaW1lIDw8JHthc3NvY2lhdGlvbkl0ZW0ubWltZX0+PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiB0b0xhbmd1YWdlQXNzb2NpYXRpb25JdGVtKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBhc3NvY2lhdGlvbi5pZCxcbiAgICAgICAgbWltZTogYXNzb2NpYXRpb24ubWltZSxcbiAgICAgICAgZmlsZW5hbWU6IGFzc29jaWF0aW9uLmZpbGVuYW1lLFxuICAgICAgICBleHRlbnNpb246IGFzc29jaWF0aW9uLmV4dGVuc2lvbixcbiAgICAgICAgZmlsZXBhdHRlcm46IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuLFxuICAgICAgICBmaXJzdGxpbmU6IGFzc29jaWF0aW9uLmZpcnN0bGluZSxcbiAgICAgICAgdXNlckNvbmZpZ3VyZWQ6IHVzZXJDb25maWd1cmVkLFxuICAgICAgICBmaWxlbmFtZUxvd2VyY2FzZTogYXNzb2NpYXRpb24uZmlsZW5hbWUgPyBhc3NvY2lhdGlvbi5maWxlbmFtZS50b0xvd2VyQ2FzZSgpIDogdW5kZWZpbmVkLFxuICAgICAgICBleHRlbnNpb25Mb3dlcmNhc2U6IGFzc29jaWF0aW9uLmV4dGVuc2lvbiA/IGFzc29jaWF0aW9uLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpIDogdW5kZWZpbmVkLFxuICAgICAgICBmaWxlcGF0dGVybkxvd2VyY2FzZTogYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4gPyBwYXJzZShhc3NvY2lhdGlvbi5maWxlcGF0dGVybi50b0xvd2VyQ2FzZSgpKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZmlsZXBhdHRlcm5PblBhdGg6IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuID8gYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4uaW5kZXhPZihwb3NpeC5zZXApID49IDAgOiBmYWxzZVxuICAgIH07XG59XG4vKipcbiAqIENsZWFyIGxhbmd1YWdlIGFzc29jaWF0aW9ucyBmcm9tIHRoZSByZWdpc3RyeSAocGxhdGZvcm0pLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJQbGF0Zm9ybUxhbmd1YWdlQXNzb2NpYXRpb25zKCkge1xuICAgIHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMgPSByZWdpc3RlcmVkQXNzb2NpYXRpb25zLmZpbHRlcihhID0+IGEudXNlckNvbmZpZ3VyZWQpO1xuICAgIG5vblVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gW107XG59XG4vKipcbiAqIEBzZWUgYGdldE1pbWVUeXBlc2BcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldExhbmd1YWdlSWRzKHJlc291cmNlLCBmaXJzdExpbmUpIHtcbiAgICByZXR1cm4gZ2V0QXNzb2NpYXRpb25zKHJlc291cmNlLCBmaXJzdExpbmUpLm1hcChpdGVtID0+IGl0ZW0uaWQpO1xufVxuZnVuY3Rpb24gZ2V0QXNzb2NpYXRpb25zKHJlc291cmNlLCBmaXJzdExpbmUpIHtcbiAgICBsZXQgcGF0aDtcbiAgICBpZiAocmVzb3VyY2UpIHtcbiAgICAgICAgc3dpdGNoIChyZXNvdXJjZS5zY2hlbWUpIHtcbiAgICAgICAgICAgIGNhc2UgU2NoZW1hcy5maWxlOlxuICAgICAgICAgICAgICAgIHBhdGggPSByZXNvdXJjZS5mc1BhdGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNjaGVtYXMuZGF0YToge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gRGF0YVVyaS5wYXJzZU1ldGFEYXRhKHJlc291cmNlKTtcbiAgICAgICAgICAgICAgICBwYXRoID0gbWV0YWRhdGEuZ2V0KERhdGFVcmkuTUVUQV9EQVRBX0xBQkVMKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgU2NoZW1hcy52c2NvZGVOb3RlYm9va0NlbGw6XG4gICAgICAgICAgICAgICAgLy8gRmlsZSBwYXRoIG5vdCByZWxldmFudCBmb3IgbGFuZ3VhZ2UgZGV0ZWN0aW9uIG9mIGNlbGxcbiAgICAgICAgICAgICAgICBwYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBwYXRoID0gcmVzb3VyY2UucGF0aDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgcmV0dXJuIFt7IGlkOiAndW5rbm93bicsIG1pbWU6IE1pbWVzLnVua25vd24gfV07XG4gICAgfVxuICAgIHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZmlsZW5hbWUgPSBiYXNlbmFtZShwYXRoKTtcbiAgICAvLyAxLikgVXNlciBjb25maWd1cmVkIG1hcHBpbmdzIGhhdmUgaGlnaGVzdCBwcmlvcml0eVxuICAgIGNvbnN0IGNvbmZpZ3VyZWRMYW5ndWFnZSA9IGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCB1c2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyk7XG4gICAgaWYgKGNvbmZpZ3VyZWRMYW5ndWFnZSkge1xuICAgICAgICByZXR1cm4gW2NvbmZpZ3VyZWRMYW5ndWFnZSwgeyBpZDogUExBSU5URVhUX0xBTkdVQUdFX0lELCBtaW1lOiBNaW1lcy50ZXh0IH1dO1xuICAgIH1cbiAgICAvLyAyLikgUmVnaXN0ZXJlZCBtYXBwaW5ncyBoYXZlIG1pZGRsZSBwcmlvcml0eVxuICAgIGNvbnN0IHJlZ2lzdGVyZWRMYW5ndWFnZSA9IGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCBub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyk7XG4gICAgaWYgKHJlZ2lzdGVyZWRMYW5ndWFnZSkge1xuICAgICAgICByZXR1cm4gW3JlZ2lzdGVyZWRMYW5ndWFnZSwgeyBpZDogUExBSU5URVhUX0xBTkdVQUdFX0lELCBtaW1lOiBNaW1lcy50ZXh0IH1dO1xuICAgIH1cbiAgICAvLyAzLikgRmlyc3RsaW5lIGhhcyBsb3dlc3QgcHJpb3JpdHlcbiAgICBpZiAoZmlyc3RMaW5lKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0bGluZUxhbmd1YWdlID0gZ2V0QXNzb2NpYXRpb25CeUZpcnN0bGluZShmaXJzdExpbmUpO1xuICAgICAgICBpZiAoZmlyc3RsaW5lTGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBbZmlyc3RsaW5lTGFuZ3VhZ2UsIHsgaWQ6IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCwgbWltZTogTWltZXMudGV4dCB9XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW3sgaWQ6ICd1bmtub3duJywgbWltZTogTWltZXMudW5rbm93biB9XTtcbn1cbmZ1bmN0aW9uIGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCBhc3NvY2lhdGlvbnMpIHtcbiAgICBsZXQgZmlsZW5hbWVNYXRjaCA9IHVuZGVmaW5lZDtcbiAgICBsZXQgcGF0dGVybk1hdGNoID0gdW5kZWZpbmVkO1xuICAgIGxldCBleHRlbnNpb25NYXRjaCA9IHVuZGVmaW5lZDtcbiAgICAvLyBXZSB3YW50IHRvIHByaW9yaXRpemUgYXNzb2NpYXRpb25zIGJhc2VkIG9uIHRoZSBvcmRlciB0aGV5IGFyZSByZWdpc3RlcmVkIHNvIHRoYXQgdGhlIGxhc3QgcmVnaXN0ZXJlZFxuICAgIC8vIGFzc29jaWF0aW9uIHdpbnMgb3ZlciBhbGwgb3RoZXIuIFRoaXMgaXMgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy8yMDA3NFxuICAgIGZvciAobGV0IGkgPSBhc3NvY2lhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgYXNzb2NpYXRpb24gPSBhc3NvY2lhdGlvbnNbaV07XG4gICAgICAgIC8vIEZpcnN0IGV4YWN0IG5hbWUgbWF0Y2hcbiAgICAgICAgaWYgKGZpbGVuYW1lID09PSBhc3NvY2lhdGlvbi5maWxlbmFtZUxvd2VyY2FzZSkge1xuICAgICAgICAgICAgZmlsZW5hbWVNYXRjaCA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgYnJlYWs7IC8vIHRha2UgaXQhXG4gICAgICAgIH1cbiAgICAgICAgLy8gTG9uZ2VzdCBwYXR0ZXJuIG1hdGNoXG4gICAgICAgIGlmIChhc3NvY2lhdGlvbi5maWxlcGF0dGVybikge1xuICAgICAgICAgICAgaWYgKCFwYXR0ZXJuTWF0Y2ggfHwgYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4ubGVuZ3RoID4gcGF0dGVybk1hdGNoLmZpbGVwYXR0ZXJuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuT25QYXRoID8gcGF0aCA6IGZpbGVuYW1lOyAvLyBtYXRjaCBvbiBmdWxsIHBhdGggaWYgcGF0dGVybiBjb250YWlucyBwYXRoIHNlcGFyYXRvclxuICAgICAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbi5maWxlcGF0dGVybkxvd2VyY2FzZT8uKHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk1hdGNoID0gYXNzb2NpYXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIExvbmdlc3QgZXh0ZW5zaW9uIG1hdGNoXG4gICAgICAgIGlmIChhc3NvY2lhdGlvbi5leHRlbnNpb24pIHtcbiAgICAgICAgICAgIGlmICghZXh0ZW5zaW9uTWF0Y2ggfHwgYXNzb2NpYXRpb24uZXh0ZW5zaW9uLmxlbmd0aCA+IGV4dGVuc2lvbk1hdGNoLmV4dGVuc2lvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZW5hbWUuZW5kc1dpdGgoYXNzb2NpYXRpb24uZXh0ZW5zaW9uTG93ZXJjYXNlKSkge1xuICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25NYXRjaCA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyAxLikgRXhhY3QgbmFtZSBtYXRjaCBoYXMgc2Vjb25kIGhpZ2hlc3QgcHJpb3JpdHlcbiAgICBpZiAoZmlsZW5hbWVNYXRjaCkge1xuICAgICAgICByZXR1cm4gZmlsZW5hbWVNYXRjaDtcbiAgICB9XG4gICAgLy8gMi4pIE1hdGNoIG9uIHBhdHRlcm5cbiAgICBpZiAocGF0dGVybk1hdGNoKSB7XG4gICAgICAgIHJldHVybiBwYXR0ZXJuTWF0Y2g7XG4gICAgfVxuICAgIC8vIDMuKSBNYXRjaCBvbiBleHRlbnNpb24gY29tZXMgbmV4dFxuICAgIGlmIChleHRlbnNpb25NYXRjaCkge1xuICAgICAgICByZXR1cm4gZXh0ZW5zaW9uTWF0Y2g7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiBnZXRBc3NvY2lhdGlvbkJ5Rmlyc3RsaW5lKGZpcnN0TGluZSkge1xuICAgIGlmIChzdGFydHNXaXRoVVRGOEJPTShmaXJzdExpbmUpKSB7XG4gICAgICAgIGZpcnN0TGluZSA9IGZpcnN0TGluZS5zdWJzdHIoMSk7XG4gICAgfVxuICAgIGlmIChmaXJzdExpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBXZSB3YW50IHRvIHByaW9yaXRpemUgYXNzb2NpYXRpb25zIGJhc2VkIG9uIHRoZSBvcmRlciB0aGV5IGFyZSByZWdpc3RlcmVkIHNvIHRoYXQgdGhlIGxhc3QgcmVnaXN0ZXJlZFxuICAgICAgICAvLyBhc3NvY2lhdGlvbiB3aW5zIG92ZXIgYWxsIG90aGVyLiBUaGlzIGlzIGZvciBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvMjAwNzRcbiAgICAgICAgZm9yIChsZXQgaSA9IHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IGFzc29jaWF0aW9uID0gcmVnaXN0ZXJlZEFzc29jaWF0aW9uc1tpXTtcbiAgICAgICAgICAgIGlmICghYXNzb2NpYXRpb24uZmlyc3RsaW5lKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gZmlyc3RMaW5lLm1hdGNoKGFzc29jaWF0aW9uLmZpcnN0bGluZSk7XG4gICAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzb2NpYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2V2ZW50LmpzJztcbmltcG9ydCB7IERpc3Bvc2FibGUgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9saWZlY3ljbGUuanMnO1xuaW1wb3J0IHsgcmVnRXhwTGVhZHNUb0VuZGxlc3NMb29wIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vc3RyaW5ncy5qcyc7XG5pbXBvcnQgeyBjbGVhclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbnMsIGdldExhbmd1YWdlSWRzLCByZWdpc3RlclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbiB9IGZyb20gJy4vbGFuZ3VhZ2VzQXNzb2NpYXRpb25zLmpzJztcbmltcG9ydCB7IE1vZGVzUmVnaXN0cnksIFBMQUlOVEVYVF9MQU5HVUFHRV9JRCB9IGZyb20gJy4uL2xhbmd1YWdlcy9tb2Rlc1JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7IEV4dGVuc2lvbnMgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9jb25maWd1cmF0aW9uL2NvbW1vbi9jb25maWd1cmF0aW9uUmVnaXN0cnkuanMnO1xuaW1wb3J0IHsgUmVnaXN0cnkgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9yZWdpc3RyeS9jb21tb24vcGxhdGZvcm0uanMnO1xuY29uc3QgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xuY29uc3QgTlVMTF9MQU5HVUFHRV9JRCA9ICd2cy5lZGl0b3IubnVsbExhbmd1YWdlJztcbmV4cG9ydCBjbGFzcyBMYW5ndWFnZUlkQ29kZWMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9sYW5ndWFnZUlkVG9MYW5ndWFnZSA9IFtdO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZVRvTGFuZ3VhZ2VJZCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXIoTlVMTF9MQU5HVUFHRV9JRCwgMCAvKiBMYW5ndWFnZUlkLk51bGwgKi8pO1xuICAgICAgICB0aGlzLl9yZWdpc3RlcihQTEFJTlRFWFRfTEFOR1VBR0VfSUQsIDEgLyogTGFuZ3VhZ2VJZC5QbGFpblRleHQgKi8pO1xuICAgICAgICB0aGlzLl9uZXh0TGFuZ3VhZ2VJZCA9IDI7XG4gICAgfVxuICAgIF9yZWdpc3RlcihsYW5ndWFnZSwgbGFuZ3VhZ2VJZCkge1xuICAgICAgICB0aGlzLl9sYW5ndWFnZUlkVG9MYW5ndWFnZVtsYW5ndWFnZUlkXSA9IGxhbmd1YWdlO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZVRvTGFuZ3VhZ2VJZC5zZXQobGFuZ3VhZ2UsIGxhbmd1YWdlSWQpO1xuICAgIH1cbiAgICByZWdpc3RlcihsYW5ndWFnZSkge1xuICAgICAgICBpZiAodGhpcy5fbGFuZ3VhZ2VUb0xhbmd1YWdlSWQuaGFzKGxhbmd1YWdlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlSWQgPSB0aGlzLl9uZXh0TGFuZ3VhZ2VJZCsrO1xuICAgICAgICB0aGlzLl9yZWdpc3RlcihsYW5ndWFnZSwgbGFuZ3VhZ2VJZCk7XG4gICAgfVxuICAgIGVuY29kZUxhbmd1YWdlSWQobGFuZ3VhZ2VJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGFuZ3VhZ2VUb0xhbmd1YWdlSWQuZ2V0KGxhbmd1YWdlSWQpIHx8IDAgLyogTGFuZ3VhZ2VJZC5OdWxsICovO1xuICAgIH1cbiAgICBkZWNvZGVMYW5ndWFnZUlkKGxhbmd1YWdlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhbmd1YWdlSWRUb0xhbmd1YWdlW2xhbmd1YWdlSWRdIHx8IE5VTExfTEFOR1VBR0VfSUQ7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIExhbmd1YWdlc1JlZ2lzdHJ5IGV4dGVuZHMgRGlzcG9zYWJsZSB7XG4gICAgc3RhdGljIHsgdGhpcy5pbnN0YW5jZUNvdW50ID0gMDsgfVxuICAgIGNvbnN0cnVjdG9yKHVzZU1vZGVzUmVnaXN0cnkgPSB0cnVlLCB3YXJuT25PdmVyd3JpdGUgPSBmYWxzZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9vbkRpZENoYW5nZSA9IHRoaXMuX3JlZ2lzdGVyKG5ldyBFbWl0dGVyKCkpO1xuICAgICAgICB0aGlzLm9uRGlkQ2hhbmdlID0gdGhpcy5fb25EaWRDaGFuZ2UuZXZlbnQ7XG4gICAgICAgIExhbmd1YWdlc1JlZ2lzdHJ5Lmluc3RhbmNlQ291bnQrKztcbiAgICAgICAgdGhpcy5fd2Fybk9uT3ZlcndyaXRlID0gd2Fybk9uT3ZlcndyaXRlO1xuICAgICAgICB0aGlzLmxhbmd1YWdlSWRDb2RlYyA9IG5ldyBMYW5ndWFnZUlkQ29kZWMoKTtcbiAgICAgICAgdGhpcy5fZHluYW1pY0xhbmd1YWdlcyA9IFtdO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5fbWltZVR5cGVzTWFwID0ge307XG4gICAgICAgIHRoaXMuX25hbWVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcCA9IHt9O1xuICAgICAgICBpZiAodXNlTW9kZXNSZWdpc3RyeSkge1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZUZyb21SZWdpc3RyeSgpO1xuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXIoTW9kZXNSZWdpc3RyeS5vbkRpZENoYW5nZUxhbmd1YWdlcygobSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVGcm9tUmVnaXN0cnkoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBMYW5ndWFnZXNSZWdpc3RyeS5pbnN0YW5jZUNvdW50LS07XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgX2luaXRpYWxpemVGcm9tUmVnaXN0cnkoKSB7XG4gICAgICAgIHRoaXMuX2xhbmd1YWdlcyA9IHt9O1xuICAgICAgICB0aGlzLl9taW1lVHlwZXNNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbmFtZU1hcCA9IHt9O1xuICAgICAgICB0aGlzLl9sb3dlcmNhc2VOYW1lTWFwID0ge307XG4gICAgICAgIGNsZWFyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9ucygpO1xuICAgICAgICBjb25zdCBkZXNjID0gW10uY29uY2F0KE1vZGVzUmVnaXN0cnkuZ2V0TGFuZ3VhZ2VzKCkpLmNvbmNhdCh0aGlzLl9keW5hbWljTGFuZ3VhZ2VzKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXJMYW5ndWFnZXMoZGVzYyk7XG4gICAgfVxuICAgIF9yZWdpc3Rlckxhbmd1YWdlcyhkZXNjKSB7XG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBkZXNjKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWdpc3Rlckxhbmd1YWdlKGQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlYnVpbGQgZmFzdCBwYXRoIG1hcHNcbiAgICAgICAgdGhpcy5fbWltZVR5cGVzTWFwID0ge307XG4gICAgICAgIHRoaXMuX25hbWVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcCA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLl9sYW5ndWFnZXMpLmZvckVhY2goKGxhbmdJZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSB0aGlzLl9sYW5ndWFnZXNbbGFuZ0lkXTtcbiAgICAgICAgICAgIGlmIChsYW5ndWFnZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmFtZU1hcFtsYW5ndWFnZS5uYW1lXSA9IGxhbmd1YWdlLmlkZW50aWZpZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYW5ndWFnZS5hbGlhc2VzLmZvckVhY2goKGFsaWFzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcFthbGlhcy50b0xvd2VyQ2FzZSgpXSA9IGxhbmd1YWdlLmlkZW50aWZpZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxhbmd1YWdlLm1pbWV0eXBlcy5mb3JFYWNoKChtaW1ldHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX21pbWVUeXBlc01hcFttaW1ldHlwZV0gPSBsYW5ndWFnZS5pZGVudGlmaWVyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBSZWdpc3RyeS5hcyhFeHRlbnNpb25zLkNvbmZpZ3VyYXRpb24pLnJlZ2lzdGVyT3ZlcnJpZGVJZGVudGlmaWVycyh0aGlzLmdldFJlZ2lzdGVyZWRMYW5ndWFnZUlkcygpKTtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2UuZmlyZSgpO1xuICAgIH1cbiAgICBfcmVnaXN0ZXJMYW5ndWFnZShsYW5nKSB7XG4gICAgICAgIGNvbnN0IGxhbmdJZCA9IGxhbmcuaWQ7XG4gICAgICAgIGxldCByZXNvbHZlZExhbmd1YWdlO1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sYW5ndWFnZXMsIGxhbmdJZCkpIHtcbiAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UgPSB0aGlzLl9sYW5ndWFnZXNbbGFuZ0lkXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2VJZENvZGVjLnJlZ2lzdGVyKGxhbmdJZCk7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlID0ge1xuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGxhbmdJZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBudWxsLFxuICAgICAgICAgICAgICAgIG1pbWV0eXBlczogW10sXG4gICAgICAgICAgICAgICAgYWxpYXNlczogW10sXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uczogW10sXG4gICAgICAgICAgICAgICAgZmlsZW5hbWVzOiBbXSxcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uRmlsZXM6IFtdLFxuICAgICAgICAgICAgICAgIGljb25zOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuX2xhbmd1YWdlc1tsYW5nSWRdID0gcmVzb2x2ZWRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tZXJnZUxhbmd1YWdlKHJlc29sdmVkTGFuZ3VhZ2UsIGxhbmcpO1xuICAgIH1cbiAgICBfbWVyZ2VMYW5ndWFnZShyZXNvbHZlZExhbmd1YWdlLCBsYW5nKSB7XG4gICAgICAgIGNvbnN0IGxhbmdJZCA9IGxhbmcuaWQ7XG4gICAgICAgIGxldCBwcmltYXJ5TWltZSA9IG51bGw7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcubWltZXR5cGVzKSAmJiBsYW5nLm1pbWV0eXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLm1pbWV0eXBlcy5wdXNoKC4uLmxhbmcubWltZXR5cGVzKTtcbiAgICAgICAgICAgIHByaW1hcnlNaW1lID0gbGFuZy5taW1ldHlwZXNbMF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwcmltYXJ5TWltZSkge1xuICAgICAgICAgICAgcHJpbWFyeU1pbWUgPSBgdGV4dC94LSR7bGFuZ0lkfWA7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLm1pbWV0eXBlcy5wdXNoKHByaW1hcnlNaW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsYW5nLmV4dGVuc2lvbnMpKSB7XG4gICAgICAgICAgICBpZiAobGFuZy5jb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gaW5zZXJ0IGZpcnN0IGFzIHRoaXMgYXBwZWFycyB0byBiZSB0aGUgJ3ByaW1hcnknIGxhbmd1YWdlIGRlZmluaXRpb25cbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMgPSBsYW5nLmV4dGVuc2lvbnMuY29uY2F0KHJlc29sdmVkTGFuZ3VhZ2UuZXh0ZW5zaW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMgPSByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMuY29uY2F0KGxhbmcuZXh0ZW5zaW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGV4dGVuc2lvbiBvZiBsYW5nLmV4dGVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbih7IGlkOiBsYW5nSWQsIG1pbWU6IHByaW1hcnlNaW1lLCBleHRlbnNpb246IGV4dGVuc2lvbiB9LCB0aGlzLl93YXJuT25PdmVyd3JpdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcuZmlsZW5hbWVzKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlbmFtZSBvZiBsYW5nLmZpbGVuYW1lcykge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpbGVuYW1lOiBmaWxlbmFtZSB9LCB0aGlzLl93YXJuT25PdmVyd3JpdGUpO1xuICAgICAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuZmlsZW5hbWVzLnB1c2goZmlsZW5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcuZmlsZW5hbWVQYXR0ZXJucykpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZW5hbWVQYXR0ZXJuIG9mIGxhbmcuZmlsZW5hbWVQYXR0ZXJucykge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpbGVwYXR0ZXJuOiBmaWxlbmFtZVBhdHRlcm4gfSwgdGhpcy5fd2Fybk9uT3ZlcndyaXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGxhbmcuZmlyc3RMaW5lID09PSAnc3RyaW5nJyAmJiBsYW5nLmZpcnN0TGluZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBsZXQgZmlyc3RMaW5lUmVnZXhTdHIgPSBsYW5nLmZpcnN0TGluZTtcbiAgICAgICAgICAgIGlmIChmaXJzdExpbmVSZWdleFN0ci5jaGFyQXQoMCkgIT09ICdeJykge1xuICAgICAgICAgICAgICAgIGZpcnN0TGluZVJlZ2V4U3RyID0gJ14nICsgZmlyc3RMaW5lUmVnZXhTdHI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0TGluZVJlZ2V4ID0gbmV3IFJlZ0V4cChmaXJzdExpbmVSZWdleFN0cik7XG4gICAgICAgICAgICAgICAgaWYgKCFyZWdFeHBMZWFkc1RvRW5kbGVzc0xvb3AoZmlyc3RMaW5lUmVnZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpcnN0bGluZTogZmlyc3RMaW5lUmVnZXggfSwgdGhpcy5fd2Fybk9uT3ZlcndyaXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgLy8gTW9zdCBsaWtlbHksIHRoZSByZWdleCB3YXMgYmFkXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHtsYW5nLmlkfV06IEludmFsaWQgcmVndWxhciBleHByZXNzaW9uIFxcYCR7Zmlyc3RMaW5lUmVnZXhTdHJ9XFxgOiBgLCBlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuYWxpYXNlcy5wdXNoKGxhbmdJZCk7XG4gICAgICAgIGxldCBsYW5nQWxpYXNlcyA9IG51bGw7XG4gICAgICAgIGlmICh0eXBlb2YgbGFuZy5hbGlhc2VzICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGxhbmcuYWxpYXNlcykpIHtcbiAgICAgICAgICAgIGlmIChsYW5nLmFsaWFzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gc2lnbmFsIHRoYXQgdGhpcyBsYW5ndWFnZSBzaG91bGQgbm90IGdldCBhIG5hbWVcbiAgICAgICAgICAgICAgICBsYW5nQWxpYXNlcyA9IFtudWxsXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxhbmdBbGlhc2VzID0gbGFuZy5hbGlhc2VzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5nQWxpYXNlcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBsYW5nQWxpYXMgb2YgbGFuZ0FsaWFzZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWxhbmdBbGlhcyB8fCBsYW5nQWxpYXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmFsaWFzZXMucHVzaChsYW5nQWxpYXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zQWxpYXNlcyA9IChsYW5nQWxpYXNlcyAhPT0gbnVsbCAmJiBsYW5nQWxpYXNlcy5sZW5ndGggPiAwKTtcbiAgICAgICAgaWYgKGNvbnRhaW5zQWxpYXNlcyAmJiBsYW5nQWxpYXNlc1swXSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gc2lnbmFsIHRoYXQgdGhpcyBsYW5ndWFnZSBzaG91bGQgbm90IGdldCBhIG5hbWVcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGJlc3ROYW1lID0gKGNvbnRhaW5zQWxpYXNlcyA/IGxhbmdBbGlhc2VzWzBdIDogbnVsbCkgfHwgbGFuZ0lkO1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5zQWxpYXNlcyB8fCAhcmVzb2x2ZWRMYW5ndWFnZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRMYW5ndWFnZS5uYW1lID0gYmVzdE5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhbmcuY29uZmlndXJhdGlvbikge1xuICAgICAgICAgICAgcmVzb2x2ZWRMYW5ndWFnZS5jb25maWd1cmF0aW9uRmlsZXMucHVzaChsYW5nLmNvbmZpZ3VyYXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5nLmljb24pIHtcbiAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuaWNvbnMucHVzaChsYW5nLmljb24pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzUmVnaXN0ZXJlZExhbmd1YWdlSWQobGFuZ3VhZ2VJZCkge1xuICAgICAgICBpZiAoIWxhbmd1YWdlSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sYW5ndWFnZXMsIGxhbmd1YWdlSWQpO1xuICAgIH1cbiAgICBnZXRSZWdpc3RlcmVkTGFuZ3VhZ2VJZHMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9sYW5ndWFnZXMpO1xuICAgIH1cbiAgICBnZXRMYW5ndWFnZUlkQnlMYW5ndWFnZU5hbWUobGFuZ3VhZ2VOYW1lKSB7XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlTmFtZUxvd2VyID0gbGFuZ3VhZ2VOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sb3dlcmNhc2VOYW1lTWFwLCBsYW5ndWFnZU5hbWVMb3dlcikpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9sb3dlcmNhc2VOYW1lTWFwW2xhbmd1YWdlTmFtZUxvd2VyXTtcbiAgICB9XG4gICAgZ2V0TGFuZ3VhZ2VJZEJ5TWltZVR5cGUobWltZVR5cGUpIHtcbiAgICAgICAgaWYgKCFtaW1lVHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodGhpcy5fbWltZVR5cGVzTWFwLCBtaW1lVHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taW1lVHlwZXNNYXBbbWltZVR5cGVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBndWVzc0xhbmd1YWdlSWRCeUZpbGVwYXRoT3JGaXJzdExpbmUocmVzb3VyY2UsIGZpcnN0TGluZSkge1xuICAgICAgICBpZiAoIXJlc291cmNlICYmICFmaXJzdExpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ2V0TGFuZ3VhZ2VJZHMocmVzb3VyY2UsIGZpcnN0TGluZSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9