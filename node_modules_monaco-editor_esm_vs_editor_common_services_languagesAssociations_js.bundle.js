"use strict";
(self["webpackChunkpylinac_yaml_editor"] = self["webpackChunkpylinac_yaml_editor"] || []).push([["node_modules_monaco-editor_esm_vs_editor_common_services_languagesAssociations_js"],{

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":
/*!*******************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   clearPlatformLanguageAssociations: () => (/* binding */ clearPlatformLanguageAssociations),
/* harmony export */   getLanguageIds: () => (/* binding */ getLanguageIds),
/* harmony export */   registerPlatformLanguageAssociation: () => (/* binding */ registerPlatformLanguageAssociation)
/* harmony export */ });
/* harmony import */ var _base_common_glob_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/glob.js */ "./node_modules/monaco-editor/esm/vs/base/common/glob.js");
/* harmony import */ var _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/mime.js */ "./node_modules/monaco-editor/esm/vs/base/common/mime.js");
/* harmony import */ var _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/common/network.js */ "./node_modules/monaco-editor/esm/vs/base/common/network.js");
/* harmony import */ var _base_common_path_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../base/common/path.js */ "./node_modules/monaco-editor/esm/vs/base/common/path.js");
/* harmony import */ var _base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../base/common/resources.js */ "./node_modules/monaco-editor/esm/vs/base/common/resources.js");
/* harmony import */ var _base_common_strings_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../base/common/strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/* harmony import */ var _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../languages/modesRegistry.js */ "./node_modules/monaco-editor/esm/vs/editor/common/languages/modesRegistry.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/







let registeredAssociations = [];
let nonUserRegisteredAssociations = [];
let userRegisteredAssociations = [];
/**
 * Associate a language to the registry (platform).
 * * **NOTE**: This association will lose over associations registered using `registerConfiguredLanguageAssociation`.
 * * **NOTE**: Use `clearPlatformLanguageAssociations` to remove all associations registered using this function.
 */
function registerPlatformLanguageAssociation(association, warnOnOverwrite = false) {
    _registerLanguageAssociation(association, false, warnOnOverwrite);
}
function _registerLanguageAssociation(association, userConfigured, warnOnOverwrite) {
    // Register
    const associationItem = toLanguageAssociationItem(association, userConfigured);
    registeredAssociations.push(associationItem);
    if (!associationItem.userConfigured) {
        nonUserRegisteredAssociations.push(associationItem);
    }
    else {
        userRegisteredAssociations.push(associationItem);
    }
    // Check for conflicts unless this is a user configured association
    if (warnOnOverwrite && !associationItem.userConfigured) {
        registeredAssociations.forEach(a => {
            if (a.mime === associationItem.mime || a.userConfigured) {
                return; // same mime or userConfigured is ok
            }
            if (associationItem.extension && a.extension === associationItem.extension) {
                console.warn(`Overwriting extension <<${associationItem.extension}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.filename && a.filename === associationItem.filename) {
                console.warn(`Overwriting filename <<${associationItem.filename}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.filepattern && a.filepattern === associationItem.filepattern) {
                console.warn(`Overwriting filepattern <<${associationItem.filepattern}>> to now point to mime <<${associationItem.mime}>>`);
            }
            if (associationItem.firstline && a.firstline === associationItem.firstline) {
                console.warn(`Overwriting firstline <<${associationItem.firstline}>> to now point to mime <<${associationItem.mime}>>`);
            }
        });
    }
}
function toLanguageAssociationItem(association, userConfigured) {
    return {
        id: association.id,
        mime: association.mime,
        filename: association.filename,
        extension: association.extension,
        filepattern: association.filepattern,
        firstline: association.firstline,
        userConfigured: userConfigured,
        filenameLowercase: association.filename ? association.filename.toLowerCase() : undefined,
        extensionLowercase: association.extension ? association.extension.toLowerCase() : undefined,
        filepatternLowercase: association.filepattern ? (0,_base_common_glob_js__WEBPACK_IMPORTED_MODULE_0__.parse)(association.filepattern.toLowerCase()) : undefined,
        filepatternOnPath: association.filepattern ? association.filepattern.indexOf(_base_common_path_js__WEBPACK_IMPORTED_MODULE_3__.posix.sep) >= 0 : false
    };
}
/**
 * Clear language associations from the registry (platform).
 */
function clearPlatformLanguageAssociations() {
    registeredAssociations = registeredAssociations.filter(a => a.userConfigured);
    nonUserRegisteredAssociations = [];
}
/**
 * @see `getMimeTypes`
 */
function getLanguageIds(resource, firstLine) {
    return getAssociations(resource, firstLine).map(item => item.id);
}
function getAssociations(resource, firstLine) {
    let path;
    if (resource) {
        switch (resource.scheme) {
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.file:
                path = resource.fsPath;
                break;
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.data: {
                const metadata = _base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__.DataUri.parseMetaData(resource);
                path = metadata.get(_base_common_resources_js__WEBPACK_IMPORTED_MODULE_4__.DataUri.META_DATA_LABEL);
                break;
            }
            case _base_common_network_js__WEBPACK_IMPORTED_MODULE_2__.Schemas.vscodeNotebookCell:
                // File path not relevant for language detection of cell
                path = undefined;
                break;
            default:
                path = resource.path;
        }
    }
    if (!path) {
        return [{ id: 'unknown', mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.unknown }];
    }
    path = path.toLowerCase();
    const filename = (0,_base_common_path_js__WEBPACK_IMPORTED_MODULE_3__.basename)(path);
    // 1.) User configured mappings have highest priority
    const configuredLanguage = getAssociationByPath(path, filename, userRegisteredAssociations);
    if (configuredLanguage) {
        return [configuredLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
    }
    // 2.) Registered mappings have middle priority
    const registeredLanguage = getAssociationByPath(path, filename, nonUserRegisteredAssociations);
    if (registeredLanguage) {
        return [registeredLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
    }
    // 3.) Firstline has lowest priority
    if (firstLine) {
        const firstlineLanguage = getAssociationByFirstline(firstLine);
        if (firstlineLanguage) {
            return [firstlineLanguage, { id: _languages_modesRegistry_js__WEBPACK_IMPORTED_MODULE_6__.PLAINTEXT_LANGUAGE_ID, mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.text }];
        }
    }
    return [{ id: 'unknown', mime: _base_common_mime_js__WEBPACK_IMPORTED_MODULE_1__.Mimes.unknown }];
}
function getAssociationByPath(path, filename, associations) {
    let filenameMatch = undefined;
    let patternMatch = undefined;
    let extensionMatch = undefined;
    // We want to prioritize associations based on the order they are registered so that the last registered
    // association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074
    for (let i = associations.length - 1; i >= 0; i--) {
        const association = associations[i];
        // First exact name match
        if (filename === association.filenameLowercase) {
            filenameMatch = association;
            break; // take it!
        }
        // Longest pattern match
        if (association.filepattern) {
            if (!patternMatch || association.filepattern.length > patternMatch.filepattern.length) {
                const target = association.filepatternOnPath ? path : filename; // match on full path if pattern contains path separator
                if (association.filepatternLowercase?.(target)) {
                    patternMatch = association;
                }
            }
        }
        // Longest extension match
        if (association.extension) {
            if (!extensionMatch || association.extension.length > extensionMatch.extension.length) {
                if (filename.endsWith(association.extensionLowercase)) {
                    extensionMatch = association;
                }
            }
        }
    }
    // 1.) Exact name match has second highest priority
    if (filenameMatch) {
        return filenameMatch;
    }
    // 2.) Match on pattern
    if (patternMatch) {
        return patternMatch;
    }
    // 3.) Match on extension comes next
    if (extensionMatch) {
        return extensionMatch;
    }
    return undefined;
}
function getAssociationByFirstline(firstLine) {
    if ((0,_base_common_strings_js__WEBPACK_IMPORTED_MODULE_5__.startsWithUTF8BOM)(firstLine)) {
        firstLine = firstLine.substr(1);
    }
    if (firstLine.length > 0) {
        // We want to prioritize associations based on the order they are registered so that the last registered
        // association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074
        for (let i = registeredAssociations.length - 1; i >= 0; i--) {
            const association = registeredAssociations[i];
            if (!association.firstline) {
                continue;
            }
            const matches = firstLine.match(association.firstline);
            if (matches && matches.length > 0) {
                return association;
            }
        }
    }
    return undefined;
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZV9tb2R1bGVzX21vbmFjby1lZGl0b3JfZXNtX3ZzX2VkaXRvcl9jb21tb25fc2VydmljZXNfbGFuZ3VhZ2VzQXNzb2NpYXRpb25zX2pzLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDcUQ7QUFDQTtBQUNLO0FBQ0s7QUFDSDtBQUNRO0FBQ0U7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBLHdEQUF3RCwwQkFBMEIsNEJBQTRCLHFCQUFxQjtBQUNuSTtBQUNBO0FBQ0EsdURBQXVELHlCQUF5Qiw0QkFBNEIscUJBQXFCO0FBQ2pJO0FBQ0E7QUFDQSwwREFBMEQsNEJBQTRCLDRCQUE0QixxQkFBcUI7QUFDdkk7QUFDQTtBQUNBLHdEQUF3RCwwQkFBMEIsNEJBQTRCLHFCQUFxQjtBQUNuSTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCwyREFBSztBQUM3RCxxRkFBcUYsdURBQUs7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsNERBQU87QUFDeEI7QUFDQTtBQUNBLGlCQUFpQiw0REFBTztBQUN4QixpQ0FBaUMsOERBQU87QUFDeEMsb0NBQW9DLDhEQUFPO0FBQzNDO0FBQ0E7QUFDQSxpQkFBaUIsNERBQU87QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixxQkFBcUIsdURBQUssVUFBVTtBQUN0RDtBQUNBO0FBQ0EscUJBQXFCLDhEQUFRO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxJQUFJLDhFQUFxQixRQUFRLHVEQUFLLE9BQU87QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsSUFBSSw4RUFBcUIsUUFBUSx1REFBSyxPQUFPO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsSUFBSSw4RUFBcUIsUUFBUSx1REFBSyxPQUFPO0FBQ3RGO0FBQ0E7QUFDQSxjQUFjLHFCQUFxQix1REFBSyxVQUFVO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLFFBQVE7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0Y7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMEVBQWlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsUUFBUTtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbGFuZ3VhZ2VzQXNzb2NpYXRpb25zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9nbG9iLmpzJztcbmltcG9ydCB7IE1pbWVzIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbWltZS5qcyc7XG5pbXBvcnQgeyBTY2hlbWFzIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbmV0d29yay5qcyc7XG5pbXBvcnQgeyBiYXNlbmFtZSwgcG9zaXggfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9wYXRoLmpzJztcbmltcG9ydCB7IERhdGFVcmkgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9yZXNvdXJjZXMuanMnO1xuaW1wb3J0IHsgc3RhcnRzV2l0aFVURjhCT00gfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9zdHJpbmdzLmpzJztcbmltcG9ydCB7IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCB9IGZyb20gJy4uL2xhbmd1YWdlcy9tb2Rlc1JlZ2lzdHJ5LmpzJztcbmxldCByZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gW107XG5sZXQgbm9uVXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMgPSBbXTtcbmxldCB1c2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyA9IFtdO1xuLyoqXG4gKiBBc3NvY2lhdGUgYSBsYW5ndWFnZSB0byB0aGUgcmVnaXN0cnkgKHBsYXRmb3JtKS5cbiAqICogKipOT1RFKio6IFRoaXMgYXNzb2NpYXRpb24gd2lsbCBsb3NlIG92ZXIgYXNzb2NpYXRpb25zIHJlZ2lzdGVyZWQgdXNpbmcgYHJlZ2lzdGVyQ29uZmlndXJlZExhbmd1YWdlQXNzb2NpYXRpb25gLlxuICogKiAqKk5PVEUqKjogVXNlIGBjbGVhclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbnNgIHRvIHJlbW92ZSBhbGwgYXNzb2NpYXRpb25zIHJlZ2lzdGVyZWQgdXNpbmcgdGhpcyBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKGFzc29jaWF0aW9uLCB3YXJuT25PdmVyd3JpdGUgPSBmYWxzZSkge1xuICAgIF9yZWdpc3Rlckxhbmd1YWdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb24sIGZhbHNlLCB3YXJuT25PdmVyd3JpdGUpO1xufVxuZnVuY3Rpb24gX3JlZ2lzdGVyTGFuZ3VhZ2VBc3NvY2lhdGlvbihhc3NvY2lhdGlvbiwgdXNlckNvbmZpZ3VyZWQsIHdhcm5Pbk92ZXJ3cml0ZSkge1xuICAgIC8vIFJlZ2lzdGVyXG4gICAgY29uc3QgYXNzb2NpYXRpb25JdGVtID0gdG9MYW5ndWFnZUFzc29jaWF0aW9uSXRlbShhc3NvY2lhdGlvbiwgdXNlckNvbmZpZ3VyZWQpO1xuICAgIHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbkl0ZW0pO1xuICAgIGlmICghYXNzb2NpYXRpb25JdGVtLnVzZXJDb25maWd1cmVkKSB7XG4gICAgICAgIG5vblVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zLnB1c2goYXNzb2NpYXRpb25JdGVtKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zLnB1c2goYXNzb2NpYXRpb25JdGVtKTtcbiAgICB9XG4gICAgLy8gQ2hlY2sgZm9yIGNvbmZsaWN0cyB1bmxlc3MgdGhpcyBpcyBhIHVzZXIgY29uZmlndXJlZCBhc3NvY2lhdGlvblxuICAgIGlmICh3YXJuT25PdmVyd3JpdGUgJiYgIWFzc29jaWF0aW9uSXRlbS51c2VyQ29uZmlndXJlZCkge1xuICAgICAgICByZWdpc3RlcmVkQXNzb2NpYXRpb25zLmZvckVhY2goYSA9PiB7XG4gICAgICAgICAgICBpZiAoYS5taW1lID09PSBhc3NvY2lhdGlvbkl0ZW0ubWltZSB8fCBhLnVzZXJDb25maWd1cmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBzYW1lIG1pbWUgb3IgdXNlckNvbmZpZ3VyZWQgaXMgb2tcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbkl0ZW0uZXh0ZW5zaW9uICYmIGEuZXh0ZW5zaW9uID09PSBhc3NvY2lhdGlvbkl0ZW0uZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBPdmVyd3JpdGluZyBleHRlbnNpb24gPDwke2Fzc29jaWF0aW9uSXRlbS5leHRlbnNpb259Pj4gdG8gbm93IHBvaW50IHRvIG1pbWUgPDwke2Fzc29jaWF0aW9uSXRlbS5taW1lfT4+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXNzb2NpYXRpb25JdGVtLmZpbGVuYW1lICYmIGEuZmlsZW5hbWUgPT09IGFzc29jaWF0aW9uSXRlbS5maWxlbmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgT3ZlcndyaXRpbmcgZmlsZW5hbWUgPDwke2Fzc29jaWF0aW9uSXRlbS5maWxlbmFtZX0+PiB0byBub3cgcG9pbnQgdG8gbWltZSA8PCR7YXNzb2NpYXRpb25JdGVtLm1pbWV9Pj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbkl0ZW0uZmlsZXBhdHRlcm4gJiYgYS5maWxlcGF0dGVybiA9PT0gYXNzb2NpYXRpb25JdGVtLmZpbGVwYXR0ZXJuKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBPdmVyd3JpdGluZyBmaWxlcGF0dGVybiA8PCR7YXNzb2NpYXRpb25JdGVtLmZpbGVwYXR0ZXJufT4+IHRvIG5vdyBwb2ludCB0byBtaW1lIDw8JHthc3NvY2lhdGlvbkl0ZW0ubWltZX0+PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uSXRlbS5maXJzdGxpbmUgJiYgYS5maXJzdGxpbmUgPT09IGFzc29jaWF0aW9uSXRlbS5maXJzdGxpbmUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE92ZXJ3cml0aW5nIGZpcnN0bGluZSA8PCR7YXNzb2NpYXRpb25JdGVtLmZpcnN0bGluZX0+PiB0byBub3cgcG9pbnQgdG8gbWltZSA8PCR7YXNzb2NpYXRpb25JdGVtLm1pbWV9Pj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gdG9MYW5ndWFnZUFzc29jaWF0aW9uSXRlbShhc3NvY2lhdGlvbiwgdXNlckNvbmZpZ3VyZWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpZDogYXNzb2NpYXRpb24uaWQsXG4gICAgICAgIG1pbWU6IGFzc29jaWF0aW9uLm1pbWUsXG4gICAgICAgIGZpbGVuYW1lOiBhc3NvY2lhdGlvbi5maWxlbmFtZSxcbiAgICAgICAgZXh0ZW5zaW9uOiBhc3NvY2lhdGlvbi5leHRlbnNpb24sXG4gICAgICAgIGZpbGVwYXR0ZXJuOiBhc3NvY2lhdGlvbi5maWxlcGF0dGVybixcbiAgICAgICAgZmlyc3RsaW5lOiBhc3NvY2lhdGlvbi5maXJzdGxpbmUsXG4gICAgICAgIHVzZXJDb25maWd1cmVkOiB1c2VyQ29uZmlndXJlZCxcbiAgICAgICAgZmlsZW5hbWVMb3dlcmNhc2U6IGFzc29jaWF0aW9uLmZpbGVuYW1lID8gYXNzb2NpYXRpb24uZmlsZW5hbWUudG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZXh0ZW5zaW9uTG93ZXJjYXNlOiBhc3NvY2lhdGlvbi5leHRlbnNpb24gPyBhc3NvY2lhdGlvbi5leHRlbnNpb24udG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZmlsZXBhdHRlcm5Mb3dlcmNhc2U6IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuID8gcGFyc2UoYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4udG9Mb3dlckNhc2UoKSkgOiB1bmRlZmluZWQsXG4gICAgICAgIGZpbGVwYXR0ZXJuT25QYXRoOiBhc3NvY2lhdGlvbi5maWxlcGF0dGVybiA/IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuLmluZGV4T2YocG9zaXguc2VwKSA+PSAwIDogZmFsc2VcbiAgICB9O1xufVxuLyoqXG4gKiBDbGVhciBsYW5ndWFnZSBhc3NvY2lhdGlvbnMgZnJvbSB0aGUgcmVnaXN0cnkgKHBsYXRmb3JtKS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9ucygpIHtcbiAgICByZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gcmVnaXN0ZXJlZEFzc29jaWF0aW9ucy5maWx0ZXIoYSA9PiBhLnVzZXJDb25maWd1cmVkKTtcbiAgICBub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyA9IFtdO1xufVxuLyoqXG4gKiBAc2VlIGBnZXRNaW1lVHlwZXNgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRMYW5ndWFnZUlkcyhyZXNvdXJjZSwgZmlyc3RMaW5lKSB7XG4gICAgcmV0dXJuIGdldEFzc29jaWF0aW9ucyhyZXNvdXJjZSwgZmlyc3RMaW5lKS5tYXAoaXRlbSA9PiBpdGVtLmlkKTtcbn1cbmZ1bmN0aW9uIGdldEFzc29jaWF0aW9ucyhyZXNvdXJjZSwgZmlyc3RMaW5lKSB7XG4gICAgbGV0IHBhdGg7XG4gICAgaWYgKHJlc291cmNlKSB7XG4gICAgICAgIHN3aXRjaCAocmVzb3VyY2Uuc2NoZW1lKSB7XG4gICAgICAgICAgICBjYXNlIFNjaGVtYXMuZmlsZTpcbiAgICAgICAgICAgICAgICBwYXRoID0gcmVzb3VyY2UuZnNQYXRoO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBTY2hlbWFzLmRhdGE6IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXRhZGF0YSA9IERhdGFVcmkucGFyc2VNZXRhRGF0YShyZXNvdXJjZSk7XG4gICAgICAgICAgICAgICAgcGF0aCA9IG1ldGFkYXRhLmdldChEYXRhVXJpLk1FVEFfREFUQV9MQUJFTCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFNjaGVtYXMudnNjb2RlTm90ZWJvb2tDZWxsOlxuICAgICAgICAgICAgICAgIC8vIEZpbGUgcGF0aCBub3QgcmVsZXZhbnQgZm9yIGxhbmd1YWdlIGRldGVjdGlvbiBvZiBjZWxsXG4gICAgICAgICAgICAgICAgcGF0aCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcGF0aCA9IHJlc291cmNlLnBhdGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICAgIHJldHVybiBbeyBpZDogJ3Vua25vd24nLCBtaW1lOiBNaW1lcy51bmtub3duIH1dO1xuICAgIH1cbiAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGZpbGVuYW1lID0gYmFzZW5hbWUocGF0aCk7XG4gICAgLy8gMS4pIFVzZXIgY29uZmlndXJlZCBtYXBwaW5ncyBoYXZlIGhpZ2hlc3QgcHJpb3JpdHlcbiAgICBjb25zdCBjb25maWd1cmVkTGFuZ3VhZ2UgPSBnZXRBc3NvY2lhdGlvbkJ5UGF0aChwYXRoLCBmaWxlbmFtZSwgdXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMpO1xuICAgIGlmIChjb25maWd1cmVkTGFuZ3VhZ2UpIHtcbiAgICAgICAgcmV0dXJuIFtjb25maWd1cmVkTGFuZ3VhZ2UsIHsgaWQ6IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCwgbWltZTogTWltZXMudGV4dCB9XTtcbiAgICB9XG4gICAgLy8gMi4pIFJlZ2lzdGVyZWQgbWFwcGluZ3MgaGF2ZSBtaWRkbGUgcHJpb3JpdHlcbiAgICBjb25zdCByZWdpc3RlcmVkTGFuZ3VhZ2UgPSBnZXRBc3NvY2lhdGlvbkJ5UGF0aChwYXRoLCBmaWxlbmFtZSwgbm9uVXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMpO1xuICAgIGlmIChyZWdpc3RlcmVkTGFuZ3VhZ2UpIHtcbiAgICAgICAgcmV0dXJuIFtyZWdpc3RlcmVkTGFuZ3VhZ2UsIHsgaWQ6IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCwgbWltZTogTWltZXMudGV4dCB9XTtcbiAgICB9XG4gICAgLy8gMy4pIEZpcnN0bGluZSBoYXMgbG93ZXN0IHByaW9yaXR5XG4gICAgaWYgKGZpcnN0TGluZSkge1xuICAgICAgICBjb25zdCBmaXJzdGxpbmVMYW5ndWFnZSA9IGdldEFzc29jaWF0aW9uQnlGaXJzdGxpbmUoZmlyc3RMaW5lKTtcbiAgICAgICAgaWYgKGZpcnN0bGluZUxhbmd1YWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gW2ZpcnN0bGluZUxhbmd1YWdlLCB7IGlkOiBQTEFJTlRFWFRfTEFOR1VBR0VfSUQsIG1pbWU6IE1pbWVzLnRleHQgfV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFt7IGlkOiAndW5rbm93bicsIG1pbWU6IE1pbWVzLnVua25vd24gfV07XG59XG5mdW5jdGlvbiBnZXRBc3NvY2lhdGlvbkJ5UGF0aChwYXRoLCBmaWxlbmFtZSwgYXNzb2NpYXRpb25zKSB7XG4gICAgbGV0IGZpbGVuYW1lTWF0Y2ggPSB1bmRlZmluZWQ7XG4gICAgbGV0IHBhdHRlcm5NYXRjaCA9IHVuZGVmaW5lZDtcbiAgICBsZXQgZXh0ZW5zaW9uTWF0Y2ggPSB1bmRlZmluZWQ7XG4gICAgLy8gV2Ugd2FudCB0byBwcmlvcml0aXplIGFzc29jaWF0aW9ucyBiYXNlZCBvbiB0aGUgb3JkZXIgdGhleSBhcmUgcmVnaXN0ZXJlZCBzbyB0aGF0IHRoZSBsYXN0IHJlZ2lzdGVyZWRcbiAgICAvLyBhc3NvY2lhdGlvbiB3aW5zIG92ZXIgYWxsIG90aGVyLiBUaGlzIGlzIGZvciBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvMjAwNzRcbiAgICBmb3IgKGxldCBpID0gYXNzb2NpYXRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IGFzc29jaWF0aW9uID0gYXNzb2NpYXRpb25zW2ldO1xuICAgICAgICAvLyBGaXJzdCBleGFjdCBuYW1lIG1hdGNoXG4gICAgICAgIGlmIChmaWxlbmFtZSA9PT0gYXNzb2NpYXRpb24uZmlsZW5hbWVMb3dlcmNhc2UpIHtcbiAgICAgICAgICAgIGZpbGVuYW1lTWF0Y2ggPSBhc3NvY2lhdGlvbjtcbiAgICAgICAgICAgIGJyZWFrOyAvLyB0YWtlIGl0IVxuICAgICAgICB9XG4gICAgICAgIC8vIExvbmdlc3QgcGF0dGVybiBtYXRjaFxuICAgICAgICBpZiAoYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4pIHtcbiAgICAgICAgICAgIGlmICghcGF0dGVybk1hdGNoIHx8IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuLmxlbmd0aCA+IHBhdHRlcm5NYXRjaC5maWxlcGF0dGVybi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBhc3NvY2lhdGlvbi5maWxlcGF0dGVybk9uUGF0aCA/IHBhdGggOiBmaWxlbmFtZTsgLy8gbWF0Y2ggb24gZnVsbCBwYXRoIGlmIHBhdHRlcm4gY29udGFpbnMgcGF0aCBzZXBhcmF0b3JcbiAgICAgICAgICAgICAgICBpZiAoYXNzb2NpYXRpb24uZmlsZXBhdHRlcm5Mb3dlcmNhc2U/Lih0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdHRlcm5NYXRjaCA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBMb25nZXN0IGV4dGVuc2lvbiBtYXRjaFxuICAgICAgICBpZiAoYXNzb2NpYXRpb24uZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICBpZiAoIWV4dGVuc2lvbk1hdGNoIHx8IGFzc29jaWF0aW9uLmV4dGVuc2lvbi5sZW5ndGggPiBleHRlbnNpb25NYXRjaC5leHRlbnNpb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKGFzc29jaWF0aW9uLmV4dGVuc2lvbkxvd2VyY2FzZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uTWF0Y2ggPSBhc3NvY2lhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gMS4pIEV4YWN0IG5hbWUgbWF0Y2ggaGFzIHNlY29uZCBoaWdoZXN0IHByaW9yaXR5XG4gICAgaWYgKGZpbGVuYW1lTWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGZpbGVuYW1lTWF0Y2g7XG4gICAgfVxuICAgIC8vIDIuKSBNYXRjaCBvbiBwYXR0ZXJuXG4gICAgaWYgKHBhdHRlcm5NYXRjaCkge1xuICAgICAgICByZXR1cm4gcGF0dGVybk1hdGNoO1xuICAgIH1cbiAgICAvLyAzLikgTWF0Y2ggb24gZXh0ZW5zaW9uIGNvbWVzIG5leHRcbiAgICBpZiAoZXh0ZW5zaW9uTWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGV4dGVuc2lvbk1hdGNoO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gZ2V0QXNzb2NpYXRpb25CeUZpcnN0bGluZShmaXJzdExpbmUpIHtcbiAgICBpZiAoc3RhcnRzV2l0aFVURjhCT00oZmlyc3RMaW5lKSkge1xuICAgICAgICBmaXJzdExpbmUgPSBmaXJzdExpbmUuc3Vic3RyKDEpO1xuICAgIH1cbiAgICBpZiAoZmlyc3RMaW5lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gV2Ugd2FudCB0byBwcmlvcml0aXplIGFzc29jaWF0aW9ucyBiYXNlZCBvbiB0aGUgb3JkZXIgdGhleSBhcmUgcmVnaXN0ZXJlZCBzbyB0aGF0IHRoZSBsYXN0IHJlZ2lzdGVyZWRcbiAgICAgICAgLy8gYXNzb2NpYXRpb24gd2lucyBvdmVyIGFsbCBvdGhlci4gVGhpcyBpcyBmb3IgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzIwMDc0XG4gICAgICAgIGZvciAobGV0IGkgPSByZWdpc3RlcmVkQXNzb2NpYXRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBhc3NvY2lhdGlvbiA9IHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnNbaV07XG4gICAgICAgICAgICBpZiAoIWFzc29jaWF0aW9uLmZpcnN0bGluZSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IGZpcnN0TGluZS5tYXRjaChhc3NvY2lhdGlvbi5maXJzdGxpbmUpO1xuICAgICAgICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=