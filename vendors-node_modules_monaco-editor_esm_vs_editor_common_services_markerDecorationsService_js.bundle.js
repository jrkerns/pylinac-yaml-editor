"use strict";
(self["webpackChunkpylinac_yaml_editor"] = self["webpackChunkpylinac_yaml_editor"] || []).push([["vendors-node_modules_monaco-editor_esm_vs_editor_common_services_markerDecorationsService_js"],{

/***/ "./node_modules/monaco-editor/esm/vs/base/common/collections.js":
/*!**********************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/collections.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   diffSets: () => (/* binding */ diffSets),
/* harmony export */   intersection: () => (/* binding */ intersection)
/* harmony export */ });
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
function diffSets(before, after) {
    const removed = [];
    const added = [];
    for (const element of before) {
        if (!after.has(element)) {
            removed.push(element);
        }
    }
    for (const element of after) {
        if (!before.has(element)) {
            added.push(element);
        }
    }
    return { removed, added };
}
/**
 * Computes the intersection of two sets.
 *
 * @param setA - The first set.
 * @param setB - The second iterable.
 * @returns A new set containing the elements that are in both `setA` and `setB`.
 */
function intersection(setA, setB) {
    const result = new Set();
    for (const elem of setB) {
        if (setA.has(elem)) {
            result.add(elem);
        }
    }
    return result;
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/base/common/severity.js":
/*!*******************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/base/common/severity.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _strings_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./strings.js */ "./node_modules/monaco-editor/esm/vs/base/common/strings.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

var Severity;
(function (Severity) {
    Severity[Severity["Ignore"] = 0] = "Ignore";
    Severity[Severity["Info"] = 1] = "Info";
    Severity[Severity["Warning"] = 2] = "Warning";
    Severity[Severity["Error"] = 3] = "Error";
})(Severity || (Severity = {}));
(function (Severity) {
    const _error = 'error';
    const _warning = 'warning';
    const _warn = 'warn';
    const _info = 'info';
    const _ignore = 'ignore';
    /**
     * Parses 'error', 'warning', 'warn', 'info' in call casings
     * and falls back to ignore.
     */
    function fromValue(value) {
        if (!value) {
            return Severity.Ignore;
        }
        if (_strings_js__WEBPACK_IMPORTED_MODULE_0__.equalsIgnoreCase(_error, value)) {
            return Severity.Error;
        }
        if (_strings_js__WEBPACK_IMPORTED_MODULE_0__.equalsIgnoreCase(_warning, value) || _strings_js__WEBPACK_IMPORTED_MODULE_0__.equalsIgnoreCase(_warn, value)) {
            return Severity.Warning;
        }
        if (_strings_js__WEBPACK_IMPORTED_MODULE_0__.equalsIgnoreCase(_info, value)) {
            return Severity.Info;
        }
        return Severity.Ignore;
    }
    Severity.fromValue = fromValue;
    function toString(severity) {
        switch (severity) {
            case Severity.Error: return _error;
            case Severity.Warning: return _warning;
            case Severity.Info: return _info;
            default: return _ignore;
        }
    }
    Severity.toString = toString;
})(Severity || (Severity = {}));
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Severity);


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MarkerDecorationsService: () => (/* binding */ MarkerDecorationsService)
/* harmony export */ });
/* harmony import */ var _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../platform/markers/common/markers.js */ "./node_modules/monaco-editor/esm/vs/platform/markers/common/markers.js");
/* harmony import */ var _base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/common/lifecycle.js */ "./node_modules/monaco-editor/esm/vs/base/common/lifecycle.js");
/* harmony import */ var _model_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../model.js */ "./node_modules/monaco-editor/esm/vs/editor/common/model.js");
/* harmony import */ var _platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../platform/theme/common/themeService.js */ "./node_modules/monaco-editor/esm/vs/platform/theme/common/themeService.js");
/* harmony import */ var _core_editorColorRegistry_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../core/editorColorRegistry.js */ "./node_modules/monaco-editor/esm/vs/editor/common/core/editorColorRegistry.js");
/* harmony import */ var _model_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./model.js */ "./node_modules/monaco-editor/esm/vs/editor/common/services/model.js");
/* harmony import */ var _core_range_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../core/range.js */ "./node_modules/monaco-editor/esm/vs/editor/common/core/range.js");
/* harmony import */ var _base_common_network_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../base/common/network.js */ "./node_modules/monaco-editor/esm/vs/base/common/network.js");
/* harmony import */ var _base_common_event_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../base/common/event.js */ "./node_modules/monaco-editor/esm/vs/base/common/event.js");
/* harmony import */ var _platform_theme_common_colorRegistry_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../platform/theme/common/colorRegistry.js */ "./node_modules/monaco-editor/esm/vs/platform/theme/common/colorRegistry.js");
/* harmony import */ var _base_common_map_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../base/common/map.js */ "./node_modules/monaco-editor/esm/vs/base/common/map.js");
/* harmony import */ var _base_common_collections_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../base/common/collections.js */ "./node_modules/monaco-editor/esm/vs/base/common/collections.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __param = (undefined && undefined.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};












let MarkerDecorationsService = class MarkerDecorationsService extends _base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__.Disposable {
    constructor(modelService, _markerService) {
        super();
        this._markerService = _markerService;
        this._onDidChangeMarker = this._register(new _base_common_event_js__WEBPACK_IMPORTED_MODULE_8__.Emitter());
        this._markerDecorations = new _base_common_map_js__WEBPACK_IMPORTED_MODULE_10__.ResourceMap();
        modelService.getModels().forEach(model => this._onModelAdded(model));
        this._register(modelService.onModelAdded(this._onModelAdded, this));
        this._register(modelService.onModelRemoved(this._onModelRemoved, this));
        this._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));
    }
    dispose() {
        super.dispose();
        this._markerDecorations.forEach(value => value.dispose());
        this._markerDecorations.clear();
    }
    getMarker(uri, decoration) {
        const markerDecorations = this._markerDecorations.get(uri);
        return markerDecorations ? (markerDecorations.getMarker(decoration) || null) : null;
    }
    _handleMarkerChange(changedResources) {
        changedResources.forEach((resource) => {
            const markerDecorations = this._markerDecorations.get(resource);
            if (markerDecorations) {
                this._updateDecorations(markerDecorations);
            }
        });
    }
    _onModelAdded(model) {
        const markerDecorations = new MarkerDecorations(model);
        this._markerDecorations.set(model.uri, markerDecorations);
        this._updateDecorations(markerDecorations);
    }
    _onModelRemoved(model) {
        const markerDecorations = this._markerDecorations.get(model.uri);
        if (markerDecorations) {
            markerDecorations.dispose();
            this._markerDecorations.delete(model.uri);
        }
        // clean up markers for internal, transient models
        if (model.uri.scheme === _base_common_network_js__WEBPACK_IMPORTED_MODULE_7__.Schemas.inMemory
            || model.uri.scheme === _base_common_network_js__WEBPACK_IMPORTED_MODULE_7__.Schemas.internal
            || model.uri.scheme === _base_common_network_js__WEBPACK_IMPORTED_MODULE_7__.Schemas.vscode) {
            this._markerService?.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));
        }
    }
    _updateDecorations(markerDecorations) {
        // Limit to the first 500 errors/warnings
        const markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });
        if (markerDecorations.update(markers)) {
            this._onDidChangeMarker.fire(markerDecorations.model);
        }
    }
};
MarkerDecorationsService = __decorate([
    __param(0, _model_js__WEBPACK_IMPORTED_MODULE_5__.IModelService),
    __param(1, _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.IMarkerService)
], MarkerDecorationsService);

class MarkerDecorations extends _base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__.Disposable {
    constructor(model) {
        super();
        this.model = model;
        this._map = new _base_common_map_js__WEBPACK_IMPORTED_MODULE_10__.BidirectionalMap();
        this._register((0,_base_common_lifecycle_js__WEBPACK_IMPORTED_MODULE_1__.toDisposable)(() => {
            this.model.deltaDecorations([...this._map.values()], []);
            this._map.clear();
        }));
    }
    update(markers) {
        // We use the fact that marker instances are not recreated when different owners
        // update. So we can compare references to find out what changed since the last update.
        const { added, removed } = (0,_base_common_collections_js__WEBPACK_IMPORTED_MODULE_11__.diffSets)(new Set(this._map.keys()), new Set(markers));
        if (added.length === 0 && removed.length === 0) {
            return false;
        }
        const oldIds = removed.map(marker => this._map.get(marker));
        const newDecorations = added.map(marker => {
            return {
                range: this._createDecorationRange(this.model, marker),
                options: this._createDecorationOption(marker)
            };
        });
        const ids = this.model.deltaDecorations(oldIds, newDecorations);
        for (const removedMarker of removed) {
            this._map.delete(removedMarker);
        }
        for (let index = 0; index < ids.length; index++) {
            this._map.set(added[index], ids[index]);
        }
        return true;
    }
    getMarker(decoration) {
        return this._map.getKey(decoration.id);
    }
    _createDecorationRange(model, rawMarker) {
        let ret = _core_range_js__WEBPACK_IMPORTED_MODULE_6__.Range.lift(rawMarker);
        if (rawMarker.severity === _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, 1 /* MarkerTag.Unnecessary */) && !this._hasMarkerTag(rawMarker, 2 /* MarkerTag.Deprecated */)) {
            // * never render hints on multiple lines
            // * make enough space for three dots
            ret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);
        }
        ret = model.validateRange(ret);
        if (ret.isEmpty()) {
            const maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||
                model.getLineMaxColumn(ret.startLineNumber);
            if (maxColumn === 1 || ret.endColumn >= maxColumn) {
                // empty line or behind eol
                // keep the range as is, it will be rendered 1ch wide
                return ret;
            }
            const word = model.getWordAtPosition(ret.getStartPosition());
            if (word) {
                ret = new _core_range_js__WEBPACK_IMPORTED_MODULE_6__.Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);
            }
        }
        else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {
            const minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);
            if (minColumn < ret.endColumn) {
                ret = new _core_range_js__WEBPACK_IMPORTED_MODULE_6__.Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);
                rawMarker.startColumn = minColumn;
            }
        }
        return ret;
    }
    _createDecorationOption(marker) {
        let className;
        let color = undefined;
        let zIndex;
        let inlineClassName = undefined;
        let minimap;
        switch (marker.severity) {
            case _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.MarkerSeverity.Hint:
                if (this._hasMarkerTag(marker, 2 /* MarkerTag.Deprecated */)) {
                    className = undefined;
                }
                else if (this._hasMarkerTag(marker, 1 /* MarkerTag.Unnecessary */)) {
                    className = "squiggly-unnecessary" /* ClassName.EditorUnnecessaryDecoration */;
                }
                else {
                    className = "squiggly-hint" /* ClassName.EditorHintDecoration */;
                }
                zIndex = 0;
                break;
            case _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.MarkerSeverity.Info:
                className = "squiggly-info" /* ClassName.EditorInfoDecoration */;
                color = (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_core_editorColorRegistry_js__WEBPACK_IMPORTED_MODULE_4__.overviewRulerInfo);
                zIndex = 10;
                minimap = {
                    color: (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_platform_theme_common_colorRegistry_js__WEBPACK_IMPORTED_MODULE_9__.minimapInfo),
                    position: 1 /* MinimapPosition.Inline */
                };
                break;
            case _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.MarkerSeverity.Warning:
                className = "squiggly-warning" /* ClassName.EditorWarningDecoration */;
                color = (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_core_editorColorRegistry_js__WEBPACK_IMPORTED_MODULE_4__.overviewRulerWarning);
                zIndex = 20;
                minimap = {
                    color: (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_platform_theme_common_colorRegistry_js__WEBPACK_IMPORTED_MODULE_9__.minimapWarning),
                    position: 1 /* MinimapPosition.Inline */
                };
                break;
            case _platform_markers_common_markers_js__WEBPACK_IMPORTED_MODULE_0__.MarkerSeverity.Error:
            default:
                className = "squiggly-error" /* ClassName.EditorErrorDecoration */;
                color = (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_core_editorColorRegistry_js__WEBPACK_IMPORTED_MODULE_4__.overviewRulerError);
                zIndex = 30;
                minimap = {
                    color: (0,_platform_theme_common_themeService_js__WEBPACK_IMPORTED_MODULE_3__.themeColorFromId)(_platform_theme_common_colorRegistry_js__WEBPACK_IMPORTED_MODULE_9__.minimapError),
                    position: 1 /* MinimapPosition.Inline */
                };
                break;
        }
        if (marker.tags) {
            if (marker.tags.indexOf(1 /* MarkerTag.Unnecessary */) !== -1) {
                inlineClassName = "squiggly-inline-unnecessary" /* ClassName.EditorUnnecessaryInlineDecoration */;
            }
            if (marker.tags.indexOf(2 /* MarkerTag.Deprecated */) !== -1) {
                inlineClassName = "squiggly-inline-deprecated" /* ClassName.EditorDeprecatedInlineDecoration */;
            }
        }
        return {
            description: 'marker-decoration',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */,
            className,
            showIfCollapsed: true,
            overviewRuler: {
                color,
                position: _model_js__WEBPACK_IMPORTED_MODULE_2__.OverviewRulerLane.Right
            },
            minimap,
            zIndex,
            inlineClassName,
        };
    }
    _hasMarkerTag(marker, tag) {
        if (marker.tags) {
            return marker.tags.indexOf(tag) >= 0;
        }
        return false;
    }
}


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/editor/common/services/model.js":
/*!***************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/editor/common/services/model.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IModelService: () => (/* binding */ IModelService)
/* harmony export */ });
/* harmony import */ var _platform_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../platform/instantiation/common/instantiation.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

const IModelService = (0,_platform_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_0__.createDecorator)('modelService');


/***/ }),

/***/ "./node_modules/monaco-editor/esm/vs/platform/markers/common/markers.js":
/*!******************************************************************************!*\
  !*** ./node_modules/monaco-editor/esm/vs/platform/markers/common/markers.js ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   IMarkerData: () => (/* binding */ IMarkerData),
/* harmony export */   IMarkerService: () => (/* binding */ IMarkerService),
/* harmony export */   MarkerSeverity: () => (/* binding */ MarkerSeverity)
/* harmony export */ });
/* harmony import */ var _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/common/severity.js */ "./node_modules/monaco-editor/esm/vs/base/common/severity.js");
/* harmony import */ var _nls_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../nls.js */ "./node_modules/monaco-editor/esm/vs/nls.js");
/* harmony import */ var _instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../instantiation/common/instantiation.js */ "./node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/



var MarkerSeverity;
(function (MarkerSeverity) {
    MarkerSeverity[MarkerSeverity["Hint"] = 1] = "Hint";
    MarkerSeverity[MarkerSeverity["Info"] = 2] = "Info";
    MarkerSeverity[MarkerSeverity["Warning"] = 4] = "Warning";
    MarkerSeverity[MarkerSeverity["Error"] = 8] = "Error";
})(MarkerSeverity || (MarkerSeverity = {}));
(function (MarkerSeverity) {
    function compare(a, b) {
        return b - a;
    }
    MarkerSeverity.compare = compare;
    const _displayStrings = Object.create(null);
    _displayStrings[MarkerSeverity.Error] = (0,_nls_js__WEBPACK_IMPORTED_MODULE_1__.localize)('sev.error', "Error");
    _displayStrings[MarkerSeverity.Warning] = (0,_nls_js__WEBPACK_IMPORTED_MODULE_1__.localize)('sev.warning', "Warning");
    _displayStrings[MarkerSeverity.Info] = (0,_nls_js__WEBPACK_IMPORTED_MODULE_1__.localize)('sev.info', "Info");
    function toString(a) {
        return _displayStrings[a] || '';
    }
    MarkerSeverity.toString = toString;
    function fromSeverity(severity) {
        switch (severity) {
            case _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Error: return MarkerSeverity.Error;
            case _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Warning: return MarkerSeverity.Warning;
            case _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Info: return MarkerSeverity.Info;
            case _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Ignore: return MarkerSeverity.Hint;
        }
    }
    MarkerSeverity.fromSeverity = fromSeverity;
    function toSeverity(severity) {
        switch (severity) {
            case MarkerSeverity.Error: return _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Error;
            case MarkerSeverity.Warning: return _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Warning;
            case MarkerSeverity.Info: return _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Info;
            case MarkerSeverity.Hint: return _base_common_severity_js__WEBPACK_IMPORTED_MODULE_0__["default"].Ignore;
        }
    }
    MarkerSeverity.toSeverity = toSeverity;
})(MarkerSeverity || (MarkerSeverity = {}));
var IMarkerData;
(function (IMarkerData) {
    const emptyString = '';
    function makeKey(markerData) {
        return makeKeyOptionalMessage(markerData, true);
    }
    IMarkerData.makeKey = makeKey;
    function makeKeyOptionalMessage(markerData, useMessage) {
        const result = [emptyString];
        if (markerData.source) {
            result.push(markerData.source.replace('¦', '\\¦'));
        }
        else {
            result.push(emptyString);
        }
        if (markerData.code) {
            if (typeof markerData.code === 'string') {
                result.push(markerData.code.replace('¦', '\\¦'));
            }
            else {
                result.push(markerData.code.value.replace('¦', '\\¦'));
            }
        }
        else {
            result.push(emptyString);
        }
        if (markerData.severity !== undefined && markerData.severity !== null) {
            result.push(MarkerSeverity.toString(markerData.severity));
        }
        else {
            result.push(emptyString);
        }
        // Modifed to not include the message as part of the marker key to work around
        // https://github.com/microsoft/vscode/issues/77475
        if (markerData.message && useMessage) {
            result.push(markerData.message.replace('¦', '\\¦'));
        }
        else {
            result.push(emptyString);
        }
        if (markerData.startLineNumber !== undefined && markerData.startLineNumber !== null) {
            result.push(markerData.startLineNumber.toString());
        }
        else {
            result.push(emptyString);
        }
        if (markerData.startColumn !== undefined && markerData.startColumn !== null) {
            result.push(markerData.startColumn.toString());
        }
        else {
            result.push(emptyString);
        }
        if (markerData.endLineNumber !== undefined && markerData.endLineNumber !== null) {
            result.push(markerData.endLineNumber.toString());
        }
        else {
            result.push(emptyString);
        }
        if (markerData.endColumn !== undefined && markerData.endColumn !== null) {
            result.push(markerData.endColumn.toString());
        }
        else {
            result.push(emptyString);
        }
        result.push(emptyString);
        return result.join('¦');
    }
    IMarkerData.makeKeyOptionalMessage = makeKeyOptionalMessage;
})(IMarkerData || (IMarkerData = {}));
const IMarkerService = (0,_instantiation_common_instantiation_js__WEBPACK_IMPORTED_MODULE_2__.createDecorator)('markerService');


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfbW9uYWNvLWVkaXRvcl9lc21fdnNfZWRpdG9yX2NvbW1vbl9zZXJ2aWNlc19tYXJrZXJEZWNvcmF0aW9uc1NlcnZpY2VfanMuYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ3dDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEJBQTRCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHlEQUF3QjtBQUNwQztBQUNBO0FBQ0EsWUFBWSx5REFBd0IscUJBQXFCLHlEQUF3QjtBQUNqRjtBQUNBO0FBQ0EsWUFBWSx5REFBd0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEJBQTRCO0FBQzdCLGlFQUFlLFFBQVEsRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDaER4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixTQUFJLElBQUksU0FBSTtBQUM5QjtBQUNBO0FBQ0EsNkNBQTZDLFFBQVE7QUFDckQ7QUFDQTtBQUNBLGVBQWUsU0FBSSxJQUFJLFNBQUk7QUFDM0Isb0NBQW9DO0FBQ3BDO0FBQzZGO0FBQ2hCO0FBQzdCO0FBQ2tDO0FBQzJCO0FBQ2xFO0FBQ0Y7QUFDaUI7QUFDRjtBQUNvRDtBQUNoQztBQUNiO0FBQy9ELHNFQUFzRSxpRUFBVTtBQUNoRjtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsMERBQU87QUFDNUQsc0NBQXNDLDZEQUFXO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsNERBQU87QUFDeEMsb0NBQW9DLDREQUFPO0FBQzNDLG9DQUFvQyw0REFBTztBQUMzQyx3Q0FBd0MscUJBQXFCO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGtEQUFrRDtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLG9EQUFhO0FBQzVCLGVBQWUsK0VBQWM7QUFDN0I7QUFDb0M7QUFDcEMsZ0NBQWdDLGlFQUFVO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixrRUFBZ0I7QUFDeEMsdUJBQXVCLHVFQUFZO0FBQ25DO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaUJBQWlCLEVBQUUsc0VBQVE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG9CQUFvQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlEQUFLO0FBQ3ZCLG1DQUFtQywrRUFBYztBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsaURBQUs7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpREFBSztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsK0VBQWM7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiwrRUFBYztBQUMvQjtBQUNBLHdCQUF3Qix3RkFBZ0IsQ0FBQywyRUFBaUI7QUFDMUQ7QUFDQTtBQUNBLDJCQUEyQix3RkFBZ0IsQ0FBQyxnRkFBVztBQUN2RDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsK0VBQWM7QUFDL0I7QUFDQSx3QkFBd0Isd0ZBQWdCLENBQUMsOEVBQW9CO0FBQzdEO0FBQ0E7QUFDQSwyQkFBMkIsd0ZBQWdCLENBQUMsbUZBQWM7QUFDMUQ7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLCtFQUFjO0FBQy9CO0FBQ0E7QUFDQSx3QkFBd0Isd0ZBQWdCLENBQUMsNEVBQWtCO0FBQzNEO0FBQ0E7QUFDQSwyQkFBMkIsd0ZBQWdCLENBQUMsaUZBQVk7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsd0RBQWlCO0FBQzNDLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUNsT0E7QUFDQTtBQUNBO0FBQ0E7QUFDMEY7QUFDbkYsc0JBQXNCLGdHQUFlOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0w1QztBQUNBO0FBQ0E7QUFDQTtBQUN3RDtBQUNiO0FBQ21DO0FBQ3ZFO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0NBQXdDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxpREFBUTtBQUNwRCw4Q0FBOEMsaURBQVE7QUFDdEQsMkNBQTJDLGlEQUFRO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixnRUFBUTtBQUN6QixpQkFBaUIsZ0VBQVE7QUFDekIsaUJBQWlCLGdFQUFRO0FBQ3pCLGlCQUFpQixnRUFBUTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGdFQUFRO0FBQ3RELGdEQUFnRCxnRUFBUTtBQUN4RCw2Q0FBNkMsZ0VBQVE7QUFDckQsNkNBQTZDLGdFQUFRO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0NBQXdDO0FBQ2xDO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGtDQUFrQztBQUM1Qix1QkFBdUIsdUZBQWUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2Jhc2UvY29tbW9uL2NvbGxlY3Rpb25zLmpzIiwid2VicGFjazovL3B5bGluYWMteWFtbC1lZGl0b3IvLi9ub2RlX21vZHVsZXMvbW9uYWNvLWVkaXRvci9lc20vdnMvYmFzZS9jb21tb24vc2V2ZXJpdHkuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9lZGl0b3IvY29tbW9uL3NlcnZpY2VzL21hcmtlckRlY29yYXRpb25zU2VydmljZS5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbW9kZWwuanMiLCJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9wbGF0Zm9ybS9tYXJrZXJzL2NvbW1vbi9tYXJrZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuZXhwb3J0IGZ1bmN0aW9uIGRpZmZTZXRzKGJlZm9yZSwgYWZ0ZXIpIHtcbiAgICBjb25zdCByZW1vdmVkID0gW107XG4gICAgY29uc3QgYWRkZWQgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYmVmb3JlKSB7XG4gICAgICAgIGlmICghYWZ0ZXIuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZW1vdmVkLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGFmdGVyKSB7XG4gICAgICAgIGlmICghYmVmb3JlLmhhcyhlbGVtZW50KSkge1xuICAgICAgICAgICAgYWRkZWQucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geyByZW1vdmVkLCBhZGRlZCB9O1xufVxuLyoqXG4gKiBDb21wdXRlcyB0aGUgaW50ZXJzZWN0aW9uIG9mIHR3byBzZXRzLlxuICpcbiAqIEBwYXJhbSBzZXRBIC0gVGhlIGZpcnN0IHNldC5cbiAqIEBwYXJhbSBzZXRCIC0gVGhlIHNlY29uZCBpdGVyYWJsZS5cbiAqIEByZXR1cm5zIEEgbmV3IHNldCBjb250YWluaW5nIHRoZSBlbGVtZW50cyB0aGF0IGFyZSBpbiBib3RoIGBzZXRBYCBhbmQgYHNldEJgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW50ZXJzZWN0aW9uKHNldEEsIHNldEIpIHtcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgU2V0KCk7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIHNldEIpIHtcbiAgICAgICAgaWYgKHNldEEuaGFzKGVsZW0pKSB7XG4gICAgICAgICAgICByZXN1bHQuYWRkKGVsZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4iLCIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cbmltcG9ydCAqIGFzIHN0cmluZ3MgZnJvbSAnLi9zdHJpbmdzLmpzJztcbnZhciBTZXZlcml0eTtcbihmdW5jdGlvbiAoU2V2ZXJpdHkpIHtcbiAgICBTZXZlcml0eVtTZXZlcml0eVtcIklnbm9yZVwiXSA9IDBdID0gXCJJZ25vcmVcIjtcbiAgICBTZXZlcml0eVtTZXZlcml0eVtcIkluZm9cIl0gPSAxXSA9IFwiSW5mb1wiO1xuICAgIFNldmVyaXR5W1NldmVyaXR5W1wiV2FybmluZ1wiXSA9IDJdID0gXCJXYXJuaW5nXCI7XG4gICAgU2V2ZXJpdHlbU2V2ZXJpdHlbXCJFcnJvclwiXSA9IDNdID0gXCJFcnJvclwiO1xufSkoU2V2ZXJpdHkgfHwgKFNldmVyaXR5ID0ge30pKTtcbihmdW5jdGlvbiAoU2V2ZXJpdHkpIHtcbiAgICBjb25zdCBfZXJyb3IgPSAnZXJyb3InO1xuICAgIGNvbnN0IF93YXJuaW5nID0gJ3dhcm5pbmcnO1xuICAgIGNvbnN0IF93YXJuID0gJ3dhcm4nO1xuICAgIGNvbnN0IF9pbmZvID0gJ2luZm8nO1xuICAgIGNvbnN0IF9pZ25vcmUgPSAnaWdub3JlJztcbiAgICAvKipcbiAgICAgKiBQYXJzZXMgJ2Vycm9yJywgJ3dhcm5pbmcnLCAnd2FybicsICdpbmZvJyBpbiBjYWxsIGNhc2luZ3NcbiAgICAgKiBhbmQgZmFsbHMgYmFjayB0byBpZ25vcmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZnJvbVZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBTZXZlcml0eS5JZ25vcmU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmluZ3MuZXF1YWxzSWdub3JlQ2FzZShfZXJyb3IsIHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIFNldmVyaXR5LkVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJpbmdzLmVxdWFsc0lnbm9yZUNhc2UoX3dhcm5pbmcsIHZhbHVlKSB8fCBzdHJpbmdzLmVxdWFsc0lnbm9yZUNhc2UoX3dhcm4sIHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIFNldmVyaXR5Lldhcm5pbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmluZ3MuZXF1YWxzSWdub3JlQ2FzZShfaW5mbywgdmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gU2V2ZXJpdHkuSW5mbztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gU2V2ZXJpdHkuSWdub3JlO1xuICAgIH1cbiAgICBTZXZlcml0eS5mcm9tVmFsdWUgPSBmcm9tVmFsdWU7XG4gICAgZnVuY3Rpb24gdG9TdHJpbmcoc2V2ZXJpdHkpIHtcbiAgICAgICAgc3dpdGNoIChzZXZlcml0eSkge1xuICAgICAgICAgICAgY2FzZSBTZXZlcml0eS5FcnJvcjogcmV0dXJuIF9lcnJvcjtcbiAgICAgICAgICAgIGNhc2UgU2V2ZXJpdHkuV2FybmluZzogcmV0dXJuIF93YXJuaW5nO1xuICAgICAgICAgICAgY2FzZSBTZXZlcml0eS5JbmZvOiByZXR1cm4gX2luZm87XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gX2lnbm9yZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBTZXZlcml0eS50b1N0cmluZyA9IHRvU3RyaW5nO1xufSkoU2V2ZXJpdHkgfHwgKFNldmVyaXR5ID0ge30pKTtcbmV4cG9ydCBkZWZhdWx0IFNldmVyaXR5O1xuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxufTtcbmltcG9ydCB7IElNYXJrZXJTZXJ2aWNlLCBNYXJrZXJTZXZlcml0eSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL21hcmtlcnMvY29tbW9uL21hcmtlcnMuanMnO1xuaW1wb3J0IHsgRGlzcG9zYWJsZSwgdG9EaXNwb3NhYmxlIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbGlmZWN5Y2xlLmpzJztcbmltcG9ydCB7IE92ZXJ2aWV3UnVsZXJMYW5lIH0gZnJvbSAnLi4vbW9kZWwuanMnO1xuaW1wb3J0IHsgdGhlbWVDb2xvckZyb21JZCB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL3RoZW1lL2NvbW1vbi90aGVtZVNlcnZpY2UuanMnO1xuaW1wb3J0IHsgb3ZlcnZpZXdSdWxlcldhcm5pbmcsIG92ZXJ2aWV3UnVsZXJJbmZvLCBvdmVydmlld1J1bGVyRXJyb3IgfSBmcm9tICcuLi9jb3JlL2VkaXRvckNvbG9yUmVnaXN0cnkuanMnO1xuaW1wb3J0IHsgSU1vZGVsU2VydmljZSB9IGZyb20gJy4vbW9kZWwuanMnO1xuaW1wb3J0IHsgUmFuZ2UgfSBmcm9tICcuLi9jb3JlL3JhbmdlLmpzJztcbmltcG9ydCB7IFNjaGVtYXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9uZXR3b3JrLmpzJztcbmltcG9ydCB7IEVtaXR0ZXIgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9ldmVudC5qcyc7XG5pbXBvcnQgeyBtaW5pbWFwSW5mbywgbWluaW1hcFdhcm5pbmcsIG1pbmltYXBFcnJvciB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL3RoZW1lL2NvbW1vbi9jb2xvclJlZ2lzdHJ5LmpzJztcbmltcG9ydCB7IEJpZGlyZWN0aW9uYWxNYXAsIFJlc291cmNlTWFwIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vbWFwLmpzJztcbmltcG9ydCB7IGRpZmZTZXRzIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vY29sbGVjdGlvbnMuanMnO1xubGV0IE1hcmtlckRlY29yYXRpb25zU2VydmljZSA9IGNsYXNzIE1hcmtlckRlY29yYXRpb25zU2VydmljZSBleHRlbmRzIERpc3Bvc2FibGUge1xuICAgIGNvbnN0cnVjdG9yKG1vZGVsU2VydmljZSwgX21hcmtlclNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fbWFya2VyU2VydmljZSA9IF9tYXJrZXJTZXJ2aWNlO1xuICAgICAgICB0aGlzLl9vbkRpZENoYW5nZU1hcmtlciA9IHRoaXMuX3JlZ2lzdGVyKG5ldyBFbWl0dGVyKCkpO1xuICAgICAgICB0aGlzLl9tYXJrZXJEZWNvcmF0aW9ucyA9IG5ldyBSZXNvdXJjZU1hcCgpO1xuICAgICAgICBtb2RlbFNlcnZpY2UuZ2V0TW9kZWxzKCkuZm9yRWFjaChtb2RlbCA9PiB0aGlzLl9vbk1vZGVsQWRkZWQobW9kZWwpKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXIobW9kZWxTZXJ2aWNlLm9uTW9kZWxBZGRlZCh0aGlzLl9vbk1vZGVsQWRkZWQsIHRoaXMpKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXIobW9kZWxTZXJ2aWNlLm9uTW9kZWxSZW1vdmVkKHRoaXMuX29uTW9kZWxSZW1vdmVkLCB0aGlzKSk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyKHRoaXMuX21hcmtlclNlcnZpY2Uub25NYXJrZXJDaGFuZ2VkKHRoaXMuX2hhbmRsZU1hcmtlckNoYW5nZSwgdGhpcykpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMuX21hcmtlckRlY29yYXRpb25zLmZvckVhY2godmFsdWUgPT4gdmFsdWUuZGlzcG9zZSgpKTtcbiAgICAgICAgdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMuY2xlYXIoKTtcbiAgICB9XG4gICAgZ2V0TWFya2VyKHVyaSwgZGVjb3JhdGlvbikge1xuICAgICAgICBjb25zdCBtYXJrZXJEZWNvcmF0aW9ucyA9IHRoaXMuX21hcmtlckRlY29yYXRpb25zLmdldCh1cmkpO1xuICAgICAgICByZXR1cm4gbWFya2VyRGVjb3JhdGlvbnMgPyAobWFya2VyRGVjb3JhdGlvbnMuZ2V0TWFya2VyKGRlY29yYXRpb24pIHx8IG51bGwpIDogbnVsbDtcbiAgICB9XG4gICAgX2hhbmRsZU1hcmtlckNoYW5nZShjaGFuZ2VkUmVzb3VyY2VzKSB7XG4gICAgICAgIGNoYW5nZWRSZXNvdXJjZXMuZm9yRWFjaCgocmVzb3VyY2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtlckRlY29yYXRpb25zID0gdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMuZ2V0KHJlc291cmNlKTtcbiAgICAgICAgICAgIGlmIChtYXJrZXJEZWNvcmF0aW9ucykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZURlY29yYXRpb25zKG1hcmtlckRlY29yYXRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIF9vbk1vZGVsQWRkZWQobW9kZWwpIHtcbiAgICAgICAgY29uc3QgbWFya2VyRGVjb3JhdGlvbnMgPSBuZXcgTWFya2VyRGVjb3JhdGlvbnMobW9kZWwpO1xuICAgICAgICB0aGlzLl9tYXJrZXJEZWNvcmF0aW9ucy5zZXQobW9kZWwudXJpLCBtYXJrZXJEZWNvcmF0aW9ucyk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURlY29yYXRpb25zKG1hcmtlckRlY29yYXRpb25zKTtcbiAgICB9XG4gICAgX29uTW9kZWxSZW1vdmVkKG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlckRlY29yYXRpb25zID0gdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMuZ2V0KG1vZGVsLnVyaSk7XG4gICAgICAgIGlmIChtYXJrZXJEZWNvcmF0aW9ucykge1xuICAgICAgICAgICAgbWFya2VyRGVjb3JhdGlvbnMuZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5fbWFya2VyRGVjb3JhdGlvbnMuZGVsZXRlKG1vZGVsLnVyaSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY2xlYW4gdXAgbWFya2VycyBmb3IgaW50ZXJuYWwsIHRyYW5zaWVudCBtb2RlbHNcbiAgICAgICAgaWYgKG1vZGVsLnVyaS5zY2hlbWUgPT09IFNjaGVtYXMuaW5NZW1vcnlcbiAgICAgICAgICAgIHx8IG1vZGVsLnVyaS5zY2hlbWUgPT09IFNjaGVtYXMuaW50ZXJuYWxcbiAgICAgICAgICAgIHx8IG1vZGVsLnVyaS5zY2hlbWUgPT09IFNjaGVtYXMudnNjb2RlKSB7XG4gICAgICAgICAgICB0aGlzLl9tYXJrZXJTZXJ2aWNlPy5yZWFkKHsgcmVzb3VyY2U6IG1vZGVsLnVyaSB9KS5tYXAobWFya2VyID0+IG1hcmtlci5vd25lcikuZm9yRWFjaChvd25lciA9PiB0aGlzLl9tYXJrZXJTZXJ2aWNlLnJlbW92ZShvd25lciwgW21vZGVsLnVyaV0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfdXBkYXRlRGVjb3JhdGlvbnMobWFya2VyRGVjb3JhdGlvbnMpIHtcbiAgICAgICAgLy8gTGltaXQgdG8gdGhlIGZpcnN0IDUwMCBlcnJvcnMvd2FybmluZ3NcbiAgICAgICAgY29uc3QgbWFya2VycyA9IHRoaXMuX21hcmtlclNlcnZpY2UucmVhZCh7IHJlc291cmNlOiBtYXJrZXJEZWNvcmF0aW9ucy5tb2RlbC51cmksIHRha2U6IDUwMCB9KTtcbiAgICAgICAgaWYgKG1hcmtlckRlY29yYXRpb25zLnVwZGF0ZShtYXJrZXJzKSkge1xuICAgICAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2VNYXJrZXIuZmlyZShtYXJrZXJEZWNvcmF0aW9ucy5tb2RlbCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuTWFya2VyRGVjb3JhdGlvbnNTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgX19wYXJhbSgwLCBJTW9kZWxTZXJ2aWNlKSxcbiAgICBfX3BhcmFtKDEsIElNYXJrZXJTZXJ2aWNlKVxuXSwgTWFya2VyRGVjb3JhdGlvbnNTZXJ2aWNlKTtcbmV4cG9ydCB7IE1hcmtlckRlY29yYXRpb25zU2VydmljZSB9O1xuY2xhc3MgTWFya2VyRGVjb3JhdGlvbnMgZXh0ZW5kcyBEaXNwb3NhYmxlIHtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7XG4gICAgICAgIHRoaXMuX21hcCA9IG5ldyBCaWRpcmVjdGlvbmFsTWFwKCk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyKHRvRGlzcG9zYWJsZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLmRlbHRhRGVjb3JhdGlvbnMoWy4uLnRoaXMuX21hcC52YWx1ZXMoKV0sIFtdKTtcbiAgICAgICAgICAgIHRoaXMuX21hcC5jbGVhcigpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHVwZGF0ZShtYXJrZXJzKSB7XG4gICAgICAgIC8vIFdlIHVzZSB0aGUgZmFjdCB0aGF0IG1hcmtlciBpbnN0YW5jZXMgYXJlIG5vdCByZWNyZWF0ZWQgd2hlbiBkaWZmZXJlbnQgb3duZXJzXG4gICAgICAgIC8vIHVwZGF0ZS4gU28gd2UgY2FuIGNvbXBhcmUgcmVmZXJlbmNlcyB0byBmaW5kIG91dCB3aGF0IGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgdXBkYXRlLlxuICAgICAgICBjb25zdCB7IGFkZGVkLCByZW1vdmVkIH0gPSBkaWZmU2V0cyhuZXcgU2V0KHRoaXMuX21hcC5rZXlzKCkpLCBuZXcgU2V0KG1hcmtlcnMpKTtcbiAgICAgICAgaWYgKGFkZGVkLmxlbmd0aCA9PT0gMCAmJiByZW1vdmVkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9sZElkcyA9IHJlbW92ZWQubWFwKG1hcmtlciA9PiB0aGlzLl9tYXAuZ2V0KG1hcmtlcikpO1xuICAgICAgICBjb25zdCBuZXdEZWNvcmF0aW9ucyA9IGFkZGVkLm1hcChtYXJrZXIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByYW5nZTogdGhpcy5fY3JlYXRlRGVjb3JhdGlvblJhbmdlKHRoaXMubW9kZWwsIG1hcmtlciksXG4gICAgICAgICAgICAgICAgb3B0aW9uczogdGhpcy5fY3JlYXRlRGVjb3JhdGlvbk9wdGlvbihtYXJrZXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaWRzID0gdGhpcy5tb2RlbC5kZWx0YURlY29yYXRpb25zKG9sZElkcywgbmV3RGVjb3JhdGlvbnMpO1xuICAgICAgICBmb3IgKGNvbnN0IHJlbW92ZWRNYXJrZXIgb2YgcmVtb3ZlZCkge1xuICAgICAgICAgICAgdGhpcy5fbWFwLmRlbGV0ZShyZW1vdmVkTWFya2VyKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgaWRzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgdGhpcy5fbWFwLnNldChhZGRlZFtpbmRleF0sIGlkc1tpbmRleF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXRNYXJrZXIoZGVjb3JhdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWFwLmdldEtleShkZWNvcmF0aW9uLmlkKTtcbiAgICB9XG4gICAgX2NyZWF0ZURlY29yYXRpb25SYW5nZShtb2RlbCwgcmF3TWFya2VyKSB7XG4gICAgICAgIGxldCByZXQgPSBSYW5nZS5saWZ0KHJhd01hcmtlcik7XG4gICAgICAgIGlmIChyYXdNYXJrZXIuc2V2ZXJpdHkgPT09IE1hcmtlclNldmVyaXR5LkhpbnQgJiYgIXRoaXMuX2hhc01hcmtlclRhZyhyYXdNYXJrZXIsIDEgLyogTWFya2VyVGFnLlVubmVjZXNzYXJ5ICovKSAmJiAhdGhpcy5faGFzTWFya2VyVGFnKHJhd01hcmtlciwgMiAvKiBNYXJrZXJUYWcuRGVwcmVjYXRlZCAqLykpIHtcbiAgICAgICAgICAgIC8vICogbmV2ZXIgcmVuZGVyIGhpbnRzIG9uIG11bHRpcGxlIGxpbmVzXG4gICAgICAgICAgICAvLyAqIG1ha2UgZW5vdWdoIHNwYWNlIGZvciB0aHJlZSBkb3RzXG4gICAgICAgICAgICByZXQgPSByZXQuc2V0RW5kUG9zaXRpb24ocmV0LnN0YXJ0TGluZU51bWJlciwgcmV0LnN0YXJ0Q29sdW1uICsgMik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0ID0gbW9kZWwudmFsaWRhdGVSYW5nZShyZXQpO1xuICAgICAgICBpZiAocmV0LmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgY29uc3QgbWF4Q29sdW1uID0gbW9kZWwuZ2V0TGluZUxhc3ROb25XaGl0ZXNwYWNlQ29sdW1uKHJldC5zdGFydExpbmVOdW1iZXIpIHx8XG4gICAgICAgICAgICAgICAgbW9kZWwuZ2V0TGluZU1heENvbHVtbihyZXQuc3RhcnRMaW5lTnVtYmVyKTtcbiAgICAgICAgICAgIGlmIChtYXhDb2x1bW4gPT09IDEgfHwgcmV0LmVuZENvbHVtbiA+PSBtYXhDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAvLyBlbXB0eSBsaW5lIG9yIGJlaGluZCBlb2xcbiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZSByYW5nZSBhcyBpcywgaXQgd2lsbCBiZSByZW5kZXJlZCAxY2ggd2lkZVxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB3b3JkID0gbW9kZWwuZ2V0V29yZEF0UG9zaXRpb24ocmV0LmdldFN0YXJ0UG9zaXRpb24oKSk7XG4gICAgICAgICAgICBpZiAod29yZCkge1xuICAgICAgICAgICAgICAgIHJldCA9IG5ldyBSYW5nZShyZXQuc3RhcnRMaW5lTnVtYmVyLCB3b3JkLnN0YXJ0Q29sdW1uLCByZXQuZW5kTGluZU51bWJlciwgd29yZC5lbmRDb2x1bW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJhd01hcmtlci5lbmRDb2x1bW4gPT09IE51bWJlci5NQVhfVkFMVUUgJiYgcmF3TWFya2VyLnN0YXJ0Q29sdW1uID09PSAxICYmIHJldC5zdGFydExpbmVOdW1iZXIgPT09IHJldC5lbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICBjb25zdCBtaW5Db2x1bW4gPSBtb2RlbC5nZXRMaW5lRmlyc3ROb25XaGl0ZXNwYWNlQ29sdW1uKHJhd01hcmtlci5zdGFydExpbmVOdW1iZXIpO1xuICAgICAgICAgICAgaWYgKG1pbkNvbHVtbiA8IHJldC5lbmRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICByZXQgPSBuZXcgUmFuZ2UocmV0LnN0YXJ0TGluZU51bWJlciwgbWluQ29sdW1uLCByZXQuZW5kTGluZU51bWJlciwgcmV0LmVuZENvbHVtbik7XG4gICAgICAgICAgICAgICAgcmF3TWFya2VyLnN0YXJ0Q29sdW1uID0gbWluQ29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIF9jcmVhdGVEZWNvcmF0aW9uT3B0aW9uKG1hcmtlcikge1xuICAgICAgICBsZXQgY2xhc3NOYW1lO1xuICAgICAgICBsZXQgY29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIGxldCB6SW5kZXg7XG4gICAgICAgIGxldCBpbmxpbmVDbGFzc05hbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIGxldCBtaW5pbWFwO1xuICAgICAgICBzd2l0Y2ggKG1hcmtlci5zZXZlcml0eSkge1xuICAgICAgICAgICAgY2FzZSBNYXJrZXJTZXZlcml0eS5IaW50OlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9oYXNNYXJrZXJUYWcobWFya2VyLCAyIC8qIE1hcmtlclRhZy5EZXByZWNhdGVkICovKSkge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2hhc01hcmtlclRhZyhtYXJrZXIsIDEgLyogTWFya2VyVGFnLlVubmVjZXNzYXJ5ICovKSkge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcInNxdWlnZ2x5LXVubmVjZXNzYXJ5XCIgLyogQ2xhc3NOYW1lLkVkaXRvclVubmVjZXNzYXJ5RGVjb3JhdGlvbiAqLztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwic3F1aWdnbHktaGludFwiIC8qIENsYXNzTmFtZS5FZGl0b3JIaW50RGVjb3JhdGlvbiAqLztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgekluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgTWFya2VyU2V2ZXJpdHkuSW5mbzpcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcInNxdWlnZ2x5LWluZm9cIiAvKiBDbGFzc05hbWUuRWRpdG9ySW5mb0RlY29yYXRpb24gKi87XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9yRnJvbUlkKG92ZXJ2aWV3UnVsZXJJbmZvKTtcbiAgICAgICAgICAgICAgICB6SW5kZXggPSAxMDtcbiAgICAgICAgICAgICAgICBtaW5pbWFwID0ge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVDb2xvckZyb21JZChtaW5pbWFwSW5mbyksXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAxIC8qIE1pbmltYXBQb3NpdGlvbi5JbmxpbmUgKi9cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBNYXJrZXJTZXZlcml0eS5XYXJuaW5nOlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFwic3F1aWdnbHktd2FybmluZ1wiIC8qIENsYXNzTmFtZS5FZGl0b3JXYXJuaW5nRGVjb3JhdGlvbiAqLztcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JGcm9tSWQob3ZlcnZpZXdSdWxlcldhcm5pbmcpO1xuICAgICAgICAgICAgICAgIHpJbmRleCA9IDIwO1xuICAgICAgICAgICAgICAgIG1pbmltYXAgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZUNvbG9yRnJvbUlkKG1pbmltYXBXYXJuaW5nKSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IDEgLyogTWluaW1hcFBvc2l0aW9uLklubGluZSAqL1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5LkVycm9yOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBcInNxdWlnZ2x5LWVycm9yXCIgLyogQ2xhc3NOYW1lLkVkaXRvckVycm9yRGVjb3JhdGlvbiAqLztcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JGcm9tSWQob3ZlcnZpZXdSdWxlckVycm9yKTtcbiAgICAgICAgICAgICAgICB6SW5kZXggPSAzMDtcbiAgICAgICAgICAgICAgICBtaW5pbWFwID0ge1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVDb2xvckZyb21JZChtaW5pbWFwRXJyb3IpLFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogMSAvKiBNaW5pbWFwUG9zaXRpb24uSW5saW5lICovXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAobWFya2VyLnRhZ3MpIHtcbiAgICAgICAgICAgIGlmIChtYXJrZXIudGFncy5pbmRleE9mKDEgLyogTWFya2VyVGFnLlVubmVjZXNzYXJ5ICovKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBpbmxpbmVDbGFzc05hbWUgPSBcInNxdWlnZ2x5LWlubGluZS11bm5lY2Vzc2FyeVwiIC8qIENsYXNzTmFtZS5FZGl0b3JVbm5lY2Vzc2FyeUlubGluZURlY29yYXRpb24gKi87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWFya2VyLnRhZ3MuaW5kZXhPZigyIC8qIE1hcmtlclRhZy5EZXByZWNhdGVkICovKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBpbmxpbmVDbGFzc05hbWUgPSBcInNxdWlnZ2x5LWlubGluZS1kZXByZWNhdGVkXCIgLyogQ2xhc3NOYW1lLkVkaXRvckRlcHJlY2F0ZWRJbmxpbmVEZWNvcmF0aW9uICovO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ21hcmtlci1kZWNvcmF0aW9uJyxcbiAgICAgICAgICAgIHN0aWNraW5lc3M6IDEgLyogVHJhY2tlZFJhbmdlU3RpY2tpbmVzcy5OZXZlckdyb3dzV2hlblR5cGluZ0F0RWRnZXMgKi8sXG4gICAgICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgICAgICBzaG93SWZDb2xsYXBzZWQ6IHRydWUsXG4gICAgICAgICAgICBvdmVydmlld1J1bGVyOiB7XG4gICAgICAgICAgICAgICAgY29sb3IsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IE92ZXJ2aWV3UnVsZXJMYW5lLlJpZ2h0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWluaW1hcCxcbiAgICAgICAgICAgIHpJbmRleCxcbiAgICAgICAgICAgIGlubGluZUNsYXNzTmFtZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgX2hhc01hcmtlclRhZyhtYXJrZXIsIHRhZykge1xuICAgICAgICBpZiAobWFya2VyLnRhZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXIudGFncy5pbmRleE9mKHRhZykgPj0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuIiwiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBjcmVhdGVEZWNvcmF0b3IgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9pbnN0YW50aWF0aW9uL2NvbW1vbi9pbnN0YW50aWF0aW9uLmpzJztcbmV4cG9ydCBjb25zdCBJTW9kZWxTZXJ2aWNlID0gY3JlYXRlRGVjb3JhdG9yKCdtb2RlbFNlcnZpY2UnKTtcbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IFNldmVyaXR5IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3NldmVyaXR5LmpzJztcbmltcG9ydCB7IGxvY2FsaXplIH0gZnJvbSAnLi4vLi4vLi4vbmxzLmpzJztcbmltcG9ydCB7IGNyZWF0ZURlY29yYXRvciB9IGZyb20gJy4uLy4uL2luc3RhbnRpYXRpb24vY29tbW9uL2luc3RhbnRpYXRpb24uanMnO1xuZXhwb3J0IHZhciBNYXJrZXJTZXZlcml0eTtcbihmdW5jdGlvbiAoTWFya2VyU2V2ZXJpdHkpIHtcbiAgICBNYXJrZXJTZXZlcml0eVtNYXJrZXJTZXZlcml0eVtcIkhpbnRcIl0gPSAxXSA9IFwiSGludFwiO1xuICAgIE1hcmtlclNldmVyaXR5W01hcmtlclNldmVyaXR5W1wiSW5mb1wiXSA9IDJdID0gXCJJbmZvXCI7XG4gICAgTWFya2VyU2V2ZXJpdHlbTWFya2VyU2V2ZXJpdHlbXCJXYXJuaW5nXCJdID0gNF0gPSBcIldhcm5pbmdcIjtcbiAgICBNYXJrZXJTZXZlcml0eVtNYXJrZXJTZXZlcml0eVtcIkVycm9yXCJdID0gOF0gPSBcIkVycm9yXCI7XG59KShNYXJrZXJTZXZlcml0eSB8fCAoTWFya2VyU2V2ZXJpdHkgPSB7fSkpO1xuKGZ1bmN0aW9uIChNYXJrZXJTZXZlcml0eSkge1xuICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikge1xuICAgICAgICByZXR1cm4gYiAtIGE7XG4gICAgfVxuICAgIE1hcmtlclNldmVyaXR5LmNvbXBhcmUgPSBjb21wYXJlO1xuICAgIGNvbnN0IF9kaXNwbGF5U3RyaW5ncyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgX2Rpc3BsYXlTdHJpbmdzW01hcmtlclNldmVyaXR5LkVycm9yXSA9IGxvY2FsaXplKCdzZXYuZXJyb3InLCBcIkVycm9yXCIpO1xuICAgIF9kaXNwbGF5U3RyaW5nc1tNYXJrZXJTZXZlcml0eS5XYXJuaW5nXSA9IGxvY2FsaXplKCdzZXYud2FybmluZycsIFwiV2FybmluZ1wiKTtcbiAgICBfZGlzcGxheVN0cmluZ3NbTWFya2VyU2V2ZXJpdHkuSW5mb10gPSBsb2NhbGl6ZSgnc2V2LmluZm8nLCBcIkluZm9cIik7XG4gICAgZnVuY3Rpb24gdG9TdHJpbmcoYSkge1xuICAgICAgICByZXR1cm4gX2Rpc3BsYXlTdHJpbmdzW2FdIHx8ICcnO1xuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS50b1N0cmluZyA9IHRvU3RyaW5nO1xuICAgIGZ1bmN0aW9uIGZyb21TZXZlcml0eShzZXZlcml0eSkge1xuICAgICAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICAgICAgICBjYXNlIFNldmVyaXR5LkVycm9yOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuRXJyb3I7XG4gICAgICAgICAgICBjYXNlIFNldmVyaXR5Lldhcm5pbmc6IHJldHVybiBNYXJrZXJTZXZlcml0eS5XYXJuaW5nO1xuICAgICAgICAgICAgY2FzZSBTZXZlcml0eS5JbmZvOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuSW5mbztcbiAgICAgICAgICAgIGNhc2UgU2V2ZXJpdHkuSWdub3JlOiByZXR1cm4gTWFya2VyU2V2ZXJpdHkuSGludDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS5mcm9tU2V2ZXJpdHkgPSBmcm9tU2V2ZXJpdHk7XG4gICAgZnVuY3Rpb24gdG9TZXZlcml0eShzZXZlcml0eSkge1xuICAgICAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5LkVycm9yOiByZXR1cm4gU2V2ZXJpdHkuRXJyb3I7XG4gICAgICAgICAgICBjYXNlIE1hcmtlclNldmVyaXR5Lldhcm5pbmc6IHJldHVybiBTZXZlcml0eS5XYXJuaW5nO1xuICAgICAgICAgICAgY2FzZSBNYXJrZXJTZXZlcml0eS5JbmZvOiByZXR1cm4gU2V2ZXJpdHkuSW5mbztcbiAgICAgICAgICAgIGNhc2UgTWFya2VyU2V2ZXJpdHkuSGludDogcmV0dXJuIFNldmVyaXR5Lklnbm9yZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBNYXJrZXJTZXZlcml0eS50b1NldmVyaXR5ID0gdG9TZXZlcml0eTtcbn0pKE1hcmtlclNldmVyaXR5IHx8IChNYXJrZXJTZXZlcml0eSA9IHt9KSk7XG5leHBvcnQgdmFyIElNYXJrZXJEYXRhO1xuKGZ1bmN0aW9uIChJTWFya2VyRGF0YSkge1xuICAgIGNvbnN0IGVtcHR5U3RyaW5nID0gJyc7XG4gICAgZnVuY3Rpb24gbWFrZUtleShtYXJrZXJEYXRhKSB7XG4gICAgICAgIHJldHVybiBtYWtlS2V5T3B0aW9uYWxNZXNzYWdlKG1hcmtlckRhdGEsIHRydWUpO1xuICAgIH1cbiAgICBJTWFya2VyRGF0YS5tYWtlS2V5ID0gbWFrZUtleTtcbiAgICBmdW5jdGlvbiBtYWtlS2V5T3B0aW9uYWxNZXNzYWdlKG1hcmtlckRhdGEsIHVzZU1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW2VtcHR5U3RyaW5nXTtcbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc291cmNlKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChtYXJrZXJEYXRhLnNvdXJjZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuY29kZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXJrZXJEYXRhLmNvZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobWFya2VyRGF0YS5jb2RlLnJlcGxhY2UoJ8KmJywgJ1xcXFzCpicpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuY29kZS52YWx1ZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc2V2ZXJpdHkgIT09IHVuZGVmaW5lZCAmJiBtYXJrZXJEYXRhLnNldmVyaXR5ICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChNYXJrZXJTZXZlcml0eS50b1N0cmluZyhtYXJrZXJEYXRhLnNldmVyaXR5KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTW9kaWZlZCB0byBub3QgaW5jbHVkZSB0aGUgbWVzc2FnZSBhcyBwYXJ0IG9mIHRoZSBtYXJrZXIga2V5IHRvIHdvcmsgYXJvdW5kXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy83NzQ3NVxuICAgICAgICBpZiAobWFya2VyRGF0YS5tZXNzYWdlICYmIHVzZU1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEubWVzc2FnZS5yZXBsYWNlKCfCpicsICdcXFxcwqYnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuc3RhcnRMaW5lTnVtYmVyICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5zdGFydExpbmVOdW1iZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuc3RhcnRMaW5lTnVtYmVyLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goZW1wdHlTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXJrZXJEYXRhLnN0YXJ0Q29sdW1uICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5zdGFydENvbHVtbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2gobWFya2VyRGF0YS5zdGFydENvbHVtbi50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGVtcHR5U3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWFya2VyRGF0YS5lbmRMaW5lTnVtYmVyICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5lbmRMaW5lTnVtYmVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChtYXJrZXJEYXRhLmVuZExpbmVOdW1iZXIudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbXB0eVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtlckRhdGEuZW5kQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgbWFya2VyRGF0YS5lbmRDb2x1bW4gIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcmtlckRhdGEuZW5kQ29sdW1uLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goZW1wdHlTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5wdXNoKGVtcHR5U3RyaW5nKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCfCpicpO1xuICAgIH1cbiAgICBJTWFya2VyRGF0YS5tYWtlS2V5T3B0aW9uYWxNZXNzYWdlID0gbWFrZUtleU9wdGlvbmFsTWVzc2FnZTtcbn0pKElNYXJrZXJEYXRhIHx8IChJTWFya2VyRGF0YSA9IHt9KSk7XG5leHBvcnQgY29uc3QgSU1hcmtlclNlcnZpY2UgPSBjcmVhdGVEZWNvcmF0b3IoJ21hcmtlclNlcnZpY2UnKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==