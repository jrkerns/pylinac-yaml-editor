"use strict";(self.webpackChunkpylinac_yaml_editor=self.webpackChunkpylinac_yaml_editor||[]).push([[6995,5996],{5996:(e,i,n)=>{n.r(i),n.d(i,{clearPlatformLanguageAssociations:()=>h,getLanguageIds:()=>d,registerPlatformLanguageAssociation:()=>c});var t=n(3958),a=n(3720),s=n(3072),r=n(8019),o=n(2467),g=n(6844),l=n(4957);let u=[],f=[],m=[];function c(e,i=!1){!function(e,i,n){const a=function(e){return{id:e.id,mime:e.mime,filename:e.filename,extension:e.extension,filepattern:e.filepattern,firstline:e.firstline,userConfigured:false,filenameLowercase:e.filename?e.filename.toLowerCase():void 0,extensionLowercase:e.extension?e.extension.toLowerCase():void 0,filepatternLowercase:e.filepattern?(0,t.qg)(e.filepattern.toLowerCase()):void 0,filepatternOnPath:!!e.filepattern&&e.filepattern.indexOf(r.SA.sep)>=0}}(e);u.push(a),a.userConfigured?m.push(a):f.push(a),n&&!a.userConfigured&&u.forEach((e=>{e.mime===a.mime||e.userConfigured||(a.extension&&e.extension===a.extension&&console.warn(`Overwriting extension <<${a.extension}>> to now point to mime <<${a.mime}>>`),a.filename&&e.filename===a.filename&&console.warn(`Overwriting filename <<${a.filename}>> to now point to mime <<${a.mime}>>`),a.filepattern&&e.filepattern===a.filepattern&&console.warn(`Overwriting filepattern <<${a.filepattern}>> to now point to mime <<${a.mime}>>`),a.firstline&&e.firstline===a.firstline&&console.warn(`Overwriting firstline <<${a.firstline}>> to now point to mime <<${a.mime}>>`))}))}(e,0,i)}function h(){u=u.filter((e=>e.userConfigured)),f=[]}function d(e,i){return function(e,i){let n;if(e)switch(e.scheme){case s.ny.file:n=e.fsPath;break;case s.ny.data:n=o.B6.parseMetaData(e).get(o.B6.META_DATA_LABEL);break;case s.ny.vscodeNotebookCell:n=void 0;break;default:n=e.path}if(!n)return[{id:"unknown",mime:a.K.unknown}];n=n.toLowerCase();const t=(0,r.P8)(n),c=p(n,t,m);if(c)return[c,{id:l.vH,mime:a.K.text}];const h=p(n,t,f);if(h)return[h,{id:l.vH,mime:a.K.text}];if(i){const e=function(e){if((0,g.LU)(e)&&(e=e.substr(1)),e.length>0)for(let i=u.length-1;i>=0;i--){const n=u[i];if(!n.firstline)continue;const t=e.match(n.firstline);if(t&&t.length>0)return n}}(i);if(e)return[e,{id:l.vH,mime:a.K.text}]}return[{id:"unknown",mime:a.K.unknown}]}(e,i).map((e=>e.id))}function p(e,i,n){let t,a,s;for(let r=n.length-1;r>=0;r--){const o=n[r];if(i===o.filenameLowercase){t=o;break}if(o.filepattern&&(!a||o.filepattern.length>a.filepattern.length)){const n=o.filepatternOnPath?e:i;o.filepatternLowercase?.(n)&&(a=o)}o.extension&&(!s||o.extension.length>s.extension.length)&&i.endsWith(o.extensionLowercase)&&(s=o)}return t||a||s||void 0}},6995:(e,i,n)=>{n.r(i),n.d(i,{LanguageIdCodec:()=>m,LanguagesRegistry:()=>c});var t=n(2106),a=n(998),s=n(6844),r=n(5996),o=n(4957),g=n(7142),l=n(7167);const u=Object.prototype.hasOwnProperty,f="vs.editor.nullLanguage";class m{constructor(){this._languageIdToLanguage=[],this._languageToLanguageId=new Map,this._register(f,0),this._register(o.vH,1),this._nextLanguageId=2}_register(e,i){this._languageIdToLanguage[i]=e,this._languageToLanguageId.set(e,i)}register(e){if(this._languageToLanguageId.has(e))return;const i=this._nextLanguageId++;this._register(e,i)}encodeLanguageId(e){return this._languageToLanguageId.get(e)||0}decodeLanguageId(e){return this._languageIdToLanguage[e]||f}}class c extends a.jG{static{this.instanceCount=0}constructor(e=!0,i=!1){super(),this._onDidChange=this._register(new t.vl),this.onDidChange=this._onDidChange.event,c.instanceCount++,this._warnOnOverwrite=i,this.languageIdCodec=new m,this._dynamicLanguages=[],this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},e&&(this._initializeFromRegistry(),this._register(o.W6.onDidChangeLanguages((e=>{this._initializeFromRegistry()}))))}dispose(){c.instanceCount--,super.dispose()}_initializeFromRegistry(){this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},(0,r.clearPlatformLanguageAssociations)();const e=[].concat(o.W6.getLanguages()).concat(this._dynamicLanguages);this._registerLanguages(e)}_registerLanguages(e){for(const i of e)this._registerLanguage(i);this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},Object.keys(this._languages).forEach((e=>{const i=this._languages[e];i.name&&(this._nameMap[i.name]=i.identifier),i.aliases.forEach((e=>{this._lowercaseNameMap[e.toLowerCase()]=i.identifier})),i.mimetypes.forEach((e=>{this._mimeTypesMap[e]=i.identifier}))})),l.O.as(g.Fd.Configuration).registerOverrideIdentifiers(this.getRegisteredLanguageIds()),this._onDidChange.fire()}_registerLanguage(e){const i=e.id;let n;u.call(this._languages,i)?n=this._languages[i]:(this.languageIdCodec.register(i),n={identifier:i,name:null,mimetypes:[],aliases:[],extensions:[],filenames:[],configurationFiles:[],icons:[]},this._languages[i]=n),this._mergeLanguage(n,e)}_mergeLanguage(e,i){const n=i.id;let t=null;if(Array.isArray(i.mimetypes)&&i.mimetypes.length>0&&(e.mimetypes.push(...i.mimetypes),t=i.mimetypes[0]),t||(t=`text/x-${n}`,e.mimetypes.push(t)),Array.isArray(i.extensions)){i.configuration?e.extensions=i.extensions.concat(e.extensions):e.extensions=e.extensions.concat(i.extensions);for(const e of i.extensions)(0,r.registerPlatformLanguageAssociation)({id:n,mime:t,extension:e},this._warnOnOverwrite)}if(Array.isArray(i.filenames))for(const a of i.filenames)(0,r.registerPlatformLanguageAssociation)({id:n,mime:t,filename:a},this._warnOnOverwrite),e.filenames.push(a);if(Array.isArray(i.filenamePatterns))for(const e of i.filenamePatterns)(0,r.registerPlatformLanguageAssociation)({id:n,mime:t,filepattern:e},this._warnOnOverwrite);if("string"==typeof i.firstLine&&i.firstLine.length>0){let e=i.firstLine;"^"!==e.charAt(0)&&(e="^"+e);try{const i=new RegExp(e);(0,s.eY)(i)||(0,r.registerPlatformLanguageAssociation)({id:n,mime:t,firstline:i},this._warnOnOverwrite)}catch(n){console.warn(`[${i.id}]: Invalid regular expression \`${e}\`: `,n)}}e.aliases.push(n);let a=null;if(void 0!==i.aliases&&Array.isArray(i.aliases)&&(a=0===i.aliases.length?[null]:i.aliases),null!==a)for(const i of a)i&&0!==i.length&&e.aliases.push(i);const o=null!==a&&a.length>0;if(o&&null===a[0]);else{const i=(o?a[0]:null)||n;!o&&e.name||(e.name=i)}i.configuration&&e.configurationFiles.push(i.configuration),i.icon&&e.icons.push(i.icon)}isRegisteredLanguageId(e){return!!e&&u.call(this._languages,e)}getRegisteredLanguageIds(){return Object.keys(this._languages)}getLanguageIdByLanguageName(e){const i=e.toLowerCase();return u.call(this._lowercaseNameMap,i)?this._lowercaseNameMap[i]:null}getLanguageIdByMimeType(e){return e&&u.call(this._mimeTypesMap,e)?this._mimeTypesMap[e]:null}guessLanguageIdByFilepathOrFirstLine(e,i){return e||i?(0,r.getLanguageIds)(e,i):[]}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bUJBQW1CdEcsS0FBS2lHLEVBQUtXLGVBRTlDWCxFQUFLdUIsTUFDTHRCLEVBQWlCSyxNQUFNdkcsS0FBS2lHLEVBQUt1QixLQUV6QyxDQUNBLHNCQUFBQyxDQUF1Qm5FLEdBQ25CLFFBQUtBLEdBR0ViLEVBQWUwRCxLQUFLcEQsS0FBS3VCLFdBQVloQixFQUNoRCxDQUNBLHdCQUFBeUMsR0FDSSxPQUFPckQsT0FBTzBDLEtBQUtyQyxLQUFLdUIsV0FDNUIsQ0FDQSwyQkFBQW9ELENBQTRCQyxHQUN4QixNQUFNQyxFQUFvQkQsRUFBYW5JLGNBQ3ZDLE9BQUtpRCxFQUFlMEQsS0FBS3BELEtBQUswQixrQkFBbUJtRCxHQUcxQzdFLEtBQUswQixrQkFBa0JtRCxHQUZuQixJQUdmLENBQ0EsdUJBQUFDLENBQXdCQyxHQUNwQixPQUFLQSxHQUdEckYsRUFBZTBELEtBQUtwRCxLQUFLd0IsY0FBZXVELEdBQ2pDL0UsS0FBS3dCLGNBQWN1RCxHQUhuQixJQU1mLENBQ0Esb0NBQUFDLENBQXFDdEgsRUFBVUMsR0FDM0MsT0FBS0QsR0FBYUMsR0FHWCxJQUFBRixnQkFBZUMsRUFBVUMsR0FGckIsRUFHZixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHlsaW5hYy15YW1sLWVkaXRvci8uL25vZGVfbW9kdWxlcy9tb25hY28tZWRpdG9yL2VzbS92cy9lZGl0b3IvY29tbW9uL3NlcnZpY2VzL2xhbmd1YWdlc0Fzc29jaWF0aW9ucy5qcyIsIndlYnBhY2s6Ly9weWxpbmFjLXlhbWwtZWRpdG9yLy4vbm9kZV9tb2R1bGVzL21vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9jb21tb24vc2VydmljZXMvbGFuZ3VhZ2VzUmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2dsb2IuanMnO1xuaW1wb3J0IHsgTWltZXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9taW1lLmpzJztcbmltcG9ydCB7IFNjaGVtYXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9uZXR3b3JrLmpzJztcbmltcG9ydCB7IGJhc2VuYW1lLCBwb3NpeCB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3BhdGguanMnO1xuaW1wb3J0IHsgRGF0YVVyaSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3Jlc291cmNlcy5qcyc7XG5pbXBvcnQgeyBzdGFydHNXaXRoVVRGOEJPTSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3N0cmluZ3MuanMnO1xuaW1wb3J0IHsgUExBSU5URVhUX0xBTkdVQUdFX0lEIH0gZnJvbSAnLi4vbGFuZ3VhZ2VzL21vZGVzUmVnaXN0cnkuanMnO1xubGV0IHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMgPSBbXTtcbmxldCBub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyA9IFtdO1xubGV0IHVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gW107XG4vKipcbiAqIEFzc29jaWF0ZSBhIGxhbmd1YWdlIHRvIHRoZSByZWdpc3RyeSAocGxhdGZvcm0pLlxuICogKiAqKk5PVEUqKjogVGhpcyBhc3NvY2lhdGlvbiB3aWxsIGxvc2Ugb3ZlciBhc3NvY2lhdGlvbnMgcmVnaXN0ZXJlZCB1c2luZyBgcmVnaXN0ZXJDb25maWd1cmVkTGFuZ3VhZ2VBc3NvY2lhdGlvbmAuXG4gKiAqICoqTk9URSoqOiBVc2UgYGNsZWFyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uc2AgdG8gcmVtb3ZlIGFsbCBhc3NvY2lhdGlvbnMgcmVnaXN0ZXJlZCB1c2luZyB0aGlzIGZ1bmN0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJQbGF0Zm9ybUxhbmd1YWdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb24sIHdhcm5Pbk92ZXJ3cml0ZSA9IGZhbHNlKSB7XG4gICAgX3JlZ2lzdGVyTGFuZ3VhZ2VBc3NvY2lhdGlvbihhc3NvY2lhdGlvbiwgZmFsc2UsIHdhcm5Pbk92ZXJ3cml0ZSk7XG59XG5mdW5jdGlvbiBfcmVnaXN0ZXJMYW5ndWFnZUFzc29jaWF0aW9uKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCwgd2Fybk9uT3ZlcndyaXRlKSB7XG4gICAgLy8gUmVnaXN0ZXJcbiAgICBjb25zdCBhc3NvY2lhdGlvbkl0ZW0gPSB0b0xhbmd1YWdlQXNzb2NpYXRpb25JdGVtKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCk7XG4gICAgcmVnaXN0ZXJlZEFzc29jaWF0aW9ucy5wdXNoKGFzc29jaWF0aW9uSXRlbSk7XG4gICAgaWYgKCFhc3NvY2lhdGlvbkl0ZW0udXNlckNvbmZpZ3VyZWQpIHtcbiAgICAgICAgbm9uVXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbkl0ZW0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdXNlclJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMucHVzaChhc3NvY2lhdGlvbkl0ZW0pO1xuICAgIH1cbiAgICAvLyBDaGVjayBmb3IgY29uZmxpY3RzIHVubGVzcyB0aGlzIGlzIGEgdXNlciBjb25maWd1cmVkIGFzc29jaWF0aW9uXG4gICAgaWYgKHdhcm5Pbk92ZXJ3cml0ZSAmJiAhYXNzb2NpYXRpb25JdGVtLnVzZXJDb25maWd1cmVkKSB7XG4gICAgICAgIHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMuZm9yRWFjaChhID0+IHtcbiAgICAgICAgICAgIGlmIChhLm1pbWUgPT09IGFzc29jaWF0aW9uSXRlbS5taW1lIHx8IGEudXNlckNvbmZpZ3VyZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIHNhbWUgbWltZSBvciB1c2VyQ29uZmlndXJlZCBpcyBva1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uSXRlbS5leHRlbnNpb24gJiYgYS5leHRlbnNpb24gPT09IGFzc29jaWF0aW9uSXRlbS5leHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE92ZXJ3cml0aW5nIGV4dGVuc2lvbiA8PCR7YXNzb2NpYXRpb25JdGVtLmV4dGVuc2lvbn0+PiB0byBub3cgcG9pbnQgdG8gbWltZSA8PCR7YXNzb2NpYXRpb25JdGVtLm1pbWV9Pj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbkl0ZW0uZmlsZW5hbWUgJiYgYS5maWxlbmFtZSA9PT0gYXNzb2NpYXRpb25JdGVtLmZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBPdmVyd3JpdGluZyBmaWxlbmFtZSA8PCR7YXNzb2NpYXRpb25JdGVtLmZpbGVuYW1lfT4+IHRvIG5vdyBwb2ludCB0byBtaW1lIDw8JHthc3NvY2lhdGlvbkl0ZW0ubWltZX0+PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uSXRlbS5maWxlcGF0dGVybiAmJiBhLmZpbGVwYXR0ZXJuID09PSBhc3NvY2lhdGlvbkl0ZW0uZmlsZXBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYE92ZXJ3cml0aW5nIGZpbGVwYXR0ZXJuIDw8JHthc3NvY2lhdGlvbkl0ZW0uZmlsZXBhdHRlcm59Pj4gdG8gbm93IHBvaW50IHRvIG1pbWUgPDwke2Fzc29jaWF0aW9uSXRlbS5taW1lfT4+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXNzb2NpYXRpb25JdGVtLmZpcnN0bGluZSAmJiBhLmZpcnN0bGluZSA9PT0gYXNzb2NpYXRpb25JdGVtLmZpcnN0bGluZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgT3ZlcndyaXRpbmcgZmlyc3RsaW5lIDw8JHthc3NvY2lhdGlvbkl0ZW0uZmlyc3RsaW5lfT4+IHRvIG5vdyBwb2ludCB0byBtaW1lIDw8JHthc3NvY2lhdGlvbkl0ZW0ubWltZX0+PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiB0b0xhbmd1YWdlQXNzb2NpYXRpb25JdGVtKGFzc29jaWF0aW9uLCB1c2VyQ29uZmlndXJlZCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBhc3NvY2lhdGlvbi5pZCxcbiAgICAgICAgbWltZTogYXNzb2NpYXRpb24ubWltZSxcbiAgICAgICAgZmlsZW5hbWU6IGFzc29jaWF0aW9uLmZpbGVuYW1lLFxuICAgICAgICBleHRlbnNpb246IGFzc29jaWF0aW9uLmV4dGVuc2lvbixcbiAgICAgICAgZmlsZXBhdHRlcm46IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuLFxuICAgICAgICBmaXJzdGxpbmU6IGFzc29jaWF0aW9uLmZpcnN0bGluZSxcbiAgICAgICAgdXNlckNvbmZpZ3VyZWQ6IHVzZXJDb25maWd1cmVkLFxuICAgICAgICBmaWxlbmFtZUxvd2VyY2FzZTogYXNzb2NpYXRpb24uZmlsZW5hbWUgPyBhc3NvY2lhdGlvbi5maWxlbmFtZS50b0xvd2VyQ2FzZSgpIDogdW5kZWZpbmVkLFxuICAgICAgICBleHRlbnNpb25Mb3dlcmNhc2U6IGFzc29jaWF0aW9uLmV4dGVuc2lvbiA/IGFzc29jaWF0aW9uLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpIDogdW5kZWZpbmVkLFxuICAgICAgICBmaWxlcGF0dGVybkxvd2VyY2FzZTogYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4gPyBwYXJzZShhc3NvY2lhdGlvbi5maWxlcGF0dGVybi50b0xvd2VyQ2FzZSgpKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZmlsZXBhdHRlcm5PblBhdGg6IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuID8gYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4uaW5kZXhPZihwb3NpeC5zZXApID49IDAgOiBmYWxzZVxuICAgIH07XG59XG4vKipcbiAqIENsZWFyIGxhbmd1YWdlIGFzc29jaWF0aW9ucyBmcm9tIHRoZSByZWdpc3RyeSAocGxhdGZvcm0pLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJQbGF0Zm9ybUxhbmd1YWdlQXNzb2NpYXRpb25zKCkge1xuICAgIHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMgPSByZWdpc3RlcmVkQXNzb2NpYXRpb25zLmZpbHRlcihhID0+IGEudXNlckNvbmZpZ3VyZWQpO1xuICAgIG5vblVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zID0gW107XG59XG4vKipcbiAqIEBzZWUgYGdldE1pbWVUeXBlc2BcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldExhbmd1YWdlSWRzKHJlc291cmNlLCBmaXJzdExpbmUpIHtcbiAgICByZXR1cm4gZ2V0QXNzb2NpYXRpb25zKHJlc291cmNlLCBmaXJzdExpbmUpLm1hcChpdGVtID0+IGl0ZW0uaWQpO1xufVxuZnVuY3Rpb24gZ2V0QXNzb2NpYXRpb25zKHJlc291cmNlLCBmaXJzdExpbmUpIHtcbiAgICBsZXQgcGF0aDtcbiAgICBpZiAocmVzb3VyY2UpIHtcbiAgICAgICAgc3dpdGNoIChyZXNvdXJjZS5zY2hlbWUpIHtcbiAgICAgICAgICAgIGNhc2UgU2NoZW1hcy5maWxlOlxuICAgICAgICAgICAgICAgIHBhdGggPSByZXNvdXJjZS5mc1BhdGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNjaGVtYXMuZGF0YToge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gRGF0YVVyaS5wYXJzZU1ldGFEYXRhKHJlc291cmNlKTtcbiAgICAgICAgICAgICAgICBwYXRoID0gbWV0YWRhdGEuZ2V0KERhdGFVcmkuTUVUQV9EQVRBX0xBQkVMKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgU2NoZW1hcy52c2NvZGVOb3RlYm9va0NlbGw6XG4gICAgICAgICAgICAgICAgLy8gRmlsZSBwYXRoIG5vdCByZWxldmFudCBmb3IgbGFuZ3VhZ2UgZGV0ZWN0aW9uIG9mIGNlbGxcbiAgICAgICAgICAgICAgICBwYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBwYXRoID0gcmVzb3VyY2UucGF0aDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgcmV0dXJuIFt7IGlkOiAndW5rbm93bicsIG1pbWU6IE1pbWVzLnVua25vd24gfV07XG4gICAgfVxuICAgIHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZmlsZW5hbWUgPSBiYXNlbmFtZShwYXRoKTtcbiAgICAvLyAxLikgVXNlciBjb25maWd1cmVkIG1hcHBpbmdzIGhhdmUgaGlnaGVzdCBwcmlvcml0eVxuICAgIGNvbnN0IGNvbmZpZ3VyZWRMYW5ndWFnZSA9IGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCB1c2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyk7XG4gICAgaWYgKGNvbmZpZ3VyZWRMYW5ndWFnZSkge1xuICAgICAgICByZXR1cm4gW2NvbmZpZ3VyZWRMYW5ndWFnZSwgeyBpZDogUExBSU5URVhUX0xBTkdVQUdFX0lELCBtaW1lOiBNaW1lcy50ZXh0IH1dO1xuICAgIH1cbiAgICAvLyAyLikgUmVnaXN0ZXJlZCBtYXBwaW5ncyBoYXZlIG1pZGRsZSBwcmlvcml0eVxuICAgIGNvbnN0IHJlZ2lzdGVyZWRMYW5ndWFnZSA9IGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCBub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyk7XG4gICAgaWYgKHJlZ2lzdGVyZWRMYW5ndWFnZSkge1xuICAgICAgICByZXR1cm4gW3JlZ2lzdGVyZWRMYW5ndWFnZSwgeyBpZDogUExBSU5URVhUX0xBTkdVQUdFX0lELCBtaW1lOiBNaW1lcy50ZXh0IH1dO1xuICAgIH1cbiAgICAvLyAzLikgRmlyc3RsaW5lIGhhcyBsb3dlc3QgcHJpb3JpdHlcbiAgICBpZiAoZmlyc3RMaW5lKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0bGluZUxhbmd1YWdlID0gZ2V0QXNzb2NpYXRpb25CeUZpcnN0bGluZShmaXJzdExpbmUpO1xuICAgICAgICBpZiAoZmlyc3RsaW5lTGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBbZmlyc3RsaW5lTGFuZ3VhZ2UsIHsgaWQ6IFBMQUlOVEVYVF9MQU5HVUFHRV9JRCwgbWltZTogTWltZXMudGV4dCB9XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW3sgaWQ6ICd1bmtub3duJywgbWltZTogTWltZXMudW5rbm93biB9XTtcbn1cbmZ1bmN0aW9uIGdldEFzc29jaWF0aW9uQnlQYXRoKHBhdGgsIGZpbGVuYW1lLCBhc3NvY2lhdGlvbnMpIHtcbiAgICBsZXQgZmlsZW5hbWVNYXRjaCA9IHVuZGVmaW5lZDtcbiAgICBsZXQgcGF0dGVybk1hdGNoID0gdW5kZWZpbmVkO1xuICAgIGxldCBleHRlbnNpb25NYXRjaCA9IHVuZGVmaW5lZDtcbiAgICAvLyBXZSB3YW50IHRvIHByaW9yaXRpemUgYXNzb2NpYXRpb25zIGJhc2VkIG9uIHRoZSBvcmRlciB0aGV5IGFyZSByZWdpc3RlcmVkIHNvIHRoYXQgdGhlIGxhc3QgcmVnaXN0ZXJlZFxuICAgIC8vIGFzc29jaWF0aW9uIHdpbnMgb3ZlciBhbGwgb3RoZXIuIFRoaXMgaXMgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy8yMDA3NFxuICAgIGZvciAobGV0IGkgPSBhc3NvY2lhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgYXNzb2NpYXRpb24gPSBhc3NvY2lhdGlvbnNbaV07XG4gICAgICAgIC8vIEZpcnN0IGV4YWN0IG5hbWUgbWF0Y2hcbiAgICAgICAgaWYgKGZpbGVuYW1lID09PSBhc3NvY2lhdGlvbi5maWxlbmFtZUxvd2VyY2FzZSkge1xuICAgICAgICAgICAgZmlsZW5hbWVNYXRjaCA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgYnJlYWs7IC8vIHRha2UgaXQhXG4gICAgICAgIH1cbiAgICAgICAgLy8gTG9uZ2VzdCBwYXR0ZXJuIG1hdGNoXG4gICAgICAgIGlmIChhc3NvY2lhdGlvbi5maWxlcGF0dGVybikge1xuICAgICAgICAgICAgaWYgKCFwYXR0ZXJuTWF0Y2ggfHwgYXNzb2NpYXRpb24uZmlsZXBhdHRlcm4ubGVuZ3RoID4gcGF0dGVybk1hdGNoLmZpbGVwYXR0ZXJuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGFzc29jaWF0aW9uLmZpbGVwYXR0ZXJuT25QYXRoID8gcGF0aCA6IGZpbGVuYW1lOyAvLyBtYXRjaCBvbiBmdWxsIHBhdGggaWYgcGF0dGVybiBjb250YWlucyBwYXRoIHNlcGFyYXRvclxuICAgICAgICAgICAgICAgIGlmIChhc3NvY2lhdGlvbi5maWxlcGF0dGVybkxvd2VyY2FzZT8uKHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk1hdGNoID0gYXNzb2NpYXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIExvbmdlc3QgZXh0ZW5zaW9uIG1hdGNoXG4gICAgICAgIGlmIChhc3NvY2lhdGlvbi5leHRlbnNpb24pIHtcbiAgICAgICAgICAgIGlmICghZXh0ZW5zaW9uTWF0Y2ggfHwgYXNzb2NpYXRpb24uZXh0ZW5zaW9uLmxlbmd0aCA+IGV4dGVuc2lvbk1hdGNoLmV4dGVuc2lvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZW5hbWUuZW5kc1dpdGgoYXNzb2NpYXRpb24uZXh0ZW5zaW9uTG93ZXJjYXNlKSkge1xuICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25NYXRjaCA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyAxLikgRXhhY3QgbmFtZSBtYXRjaCBoYXMgc2Vjb25kIGhpZ2hlc3QgcHJpb3JpdHlcbiAgICBpZiAoZmlsZW5hbWVNYXRjaCkge1xuICAgICAgICByZXR1cm4gZmlsZW5hbWVNYXRjaDtcbiAgICB9XG4gICAgLy8gMi4pIE1hdGNoIG9uIHBhdHRlcm5cbiAgICBpZiAocGF0dGVybk1hdGNoKSB7XG4gICAgICAgIHJldHVybiBwYXR0ZXJuTWF0Y2g7XG4gICAgfVxuICAgIC8vIDMuKSBNYXRjaCBvbiBleHRlbnNpb24gY29tZXMgbmV4dFxuICAgIGlmIChleHRlbnNpb25NYXRjaCkge1xuICAgICAgICByZXR1cm4gZXh0ZW5zaW9uTWF0Y2g7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiBnZXRBc3NvY2lhdGlvbkJ5Rmlyc3RsaW5lKGZpcnN0TGluZSkge1xuICAgIGlmIChzdGFydHNXaXRoVVRGOEJPTShmaXJzdExpbmUpKSB7XG4gICAgICAgIGZpcnN0TGluZSA9IGZpcnN0TGluZS5zdWJzdHIoMSk7XG4gICAgfVxuICAgIGlmIChmaXJzdExpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBXZSB3YW50IHRvIHByaW9yaXRpemUgYXNzb2NpYXRpb25zIGJhc2VkIG9uIHRoZSBvcmRlciB0aGV5IGFyZSByZWdpc3RlcmVkIHNvIHRoYXQgdGhlIGxhc3QgcmVnaXN0ZXJlZFxuICAgICAgICAvLyBhc3NvY2lhdGlvbiB3aW5zIG92ZXIgYWxsIG90aGVyLiBUaGlzIGlzIGZvciBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvMjAwNzRcbiAgICAgICAgZm9yIChsZXQgaSA9IHJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IGFzc29jaWF0aW9uID0gcmVnaXN0ZXJlZEFzc29jaWF0aW9uc1tpXTtcbiAgICAgICAgICAgIGlmICghYXNzb2NpYXRpb24uZmlyc3RsaW5lKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gZmlyc3RMaW5lLm1hdGNoKGFzc29jaWF0aW9uLmZpcnN0bGluZSk7XG4gICAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzb2NpYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiIsIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2V2ZW50LmpzJztcbmltcG9ydCB7IERpc3Bvc2FibGUgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9saWZlY3ljbGUuanMnO1xuaW1wb3J0IHsgcmVnRXhwTGVhZHNUb0VuZGxlc3NMb29wIH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vc3RyaW5ncy5qcyc7XG5pbXBvcnQgeyBjbGVhclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbnMsIGdldExhbmd1YWdlSWRzLCByZWdpc3RlclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbiB9IGZyb20gJy4vbGFuZ3VhZ2VzQXNzb2NpYXRpb25zLmpzJztcbmltcG9ydCB7IE1vZGVzUmVnaXN0cnksIFBMQUlOVEVYVF9MQU5HVUFHRV9JRCB9IGZyb20gJy4uL2xhbmd1YWdlcy9tb2Rlc1JlZ2lzdHJ5LmpzJztcbmltcG9ydCB7IEV4dGVuc2lvbnMgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9jb25maWd1cmF0aW9uL2NvbW1vbi9jb25maWd1cmF0aW9uUmVnaXN0cnkuanMnO1xuaW1wb3J0IHsgUmVnaXN0cnkgfSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9yZWdpc3RyeS9jb21tb24vcGxhdGZvcm0uanMnO1xuY29uc3QgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xuY29uc3QgTlVMTF9MQU5HVUFHRV9JRCA9ICd2cy5lZGl0b3IubnVsbExhbmd1YWdlJztcbmV4cG9ydCBjbGFzcyBMYW5ndWFnZUlkQ29kZWMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9sYW5ndWFnZUlkVG9MYW5ndWFnZSA9IFtdO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZVRvTGFuZ3VhZ2VJZCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXIoTlVMTF9MQU5HVUFHRV9JRCwgMCAvKiBMYW5ndWFnZUlkLk51bGwgKi8pO1xuICAgICAgICB0aGlzLl9yZWdpc3RlcihQTEFJTlRFWFRfTEFOR1VBR0VfSUQsIDEgLyogTGFuZ3VhZ2VJZC5QbGFpblRleHQgKi8pO1xuICAgICAgICB0aGlzLl9uZXh0TGFuZ3VhZ2VJZCA9IDI7XG4gICAgfVxuICAgIF9yZWdpc3RlcihsYW5ndWFnZSwgbGFuZ3VhZ2VJZCkge1xuICAgICAgICB0aGlzLl9sYW5ndWFnZUlkVG9MYW5ndWFnZVtsYW5ndWFnZUlkXSA9IGxhbmd1YWdlO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZVRvTGFuZ3VhZ2VJZC5zZXQobGFuZ3VhZ2UsIGxhbmd1YWdlSWQpO1xuICAgIH1cbiAgICByZWdpc3RlcihsYW5ndWFnZSkge1xuICAgICAgICBpZiAodGhpcy5fbGFuZ3VhZ2VUb0xhbmd1YWdlSWQuaGFzKGxhbmd1YWdlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlSWQgPSB0aGlzLl9uZXh0TGFuZ3VhZ2VJZCsrO1xuICAgICAgICB0aGlzLl9yZWdpc3RlcihsYW5ndWFnZSwgbGFuZ3VhZ2VJZCk7XG4gICAgfVxuICAgIGVuY29kZUxhbmd1YWdlSWQobGFuZ3VhZ2VJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGFuZ3VhZ2VUb0xhbmd1YWdlSWQuZ2V0KGxhbmd1YWdlSWQpIHx8IDAgLyogTGFuZ3VhZ2VJZC5OdWxsICovO1xuICAgIH1cbiAgICBkZWNvZGVMYW5ndWFnZUlkKGxhbmd1YWdlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhbmd1YWdlSWRUb0xhbmd1YWdlW2xhbmd1YWdlSWRdIHx8IE5VTExfTEFOR1VBR0VfSUQ7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIExhbmd1YWdlc1JlZ2lzdHJ5IGV4dGVuZHMgRGlzcG9zYWJsZSB7XG4gICAgc3RhdGljIHsgdGhpcy5pbnN0YW5jZUNvdW50ID0gMDsgfVxuICAgIGNvbnN0cnVjdG9yKHVzZU1vZGVzUmVnaXN0cnkgPSB0cnVlLCB3YXJuT25PdmVyd3JpdGUgPSBmYWxzZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9vbkRpZENoYW5nZSA9IHRoaXMuX3JlZ2lzdGVyKG5ldyBFbWl0dGVyKCkpO1xuICAgICAgICB0aGlzLm9uRGlkQ2hhbmdlID0gdGhpcy5fb25EaWRDaGFuZ2UuZXZlbnQ7XG4gICAgICAgIExhbmd1YWdlc1JlZ2lzdHJ5Lmluc3RhbmNlQ291bnQrKztcbiAgICAgICAgdGhpcy5fd2Fybk9uT3ZlcndyaXRlID0gd2Fybk9uT3ZlcndyaXRlO1xuICAgICAgICB0aGlzLmxhbmd1YWdlSWRDb2RlYyA9IG5ldyBMYW5ndWFnZUlkQ29kZWMoKTtcbiAgICAgICAgdGhpcy5fZHluYW1pY0xhbmd1YWdlcyA9IFtdO1xuICAgICAgICB0aGlzLl9sYW5ndWFnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5fbWltZVR5cGVzTWFwID0ge307XG4gICAgICAgIHRoaXMuX25hbWVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcCA9IHt9O1xuICAgICAgICBpZiAodXNlTW9kZXNSZWdpc3RyeSkge1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZUZyb21SZWdpc3RyeSgpO1xuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXIoTW9kZXNSZWdpc3RyeS5vbkRpZENoYW5nZUxhbmd1YWdlcygobSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVGcm9tUmVnaXN0cnkoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBMYW5ndWFnZXNSZWdpc3RyeS5pbnN0YW5jZUNvdW50LS07XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgX2luaXRpYWxpemVGcm9tUmVnaXN0cnkoKSB7XG4gICAgICAgIHRoaXMuX2xhbmd1YWdlcyA9IHt9O1xuICAgICAgICB0aGlzLl9taW1lVHlwZXNNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbmFtZU1hcCA9IHt9O1xuICAgICAgICB0aGlzLl9sb3dlcmNhc2VOYW1lTWFwID0ge307XG4gICAgICAgIGNsZWFyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9ucygpO1xuICAgICAgICBjb25zdCBkZXNjID0gW10uY29uY2F0KE1vZGVzUmVnaXN0cnkuZ2V0TGFuZ3VhZ2VzKCkpLmNvbmNhdCh0aGlzLl9keW5hbWljTGFuZ3VhZ2VzKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXJMYW5ndWFnZXMoZGVzYyk7XG4gICAgfVxuICAgIF9yZWdpc3Rlckxhbmd1YWdlcyhkZXNjKSB7XG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBkZXNjKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWdpc3Rlckxhbmd1YWdlKGQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlYnVpbGQgZmFzdCBwYXRoIG1hcHNcbiAgICAgICAgdGhpcy5fbWltZVR5cGVzTWFwID0ge307XG4gICAgICAgIHRoaXMuX25hbWVNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcCA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLl9sYW5ndWFnZXMpLmZvckVhY2goKGxhbmdJZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSB0aGlzLl9sYW5ndWFnZXNbbGFuZ0lkXTtcbiAgICAgICAgICAgIGlmIChsYW5ndWFnZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmFtZU1hcFtsYW5ndWFnZS5uYW1lXSA9IGxhbmd1YWdlLmlkZW50aWZpZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYW5ndWFnZS5hbGlhc2VzLmZvckVhY2goKGFsaWFzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG93ZXJjYXNlTmFtZU1hcFthbGlhcy50b0xvd2VyQ2FzZSgpXSA9IGxhbmd1YWdlLmlkZW50aWZpZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxhbmd1YWdlLm1pbWV0eXBlcy5mb3JFYWNoKChtaW1ldHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX21pbWVUeXBlc01hcFttaW1ldHlwZV0gPSBsYW5ndWFnZS5pZGVudGlmaWVyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBSZWdpc3RyeS5hcyhFeHRlbnNpb25zLkNvbmZpZ3VyYXRpb24pLnJlZ2lzdGVyT3ZlcnJpZGVJZGVudGlmaWVycyh0aGlzLmdldFJlZ2lzdGVyZWRMYW5ndWFnZUlkcygpKTtcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2UuZmlyZSgpO1xuICAgIH1cbiAgICBfcmVnaXN0ZXJMYW5ndWFnZShsYW5nKSB7XG4gICAgICAgIGNvbnN0IGxhbmdJZCA9IGxhbmcuaWQ7XG4gICAgICAgIGxldCByZXNvbHZlZExhbmd1YWdlO1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sYW5ndWFnZXMsIGxhbmdJZCkpIHtcbiAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UgPSB0aGlzLl9sYW5ndWFnZXNbbGFuZ0lkXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2VJZENvZGVjLnJlZ2lzdGVyKGxhbmdJZCk7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlID0ge1xuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGxhbmdJZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBudWxsLFxuICAgICAgICAgICAgICAgIG1pbWV0eXBlczogW10sXG4gICAgICAgICAgICAgICAgYWxpYXNlczogW10sXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uczogW10sXG4gICAgICAgICAgICAgICAgZmlsZW5hbWVzOiBbXSxcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uRmlsZXM6IFtdLFxuICAgICAgICAgICAgICAgIGljb25zOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuX2xhbmd1YWdlc1tsYW5nSWRdID0gcmVzb2x2ZWRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tZXJnZUxhbmd1YWdlKHJlc29sdmVkTGFuZ3VhZ2UsIGxhbmcpO1xuICAgIH1cbiAgICBfbWVyZ2VMYW5ndWFnZShyZXNvbHZlZExhbmd1YWdlLCBsYW5nKSB7XG4gICAgICAgIGNvbnN0IGxhbmdJZCA9IGxhbmcuaWQ7XG4gICAgICAgIGxldCBwcmltYXJ5TWltZSA9IG51bGw7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcubWltZXR5cGVzKSAmJiBsYW5nLm1pbWV0eXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLm1pbWV0eXBlcy5wdXNoKC4uLmxhbmcubWltZXR5cGVzKTtcbiAgICAgICAgICAgIHByaW1hcnlNaW1lID0gbGFuZy5taW1ldHlwZXNbMF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwcmltYXJ5TWltZSkge1xuICAgICAgICAgICAgcHJpbWFyeU1pbWUgPSBgdGV4dC94LSR7bGFuZ0lkfWA7XG4gICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLm1pbWV0eXBlcy5wdXNoKHByaW1hcnlNaW1lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsYW5nLmV4dGVuc2lvbnMpKSB7XG4gICAgICAgICAgICBpZiAobGFuZy5jb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gaW5zZXJ0IGZpcnN0IGFzIHRoaXMgYXBwZWFycyB0byBiZSB0aGUgJ3ByaW1hcnknIGxhbmd1YWdlIGRlZmluaXRpb25cbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMgPSBsYW5nLmV4dGVuc2lvbnMuY29uY2F0KHJlc29sdmVkTGFuZ3VhZ2UuZXh0ZW5zaW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMgPSByZXNvbHZlZExhbmd1YWdlLmV4dGVuc2lvbnMuY29uY2F0KGxhbmcuZXh0ZW5zaW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGV4dGVuc2lvbiBvZiBsYW5nLmV4dGVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbih7IGlkOiBsYW5nSWQsIG1pbWU6IHByaW1hcnlNaW1lLCBleHRlbnNpb246IGV4dGVuc2lvbiB9LCB0aGlzLl93YXJuT25PdmVyd3JpdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcuZmlsZW5hbWVzKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlbmFtZSBvZiBsYW5nLmZpbGVuYW1lcykge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpbGVuYW1lOiBmaWxlbmFtZSB9LCB0aGlzLl93YXJuT25PdmVyd3JpdGUpO1xuICAgICAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuZmlsZW5hbWVzLnB1c2goZmlsZW5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxhbmcuZmlsZW5hbWVQYXR0ZXJucykpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZW5hbWVQYXR0ZXJuIG9mIGxhbmcuZmlsZW5hbWVQYXR0ZXJucykge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpbGVwYXR0ZXJuOiBmaWxlbmFtZVBhdHRlcm4gfSwgdGhpcy5fd2Fybk9uT3ZlcndyaXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGxhbmcuZmlyc3RMaW5lID09PSAnc3RyaW5nJyAmJiBsYW5nLmZpcnN0TGluZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBsZXQgZmlyc3RMaW5lUmVnZXhTdHIgPSBsYW5nLmZpcnN0TGluZTtcbiAgICAgICAgICAgIGlmIChmaXJzdExpbmVSZWdleFN0ci5jaGFyQXQoMCkgIT09ICdeJykge1xuICAgICAgICAgICAgICAgIGZpcnN0TGluZVJlZ2V4U3RyID0gJ14nICsgZmlyc3RMaW5lUmVnZXhTdHI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0TGluZVJlZ2V4ID0gbmV3IFJlZ0V4cChmaXJzdExpbmVSZWdleFN0cik7XG4gICAgICAgICAgICAgICAgaWYgKCFyZWdFeHBMZWFkc1RvRW5kbGVzc0xvb3AoZmlyc3RMaW5lUmVnZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyUGxhdGZvcm1MYW5ndWFnZUFzc29jaWF0aW9uKHsgaWQ6IGxhbmdJZCwgbWltZTogcHJpbWFyeU1pbWUsIGZpcnN0bGluZTogZmlyc3RMaW5lUmVnZXggfSwgdGhpcy5fd2Fybk9uT3ZlcndyaXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgLy8gTW9zdCBsaWtlbHksIHRoZSByZWdleCB3YXMgYmFkXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbJHtsYW5nLmlkfV06IEludmFsaWQgcmVndWxhciBleHByZXNzaW9uIFxcYCR7Zmlyc3RMaW5lUmVnZXhTdHJ9XFxgOiBgLCBlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuYWxpYXNlcy5wdXNoKGxhbmdJZCk7XG4gICAgICAgIGxldCBsYW5nQWxpYXNlcyA9IG51bGw7XG4gICAgICAgIGlmICh0eXBlb2YgbGFuZy5hbGlhc2VzICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheS5pc0FycmF5KGxhbmcuYWxpYXNlcykpIHtcbiAgICAgICAgICAgIGlmIChsYW5nLmFsaWFzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gc2lnbmFsIHRoYXQgdGhpcyBsYW5ndWFnZSBzaG91bGQgbm90IGdldCBhIG5hbWVcbiAgICAgICAgICAgICAgICBsYW5nQWxpYXNlcyA9IFtudWxsXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxhbmdBbGlhc2VzID0gbGFuZy5hbGlhc2VzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5nQWxpYXNlcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBsYW5nQWxpYXMgb2YgbGFuZ0FsaWFzZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWxhbmdBbGlhcyB8fCBsYW5nQWxpYXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlZExhbmd1YWdlLmFsaWFzZXMucHVzaChsYW5nQWxpYXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zQWxpYXNlcyA9IChsYW5nQWxpYXNlcyAhPT0gbnVsbCAmJiBsYW5nQWxpYXNlcy5sZW5ndGggPiAwKTtcbiAgICAgICAgaWYgKGNvbnRhaW5zQWxpYXNlcyAmJiBsYW5nQWxpYXNlc1swXSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gc2lnbmFsIHRoYXQgdGhpcyBsYW5ndWFnZSBzaG91bGQgbm90IGdldCBhIG5hbWVcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGJlc3ROYW1lID0gKGNvbnRhaW5zQWxpYXNlcyA/IGxhbmdBbGlhc2VzWzBdIDogbnVsbCkgfHwgbGFuZ0lkO1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5zQWxpYXNlcyB8fCAhcmVzb2x2ZWRMYW5ndWFnZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZWRMYW5ndWFnZS5uYW1lID0gYmVzdE5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhbmcuY29uZmlndXJhdGlvbikge1xuICAgICAgICAgICAgcmVzb2x2ZWRMYW5ndWFnZS5jb25maWd1cmF0aW9uRmlsZXMucHVzaChsYW5nLmNvbmZpZ3VyYXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5nLmljb24pIHtcbiAgICAgICAgICAgIHJlc29sdmVkTGFuZ3VhZ2UuaWNvbnMucHVzaChsYW5nLmljb24pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzUmVnaXN0ZXJlZExhbmd1YWdlSWQobGFuZ3VhZ2VJZCkge1xuICAgICAgICBpZiAoIWxhbmd1YWdlSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sYW5ndWFnZXMsIGxhbmd1YWdlSWQpO1xuICAgIH1cbiAgICBnZXRSZWdpc3RlcmVkTGFuZ3VhZ2VJZHMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9sYW5ndWFnZXMpO1xuICAgIH1cbiAgICBnZXRMYW5ndWFnZUlkQnlMYW5ndWFnZU5hbWUobGFuZ3VhZ2VOYW1lKSB7XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlTmFtZUxvd2VyID0gbGFuZ3VhZ2VOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9sb3dlcmNhc2VOYW1lTWFwLCBsYW5ndWFnZU5hbWVMb3dlcikpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9sb3dlcmNhc2VOYW1lTWFwW2xhbmd1YWdlTmFtZUxvd2VyXTtcbiAgICB9XG4gICAgZ2V0TGFuZ3VhZ2VJZEJ5TWltZVR5cGUobWltZVR5cGUpIHtcbiAgICAgICAgaWYgKCFtaW1lVHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodGhpcy5fbWltZVR5cGVzTWFwLCBtaW1lVHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taW1lVHlwZXNNYXBbbWltZVR5cGVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBndWVzc0xhbmd1YWdlSWRCeUZpbGVwYXRoT3JGaXJzdExpbmUocmVzb3VyY2UsIGZpcnN0TGluZSkge1xuICAgICAgICBpZiAoIXJlc291cmNlICYmICFmaXJzdExpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ2V0TGFuZ3VhZ2VJZHMocmVzb3VyY2UsIGZpcnN0TGluZSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbInJlZ2lzdGVyZWRBc3NvY2lhdGlvbnMiLCJub25Vc2VyUmVnaXN0ZXJlZEFzc29jaWF0aW9ucyIsInVzZXJSZWdpc3RlcmVkQXNzb2NpYXRpb25zIiwicmVnaXN0ZXJQbGF0Zm9ybUxhbmd1YWdlQXNzb2NpYXRpb24iLCJhc3NvY2lhdGlvbiIsIndhcm5Pbk92ZXJ3cml0ZSIsInVzZXJDb25maWd1cmVkIiwiYXNzb2NpYXRpb25JdGVtIiwiaWQiLCJtaW1lIiwiZmlsZW5hbWUiLCJleHRlbnNpb24iLCJmaWxlcGF0dGVybiIsImZpcnN0bGluZSIsImZpbGVuYW1lTG93ZXJjYXNlIiwidG9Mb3dlckNhc2UiLCJ1bmRlZmluZWQiLCJleHRlbnNpb25Mb3dlcmNhc2UiLCJmaWxlcGF0dGVybkxvd2VyY2FzZSIsImZpbGVwYXR0ZXJuT25QYXRoIiwiaW5kZXhPZiIsInNlcCIsInRvTGFuZ3VhZ2VBc3NvY2lhdGlvbkl0ZW0iLCJwdXNoIiwiZm9yRWFjaCIsImEiLCJjb25zb2xlIiwid2FybiIsIl9yZWdpc3Rlckxhbmd1YWdlQXNzb2NpYXRpb24iLCJjbGVhclBsYXRmb3JtTGFuZ3VhZ2VBc3NvY2lhdGlvbnMiLCJmaWx0ZXIiLCJnZXRMYW5ndWFnZUlkcyIsInJlc291cmNlIiwiZmlyc3RMaW5lIiwicGF0aCIsInNjaGVtZSIsImZpbGUiLCJmc1BhdGgiLCJkYXRhIiwicGFyc2VNZXRhRGF0YSIsImdldCIsIk1FVEFfREFUQV9MQUJFTCIsInZzY29kZU5vdGVib29rQ2VsbCIsInVua25vd24iLCJjb25maWd1cmVkTGFuZ3VhZ2UiLCJnZXRBc3NvY2lhdGlvbkJ5UGF0aCIsInRleHQiLCJyZWdpc3RlcmVkTGFuZ3VhZ2UiLCJmaXJzdGxpbmVMYW5ndWFnZSIsInN1YnN0ciIsImxlbmd0aCIsImkiLCJtYXRjaGVzIiwibWF0Y2giLCJnZXRBc3NvY2lhdGlvbkJ5Rmlyc3RsaW5lIiwiZ2V0QXNzb2NpYXRpb25zIiwibWFwIiwiaXRlbSIsImFzc29jaWF0aW9ucyIsImZpbGVuYW1lTWF0Y2giLCJwYXR0ZXJuTWF0Y2giLCJleHRlbnNpb25NYXRjaCIsInRhcmdldCIsImVuZHNXaXRoIiwiaGFzT3duUHJvcGVydHkiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJOVUxMX0xBTkdVQUdFX0lEIiwiTGFuZ3VhZ2VJZENvZGVjIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiX2xhbmd1YWdlSWRUb0xhbmd1YWdlIiwiX2xhbmd1YWdlVG9MYW5ndWFnZUlkIiwiTWFwIiwiX3JlZ2lzdGVyIiwiX25leHRMYW5ndWFnZUlkIiwibGFuZ3VhZ2UiLCJsYW5ndWFnZUlkIiwic2V0IiwicmVnaXN0ZXIiLCJoYXMiLCJlbmNvZGVMYW5ndWFnZUlkIiwiZGVjb2RlTGFuZ3VhZ2VJZCIsIkxhbmd1YWdlc1JlZ2lzdHJ5IiwiaW5zdGFuY2VDb3VudCIsInVzZU1vZGVzUmVnaXN0cnkiLCJzdXBlciIsIl9vbkRpZENoYW5nZSIsIm9uRGlkQ2hhbmdlIiwiZXZlbnQiLCJfd2Fybk9uT3ZlcndyaXRlIiwibGFuZ3VhZ2VJZENvZGVjIiwiX2R5bmFtaWNMYW5ndWFnZXMiLCJfbGFuZ3VhZ2VzIiwiX21pbWVUeXBlc01hcCIsIl9uYW1lTWFwIiwiX2xvd2VyY2FzZU5hbWVNYXAiLCJfaW5pdGlhbGl6ZUZyb21SZWdpc3RyeSIsIm9uRGlkQ2hhbmdlTGFuZ3VhZ2VzIiwibSIsImRpc3Bvc2UiLCJkZXNjIiwiY29uY2F0IiwiZ2V0TGFuZ3VhZ2VzIiwiX3JlZ2lzdGVyTGFuZ3VhZ2VzIiwiZCIsIl9yZWdpc3Rlckxhbmd1YWdlIiwia2V5cyIsImxhbmdJZCIsIm5hbWUiLCJpZGVudGlmaWVyIiwiYWxpYXNlcyIsImFsaWFzIiwibWltZXR5cGVzIiwibWltZXR5cGUiLCJhcyIsIkNvbmZpZ3VyYXRpb24iLCJyZWdpc3Rlck92ZXJyaWRlSWRlbnRpZmllcnMiLCJnZXRSZWdpc3RlcmVkTGFuZ3VhZ2VJZHMiLCJmaXJlIiwibGFuZyIsInJlc29sdmVkTGFuZ3VhZ2UiLCJjYWxsIiwiZXh0ZW5zaW9ucyIsImZpbGVuYW1lcyIsImNvbmZpZ3VyYXRpb25GaWxlcyIsImljb25zIiwiX21lcmdlTGFuZ3VhZ2UiLCJwcmltYXJ5TWltZSIsIkFycmF5IiwiaXNBcnJheSIsImNvbmZpZ3VyYXRpb24iLCJmaWxlbmFtZVBhdHRlcm5zIiwiZmlsZW5hbWVQYXR0ZXJuIiwiZmlyc3RMaW5lUmVnZXhTdHIiLCJjaGFyQXQiLCJmaXJzdExpbmVSZWdleCIsIlJlZ0V4cCIsImVyciIsImxhbmdBbGlhc2VzIiwibGFuZ0FsaWFzIiwiY29udGFpbnNBbGlhc2VzIiwiYmVzdE5hbWUiLCJpY29uIiwiaXNSZWdpc3RlcmVkTGFuZ3VhZ2VJZCIsImdldExhbmd1YWdlSWRCeUxhbmd1YWdlTmFtZSIsImxhbmd1YWdlTmFtZSIsImxhbmd1YWdlTmFtZUxvd2VyIiwiZ2V0TGFuZ3VhZ2VJZEJ5TWltZVR5cGUiLCJtaW1lVHlwZSIsImd1ZXNzTGFuZ3VhZ2VJZEJ5RmlsZXBhdGhPckZpcnN0TGluZSJdLCJzb3VyY2VSb290IjoiIn0=